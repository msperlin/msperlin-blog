% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  11pt,
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1.5in, textwidth=6in, textheight=9in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.61,0.61,0.61}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.14,0.14,0.14}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.43,0.43,0.43}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{imakeidx}
\makeindex

% pkg for chapter heading
\usepackage[Lenny]{fncychap}

\usepackage{textcomp}
%\usepackage[english]{babel}
\usepackage[brazil]{babel}

%\usepackage[pdfpagelabels,draft,implicit=false]{hyperref}

%\frontmatter
%\usepackage{fontspec}
%\setmainfont{Times Roman}
%\usepackage[urw-garamond]{mathdesign}
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}
%\hypersetup{hidelinks=true}

%\frontmatter

% Code for rmdimportant and rmdcaution boxes

%\usepackage{xcolor}         % Extended colors
%\usepackage{color}         % Color extended names
%\usepackage[many]{tcolorbox}

\usepackage{awesomebox}


\newenvironment{rmdcaution}
{\begin{cautionblock}

} {\end{cautionblock}}


\newenvironment{rmdimportant}
{\begin{importantblock}

	} {\end{importantblock}}


\newenvironment{pleasebuyit}
{\begin{noteblock}
		
	} {\end{noteblock}}

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Análise de Dados Financeiros e Econômicos com o R - Versão Online},
  pdfauthor={Marcelo S. Perlin (marcelo.perlin@ufrgs.br)},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Análise de Dados Financeiros e Econômicos com o R - Versão Online}
\author{Marcelo S. Perlin (\href{mailto:marcelo.perlin@ufrgs.br}{\nolinkurl{marcelo.perlin@ufrgs.br}})}
\date{2022-11-23}

\begin{document}
\maketitle

\thispagestyle{empty}

\begin{tabular}{@{}l }
	\textbf{Análise de Dados Financeiros e Econômicos com o R}   \\
	{} \\
	por \textbf{Marcelo Scherer Perlin}
\end{tabular}

\vspace{0.75cm}

\begin{tabular}{@{}l }
	{\textcopyright} 2021 Marcelo S. Perlin. All rights reserved.
\end{tabular}

\begin{tabular}{@{}l }
	Publicação Independente. Impresso sob demanda por Amazon.com. \\
	Versão Online disponível em \textit{https://www.msperlin.com/adfeR/}
\end{tabular}


\vspace{0.75cm}

\begin{tabular}{@{} ll}
	\textbf{Revisão de texto:} & Diversos  \\
	\textbf{Capa:} & Rubens Lima - http://capista.com.br/  \\
	\textbf{ISBN (paperback):} & 9798707107559 \\
	\textbf{ISBN (hardcover):} & 9798711081821 \\
\end{tabular}

\vspace{0.5cm}

\begin{tabular}{@{} ll}
	\textbf{Histórico de edições:} &   \\
	  Primeira edição: & 2017-03-01 \\
	  Segunda edição: & 2018-07-01 \\
	  Terceira edição: &  2021-03-01 \\	  
\end{tabular}


\vspace{0.5cm}

Embora o autor tenha boa fé para garantir que as instruções e o código contidos neste trabalho sejam precisos, ele se exime de toda responsabilidade por erros ou omissões, incluindo, sem limitação, a responsabilidade por danos resultantes do uso ou da confiança neste trabalho e em seus resultados. O uso das informações contidas neste trabalho é por sua conta e risco. Se qualquer código deste livro estiver sujeito a licenças de código aberto ou direitos de propriedade intelectual de terceiros, o cumprimento desses direitos e licenças é de sua responsabilidade como usuário.

Todo o código contigo no livro é disponibilizado pela generosa licença do \href{https://opensource.org/licenses/MIT}{MIT}. Portanto, sinta-se livre para utilizá-lo no seu trabalho, desde de que a origem do código seja citada. Uma sugestão de citação é disponibilizada abaixo:

Perlin, M. S. Análise de Dados Financeiros com o R. Terceira Edição, Porto Alegre: Marcelo S. Perlin (publicação independente), 2021.

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\hypertarget{sobre-nova-ediuxe7uxe3o}{%
\chapter*{Sobre Nova Edição}\label{sobre-nova-ediuxe7uxe3o}}
\addcontentsline{toc}{chapter}{Sobre Nova Edição}

Desde a última edição do livro em 2018, muita coisa mudou. O ecossistema do R e RStudio tem evoluído de forma constante. Em um esforço de atualização, tenho enorme prazer em publicar a terceira edição de ``Análise de Dados Financeiros e Econômicos com o R''. É gratificante perceber que, como um bom vinho, o conteúdo do livro só melhora com o tempo.

O diferencial da terceira edição é o \textbf{foco no leitor}. As principais mudanças são:

\begin{itemize}
\item
  Todo o conteúdo do livro agora é disponibilizado via \textbf{pacote \texttt{adfeR}}, facilitando muito a reprodução de todos os exemplos de código.
\item
  Uso de \textbf{caixas de textos customizadas} para indicar pontos importantes e precauções que os leitores devem ter em cada seção do livro.
\item
  Mais de \textbf{100 exercícios de final de capítulo} foram criados e agora possuem gabarito em texto e código, disponível na versão \href{https://www.msperlin.com/adfeR}{web do livro}\footnote{\url{https://www.msperlin.com/adfeR}}. Todos os exercícios estão disponíveis no formato \texttt{exams} \citep{R-exams} e podem ser compilados para um pdf ou então exportados para plataformas de \emph{e-learning}, tal como o \emph{Moodle} ou \emph{Blackboard} (veja seção \emph{Conteúdo para Instrutores} no Prefácio).
\item
  \textbf{Quatro novos pacotes} especializados na obtenção de dados financeiros e econômicos estão inclusos na nova edição. São estes: \texttt{GetDFPData2}, \texttt{GetFREData}, \texttt{GetQuandlData} e \texttt{GetBCBData}. Todos são pacotes estáveis, desenvolvidos por mim e serão mantidos ao longo do tempo. Assim, não corremos mais o risco de quebra de código devido a desatualização de um pacote por um autor.
\item
  Um novo capítulo sobre \textbf{Otimização de Código em R}, discutindo melhorias na estrutura de código e também minimização do tempo de execução via estratégias de cacheamento local e processamento paralelo.
\item
  Uso de \textbf{template customizado} para o ebook e html via CSS (\emph{Cascading Style Sheets}). Agora, o livro possui, sem dúvida, uma cara própria e consistente entre os diferentes formatos.
\end{itemize}

Este livro é um projeto vitalício que pretendo atualizar frequentemente. Vejo neste trabalho uma maneira de contribuir para a formação profissional de uma nova geração de pesquisadores e analistas de mercado. Espero que goste da obra e use-a para tornar o R um aliado no seu ciclo de trabalho.

\hypertarget{prefuxe1cio}{%
\chapter*{Prefácio}\label{prefuxe1cio}}
\addcontentsline{toc}{chapter}{Prefácio}

Dado que se interessou por este livro, prevejo que você é um aluno de pós-graduação dando os primeiros passos em pesquisa com dados, ou é um profissional experiente procurando conhecer novas ferramentas para utilizar em seu trabalho. Em ambos os casos, este livro é para você. \textbf{A finalidade e objeto deste trabalho é introduzir o leitor ao uso do R como ferramenta de computação e análise de dados, com uma ênfase especial para pesquisa empírica no tópico de Finanças e Economia.} Ao final deste livro você irá aprender como utilizar o R para importar e manipular dados e, por fim, reportar tabelas e figuras de uma pesquisa em um relatório técnico.

Este livro é o resultado do meu trabalho como docente na Escola de Administração da Universidade Federal do Rio Grande do Sul. No programa de pós-graduação em Administração, eu leciono uma disciplina introdutória ao uso do R para resolver problemas de pesquisa na área de Finanças e Economia. Observando os alunos em sala de aula, percebo diariamente o impacto positivo que esse tipo de orientação tem em suas futuras carreiras profissionais, seja como pesquisadores acadêmicos, seja como analistas de dados em organizações públicas e privadas. Este livro é um projeto pessoal para disseminar conhecimento sobre a ferramenta para um público maior e mais diversificado.

Outra motivação que tive para escrever o livro foi minha experiência na utilização de códigos disponibilizados por outros pesquisadores em pesquisas específicas. Na maioria das vezes, esses códigos são desorganizados, pouco claros e, possivelmente, funcionam apenas no computador do pesquisador que os escreveu! Surpreendentemente, devido a desorganização, o trabalho de desvendar o código de outros professores tende a levar mais tempo do que desenvolver eu mesmo o procedimento, por mais complexo que ele fosse. Esses casos, aliás, ferem a ciência, pois um dos princípios básicos da pesquisa é a \textbf{replicabilidade} - isto é, uma rotina de pesquisa mal escrita irá reduzir a possibilidade de outras pessoas a utilizarem.

Assim como se espera que um artigo científico esteja bem escrito, também se deve esperar que o código por trás da respectiva pesquisa seja de qualidade. Porém, esse não é o caso na grande maioria das vezes. Com este livro, irei atacar esse problema, formalizando uma estrutura de código voltada à reprodutibilidade científica, focando em organização e usabilidade. Nesse sentido, espero que as futuras gerações de pesquisadores estejam mais bem preparadas para compartilhar o seu trabalho.

Antes de prosseguir, um aviso. Não iremos trabalhar usos avançados do R. O conteúdo será limitado a exemplos simples e práticos de utilização do \emph{software} para a construção de pesquisa baseada em dados financeiros e econômicos. De fato, um dos desafios na escrita deste livro foi definir o limite entre o material introdutório e o avançado. Procurei, sempre que possível, dosar gradualmente o nível de complexidade. Para leitores interessados em conhecer funções avançadas do programa e o seu funcionamento interno, sugiro a leitura do manual oficial do R \citep{teetor2011r} e de \citet{wickham2019advanced}.

Com este livro irás aprender os seguinte tópicos:

\begin{description}
\tightlist
\item[Usar o R e RStudio]
O capítulo 01 apresenta, discute e justifica o uso do R como uma plataforma de programação desenhada para resolver problemas relacionados a dados. No capítulo 02 exploraremos os comandos básicos R e os recursos do RStudio, incluindo criação de objetos, execução de \emph{scripts}, interação com o disco rígido do computador, e muito mais.
\item[Importação de dados financeiros e econômicos]
Nos capítulos 04 e 05 vamos aprender a importar dados de arquivos locais, tal como uma planilha do Excel, ou então da internet. Aprenderemos a tirar proveito da modularidade do R e, quando necessário, instalar pacotes que permitam o download de dados diversos tal como preços de ações, índices econômicos, curva de juros, dados financeiros de empresas e muito mais.
\item[Limpar, estruturar e analisar dados]
Nos capítulos 06 e 07 iremos estudar o ecossistema de objetos do R. Aprenderemos a manipular objetos tal como vetores numéricos, datas e tabelas inteiras. Nos capítulo 08 e 09 vamos estudar o uso de ferramentas de programação para resolver problemas com dados incluindo limpeza, reestruturação e também análise.
\item[Visualização de dados]
No capítulo 10 aprenderemos a usar o pacote \texttt{ggplot2} para criar visualizações do conjunto de dados, incluindo os casos mais comuns em finanças e economia, séries temporais e gráficos estatísticos.
\item[Analisar dados com econometria]
No capítulo 11 aprenderemos a usar os modelos econométricos mais populares em finanças e economia, incluindo o modelo linear, GLM, Arima e outros. Isto inclui simulação, teste de hipóteses e estimação de modelos para diversas séries de dados reais.
\item[Reporte de resultados]
No capítulo 12 veremos como reportar os resultados de sua pesquisa para um documento externo com a exportação fácil e reproduzível de tabelas e figuras. O conteúdo também inclui uma seção sobre a inovadora tecnologia \emph{RMarkdown}, a qual permite que código e texto sejam compilados conjuntamente.
\item[Melhorando o seu código]
No último capítulo do livro vamos discutir as melhores práticas de programação, incluindo análise do perfil de execução do código R, destacando pontos de gargalo e melhoria do tempo de execução com estratégias de cacheamento local, uso de código \texttt{C++} e processamento paralelo.
\end{description}

\hypertarget{material-suplementar}{%
\section*{Material Suplementar}\label{material-suplementar}}
\addcontentsline{toc}{section}{Material Suplementar}

Todo o material usado no livro, incluindo exemplos de código separados por capítulos, está publicamente disponível na Internet e distribuído com um pacote R denominado \texttt{adfeR}. Este inclui arquivos de dados, código em si, e várias funções que irão facilitar a execução dos exemplos do livro. Se você planeja, como sugerido, escrever código enquanto lê o livro, este pacote ajudará muito em sua jornada.

Para instalar este pacote no seu computador, basta executar algumas linhas de comando no R. Veja o código destacado a seguir e copie e cole o mesmo no prompt do RStudio (canto inferior esquerdo da tela, com um sinal ``\textgreater{}'') e pressione Enter para cada comando. Esteja ciente de que você precisará do R e RStudio instalados em seu computador (consulte a seção \ref{instalacao}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install devtools dependency}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}devtools\textquotesingle{}}\NormalTok{)}

\CommentTok{\# install book package}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{\textquotesingle{}msperlin/adfeR\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O que este código fará é instalar o pacote \texttt{devtools}, uma dependência necessária para instalar \href{https://github.com/msperlin/adfeR}{código do Github} -- um repositório de pacotes onde o livro está hospedado. Depois disso, uma chamada para \texttt{install\_github(\textquotesingle{}msperlin/adfeR\textquotesingle{})} irá instalar o pacote em seu computador.

Depois da instalação, todos os arquivos do livro estarão disponíveis localmente, salvos em uma pasta do seu computador. Iremos usar todos estes arquivos futuramente. Opcionalmente, caso quiser olhar os arquivos, podes copiar todo conteúdo para outra pasta com o código a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adfeR}\SpecialCharTok{::}\FunctionTok{copy\_book\_files}\NormalTok{(}\AttributeTok{path\_to\_copy =} \StringTok{\textquotesingle{}\textasciitilde{}\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Veja que o tilda (\texttt{\textasciitilde{}}) é um atalho para o diretório ``Documentos'' no Windows (ou ``home'' no Linux/Mac). Assim, o código anterior descompactará o arquivo do livro na pasta ``Documentos/adfeR-files''. O pacote também inclui várias outras funções que serão usadas ao longo do livro. Se você preferir a maneira antiga e consagrada de baixar o arquivo e descompactar manualmente, podes encontrar uma cópia no \href{https://www.msperlin.com/files/adfer-files/adfeR-code-and-data.zip}{site do livro}\footnote{\url{https://www.msperlin.com/files/adfer-files/adfeR-code-and-data.zip}}.

\hypertarget{conteuxfado-para-instrutores}{%
\section*{Conteúdo para Instrutores}\label{conteuxfado-para-instrutores}}
\addcontentsline{toc}{section}{Conteúdo para Instrutores}

Se você for um instrutor de R, aqui encontrarás muito material para usar em suas aulas:

\begin{description}
\tightlist
\item[Exercícios estáticos na internet]
Cada capítulo deste livro inclui exercícios que seus alunos podem praticar. Todas as soluções estão disponíveis na versão online do livro, disponível em \url{https://www.msperlin.com/adfeR/}.
\item[Exercícios exportáveis para pdf ou plataformas de \emph{e-learning}]
Todos exercícios do livro estão no formato \texttt{exams} \citep{R-exams} e são exportáveis para arquivos em pdf ou então para plataformas de \emph{e-learning} tal como o \emph{Moodle} ou \emph{Blackboard}. Veja este \href{https://www.msperlin.com/post/2021-02-18-dynamic-exercises-adfer/}{post no blog}\footnote{\url{https://www.msperlin.com/post/2021-02-18-dynamic-exercises-adfer/}} para maiores detalhes.
\item[Acesso ao livro na internet]
Na versão web do livro, o conteúdo integral está liberado até o capítulo 7, o qual é mais que suficiente para um curso introdutório sobre a plataforma.
\end{description}

Espero que goste deste livro. O conteúdo tem sido compilado por um longo período de tempo, a base de muito suor e, literalmente, litros de café por parte do autor.

Boa leitura!

Marcelo S. Perlin

\hypertarget{introducao}{%
\chapter{Introdução}\label{introducao}}

\textbf{Na era digital, informação é abundante e de fácil acesso}. Nota-se, em todas as áreas de conhecimento, um crescimento substancial no registro digital dos mais diversos eventos. A cada segundo, volumosos bancos de dados de diferentes empresas e organizações são alimentados com novas informações. Essa tendência impõe uma alteração significativa na forma como organizações utilizam a análise de dados na tomada de decisões. Sem dúvida, o período atual é bastante prolífico para profissionais com conhecimento e experiência na utilização das ferramentas corretas para a análise computacional de dados.

Em particular, a área de Economia e Finanças oferece grande variedade de informações disponíveis ao público. Instituições de pesquisa como IBGE, IPEA, Bancos Centrais, bolsas de valores e tantas outras, disponibilizam seus dados publicamente, seja por obrigatoriedade legal, seja para o próprio fomento da atividade de pesquisa. Hoje em dia, computadores domésticos já possuem a capacidade de processar quantidades volumosas de dados em pouco tempo. Essa evolução do aparato computacional ocorreu mais rapidamente do que o acréscimo de complexidade das metodologias utilizadas, resultando em uma diminuição significativa do tempo necessário para a execução de uma pesquisa. Ou seja, o volume de dados não é mais uma barreira de entrada para analistas.

Os métodos de processamento também avançaram em termos de complexidade. No passado, uma simples planilha eletrônica poderia dar conta do trabalho de análise. Hoje em dia, é esperado que um analista de dados ou aluno de pós-graduação saiba programar e analisar dados via código, facilitando e acelerando a obtenção de resultados, permitindo a colaboração via reproducibilidade de resultados.

É nesse ambiente que se destaca o papel do R, uma linguagem de programação voltada para a resolução de problemas computacionais envolvendo análise, processamento, visualização e modelagem de dados. Nas próximas seções, explicarei o que é o R e quais são suas vantagens frente a outras alternativas.

\hypertarget{o-que-uxe9-o-r}{%
\section{O que é o R}\label{o-que-uxe9-o-r}}

O R é uma linguagem de programação voltada para a resolução de problemas estatísticos e para a visualização gráfica de dados. O código base do R foi inspirado na linguagem \emph{S}, inicialmente criada no laboratório da \textbf{Bell/AT\&T} por \textbf{John Chambers} e seus colegas. Esse código foi reaproveitado por dois acadêmicos, \textbf{Ross Ihaka} e \textbf{Robert Gentleman}, resultando na plataforma de programação que temos hoje. Para os curiosos, o nome \emph{R} foi escolhido devido ao compartilhamento da primeira letra do nome de seus criadores.

Hoje, R é sinônimo de programação voltada à análise de dados, com uma larga base de usuários e funções bem estabelecidas. É muito provável que pesquisadores de áreas diversas, desde Economia até Biologia, ou mesmo Música, encontrem no R uma quantidade significativa de códigos que facilitem suas análises. No campo empresarial, grandes empresas como \emph{Google} e \emph{Microsoft} já o adotaram como a linguagem interna para a análise de dados. O R é atualmente mantido pelo \textbf{R Foundation} e o \href{https://www.r-consortium.org/}{\textbf{R Consortium}}, um esforço coletivo para financiar projetos de extensão da linguagem.

E o mais importante: \textbf{o R é totalmente livre} e disponível em vários sistemas operacionais. Seja você um usuário do Windows, do Linux/Unix ou do MacOS, existe uma instalação do R para a sua plataforma, e os seus códigos devem rodar entre uma e outra com mínimas alterações.

\hypertarget{por-que-escolher-o-r}{%
\section{Por que Escolher o R}\label{por-que-escolher-o-r}}

O processo de aprendizado de uma nova linguagem de programação exige muito tempo e esforço. Portanto, é importante entender as razões por trás dessa escolha. Possivelmente você esteja se perguntando por que deve optar pelo R e investir tempo em sua aprendizagem, ao invés de escolher uma outra linguagem.

Em primeiro lugar, \textbf{o R é uma plataforma madura, estável, continuamente suportada e intensamente utilizada na indústria.} Ao escolher o R, você terá a bagagem computacional necessária não somente para uma carreira acadêmica em pesquisa científica, mas também para o trabalho em organizações privadas. Nesse sentido, com a escolha de outra linguagem de programação menos popular ou proprietária/comercial, é provável que tal linguagem não seja utilizada em um ambiente empresarial e isso pode limitar as suas oportunidades profissionais futuras. Uma bagagem de conhecimento em R certamente aumenta a sua atratividade como um profissional em Finanças e Economia.

\textbf{Aprender a linguagem do R é fácil.} A experiência que tenho ensinando o R em sala de aula me permite afirmar que os alunos, mesmo aqueles sem experiência em programação, apresentam facilidade em aprender a linguagem e em utilizá-la para criar seus próprios códigos de pesquisa. A linguagem é intuitiva e certas normas e funções podem ser estendidas para diferentes casos. Após entender como o programa funciona, fica fácil descobrir novas funcionalidades partindo de uma lógica anterior. Essa notação compartilhada entre procedimentos facilita o aprendizado.

\textbf{A interface do R e RStudio torna o uso da ferramenta bastante produtivo.} A interface gráfica disponibilizada pelo \href{https://rstudio.com/}{RStudio} facilita o uso do software, assim como a produtividade do usuário. Utilizando o ambiente de trabalho do R e RStudio, têm-se a disposição diversas ferramentas que facilitam e estendem o uso da plataforma.

\textbf{Os pacotes do R permitem as mais diversas funcionalidades.} Logo veremos que o R permite o uso de código de outros usuários, os quais podem ser localmente instalados através de um simples comando. Esses estendem a linguagem básica do R e possibilitam as mais diversas funcionalidades. Podes, por exemplo, utilizar o R para mandar emails estruturados, escrever e publicar um livro, criar provas objetivas com conteúdo dinâmico, contar piadas e poemas (é sério!), acessar e coletar dados da internet, entre diversas outras funcionalidades.

\textbf{O R tem compatibilidade com diferentes linguagens e sistemas operacionais.} Se, por algum motivo, o usuário precisar utilizar código de outra linguagem de programação tal como \emph{C++}, \emph{Python}, \emph{Julia}, é fácil integrar a mesma dentro de um programa do R. Diversos pacotes estão disponíveis para facilitar esse processo. Portanto, o usuário nunca fica restrito a uma única linguagem e tem flexibilidade para escolher as suas ferramentas de trabalho.

\textbf{O R é totalmente gratuito!} O programa e todos os seus pacotes são completamente livres, não tendo custo algum de licença e distribuição. Portanto, você pode utilizá-lo e modificá-lo livremente no seu trabalho ou computador pessoal. Essa é uma razão muito forte para a adoção da linguagem em um ambiente empresarial, onde a obtenção de licenças individuais e coletivas de outros softwares comerciais pode incidir um alto custo financeiro.

\hypertarget{usos-do-r}{%
\section{Usos do R}\label{usos-do-r}}

O R é uma linguagem de programação completa e qualquer problema computacional pode ser resolvido com base nela. Dada a adoção do R por diferentes áreas de conhecimento, a lista de possibilidades é extensa. Para o caso de Finanças e Economia, destaco abaixo possíveis utilizações do programa:

\begin{itemize}
\item
  Substituir e melhorar tarefas intensivas e repetitivas dentro de ambientes corporativos, geralmente realizadas em planilhas eletrônicas;
\item
  Desenvolvimento de rotinas para administrar portfolios de investimentos e executar ordens financeiras;
\item
  Criação de ferramentas para controle, avaliação e divulgação de índices econômicos sobre um país ou região;
\item
  Execução de diversas possibilidades de pesquisa científica através da estimação de modelos econométricos e testes de hipóteses;
\item
  Criação e manutenção de \emph{websites} dinâmicos ou estáticos através do pacotes \texttt{shiny}, \texttt{blogdown} ou \texttt{distill};
\item
  Organização de um processo automatizado de criação e divulgação de relatórios técnicos com o pacote \texttt{knitr} e a tecnologia \emph{RMarkdown}.
\end{itemize}

Além dos usos destacados anteriormente, o acesso público a pacotes desenvolvidos por usuários expande ainda mais essas funcionalidades. O site da \href{https://cran.r-project.org/web/views}{CRAN (\emph{Comprehensive R Archive Network})}\footnote{\url{https://cran.r-project.org/web/views}} oferece um \emph{Task Views} do software para o tópico de \href{https://cran.r-project.org/web/views/Finance.html}{Finanças}\footnote{\url{https://cran.r-project.org/web/views/Finance.html}} e \href{https://cran.r-project.org/web/views/Econometrics.html}{Econometria}\footnote{\url{https://cran.r-project.org/web/views/Econometrics.html}}. Nos links é possível encontrar os principais pacotes disponíveis para cada tema. Isso inclui a importação de dados financeiros da internet, a estimação de um modelo econométrico específico, cálculos de diferentes estimativas de risco, entre várias outras possibilidades. A leitura dessa página e o conhecimento desses pacotes são essenciais para aqueles que pretendem trabalhar com Finanças e Economia. Vale destacar, porém, que essa lista é moderada e apresenta apenas os principais itens. A lista completa de pacotes é muito maior do que o apresentado no \emph{Task Views}. \index{Task Views}

\hypertarget{instalacao}{%
\section{Como Instalar o R}\label{instalacao}}

O R é instalado no seu sistema operacional como qualquer outro programa. A maneira mais direta e funcional de instalá-lo é ir ao website do R em \url{https://www.r-project.org/} e clicar no \emph{link} \emph{CRAN} do painel \emph{Download}, conforme mostrado na figura a seguir.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/website_cran_1} 

}

\caption{Página inicial para o download do R}\label{fig:website-cran-1}
\end{figure}

A próxima tela apresenta a escolha do espelho para baixar os arquivos de instalação. O repositório do CRAN é espelhado em diversas partes do mundo, permitindo acesso rápido para os usuários. Para a grande maioria dos leitores deste livro, essa localidade deve ser o Brasil. Portanto, você pode escolher um dos links da instituição mais próxima, tal como o da UFPR (Universidade Federal do Paraná). Em caso de dúvida, escolha o repositório do RStudio 0-Cloud (veja Figura \ref{fig:website-cran-2}), o qual automaticamente direciona para o local mais próximo.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/website_cran_2} 

}

\caption{Tela com a escolha do espelho para o download}\label{fig:website-cran-2}
\end{figure}

O próximo passo é selecionar o sistema operacional do computador. Devido à maior popularidade da plataforma \emph{Windows}, a partir de agora daremos enfoque à instalação do R nesse sistema. As instruções de instalação nos demais sistemas operacionais podem ser facilmente encontradas na internet. Destaca-se que, independente da plataforma, o modo de uso do R é o mesmo. Existem, porém, algumas exceções, principalmente quando o R interage com o sistema de arquivos. Essas exceções serão destacadas no decorrer do livro. Assim, mesmo que você esteja utilizando Linux ou MacOS, poderá tirar proveito do material aqui apresentado.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/website_cran_3} 

}

\caption{Tela com a escolha do sistema operacional}\label{fig:website-cran-3}
\end{figure}

Após clicar no link \emph{Download R for Windows}, a próxima tela irá mostrar as seguintes opções de \emph{download}: \emph{base}, \emph{contrib}, \emph{old.contrib} e \emph{RTools}. Dentre as opções de \emph{download}, a primeira (\emph{base}) deve ser selecionada. O \emph{link} acessa a instalação básica do R para \emph{Windows}. O link \emph{contrib} e \emph{old.contrib} acessa os pacotes/módulos disponíveis para o R. Não precisas acessar estes últimos links, existe uma maneira muito mais fácil de instalar pacotes, como veremos em seguida.

O último link, \emph{RTools}, serve para instalar dependências necessárias no caso do usuário desenvolver e distribuir os seus próprios pacotes de R. Este não é uma instalação necessária para usuários iniciantes. Porém, saiba que alguns pacotes externos ao CRAN podem exigir a instalação do \emph{RTools} para compilação de código. Minha sugestão é que já instale este software e assim evite qualquer problema futuro.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/website_cran_4} 

}

\caption{Tela com opções de instalação}\label{fig:website-cran-4}
\end{figure}

Após clicar no link \emph{base}, a próxima tela mostrará o link para o \emph{download} do arquivo de instalação do R no \emph{Windows}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/website_cran_5} 

}

\caption{Tela para o download do R}\label{fig:website-cran-5}
\end{figure}

Após baixar o arquivo, abra-o e siga os passos da tela de instalação do R. Escolha a língua inglesa em todas etapas do processo. O uso da língua inglessa não é acidental. Este é a melhor forma, mesmo para iniciantes, de se aprender a usar o R. É possível instalar uma versão em português porém isso limita o potencial da ferramenta. Caso não for fluente em inglês, não se preocupe, o vocabulário necessário é básico. Neste momento, nenhuma outra configuração especial é necessária. Sugiro manter todas as escolhas padrão selecionadas e simplesmente ir aceitando as telas de diálogo. Após a instalação do R, partimos para a instalação do RStudio.

\begin{rmdimportant}
A cada quatro meses uma nova versão do R é lançada, corrigindo
\emph{bugs} e implementando novas soluções. Temos dois tipos principais
de versões, \emph{major} e \emph{minor}. Por exemplo, hoje, 05/02/2021,
a última versão do R é 4.0.3. O primeiro dígito (``4'') indica a versão
\emph{major} e todos os demais são do tipo \emph{minor}. Geralmente, as
mudanças \emph{minor} são bem específicas e, possivelmente, terão pouco
impacto no seu trabalho.

Porém, ao contrário de mudanças \emph{minor}, mudanças do tipo
\emph{major} refletem totalmente no ecossistema de pacotes do R. Toda
vez que instalar uma nova versão \emph{major} do R, terás que reinstalar
todos os pacotes utilizados. O problema é que não é incomum problemas de
incompatibilidade de pacotes com a nova versão.

Minha dica é: toda vez que uma nova versão \emph{major} do R sair,
espere alguns meses antes de instalar na sua máquina. Assim, o autores
dos pacotes terão mais tempo para atualizar os seus códigos, minimizando
a possibilidade de problemas de compatibilidade.
\end{rmdimportant}

\hypertarget{instalando-o-rstudio}{%
\section{Instalando o RStudio}\label{instalando-o-rstudio}}

A instalação do R inclui a sua própria interface gráfica, um programa que facilita a edição e execução de nossos \emph{scripts}. Essa, porém, possui várias limitações. O RStudio é um \emph{software} que torna o uso e o visual do R muito mais prático e eficiente. Uma forma de entender essa relação é com uma analogia com carros. Enquanto o R é o motor da linguagem de programação, o RStudio é a carroceria e o painel de instrumentos, os quais melhoram significativamente a experiência de uso. Além de apresentar um visual mais atrativo, o RStudio também é acrescido de várias funcionalidades que facilitam a vida do usuário, possibilitando a construção de projetos e pacotes do próprio R, a criação de documentos dinâmicos (\emph{Sweave/knitr}) e a interface com edição de textos em \emph{LaTeX}, entre várias outras. Assim como o R, \textbf{o RStudio também é gratuito} e pode ser utilizado no ambiente empresarial.

A instalação do RStudio é mais simples do que a do R. Os arquivos estão disponíveis no endereço disponibilizado no site do livro. Após acessar a página, clique em \emph{Download RStudio} e depois em \emph{Download Rstudio Desktop}. Logo após, basta selecionar o arquivo relativo ao sistema operacional em que você irá trabalhar. Provavelmente, essa opção será \emph{Windows Vista/7/8/10}. Note que, assim como o R, o RStudio também está disponível para diferentes plataformas.

Destaco que o uso do RStudio não é essencial para desenvolver programas no R. Outros softwares de interface estão disponíveis e podem ser utilizados. Porém, dada minha experiência atual, o RStudio é o programa de interface que oferece a maior variedade de funcionalidades para essa linguagem, além de ser amplamente utilizado, o que justifica a sua escolha.

\hypertarget{recursos-na-internet}{%
\section{Recursos na Internet}\label{recursos-na-internet}}

\textbf{A comunidade R é viva e envolvente}. Na internet é possível encontrar uma diversidade de material sobre o uso do R. Diversos usuários, assim como o próprio autor do livro, publicam material sobre o uso R em seus blogs. Isso inclui anúncios de pacotes, publicações sobre análise de dados na vida real, curiosidades, novidades e tutoriais. \href{https://www.r-bloggers.com/}{\textbf{R-Bloggers}} é um site internacional que agrega esses blogs em um único local, tornando mais fácil para qualquer um acessar e participar. O conteúdo do R-Bloggers, porém, é todo em inglês.

Recentemente, uma lista de blogs locais sobre o R está compilada e organizada por Marcos Vital em \url{https://marcosvital.github.io/blogs-de-R-no-Brasil/}. Eu recomendo a inscrição no feed do R-Bloggers, além dos blogs nacionais. Não só você será informado sobre o que está acontecendo no universo do R, mas também aprenderá muito lendo artigos e os códigos de outros usuários.

Aprender e usar R pode ser uma experiência social. Várias conferências e grupos de usuários estão disponíveis em muitos países, incluindo o Brasil. O grupo \emph{R Brasil - Programadores} no \href{https://www.facebook.com/groups/1410023525939155/}{Facebook} é bastante ativo, com um grande número de participantes. Recomendo fortemente a inscrição neste grupo e o acompanhamento das discussões relacionadas ao uso do R. Diversas conferências locais sobre o R são divulgadas nesse grupo.

\hypertarget{organizauxe7uxe3o-e-material-do-livro}{%
\section{Organização e Material do Livro}\label{organizauxe7uxe3o-e-material-do-livro}}

Este livro tem uma abordagem prática no uso do R e será acompanhado por uma série de códigos que irão exemplificar e mostrar para o leitor as funcionalidades do programa. Para tirar o máximo de proveito do material, sugiro que você primeiro busque entender o código mostrado e, somente então, tente utilizá-lo em seu próprio computador. O índice remissivo disponibilizado no final do livro serve como uma mapa de uso das funções. Toda vez que uma função é chamada no livro, um registro do número da página é criado no índice remissivo. Esse indica, também, o pacote que a função pertence. Podes utilizar este mapa para localizar o uso de qualquer função ou pacote no decorrer do livro.

Sugiro também o uso da versão \href{https://www.msperlin.com/adfeR}{web do livro}\footnote{\url{https://www.msperlin.com/adfeR}}, a qual permite que os código de exemplo sejam copiados direto para a sua sessão do R. Assim, perderás menos tempo digitando código, sobrando tempo para o estudo.

Aprender a programar em uma nova linguagem é como aprender uma língua estrangeira: o uso no dia-a-dia é de extrema importância para criar fluência. Sempre que possível, teste o código no seu computador e \emph{brinque} com o mesmo, modificando os exemplos dados e verificando o efeito das modificações nas saídas do programa. Procure sempre entender como a rotina estudada pode ajudar na solução de um problema seu. Cada capítulo apresenta no seu final uma lista de exercícios, incluindo questões do tipo desafio. Podes testar as suas habilidades de programação resolvendo as atividades propostas. Vale relembrar que todo o código deste livro está disponibilizado na internet. Não precisas, portanto, escrever o código diretamente do livro. Podes copiar e colar do código fonte disponibilizado no site.

No decorrer da obra, toda demonstração de código terá duas partes: o código em si e sua saída do R. Essa saída nada mais é do que o resultado dos comandos na tela do programa. Todas as entradas e saídas de código serão sinalizadas no texto com um formato especial. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a list}
\NormalTok{L }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{var1 =} \StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{, }\AttributeTok{var2 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}

\CommentTok{\# print to prompt}
\FunctionTok{print}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $var1
R> [1] "abc"
R> 
R> $var2
R> [1] 1 2 3 4 5
\end{verbatim}

No caso anterior, os textos \texttt{L\ \textless{}-\ list(var1\ =\ \textquotesingle{}abc\textquotesingle{},\ var2\ =\ 1:5)} e \texttt{print(L)} são os códigos de entrada. A saída do programa é a apresentação na tela dos elementos de \texttt{x}, com o símbolo antecessor \texttt{R\textgreater{}}. Por enquanto não se preocupe em entender e reproduzir o código utilizado acima. Iremos tratar disso no próximo capítulo.

Note que faço uso da língua inglesa no código, tanto para a nomeação de objetos quanto para os comentários. Isso não é acidental. O uso da língua inglesa facilita o desenvolvimento de código ao evitar caracteres latinos, além de ser uma das línguas mais utilizadas no mundo. Portanto, é importante já ir se acostumando com esse formato. O vocabulário necessário, porém, é limitado. De forma alguma precisarás ter fluência em inglês para entender o código.

O código também pode ser espacialmente organizado usando novas linhas. Esse é um procedimento comum em torno de argumentos de funções. O próximo pedaço de código é equivalente ao anterior, e executará exatamente da mesma maneira. Observe como usei uma nova linha para alinhar verticalmente os argumentos da função \texttt{list}. Você verá em breve que, ao longo do livro, esse tipo de alinhamento vertical é constantemente usado em códigos longos. Afinal, o código tem que necessariamente caber na página do livro.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a list}
\NormalTok{L }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{var1 =} \StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{,}
          \AttributeTok{var2 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}

\CommentTok{\# print to prompt}
\FunctionTok{print}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $var1
R> [1] "abc"
R> 
R> $var2
R> [1] 1 2 3 4 5
\end{verbatim}

O código também segue uma estrutura bem definida. Uma das decisões a ser feita na escrita de códigos de computação é a forma de nomear os objetos e como lidar com a estrutura do texto do código em geral. É recomendável seguir um padrão limpo de código, de forma que o mesmo seja fácil de ser mantido ao longo do tempo e de ser entendido por outros usuários. Para este livro, foi utilizado uma mistura de escolhas pessoais do autor com o estilo de código sugerido pelo \href{https://google.github.io/styleguide/Rguide.xml}{Google}. O usuário, porém, é livre para escolher a estrutura que achar mais eficiente. Voltaremos a discutir estrutura de código no capítulo \ref{otimizacao}.

\hypertarget{exercuxedcios}{%
\section{Exercícios}\label{exercuxedcios}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
A linguagem R foi desenvolvida com base em qual outra linguagem de programação?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Python
\item
  Javascript
\item
  S
\item
  C++
\item
  Julia
\end{enumerate}

02 -
Qual o nome dos dois autores do R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Guido van Rossum e Bjarne Stroustrup
\item
  Roger Federer e Rafael Nadal
\item
  John Chambers e Robert Engle
\item
  Linus Torvalds e Richard Stallman
\item
  Ross Ihaka e Robert Gentleman
\end{enumerate}

03 -
Qual o principal diferencial do R em relação a outras linguagens de programação, tal como Python, C++, javascript e demais?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Execução rápida de códigos
\item
  Desenvolvimento mobile
\item
  Facilita o desenvolvimento de aplicativos web
\item
  Facilita a análise de dados
\item
  Facilidade de uso geral
\end{enumerate}

04 -
Qual a razão para o nome da linguagem de programação ser R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Uma letra foi sorteada e o resultado foi R.
\item
  A mãe de um dos autores se chamada Renata e, por isso, ele homenageou-a com o nome R.
\item
  Era a única letra ainda não usada como linguagem de programação.
\item
  R = Reausable code.
\item
  Compartilhamento da letra R por seus autores.
\end{enumerate}

05 -
Sobre o R, considere as seguintes alternativas:

I - O R é uma plataforma de programação madura e estável;

II - O RStudio é uma interface ao R, aumentando a produtividade do analista;

III - O R tem compatibilidade com diferentes linguagens de programação;

Quais alternativas estão corretas?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  TRUE, FALSE, FALSE
\item
  FALSE, FALSE, FALSE
\item
  FALSE, TRUE, TRUE
\item
  FALSE, TRUE, FALSE
\item
  TRUE, TRUE, TRUE
\end{enumerate}

06 -
Assim que tiver R e RStudio instalado, dirija-se ao \href{https://cloud.r-project.org/web/packages/available_packages_by_date.html}{site de pacotes do CRAN}\footnote{\url{https://cloud.r-project.org/web/packages/available_packages_by_date.html}} e procure por tecnologias que usas no seu trabalho. Por exemplo, se usas \href{https://www.google.com/sheets/about/}{Planilhas do Google (Sheets)}\footnote{\url{https://www.google.com/sheets/about/}} ostensivamente no seu trabalho, logo descobrirá que existe um pacote no CRAN que interage com planilhas na nuvem.

07 -
No \href{https://cloud.r-project.org/bin/windows/}{site} de instalação do R no Windows é possível instalar também o aplicativo Rtools. Para que ele serve?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Fazer café (?).
\item
  Criar gráficos.
\item
  Compilar relatórios técnicos!
\item
  Compilação de pacotes.
\item
  Construir páginas na web.
\end{enumerate}

08 -
Use o \href{https://www.google.com/search?q=R+groups+in+my+city}{Google} para pesquisar por grupos de R em sua região. Verifique se os encontros são frequentes e, caso não tiver um impedimento maior, vá para um desses encontros e faça novos amigos.

09 -
Dirija-se ao site do \href{https://www.r-bloggers.com/}{RBloggers}\footnote{\url{https://www.r-bloggers.com/}} e procure por um tópico do seu interesse, tal como futebol (\emph{soccer}) ou investimentos (\emph{investments}). Leia pelo menos três artigos encontrados.

10 -
Caso trabalhe em uma instituição com infrainstrutura de dados, converse com o encarregado do IT e busque entender quais são as tecnologias empregadas. Verifique se, através do R, é possível ter acesso a todas tabelas dos bancos de dados. Por enquanto não existe necessidade de escrever código, ainda. Apenas verifique se esta possibilidade existe.

\hypertarget{operacoes-basicas}{%
\chapter{Operações Básicas no R}\label{operacoes-basicas}}

Antes de começar a desenvolver o seu código, é necessário entender a forma de trabalhar com o R e o RStudio. Isso inclui os componentes da linguagem, os diferentes tipos de objetos e as operações que podem ser realizadas com base nos comandos existentes.

Neste capítulo iremos percorrer os passos iniciais sobre o ponto de vista de alguém que nunca trabalhou com o R e, possivelmente, nunca teve contato com outra linguagem de programação. Aqueles já familiarizados com o programa irão encontrar pouca informação nova e, portanto, sugiro a leitura da próxima seção. É recomendado, porém, que no mínimo esse usuário verifique os temas tratados para confirmar ou não o seu conhecimento sobre as funcionalidades do programa. Muitas das sugestões apresentadas aqui tem potencial de aumentar significativamente a sua produtividade no RStudio.

\hypertarget{como-o-r-funciona}{%
\section{Como o R Funciona?}\label{como-o-r-funciona}}

A maior dificuldade que um usuário iniciante possui ao começar a desenvolver rotinas com o R é a forma de trabalho. A nossa interação com computadores foi simplificada ao longo dos anos e atualmente estamos confortáveis com o formato de interação do tipo \emph{aponte e clique}. Isto é, caso se queira efetuar alguma operação no computador, basta apontar o \emph{mouse} para o local específico na tela e clicar um botão que realize tal operação. Uma série de passos nesse sentido permite a execução de tarefas complexas no computador. Mas não se engane, essa forma de interação no formato \emph{aponte e clique} é apenas uma camada por cima do que realmente acontece no computador. Por trás de todo \emph{clique} existe um comando sendo executado, seja na abertura de um arquivo \emph{pdf}, direcionamento do \emph{browser} para uma página na internet ou qualquer outra operação cotidiana de trabalho.

Enquanto esse formato de interação visual e motora tem seus benefícios ao facilitar e popularizar o uso de computadores, é pouco flexível e eficaz quando se trabalha com procedimentos computacionais. Ao conhecer os possíveis comandos disponíveis ao usuário, é possível criar um arquivo contendo alguns comandos em sequência e, futuramente, simplesmente pedir que o computador \textbf{execute} esse arquivo com os nossos procedimentos. \textbf{Uma rotina de computador é nada mais do que um texto que instrui, de forma clara e sequencial, o que o computador deve fazer}. Investe-se certo tempo para a criação do programa, porém, no futuro, esse irá executar sempre da mesma maneira o procedimento gravado. No médio e longo prazo, existe um ganho significativo de tempo entre o uso de uma rotina do computador e uma interface do tipo \emph{aponte e clique}.

Além disso, o \textbf{risco de erro humano na execução do procedimento é quase nulo}, pois os comandos e a sua sequência estão registrados no arquivo texto e irão ser executados sempre da mesma maneira. Da mesma forma, esse aglomerado de comandos pode ser compartilhado com outras pessoas, as quais podem replicar os resultados em seus computadores. Essa é uma das grandes razões que justificam a popularização de programação na realização de pesquisa em dados. Todos os procedimentos executados podem ser replicados pelo uso de um \emph{script}.

No uso do R, o ideal é mesclar o uso do mouse com a utilização de comandos. O R e o RStudio possuem algumas funcionalidades através do \emph{mouse}, porém a sua capacidade é otimizada quando os utilizamos via inserção de comandos específicos. Quando um grupo de comandos é realizado de uma maneira inteligente, temos um \emph{script} do R que deve preferencialmente produzir algo importante para nós no final de sua execução. Em Finanças e Economia, isso pode ser o valor atualizado de um portfólio de investimento, o cálculo de um índice de atividade econômica, a performance histórica de uma estratégia de investimento, o resultado de uma pesquisa acadêmica, entre diversas outras possibilidades.

O R também possibilita a exportação de arquivos, tal como figuras a serem inseridas em um relatório técnico ou informações em um arquivo texto. De fato, o próprio relatório técnico pode ser dinamicamente criado dentro do R através da tecnologia \emph{RMarkdown}. Por exemplo, este livro que estás lendo foi escrito utilizando o pacote \texttt{bookdown} \citep{R-bookdown}, o qual é baseado em \emph{RMarkdown}. O conteúdo do livro é compilado com a execução dos códigos e as suas saídas são registradas em texto. Todas as figuras e os dados do livro podem ser atualizados com a execução de um simples comando.

O produto final de trabalhar com R e RStudio será um script que produz elementos para um relatório de dados. Um bom exemplo de um código simples e polido pode ser encontrado neste \href{https://github.com/msperlin/adfeR/raw/master/inst/extdata/others/S_Example_Script.R}{link}\footnote{\url{https://github.com/msperlin/adfeR/raw/master/inst/extdata/others/S_Example_Script.R}}. Abra-o e você verá o conteúdo de um arquivo com extensão \emph{.R} que fará o download dos preços das ações de duas empresas e criará um gráfico e uma tabela. Ao terminar de ler o livro, você irá entender o que está acontecendo no código e como ele realiza o trabalho. Melhor ainda, você poderá melhorá-lo com novas funcionalidades e novas saídas. Caso esteja curioso em ver o script rodar, faça o seguinte: 1) instale R e RStudio no computador, 2) copie o conteúdo de texto do link para um novo script (``File'' -\textgreater{} ``New File'' -\textgreater{} ``R Script''), 3) salve-o com um nome qualquer e, finalizando, 4) pressione \texttt{control\ +\ shift\ +\ enter} para executar o \emph{script} inteiro.

\hypertarget{objetos-e-funuxe7uxf5es}{%
\section{Objetos e Funções}\label{objetos-e-funuxe7uxf5es}}

No R, \textbf{tudo é um objeto, e cada tipo de objeto tem suas propriedades}. Por exemplo, o valor de um índice de inflação ao longo do tempo -- em vários meses e anos -- pode ser representado como um objeto do tipo vetor numérico. As datas em si, no formato YYYY-MM-DD (ano-mês-dia), podem ser representadas como texto (\emph{character}) ou a própria classe \texttt{Date}. Por fim, podemos representar conjuntamente os dados de inflação e as datas armazenando-os em um objeto único do tipo \emph{dataframe}, o qual nada mais é do que uma \textbf{tabela} com linhas e colunas. Todos esses objetos fazem parte do ecossistema do R e é através da manipulação destes que tiramos o máximo proveito do \emph{software}.

Enquanto representamos informações do mundo real como diferentes classes no R, um tipo especial de objeto é a função, a qual representa um procedimento preestabelecido que está disponível para o usuário. O R possui uma grande quantidade de funções, as quais possibilitam que o usuário realize uma vasta gama de procedimentos. Por exemplo, os comandos básicos do R, não incluindo demais pacotes, somam um total de 1258 funções. Com base neles e outros iremos importar dados, calcular médias, testar hipóteses, limpar dados, e muito mais.

Cada função possui um próprio nome. Por exemplo, a função \texttt{sort()} é um procedimento que ordena valores valores utilizados como \emph{input}. Caso quiséssemos ordnear os valores \emph{2, 1, 3, 0}, basta inserir no \emph{prompt} o seguinte comando e apertar \emph{enter}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sort}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{), }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3 2 1 0
\end{verbatim}

O comando \texttt{c(2,\ 1,\ 3,\ 0)} combina os valores em um vetor (maiores detalhes sobre comando \texttt{c} serão dados em seção futura). Observe que a função \texttt{sort} é utilizada com parênteses de início e fim. Esses parênteses servem para destacar as entradas (\emph{inputs}), isto é, as informações enviadas para a função produzir alguma coisa. Observe que cada entrada (ou opção) da função é separada por uma vírgula, tal como em \texttt{MinhaFuncao(entrada01,\ entrada02,\ entrada03,\ ...)}. No caso do código anterior, note que usamos a opção \texttt{decreasing\ =\ TRUE}. Essa é uma instrução específica para a função \texttt{sort} ordenar de forma decrescente os elementos do vetor de entrada. Veja a diferença:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sort}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{), }\AttributeTok{decreasing =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0 1 2 3
\end{verbatim}

\textbf{O uso de funções está no coração do R} e iremos dedicar grande parte do livro a elas. Por enquanto, essa breve introdução já serve o seu propósito. O principal é entender que uma função usa suas entradas para produzir algo de volta. Nos próximos capítulos iremos utilizar funções já existentes para as mais diferentes finalidades: baixar dados da internet, ler arquivos, realizar testes estatísticos e muito mais. No capítulo \ref{programacao} iremos tratar deste assunto com maior profundidade, incluindo a forma de escrevermos nossas próprias funções.

\hypertarget{o-formato-brasileiro}{%
\section{O Formato Brasileiro}\label{o-formato-brasileiro}}

Antes de começar a explicar o uso do R e RStudio, é importante ressaltar algumas regras de formatação de números e códigos para o caso brasileiro.

\textbf{Decimal:} O decimal no R é definido pelo ponto (.), tal como em \texttt{2.5} e não vírgula, como em \texttt{2,5}. Esse é o padrão internacional, e a diferença para a notação brasileira gera muita confusão. Alguns softwares, por exemplo o Microsoft Excel, fazem essa conversão automaticamente no momento da importação dos dados. Porém isso não ocorre na maioria dos casos. Como regra geral, utilize vírgulas apenas para separar os termos de entradas em uma função (veja exemplo de seção anterior com função \texttt{sort}). Em nenhuma situação deve-se utilizar a vírgula como separador de casas decimais. Mesmo quando estiver exportando dados, sempre dê prioridade para o formato internacional, pois esse será compatível com a grande maioria dos dados e facilitará o uso do \emph{software}.

\textbf{Caracteres latinos:} Devido ao seu padrão internacional, o R apresenta problemas para entender caracteres latinos, tal como cedilha e acentos. Caso possa evitar, não utilize esses tipos de caracteres no código para nomeação de variáveis ou arquivos. Nos objetos de classe texto (\texttt{character}), é possível utilizá-los desde que a codificação do objeto esteja correta (\emph{UTF-8} ou \emph{Latin1}). Assim, recomenda-se que o código do R seja escrito na língua inglesa. Isso automaticamente elimina o uso de caracteres latinos e facilita a usabilidade do código por outras pessoas que não entendam a língua portuguesa. Destaca-se que essa foi a escolha utilizada para o livro. Os nomes dos objetos nos exemplos estão em inglês, assim como também todos os comentários do código. \index{caracteres latinos}

\textbf{Formato das datas:} Datas no R são formatadas de acordo com a norma \href{https://www.iso.org/iso-8601-date-and-time-format.html}{ISO 8601}, seguindo o padrão \texttt{YYYY-MM-DD}, onde \texttt{YYYY} é o ano em quatro números, \texttt{MM} é o mês e \texttt{DD} é o dia. Por exemplo, uma data em ISO 8601 é 2022-11-23. No Brasil, as datas são formatadas como \texttt{DD/MM/YYYY}. Reforçando a regra, sempre dê preferência ao padrão internacional. Vale salientar que a conversão entre um formato e outro é bastante fácil e será apresentada em capítulo futuro.

No momento de instalação do R, diversas informações sobre o formato local do seu computador são importadas do seu sistema operacional. Para saber qual o formato que o R está configurado localmente, digite o seguinte comando no \emph{prompt} (canto esquerdo inferior do RStudio) e aperte \emph{enter}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get local format}
\FunctionTok{Sys.localeconv}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>     decimal_point     thousands_sep          grouping 
R>               "."                ""                "" 
R>   int_curr_symbol   currency_symbol mon_decimal_point 
R>            "BRL "              "R$"               "," 
R> mon_thousands_sep      mon_grouping     positive_sign 
R>               "."        "\003\003"                "" 
R>     negative_sign   int_frac_digits       frac_digits 
R>               "-"               "2"               "2" 
R>     p_cs_precedes    p_sep_by_space     n_cs_precedes 
R>               "1"               "1"               "1" 
R>    n_sep_by_space       p_sign_posn       n_sign_posn 
R>               "1"               "1"               "1"
\end{verbatim}

A saída de \texttt{Sys.localeconv()} mostra como o R interpreta pontos decimais e o separador de milhares, entre outras coisas. Como você pode ver no resultado anterior, este livro foi compilado usando a notação brasileira de moeda (BRL/R\$), mas usa a formatação internacional -- o ponto (\texttt{.}) -- para decimais.

\begin{rmdcaution}
Muito cuidado ao modificar o formato que o R interpreta os diferentes
símbolos e notações. Como regra de bolso, caso precisar usar algum
formato específico, faça-o isoladamente dentro do contexto do código.
Evite mudanças permanentes pois nunca se sabe onde tais formatos estão
sendo usados. Evite, assim, surpresas desagradáveis no futuro.
\end{rmdcaution}

\hypertarget{tipos-de-arquivos}{%
\section{Tipos de Arquivos}\label{tipos-de-arquivos}}

Assim como outros programas, o R possui um ecossistema de arquivos e cada extensão tem uma finalidade diferente. A seguir apresenta-se uma descrição de diversas extensões de arquivos. Os itens da lista estão ordenados por ordem de importância e uso. Note que omitimos arquivos de figuras tal como \emph{.png}, \emph{.jpg}, \emph{.gif} entre outros, pois estes não são exclusivos do R.

\textbf{Arquivos com extensão \emph{.R}}: Representam arquivos do tipo texto contendo diversas instruções para o R. Esses são os arquivos que conterão o código da pesquisa e onde passaremos a maior parte do tempo. Também pode ser chamado de um \emph{script} ou rotina de pesquisa. Como sugestão, pode-se dividir toda uma pesquisa em etapas e, para cada, nomear \emph{script} correspondente. Exemplos: \emph{01-Get-Data.R}, \emph{02-Clean-data.R}, \emph{03\_Estimate\_Models.R}.

\textbf{Arquivos com extensão \emph{.RData} e \emph{.rds}}: armazenam dados nativos do R. Esses arquivos servem para salvar objetos do R em um arquivo no disco rígido do computador para, em sessão futura, serem novamente carregados. Por exemplo, podes guardar o resultado de uma pesquisa em uma tabela, a qual é salva em um arquivo com extensão \emph{.RData} ou \emph{.rds}. Exemplos: \emph{Raw-Data.RData}, \emph{Table-Results.rds}.

\textbf{Arquivos com extensão \emph{.Rmd}, \emph{.md} e \emph{.Rnw}}: São arquivos relacionados a tecnologia \emph{Rmarkdown}. O uso desses arquivos permite a criação de documentos onde texto e código são integrados.

\textbf{Arquivos com extensão \emph{.Rproj}}: Contém informações para a edição de projetos no RStudio. O sistema de projetos do RStudio permite a configuração customizada do projeto e também facilita a utilização de ferramentas de controle de código, tal como controle de versões. O seu uso, porém, não é essencial. Para aqueles com interesse em conhecer esta funcionalidade, sugiro a leitura do \href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{manual do RStudio}\footnote{\url{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}}. Uma maneira simples de entender os tipos de projetos disponíveis é, no RStudio, clicar em ``File'', ``New project'', ``New Folder'' e assim deve aparecer uma tela com todos os tipos possíveis de projetos no RStudio. Exemplo: \emph{My-Dissertation-Project.Rproj}.

\hypertarget{explicando-a-tela-do-rstudio}{%
\section{Explicando a Tela do RStudio}\label{explicando-a-tela-do-rstudio}}

Após instalar os dois programas, R e RStudio, Procure o ícone do RStudio na área de trabalho ou via menu \emph{Iniciar}. Note que a instalação do R inclui um programa de interface e isso muitas vezes gera confusão. Verifique que estás utilizado o \emph{software} correto. A janela resultante deve ser igual a figura \ref{fig:RStudio1}, apresentada a seguir.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/RStudio1} 

}

\caption{A tela do RStudio}\label{fig:RStudio1}
\end{figure}

Observe que o RStudio automaticamente detectou a instalação do R e inicializou a sua tela no lado esquerdo. Caso não visualizar uma tela parecida ou chegar em uma mensagem de erro indicando que o R não foi encontrado, repita os passos de instalação do capítulo anterior (seção \ref{instalacao}).

Como um primeiro exercício, clique em \emph{File}, \emph{New File} e \emph{R Script}. Após, um editor de texto deve aparecer no lado esquerdo da tela do RStudio. É nesse editor que iremos inserir os nossos comandos, os quais são executados de cima para baixo, na mesma direção em que normalmente o lemos. Note que essa direção de execução introduz uma dinâmica de recursividade: cada comando depende do comando executado nas linhas anteriores. Após realizar os passos definidos anteriormente, a tela resultante deve ser semelhante à apresentada na figura \ref{fig:RStudio2}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/RStudio2} 

}

\caption{Explicando a tela do RStudio}\label{fig:RStudio2}
\end{figure}

\begin{rmdimportant}
Uma sugestão importante aqui é modificar o esquema de cores do RStudio
para uma configuração de \textbf{tela escura}. Não é somente uma questão
estética mas sim de prevenção e melhoria de sua saúde física.
Possivelmente irás passar demasiado tempo na frente do computador.
Assim, vale a pena modificar as cores da interface para aliviar seus
olhos do constante brilho da tela. Dessa forma, conseguirás trabalhar
por mais tempo, sem forçar a sua visão. Podes configurar o esquema de
cores do RStudio indo na opção \emph{Tools}, \emph{Global Options} e
então em \emph{Appearance}. Um esquema de cores escuras que pessoalmente
gosto e sugiro é o \emph{Ambience}.
\end{rmdimportant}

Após os passos anteriores, a tela do RStudio deve estar semelhante a Figura \ref{fig:RStudio2}, com os seguintes itens/painéis:

\textbf{Editor de scripts (\emph{Script editor}):} localizado no lado esquerdo e acima da tela. Esse painel é utilizado para escrever código e é onde passaremos a maior parte do tempo.

\textbf{Console do R (\emph{R prompt}):} localizado no lado esquerdo e abaixo do editor de \emph{scripts}. Apresenta o \emph{prompt} do R, o qual também pode ser utilizado para executar comandos. A principal função do \emph{prompt} é testar código e apresentar os resultados dos comandos inseridos no editor de \emph{scripts}.

\textbf{Área de trabalho (\emph{Environment}):} localizado no lado direito e superior da tela. Mostra todos os objetos, incluindo variáveis e funções atualmente disponíveis para o usuário. Observe também a presença do painel \emph{History}, o qual mostra o histórico dos comandos já executados.

\textbf{Pacotes (\emph{Panel Packages}):} mostra os pacotes instalados e carregados pelo R. Um pacote é nada mais que um módulo no R, cada qual com sua finalidade específica. Observe a presença de quatro abas: \emph{Files}, para carregar e visualizar arquivos do sistema; \emph{Plots}, para visualizar figuras; \emph{Help}, para acessar o sistema de ajuda do R e \emph{Viewer}, para mostrar resultados dinâmicos e interativos, tal como uma página da internet.

Como um exercício introdutório, vamos inicializar duas variáveis. Dentro do console do R (lado esquerdo inferior), digite os seguintes comandos e aperte \emph{enter} ao final de cada linha. O símbolo \texttt{\textless{}-} é nada mais que a junção de \texttt{\textless{}} com \texttt{-}. O símbolo \texttt{\textquotesingle{}} representa uma aspa simples e sua localização no teclado Brasileiro é no botão abaixo do \emph{escape} (\emph{esc}), lado esquerdo superior do teclado.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x and y}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}my text\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Após a execução, dois objetos devem aparecer no painel \emph{Environment}, um chamado \texttt{x} com o valor 1, e outro chamado \texttt{y} com o conjunto de caracteres \texttt{\textquotesingle{}my\ text\textquotesingle{}}. O histórico de comandos na aba \emph{History} também foi atualizado com os comandos utilizados anteriormente.

Agora, vamos mostrar na tela os valores de \texttt{x}. Para isso, digite o seguinte comando no \emph{prompt} e aperte \emph{enter} novamente:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print x}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

A função \texttt{print} é uma das principais funções para mostrarmos valores no \emph{prompt} do R. O texto apresentado como \texttt{{[}1{]}} indica o índice do primeiro número da linha. Para verificar isso, digite o seguinte comando, o qual irá mostrar vários números na tela: \index{base!print}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print vector from 50 to 100}
\FunctionTok{print}\NormalTok{(}\DecValTok{50}\SpecialCharTok{:}\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  50  51  52  53  54  55  56  57  58  59  60  61  62  63
R> [15]  64  65  66  67  68  69  70  71  72  73  74  75  76  77
R> [29]  78  79  80  81  82  83  84  85  86  87  88  89  90  91
R> [43]  92  93  94  95  96  97  98  99 100
\end{verbatim}

Nesse caso, utilizamos o símbolo \texttt{:} em \texttt{50:100} para criar uma sequência iniciando em 50 e terminando em 100. Observe que temos valores encapsulados por colchetes ({[}{]}) no lado esquerda da tela. Esses representam os índices do primeiro elemento apresentado na linha. Por exemplo, o décimo quinto elemento do vetor criado é o valor 64.

\hypertarget{pacotes-do-r}{%
\section{Pacotes do R}\label{pacotes-do-r}}

Um dos grandes benefícios do uso do R é o seu acervo de pacotes. Esses representam um conjunto de procedimentos agrupados em uma coleção de funções e voltados para a resolução de um problema qualquer. O R tem em sua essência uma filosofia de colaboração. Usuários disponibilizam os seus códigos para outras pessoas utilizarem. E, mais importante, \textbf{todos os pacotes são gratuitos}, assim como o R. Por exemplo, considere um caso em que está interessado em baixar dados da internet sobre o desemprego histórico no Brasil. Para isso, basta procurar e instalar o pacote específico que realiza esse procedimento.

Esses pacotes podem ser instalados de diferentes fontes, com as principais sendo \textbf{CRAN} (\emph{The Comprehensive R Archive Network}) e \textbf{Github}. A cada dia aumenta a quantidade e diversidade de pacotes existentes para o R. O próprio autor deste livro possui diversos pacotes disponíveis no CRAN, cada um para resolver algum problema diferente. Na grande maioria, são pacotes para importar e organizar dados financeiros.

O CRAN é o repositório oficial do R e é livre. Qualquer pessoa pode enviar um pacote e todo código enviado está disponível na internet. Existe, porém, um processo de avaliação que o código passa e certas normas rígidas devem ser respeitadas sobre o formato do código, o manual do usuário e a forma de atualização do pacote. Para quem tiver interesse, um tutorial claro e fácil de seguir é apresentado no site \url{http://r-pkgs.had.co.nz/intro.html}. As regras completas estão disponíveis no site do CRAN - \url{https://cran.r-project.org/web/packages/policies.html}. A adequação do código a essas normas é responsabilidade do desenvolvedor e gera um trabalho significativo, principalmente na primeira submissão.

A lista completa de pacotes disponíveis no CRAN, juntamente com uma breve descrição, pode ser acessada no link \emph{packages} do site do R - \url{https://cran.r-project.org/}. Uma maneira prática de verificar a existência de um pacote para um procedimento específico é carregar a página anterior e procurar no seu navegador de internet a palavra-chave que define o seu procedimento. Caso existir o pacote com a palavra-chave, a procura acusará o encontro do termo na descrição do pacote.

Outra fonte importante para o encontro de pacotes é o \href{https://cran.r-project.org/web/views/}{\emph{Task Views}}, em que são destacados os principais pacotes de acordo com a área e o tipo de uso. Veja a tela do \emph{Task Views} na Figura \ref{fig:TaskViews}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/TaskViews} 

}

\caption{Tela do Task Views}\label{fig:TaskViews}
\end{figure}

Ao contrário do CRAN, o \emph{Github} não possui restrição quanto ao código enviado e, devido a isso, tende a ser escolhido como ambiente de compartilhamento de código. A responsabilidade de uso, porém, é do próprio usuário. Na prática, é muito comum os desenvolvedores manterem uma versão em desenvolvimento no \emph{Github} e outra oficial no CRAN. Quando a versão em desenvolvimento atinge um estágio de maturidade, a mesma é enviada ao CRAN.

O mais interessante no uso de pacotes é que estes podem ser acessados e instalados diretamente no R via a internet. Para saber qual é a quantidade atual de pacotes no CRAN, digite e execute os seguintes comandos no \emph{prompt}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find current available packages}
\NormalTok{df\_cran\_pkgs }\OtherTok{\textless{}{-}} \FunctionTok{available.packages}\NormalTok{()}

\CommentTok{\# get size of matrix}
\NormalTok{n\_cran\_pkgs }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(df\_cran\_pkgs)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(n\_cran\_pkgs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 18877
\end{verbatim}

Atualmente, 2022-11-23 10:55:35, existem 18877 pacotes disponíveis nos servidores do CRAN.

Também se pode verificar a quantidade de pacotes localmente instalados com o comando \texttt{installed.packages()}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get number of local (installed) packages}
\NormalTok{n\_local\_pkgs }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(}\FunctionTok{installed.packages}\NormalTok{())}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(n\_local\_pkgs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 531
\end{verbatim}

Nesse caso, o computador em que o livro foi escrito possui 531 pacotes do R instalados. Note que, apesar do autor ser um experiente programador do R, apenas uma pequena fração do pacotes disponíveis no CRAN está sendo usada! A diversidade dos pacotes é gigantesca.

\hypertarget{instalando-pacotes-do-cran}{%
\subsection{Instalando Pacotes do CRAN}\label{instalando-pacotes-do-cran}}

Para instalar um pacote, basta utilizar o comando \texttt{install.packages}. Como exemplo, vamos instalar um pacote que será utilizado nos capítulos futuros, o \texttt{readr}: \index{utils!install.packages}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install pkg readr}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}readr\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Copie e cole este comando no \emph{prompt} e pronto! O R irá baixar os arquivos necessários e instalar o pacote \texttt{readr} e suas dependências. Após isto, as funções relativas ao pacote estarão prontas para serem usadas após o carregamento do módulo (detalhes a seguir). Observe que definimos o nome do pacote na instalação como se fosse texto, com o uso das aspas (\texttt{"}). Caso o pacote instalado seja dependente de outros pacotes, o R automaticamente instala todos módulos faltantes. Assim, todos os requerimentos para o uso do respectivo pacote já serão satisfeitos e tudo funcionará perfeitamente. É possível, porém, que um pacote tenha uma dependência externa. Como um exemplo, o pacote \texttt{RndTexExams} depende da existência de uma instalação do LaTex. Geralmente essa é anunciada na sua descrição e um erro é sinalizado na execução do programa quando o LaTex não é encontrado. Fique atento, portanto, a esses casos.

Aproveitando o tópico, sugiro que o leitor já instale todos os pacotes do \texttt{tidyverse} com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install pkgs from tidyverse}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}tidyverse\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O \texttt{tidyverse} é um conjunto de pacotes voltados a \emph{data science} e com uma sintaxe própria e consistente, voltada a praticabilidade. Verás que, em uma instalação nova do R, o \texttt{tidyverse} depende de uma grande quantidade de pacotes.

\hypertarget{instalando-pacotes-do-github}{%
\subsection{Instalando Pacotes do Github}\label{instalando-pacotes-do-github}}

Para instalar um pacote diretamente do Github, é necessário instalar antes o pacote \emph{devtools}, disponível no CRAN: \index{devtools}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install devtools}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}devtools\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Após isto, utilize função \texttt{devtools::install\_github} para instalar um pacote diretamente do Github. Note que o símbolo \texttt{::} indica que função \texttt{install\_github} pertence ao pacote \texttt{devtools}. Com esta particular sintaxe, não precisamos carregar todo o pacote para utilizar apenas uma função.

No exemplo a seguir instalamos a versão em desenvolvimento do pacote \texttt{ggplot2}, cuja versão oficial também está disponível no CRAN: \index{devtools!install\_github}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install ggplot2 from github}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"hadley/ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Observe que o nome do usuário do repositório também é incluído. No caso anterior, o nome \emph{hadley} pertence ao desenvolvedor do \texttt{ggplot2}, Hadley Wickham. No decorrer do livro notará que esse nome aparecerá diversas vezes, dado que Hadley é um prolífico e competente desenvolvedor de diversos pacotes do R e do \texttt{tidyverse}.

\begin{rmdcaution}
Um aviso aqui é importante. \textbf{Os pacotes do github não são
moderados. Qualquer pessoa pode enviar código para lá e o conteúdo não é
checado de forma independente.} Nunca instale pacotes do github sem
conhecer os autores. Apesar de improvável -- nunca aconteceu comigo por
exemplo -- é possível que esses possuam algum código malicioso.
\end{rmdcaution}

\hypertarget{carregando-pacotes}{%
\subsection{Carregando Pacotes}\label{carregando-pacotes}}

Dentro de uma rotina de pesquisa, utilizamos a função \texttt{library} para carregar um pacote na nossa sessão do R. Ao fecharmos o RStudio ou então iniciar uma nova sessão do R, os pacotes são descarregados. Vale salientar que alguns pacotes, tal como o \texttt{base} e o \texttt{stats}, são inicializados automaticamente a cada nova sessão. A grande maioria, porém, deve ser carregada no início dos \emph{scripts}. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load dplyr}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

A partir disso, todas as funções do pacote estarão disponíveis para o usuário. Note que não é necessário utilizar aspas (\texttt{"}) ao carregar o pacote. Caso utilize uma função específica do pacote e não deseje carregar todo ele, pode fazê-lo através do uso do símbolo especial \texttt{::}, conforme o exemplo a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# call fct fortune() from pkg fortune}
\NormalTok{fortunes}\SpecialCharTok{::}\FunctionTok{fortune}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Overall, SAS is about 11 years behind R and S-Plus in
R> statistical capabilities (last year it was about 10 years
R> behind) in my estimation.
R>    -- Frank Harrell (SAS User, 1969-1991)
R>       R-help (September 2003)
\end{verbatim}

Nesse caso, utilizamos a função \texttt{fortune} do próprio pacote \texttt{fortunes}, o qual mostra na tela uma frase possivelmente engraçada escolhida do \emph{mailing list} do R. Nesse caso, selecionamos a mensagem número 10. Se não tiver disponível o pacote, o R mostrará a seguinte mensagem de erro:

\begin{verbatim}
R> Error in library("fortune") : there is no package called "fortune"
\end{verbatim}

Para resolver, utilize o comando \texttt{install.packages("fortunes")} para instalar o pacote no seu computador. Execute o código \texttt{fortunes::fortune(10)} no \emph{prompt} para confirmar a instalação. Toda vez que se deparar com essa mensagem de erro, deves instalar o pacote que está faltando.

Outra maneira de carregar um pacote é através da função \texttt{require}. Essa tem um comportamento diferente da função \texttt{library} e deve ser utilizada dentro da definição de funções ou no teste do carregamento do pacote. Caso o usuário crie uma função customizada que necessite de procedimentos de um pacote em particular, o mesmo deve carregar o pacote no escopo da função. Por exemplo, veja o código a seguir, em que criamos uma função dependente do pacote \texttt{quantmod}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_fct }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x)\{}
  \FunctionTok{require}\NormalTok{(quantmod)}

\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{getSymbols}\NormalTok{(x, }\AttributeTok{auto.assign =}\NormalTok{ F)}
  \FunctionTok{return}\NormalTok{(df)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Nesse caso, a função \texttt{getSymbols} faz parte do pacote \texttt{quantmod}. Não se preocupe agora com a estrutura utilizada para criar uma função no R. Essa será explicada em capítulo futuro.

\begin{rmdcaution}
Uma precaucão que deve sempre ser tomada quando se carrega um pacote é
um possível \textbf{conflito de funções}. Por exemplo, existe uma função
chamada \texttt{filter} no pacote \texttt{dplyr} e também no pacote
\texttt{stats}. Caso carregarmos ambos pacotes e chamarmos a função
\texttt{filter} no escopo do código, qual delas o R irá usar? Pois bem,
a \textbf{preferência é sempre para o último pacote carregado}. Esse é
um tipo de problema que pode gerar muita confusão. Felizmente, note que
o próprio R acusa um conflito de nome de funções no carregamento do
pacote. Para testar, inicie uma nova sessão do R e carregue o pacote
\texttt{dplyr}. Verás que uma mensagem indica haver dois conflitos com o
pacote \texttt{stats} e quatro com pacote o \texttt{base}.
\end{rmdcaution}

\hypertarget{atualizando-pacotes}{%
\subsection{Atualizando Pacotes}\label{atualizando-pacotes}}

Ao longo do tempo, é natural que os pacotes disponibilizados no CRAN sejam atualizados para acomodar novas funcionalidades ou se adaptar a mudanças em suas dependências. Assim, é recomendável que os usuários atualizem os seus pacotes instalados para uma nova versão através da internet. Esse procedimento é bastante fácil. Uma maneira direta de atualizar pacotes é clicar no botão \emph{update} no painel de pacotes no canto direito inferior do RStudio, conforme mostrado na figura \ref{fig:RStudio-update}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/RStudio_update} 

}

\caption{Atualizando pacotes no R}\label{fig:RStudio-update}
\end{figure}

A atualização de pacotes através do \emph{prompt} também é possível. Para isso, basta utilizar o comando \texttt{update.packages}, conforme mostrado a seguir. \index{utils!update.packages}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{update.packages}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

O comando \texttt{update.packages()} compara a versão dos pacotes instalados em relação a versão disponível no CRAN. Caso tiver alguma diferença, a nova versão é instalada. Após a execução do comando, todos os pacotes estarão atualizados com a versão disponível nos servidores do CRAN.

\begin{rmdimportant}
Versionamento de pacotes é extremamente importante para manter a
reproducibilidade do código. Apesar de ser raro de acontecer, é possível
que a atualização de um pacote no R modifique, para os mesmos dados,
resultados já obtidos anteriormente. Tenho uma experiência
particularmente memorável quando um artigo científico retornou da
revisão e, devido a atualização de um dos pacotes, não consegui
reproduzir os resultados apresentados no artigo. No final deu tudo
certo, mas o trauma fica.

Uma solução para este problema é congelar as versões dos pacotes para
cada projeto usando a ferramenta \texttt{packrat} do RStudio. Em resumo,
o \texttt{packrat} faz cópias locais dos pacotes utilizados no projeto,
os quais têm preferência aos pacotes do sistema. Assim, se um pacote for
atualizado no sistema, mas não no projeto, o código R vai continuar
usando a versão mais antiga e seu código sempre rodará nas mesmas
condições.
\end{rmdimportant}

\hypertarget{executando-cuxf3digos-em-um-script}{%
\section{\texorpdfstring{Executando Códigos em um \emph{Script}}{Executando Códigos em um Script}}\label{executando-cuxf3digos-em-um-script}}

Agora, vamos juntar todos os códigos digitados anteriormente e colar na tela do editor (lado esquerdo superior), assim como mostrado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set objects}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}my text\textquotesingle{}}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(x)}
\FunctionTok{print}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Após colar todos os comandos no editor, salve o arquivo \emph{.R} em alguma pasta pessoal. Esse arquivo, o qual no momento não faz nada de especial, registrou os passos de um algoritmo simples que cria dois objetos e mostra os seus valores. Futuramente esse irá ter mais forma, com a importação de dados, manipulação e modelagem dos mesmos e saída de tabelas e figuras.

No RStudio existem alguns atalhos predefinidos para executar códigos que economizam bastante tempo. Para executar um \emph{script} inteiro, basta apertar \texttt{control\ +\ shift\ +\ s}. Esse é o comando \emph{source}. Com o RStudio aberto, sugiro testar essa combinação de teclas e verificar como o código digitado anteriormente é executado, mostrando os valores no \emph{prompt} do R. Visualmente, o resultado deve ser próximo ao apresentado na figura \ref{fig:example-script-source}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/RStudio_example_script_source} 

}

\caption{Exemplo de Rotina no R}\label{fig:example-script-source}
\end{figure}

Outro comando muito útil é a execução por linha. Nesse caso não é executado todo o arquivo, mas somente a linha em que o cursor do \emph{mouse} se encontra. Para isto, basta apertar \texttt{control+enter}. Esse atalho é bastante útil no desenvolvimento de rotinas pois permite que cada linha seja testada antes de executar o programa inteiro. Como um exemplo de uso, aponte o cursor para a linha \texttt{print(x)} e pressione \texttt{control\ +\ enter}. Verás que o valor de \texttt{x} é mostrado na tela do \emph{prompt}. A seguir destaco esses e outros atalhos do RStudio, os quais também são muito úteis.

\begin{itemize}
\tightlist
\item
  \textbf{control+shift+s} executa o arquivo atual do RStudio, sem mostrar comandos no \emph{prompt} (sem eco -- somente saída);
\item
  \textbf{control+shift+enter}: executa o arquivo atual, mostrando comandos na tela (com eco -- código e saída);
\item
  \textbf{control+enter}: executa a linha selecionada, mostrando comandos na tela;
\item
  \textbf{control+shift+b}: executa os códigos do início do arquivo até a linha atual onde o cursor se encontra;
\item
  \textbf{control+shift+e}: executa os códigos da linha onde o cursor se encontra até o final do arquivo.
\end{itemize}

Sugere-se que esses atalhos sejam memorizados e utilizados. Isso facilita bastante o uso do programa. Para aqueles que gostam de utilizar o \emph{mouse}, uma maneira alternativa para rodar o código do \emph{script} é apertar o botão \emph{source}, localizado no canto direito superior do editor de rotinas. Isto é equivalente ao atalho \texttt{control+shift+s}.

Porém, no mundo real de programação, poucos são os casos em que uma análise de dados é realizada por um \emph{script} apenas. Como uma forma de organizar o código, pode-se dividir o trabalho em N \emph{scripts} diferentes, onde um deles é o ``mestre'', responsável por rodar os demais.

Neste caso, para executar os \emph{scripts} em sequência, basta chamá-los no \emph{script} mestre com o comando \texttt{source}, como no código a seguir: \index{base!source}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Import all data}
\FunctionTok{source}\NormalTok{(}\StringTok{\textquotesingle{}01{-}import{-}data.R\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Clean up}
\FunctionTok{source}\NormalTok{(}\StringTok{\textquotesingle{}02{-}clean{-}data.R\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Build tables}
\FunctionTok{source}\NormalTok{(}\StringTok{\textquotesingle{}03{-}build{-}table.R\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Nesse caso, o código anterior é equivalente a abrirmos e executarmos (\emph{control + shift + s}) cada um dos \emph{scripts} sequencialmente.

Como podemos ver, existem diversas maneiras de executar uma rotina de pesquisa. Na prática, porém, iras centralizar o uso em dois comandos apenas: \texttt{control+shift+s} para rodar o \emph{script} inteiro e \texttt{control+enter} para rodar por linha.

\hypertarget{testando-cuxf3digo}{%
\section{Testando Código}\label{testando-cuxf3digo}}

O desenvolvimento de códigos em R segue um conjunto de etapas. Primeiro você escreverá uma nova linha de comando em uma rotina. Essa linha será testada com o atalho \texttt{control\ +\ enter}, verificando-se a ocorrência de erros e as saídas na tela. Caso não houver erro e o resultado for igual ao esperado, parte-se para a próxima linha de código.

Um ciclo de trabalho fica claro, a escrita do código da linha atual é seguida pela execução, seguido da verificação de resultados, modificação caso necessário e assim por diante. Esse é um processo normal e esperado. Dado que uma rotina é lida e executada de cima para baixo, você precisa ter certeza de que cada linha de código está corretamente especificada antes de passar para a próxima.

Quando você está tentando encontrar um erro em um \emph{script} preexistente, o R oferece algumas ferramentas para controlar e avaliar sua execução. Isso é especialmente útil quando você possui um código longo e complicado. A ferramenta de teste mais simples e fácil de utilizar que o RStudio oferece é o ponto de interrupção do código. No RStudio, você pode clicar no lado esquerdo do editor e aparecerá um círculo vermelho, como na Figura \ref{fig:example-debug}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.6\linewidth]{00-text-resources/figs/RStudio_example_debug} 

}

\caption{Exemplo de debug}\label{fig:example-debug}
\end{figure}

O círculo vermelho indica um ponto de interrupção do código que forçará o R a pausar a execução nessa linha. Quando a execução atinge o ponto de interrupção, o \emph{prompt} mudará para \texttt{browser{[}1{]}\textgreater{}} e você poderá verificar o conteúdo dos objetos. No console, você tem a opção de continuar a execução para o próximo ponto de interrupção ou interrompê-la. O mesmo resultado pode ser alcançado usando a função \texttt{browser}. Dê uma olhada:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}

\CommentTok{\# set y}
\FunctionTok{browser}\NormalTok{()}
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}My humble text\textquotesingle{}}

\CommentTok{\# print contents of x}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

O resultado prático do código anterior é o mesmo que utilizar o círculo vermelho do RStudio, figura \ref{fig:example-debug}. Porém, o uso do \texttt{browser} permite mais controle sobre onde a execução deve ser pausada. Como um teste, copie e cole o código anterior no RStudio, salve em um novo \emph{script} e execute com \emph{Control + Shift + S}. Para sair do ambiente de depuramento (\emph{debug}), aperte \emph{enter} no \emph{prompt} do RStudio. \index{base!browser}

\hypertarget{criando-objetos-simples}{%
\section{Criando Objetos Simples}\label{criando-objetos-simples}}

Um dos comandos mais básicos no R é a definição de objetos. Como foi mostrado nas seções anteriores, pode-se definir um objeto com o uso do comando \texttt{\textless{}-}, o qual, para o português, é traduzido para o verbo \emph{defina} (\emph{assign} em inglês). Considere o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{123}

\CommentTok{\# set x, y and z in one line}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\NormalTok{ ; my\_y }\OtherTok{\textless{}{-}} \DecValTok{2}\NormalTok{; my\_z }\OtherTok{\textless{}{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

Lê-se esse código como \emph{x é definido como 123}. A direção da seta define onde o valor será armazenado. Por exemplo, utilizar \texttt{123\ -\textgreater{}\ my\_x} também funcionaria, apesar de ser uma sintaxe pouco utilizada ou recomendada. Note que também é possível escrever diversos comandos na mesma linha com o uso da semi-vírgula (\texttt{;}).

\begin{rmdimportant}
O uso do símbolo \texttt{\textless{}-} para a definição de objetos é
específico do R. Na época da concepção da linguagem \emph{S}, de onde o
R foi baseado, existiam teclados com uma tecla específica que definia
diretamente o símbolo de seta. Teclados contemporâneos, porém, não
possuem mais esta configuração. Uma alternativa é utilizar o atalho para
o símbolo, o qual, no Windows, é definido por \texttt{alt\ +\ -}.
\end{rmdimportant}

É possível também usar o símbolo \texttt{=} para definir objetos assim como o \texttt{\textless{}-}. Saliento que esta é prática comum em outras linguagens de programação. Porém, no ecosistema do R, a utilização do \texttt{=} com esse fim específico não é recomendada. O símbolo de igualdade tem o seu uso especial e resguardado na definição de argumentos de uma função tal como \texttt{sort(x\ =\ 1:10,\ decreasing\ =\ TRUE)}.

O nome dos objetos é importante no R. Tirando alguns casos específicos, o usuário pode nomear os objetos como quiser. Essa liberdade, porém, pode ser um problema. É desejável sempre dar nomes curtos que façam sentido ao conteúdo do objeto e que sejam simples de entender. Isso facilita o entendimento do código por outros usuários e faz parte das normas sugeridas para a estruturação do código. Observe que todos os objetos criados nesse livro possuem nomenclatura em inglês e formatação específica, onde espaços entre substantivos e verbos são substituídos por traço baixo, tal como em \texttt{my\_x} e \texttt{my\_csv\_file}. Aqui, o mais importante é a consistência do formato. Sempre mantenha o mesmo padrão em todo o código. No capítulo \ref{otimizacao} vamos ir mais a fundo nesta questão de estrutura de código.

O R executa o código procurando objetos e funções disponíveis no seu ambiente de trabalho (\emph{enviromnent}). Se tentarmos acessar um objeto que não existe, o R irá retornar uma mensagem de erro:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error in print(z): object 'z' not found
\end{verbatim}

Isso ocorre pois o objeto \texttt{z} não existe na sessão atual do R. Se criarmos uma variável \texttt{z} como \texttt{z\ \textless{}-\ 123} e repetirmos o comando \texttt{print(z)}, não teremos a mesma mensagem de erro.

Um ponto importante aqui é a definição de objetos de classes diferentes com o uso de símbolos específicos. O uso de aspas duplas (\texttt{"\ "}) ou simples (\texttt{\textquotesingle{}\ \textquotesingle{}}) define objetos da classe texto enquanto números são definidos pelo próprio valor. Conforme será mostrado, cada objeto no R tem uma classe e cada classe tem um comportamento diferente. Portanto, objetos criados com o uso de aspas pertencem à classe \emph{character}. Podemos confirmar isso via código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vars}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}1\textquotesingle{}}

\CommentTok{\# display classes}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

As saídas anteriores mostram que a variável \texttt{x} é do tipo numérico, enquanto a variável \texttt{y} é do tipo texto (\emph{character}). Ambas fazem parte das classes básicas de objetos no R. Por enquanto, este é o mínimo que deves saber para avançar nos próximos capítulos. Iremos estudar este assunto mais profundamente no capítulo \ref{classes-basicas}. \index{base!class}

\hypertarget{criando-vetores}{%
\section{Criando Vetores}\label{criando-vetores}}

Nos exemplos anteriores criamos objetos simples tal como \texttt{x\ \textless{}-\ 1} e \texttt{x\ \textless{}-\ \textquotesingle{}abc\textquotesingle{}}. Enquanto isso é suficiente para demonstrar os comandos básicos do R, na prática tais comandos são bastante limitados, uma vez que um problema real de análise de dados certamente irá ter um maior volume de informações do mundo real.

Um dos procedimentos mais utilizados no R é a criação de vetores atômicos. Esses são objetos que guardam uma série de elementos. Todos os elementos de um vetor atômico devem possuir a mesma classe, o que justifica a sua propriedade \emph{atômica}. Um exemplo seria representar no R uma série de preços diários de uma ação. Tal série possui vários valores numéricos que formam um vetor da classe numérica.

\textbf{Vetores atômicos são criados no R através do uso do comando \texttt{c}, o qual é oriundo do verbo em inglês \emph{combine}.} Por exemplo, caso eu quisesse \emph{combinar} os valores 1, 2 e 3 em um objeto/vetor, eu poderia fazê-lo através do seguinte comando: \index{base!c}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

Esse comando funciona da mesma maneira para qualquer número de elementos. Caso necessário, poderíamos criar um vetor com mais elementos simplesmente adicionando valores após o \texttt{3}, tal como em \texttt{x\ \textless{}-\ c(1,\ 2,\ 3,\ 4,\ 5)}.

O uso do comando \texttt{c} não é exclusivo para vetores numéricos. Por exemplo, poderíamos criar um vetor de outra classe de dados, tal como \emph{character}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}text 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}text 2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}text 3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}text 4\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "text 1" "text 2" "text 3" "text 4"
\end{verbatim}

A única restrição no uso do comando \texttt{c} é que todos os itens do vetor \textbf{tenham a mesma classe}. Se inserirmos dados de classes diferentes, o R irá tentar transformar os itens para a mesma classe seguindo uma lógica própria, onde a classe mais complexa sempre tem preferência. Caso ele não consiga transformar todos os elementos para uma classe só, uma mensagem de erro será retornada. Observe no próximo exemplo como os valores numéricos no primeiro e segundo elemento de \texttt{x} são transformados para a classe de caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# numeric class}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# character class}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{)}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

Outra utilização do comando \texttt{c} é a combinação de vetores. De fato, isto é exatamente o que fizemos ao executar o código \texttt{c(1,\ 2,\ 3)}. Neste caso, cada vetor possuía um elemento. Podemos realizar o mesmo com vetores maiores. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x and y}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\CommentTok{\# print concatenation between x and y}
\FunctionTok{print}\NormalTok{(}\FunctionTok{c}\NormalTok{(x, y))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 4 5
\end{verbatim}

Portanto, o comando \texttt{c} possui duas funções principais: criar e combinar vetores.

\hypertarget{conhecendo-os-objetos-criados}{%
\section{Conhecendo os Objetos Criados}\label{conhecendo-os-objetos-criados}}

Após a execução de diversos comandos no editor ou \emph{prompt}, é desejável saber quais são os objetos criados pelo código. É possível descobrir essa informação simplesmente olhando para o lado direito superior do RStudio, na aba da área de trabalho. Porém, existe um comando que sinaliza a mesma informação no \emph{prompt}. Com o fim de saber quais são as variáveis atualmente disponíveis na memória do R, pode-se utilizar o comando \texttt{ls}. Observe o exemplo a seguir: \index{base!ls}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vars}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{z }\OtherTok{\textless{}{-}} \DecValTok{3}

\CommentTok{\# show current objects}
\FunctionTok{ls}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "x" "y" "z"
\end{verbatim}

Os objetos \texttt{x}, \texttt{y} e \texttt{z} foram criados e estavam disponíveis no ambiente de trabalho atual, juntamente com outros objetos. Para descobrir os valores dos mesmos, basta digitar os nomes dos objetos e apertar \texttt{enter} no \emph{prompt}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3
\end{verbatim}

Destaca-se que digitar o nome do objeto na tela tem o mesmo resultado que utilizar a função \texttt{print}. De fato, ao executar o nome de uma variável, internamente o R passa esse objeto para a função \texttt{print}.

No R, conforme já mostrado, todos os objetos pertencem a alguma classe. Para descobrir a classe de um objeto, basta utilizar a função \texttt{class}. Observe no exemplo a seguir que \texttt{x} é um objeto da classe numérica e \texttt{y} é um objeto da classe de texto (\emph{character}). \index{base!class}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vars}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}a\textquotesingle{}}

\CommentTok{\# check classes}
\FunctionTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

Outra maneira de conhecer melhor um objeto é verificar a sua representação em texto. Todo objeto no R possui uma representação textual e a verificação desta é realizada através da função \texttt{str}: \index{base!str}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print textual representation of a vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  int [1:10] 1 2 3 4 5 6 7 8 9 10
R> NULL
\end{verbatim}

Essa função é particularmente útil quando se está tentando entender os detalhes de um objeto mais complexo, tal como uma tabela. A utilidade da representação textual é que nela aparece o tamanho do objeto e suas classes internas. Nesse caso, o objeto \texttt{x} é da classe \emph{integer} e possui dez elementos.

\hypertarget{mostrando-e-formatando-informauxe7uxf5es-na-tela}{%
\section{Mostrando e Formatando Informações na Tela}\label{mostrando-e-formatando-informauxe7uxf5es-na-tela}}

Como já vimos, é possível mostrar o valor de uma variável na tela de duas formas, digitando o nome dela no \emph{prompt} ou então utilizando a função \texttt{print}. Explicando melhor, a função \texttt{print} é voltada para a apresentação de objetos e pode ser customizada para qualquer tipo. Por exemplo, caso tivéssemos um objeto de classe chamada \texttt{MyTable} que representasse um objeto tabular, poderíamos criar uma função chamada \texttt{print.MyTable} que irá mostrar uma tabela na tela com um formato especial tal como número de linhas, nomes das colunas, etc. A função \texttt{print}, portanto, pode ser customizada para cada classe de objeto.

Porém, existem outras funções específicas para apresentar texto (e não objetos) no \emph{prompt}. A principal delas é \texttt{message}. Essa toma como \emph{input} um texto, processa-o para símbolos específicos e o apresenta na tela. Essa função é muito mais poderosa e personalizável do que \texttt{print}. \index{base!message}

Por exemplo, caso quiséssemos mostrar na tela o texto \texttt{\textquotesingle{}O\ valor\ de\ x\ é\ igual\ a\ 2\textquotesingle{}}, poderíamos fazê-lo da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set var}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{2}

\CommentTok{\# print with message()}
\FunctionTok{message}\NormalTok{(}\StringTok{\textquotesingle{}The value of x is\textquotesingle{}}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The value of x is2
\end{verbatim}

Função \texttt{message} também funciona para vetores:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vec}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{2}\SpecialCharTok{:}\DecValTok{5}

\CommentTok{\# print with message()}
\FunctionTok{message}\NormalTok{(}\StringTok{\textquotesingle{}The values in x are: \textquotesingle{}}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The values in x are: 2345
\end{verbatim}

A customização da saída da tela é possível através de comandos específicos. Por exemplo, se quiséssemos quebrar a linha da tela, poderíamos fazê-lo através do uso do caractere reservado \texttt{\textbackslash{}n}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char}
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}First line,}\SpecialCharTok{\textbackslash{}n}\StringTok{Second Line,}\SpecialCharTok{\textbackslash{}n}\StringTok{Third Line\textquotesingle{}}

\CommentTok{\# print with new lines}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> First line,
R> Second Line,
R> Third Line
\end{verbatim}

Observe que o uso do \texttt{print} não resultaria no mesmo efeito, uma vez que esse comando apresenta o texto como ele é, sem processar para efeitos específicos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "First line,\nSecond Line,\nThird Line"
\end{verbatim}

Outro exemplo no uso de comandos específicos para texto é adicionar um espaçamento \emph{tab} no texto apresentado com o símbolo \texttt{\textbackslash{}t}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char with \textbackslash{}t}
\NormalTok{my\_text\_1 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}A and B\textquotesingle{}}
\NormalTok{my\_text\_2 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{A and B\textquotesingle{}}
\NormalTok{my\_text\_3 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t\textbackslash{}t}\StringTok{A and B\textquotesingle{}}

\CommentTok{\# print with message()}
\FunctionTok{message}\NormalTok{(my\_text\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> A and B
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{message}\NormalTok{(my\_text\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  A and B
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{message}\NormalTok{(my\_text\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      A and B
\end{verbatim}

Vale destacar que, na grande maioria dos casos de pesquisa, será necessário apenas o uso de \texttt{\textbackslash{}n} para formatar textos de saída. Outras maneiras de manipular a saída de texto no \emph{prompt} com base em símbolos específicos são encontradas no \href{https://cran.r-project.org/doc/manuals/R-lang.html\#Literal-constants}{manual oficial do R}.

Parte do processo de apresentação de texto na tela é a customização do mesmo. Para isto, existem duas funções muito úteis: \texttt{paste} e \texttt{format}. \index{base!paste} \index{base!format}

A função \texttt{paste} \emph{cola} uma série de caracteres juntos. É uma função muito útil, a qual será utilizada intensamente para o resto dos exemplos deste livro. Observe o código a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set chars}
\NormalTok{my\_text\_1 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}I am a text\textquotesingle{}}
\NormalTok{my\_text\_2 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}very beautiful\textquotesingle{}}
\NormalTok{my\_text\_3 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}and informative.\textquotesingle{}}

\CommentTok{\# using paste and message}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(my\_text\_1, my\_text\_2, my\_text\_3))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a text very beautiful and informative.
\end{verbatim}

O resultado anterior não está muito longe do que fizemos no exemplo com a função \texttt{print}. Note, porém, que a função \texttt{paste} adiciona um espaço entre cada texto. Caso não quiséssemos esse espaço, poderíamos usar a função \texttt{paste0}: \index{base!paste0}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# using paste0}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(my\_text\_1, my\_text\_2, my\_text\_3))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a textvery beautifuland informative.
\end{verbatim}

\begin{rmdimportant}
Uma alternativa a função \texttt{message} é \texttt{cat}
(\emph{concatenate and print}). Não é incomum encontrarmos códigos onde
mensagens para o usuário são transmitidas via \texttt{cat} e não
\texttt{message}. Como regra, dê preferência a \texttt{message} pois
esta é mais fácil de controlar. Por exemplo, caso o usuário quiser
silenciar uma função, omitindo todas saídas da tela, bastaria usar o
comando \texttt{suppressMessages}.
\end{rmdimportant}

Outra possibilidade muito útil no uso do \texttt{paste} é modificar o texto entre a junção dos itens a serem colados. Por exemplo, caso quiséssemos adicionar uma vírgula e espaço (\texttt{,}) entre cada item, poderíamos fazer isso através do uso do argumento \texttt{sep}, como a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# using custom separator}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(my\_text\_1, my\_text\_2, my\_text\_3, }\AttributeTok{sep =} \StringTok{\textquotesingle{}, \textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a text, very beautiful, and informative.
\end{verbatim}

Caso tivéssemos um vetor atômico com os elementos da frase em um objeto apenas, poderíamos atingir o mesmo resultado utilizando \texttt{paste} o argumento \emph{collapse}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# using paste with collapse argument}
\NormalTok{my\_text }\OtherTok{\textless{}{-}}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Eu sou um texto\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}muito bonito\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}e charmoso.\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(my\_text, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}, \textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Eu sou um texto, muito bonito, e charmoso.
\end{verbatim}

Prosseguindo, o comando \texttt{format} é utilizado para formatar números e datas. É especialmente útil quando formos montar tabelas e buscarmos apresentar os números de uma maneira visualmente atraente. Por definição, o R apresenta uma série de dígitos após a vírgula:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# message without formatting}
\FunctionTok{message}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 0.333333333333333
\end{verbatim}

Caso quiséssemos apenas dois dígitos aparecendo na tela, utilizaríamos o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# message with format and two digits}
\FunctionTok{message}\NormalTok{(}\FunctionTok{format}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{3}\NormalTok{, }\AttributeTok{digits=}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 0.33
\end{verbatim}

Tal como, também é possível mudar o símbolo de decimal:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# message with format and two digits}
\FunctionTok{message}\NormalTok{(}\FunctionTok{format}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{3}\NormalTok{, }\AttributeTok{decimal.mark =} \StringTok{\textquotesingle{},\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 0,3333333
\end{verbatim}

Tal flexibilidade é muito útil quando devemos reportar resultados respeitando algum formato local tal como o Brasileiro.

Uma alternativa recente e muito interessante para o comando \texttt{base::paste} é \texttt{stringr::str\_c} e \texttt{stringr::str\_glue}. Enquanto a primeira é quase idêntica a \texttt{paste0}, a segunda tem uma maneira pecular de juntar objetos. Veja um exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\CommentTok{\# define some vars}
\NormalTok{my\_name }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Pedro\textquotesingle{}}
\NormalTok{my\_age }\OtherTok{\textless{}{-}} \DecValTok{23}

\CommentTok{\# using base::paste0}
\NormalTok{my\_str\_1 }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}My name is \textquotesingle{}}\NormalTok{, my\_name, }\StringTok{\textquotesingle{} and my age is \textquotesingle{}}\NormalTok{, my\_age)}

\CommentTok{\# using stringr::str\_c}
\NormalTok{my\_str\_2 }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(}\StringTok{\textquotesingle{}My name is \textquotesingle{}}\NormalTok{, my\_name, }\StringTok{\textquotesingle{} and my age is \textquotesingle{}}\NormalTok{, my\_age)}

\CommentTok{\# using stringr::str\_glue}
\NormalTok{my\_str\_3 }\OtherTok{\textless{}{-}} \FunctionTok{str\_glue}\NormalTok{(}\StringTok{\textquotesingle{}My name is \{my\_name\} and my age is \{my\_age\}\textquotesingle{}}\NormalTok{)}

\FunctionTok{identical}\NormalTok{(my\_str\_1, my\_str\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{identical}\NormalTok{(my\_str\_1, my\_str\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{identical}\NormalTok{(my\_str\_2, my\_str\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE
\end{verbatim}

Como vemos, temos três alternativas para o mesmo resultado final. Note que \texttt{str\_glue} usa de chaves para definir as variáveis dentro do próprio texto. Esse é um formato muito interessante e prático.

\hypertarget{conhecendo-o-tamanho-dos-objetos}{%
\section{Conhecendo o Tamanho dos Objetos}\label{conhecendo-o-tamanho-dos-objetos}}

Na prática de programação com o R, é muito importante saber o tamanho das variáveis que estão sendo utilizadas. Isso serve não somente para auxiliar o usuário na verificação de possíveis erros do código, mas também para saber o tamanho necessário em certos procedimentos de iteração tal como \emph{loops}, os quais serão tratados em capítulo futuro.

No R, o tamanho do objeto pode ser verificado com o uso de quatro principais funções: \texttt{length}, \texttt{nrow}, \texttt{ncol} e \texttt{dim}. \index{base!length} \index{base!nrow} \index{base!ncol} \index{base!dim}

A função \texttt{length} é destinada a objetos com uma única dimensão, tal como vetores atômicos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{)}

\CommentTok{\# get length x}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x)}

\CommentTok{\# display message}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}The length of x is\textquotesingle{}}\NormalTok{, n))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The length of x is 6
\end{verbatim}

Para objetos com mais de uma dimensão, por exemplo matrizes e dataframes, utilizam-se as funções \texttt{nrow}, \texttt{ncol} e \texttt{dim} para descobrir o número de linhas (primeira dimensão) e o número de colunas (segunda dimensão). Veja a diferença a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set matrix and print it}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{4}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    5    9   13   17
R> [2,]    2    6   10   14   18
R> [3,]    3    7   11   15   19
R> [4,]    4    8   12   16   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find number of rows, columns and elements}
\NormalTok{my\_nrow }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(x)}
\NormalTok{my\_ncol }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(x)}
\NormalTok{my\_length }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x)}

\CommentTok{\# print message}
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{The number of lines in x is \textquotesingle{}}\NormalTok{, my\_nrow))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> The number of lines in x is  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{The number of columns in x is \textquotesingle{}}\NormalTok{, my\_ncol))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> The number of columns in x is  5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{message}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{The number of elements in x is \textquotesingle{}}\NormalTok{, my\_length))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> The number of elements in x is  20
\end{verbatim}

Já a função \texttt{dim} mostra a dimensão do objeto, resultando em um vetor numérico como saída. Essa deve ser utilizada quando o objeto tiver mais de duas dimensões. Na prática, esses casos são raros. Um exemplo para a variável \texttt{x} é dado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 5
\end{verbatim}

Para o caso de objetos com mais de duas dimensões, podemos utilizar a função \texttt{array} para criá-los e \texttt{dim} para descobrir o seu tamanho:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set array with dimension}
\NormalTok{my\_array }\OtherTok{\textless{}{-}} \FunctionTok{array}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{dim =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_array)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> , , 1
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
R> 
R> , , 2
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
R> 
R> , , 3
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print its dimension}
\FunctionTok{print}\NormalTok{(}\FunctionTok{dim}\NormalTok{(my\_array))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3 3 3
\end{verbatim}

Uma observação importante aqui é que as funções \texttt{length}, \texttt{nrow}, \texttt{ncol} e \texttt{dim} não servem para descobrir o número de letras em um texto. Esse é um erro bastante comum. Por exemplo, caso tivéssemos um objeto do tipo texto e usássemos a função \texttt{length}, o resultado seria o seguinte:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}abcde\textquotesingle{}}

\CommentTok{\# find its length (and NOT number of characters)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{length}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

Isso ocorre pois a função \texttt{length} retorna o número de elementos. Nesse caso, \texttt{my\_char} possui apenas um elemento. Para descobrir o número de caracteres no objeto, utilizamos a função \texttt{nchar}, conforme a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# using nchar for number of characters}
\FunctionTok{print}\NormalTok{(}\FunctionTok{nchar}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5
\end{verbatim}

Reforçando, cada objeto no R tem suas propriedades e funções específicas para manipulação.

\hypertarget{selecionando-elementos-de-um-vetor-atuxf4mico}{%
\section{Selecionando Elementos de um Vetor Atômico}\label{selecionando-elementos-de-um-vetor-atuxf4mico}}

Após a criação de um vetor atômico de qualquer classe, é possível que se esteja interessado em apenas um ou alguns elementos desse mesmo vetor. Por exemplo, caso estivéssemos buscando atualizar o valor de um portfólio de investimento, o nosso interesse dentro de um vetor contendo preços de uma ação é somente para o preço mais recente. Todos os demais preços não seriam relevantes para a nossa análise e, portanto, poderiam ser ignorados.

Esse processo de seleção de \emph{pedaços} de um vetor atômico é chamado de indexação e é executado através do uso de colchetes \texttt{{[}{]}}. Observe o exemplo de código a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set my\_x}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{7}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\FloatTok{4.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Se quiséssemos apenas o terceiro elemento de \texttt{my\_x}, utilizaríamos o operador de colchete da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get third element of my\_x}
\NormalTok{elem\_x }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[}\DecValTok{3}\NormalTok{]}
\FunctionTok{print}\NormalTok{(elem\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4
\end{verbatim}

Também podemos utilizar o comando \texttt{length}, apresentado anteriormente, para acessar o último elemento do vetor:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get last element of my\_x}
\NormalTok{last\_elem }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[}\FunctionTok{length}\NormalTok{(my\_x)]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(last\_elem)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4.3
\end{verbatim}

No caso de estarmos interessado apenas no último e penúltimo valor de \texttt{my\_x} utilizaríamos o operador de sequência (\texttt{:}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get last and second last elements}
\NormalTok{piece\_x\_1 }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[ (}\FunctionTok{length}\NormalTok{(my\_x)}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(my\_x) ]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(piece\_x\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3.5 4.3
\end{verbatim}

Uma propriedade única da linguagem R é que, caso for acessado uma posição que não existe no vetor, o programa retorna o valor \texttt{NA} (\emph{not available}). Veja a seguir, onde tenta-se obter o quarto valor de um vetor com apenas três elementos.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vec}
\NormalTok{my\_vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}

\CommentTok{\# find fourth element (NA returned!)}
\FunctionTok{print}\NormalTok{(my\_vec[}\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] NA
\end{verbatim}

É importante conhecer esse comportamento do R, pois o não tratamento desses erros pode gerar problemas difíceis de identificar em um código mais complexo. Em outras linguagens de programação, a tentativa de acesso a elementos não existentes geralmente retorna um erro e cancela a execução do resto do código. No caso do R, dado que o acesso a elementos inexistentes não gera erro, é possível que isso gere um problema em outras partes do \emph{script}.

\begin{rmdimportant}
Geralmente, a ocorrência de \texttt{NAs} (\emph{Not Available}) sugere a
existência de problema no código. Saiba que \texttt{NA} indicam a falta
de dados e são contagiosos: tudo que interagir com objeto do tipo
\texttt{NA}, seja uma soma ou multiplicação, irá também virar
\texttt{NA}. \textbf{O usuário deve prestar atenção toda vez que
surgirem valores \texttt{NA} de forma inesperada nos objetos criados.}
Uma inspeção nos índices dos vetores pode ser necessária.
\end{rmdimportant}

O uso de indexadores é muito útil quando se está procurando por itens de um vetor que satisfaçam alguma condição. Por exemplo, caso quiséssemos todos os valores de \texttt{my\_x} que são maiores que 3, utilizaríamos o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get all values higher than 3}
\NormalTok{piece\_x\_2 }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[my\_x}\SpecialCharTok{\textgreater{}}\DecValTok{3}\NormalTok{]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(piece\_x\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5.0 4.0 7.0 3.5 4.3
\end{verbatim}

É possível também indexar por mais de uma condição através dos operadores de lógica \texttt{\&} (\emph{e}) e \texttt{\textbar{}} (\emph{ou}). Por exemplo, caso quiséssemos os valores de \texttt{my\_x} maiores que 2 e menores que 4, usaríamos o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get all values higher than 2 AND lower than 4}
\NormalTok{piece\_x\_3 }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[ (my\_x}\SpecialCharTok{\textgreater{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\&}\NormalTok{ (my\_x}\SpecialCharTok{\textless{}}\DecValTok{4}\NormalTok{) ]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(piece\_x\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3.0 3.5
\end{verbatim}

Da mesma forma, havendo interesse nos itens que são menores que 3 ou maiores que 6, teríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get all values lower than 3 OR higher than 6}
\NormalTok{piece\_x\_4 }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[ (my\_x}\SpecialCharTok{\textless{}}\DecValTok{3}\NormalTok{)}\SpecialCharTok{|}\NormalTok{(my\_x}\SpecialCharTok{\textgreater{}}\DecValTok{6}\NormalTok{) ]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(piece\_x\_4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 7
\end{verbatim}

A indexação lógica também funciona com a interação de diferentes variáveis, isto é, podemos utilizar uma condição lógica em uma variável para selecionar itens em outra:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set my\_x and my\_y}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{12}\NormalTok{)}
\NormalTok{my\_y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{)}

\CommentTok{\# find elements in my\_x where my\_y are positive}
\NormalTok{my\_piece\_x }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[ my\_y }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_piece\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  6  8 12
\end{verbatim}

Olhando mais de perto o processo de indexação, vale salientar que, quando utilizamos uma condição de indexação dos dados, esta-se criando uma variável do tipo lógica. Essa toma apenas dois valores: \texttt{TRUE} (verdadeiro) ou \texttt{FALSE} (falso). É fácil perceber isso quando criamos o teste lógico em um objeto e o mostramos na tela:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set logical object}
\NormalTok{my\_logical }\OtherTok{\textless{}{-}}\NormalTok{ my\_y }\SpecialCharTok{\textgreater{}} \DecValTok{0}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_logical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# show its class}
\FunctionTok{class}\NormalTok{(my\_logical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "logical"
\end{verbatim}

As demais propriedades e operações com vetores lógicos serão explicadas em capítulo futuro.

\hypertarget{limpando-a-memuxf3ria}{%
\section{Limpando a Memória}\label{limpando-a-memuxf3ria}}

Após a criação de diversas variáveis, o ambiente de trabalho do R pode ficar cheio de conteúdo já utilizado e dispensável. Nesse caso, é desejável limpar a memória do programa. Geralmente isso é realizado no começo de um \emph{script}, de forma que toda vez que o script for executado, a memória estará totalmente limpa antes de qualquer cálculo. Além de desocupar a memória do computador, isso ajuda a evitar possíveis erros no código. Na grande maioria dos casos, porém, a limpeza do ambiente de trabalho deve ser realizada apenas uma vez.

Por exemplo, dada uma variável \texttt{x}, podemos excluí-la da memória com o comando \texttt{rm}, conforme mostrado a seguir: \index{base!rm}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x and y}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{2}

\CommentTok{\# print all existing objects}
\FunctionTok{ls}\NormalTok{()}

\CommentTok{\# remove x from memory}
\FunctionTok{rm}\NormalTok{(}\StringTok{\textquotesingle{}x\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print objects again}
\FunctionTok{ls}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Observe que o objeto \texttt{x} não estará mais mais disponível após o uso do comando \texttt{rm(\textquotesingle{}x\textquotesingle{})}.

Entretanto, em situações práticas é desejável limpar toda a memória utilizada por todos os objetos disponíveis no R. Pode-se atingir esse objetivo com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# clean up workspace (all existing objects)}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list =} \FunctionTok{ls}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

O termo \texttt{list} é um argumento da função \texttt{rm}, o qual define quais objetos serão eliminados. Já o comando \texttt{ls()} mostra todas os objetos disponíveis atualmente. Portanto, ao encadear ambos os comandos, limpamos da memória \textbf{todos} os objetos disponíveis para o R. Como comentado, uma boa política de programação é sempre iniciar o \emph{script} limpando a memória do R. .

\begin{rmdcaution}
A limpeza da memória em \emph{scripts} é uma estratégia controversa.
Alguns autores argumentam que é melhor não limpar a memória pois isso
pode apagar resultados importantes. Na minha opinião, acho fundamental
limpar a memória, desde que todos resultados sejam reproduzíveis. Ao
iniciar um código sempre do mesmo estado, isto é, nenhuma variável
criada, fica mais fácil de entender e capturar possíveis \emph{bugs}.
\end{rmdcaution}

\hypertarget{mostrando-e-mudando-o-diretuxf3rio-de-trabalho}{%
\section{Mostrando e Mudando o Diretório de Trabalho}\label{mostrando-e-mudando-o-diretuxf3rio-de-trabalho}}

Assim como outros softwares, \textbf{o R sempre trabalha em algum diretório}. É com base nesse diretório que o R procura arquivos para importar dados. É nesse mesmo diretório que o R salva arquivos, caso não definirmos um endereço no computador explicitamente. Essa saída pode ser um arquivo de uma figura, um arquivo de texto ou uma planilha eletrônica. \textbf{Como boa prática de criação e organização de \emph{scripts}, deve-se sempre mudar o diretório de trabalho para onde o arquivo do \emph{script} está localizado}.

Em sua inicialização, o R possui como diretório \emph{default} a pasta de documentos do usuário cujo atalho é o tilda (\texttt{\textquotesingle{}\textasciitilde{}\textquotesingle{}}).

Para mostrar o diretório atual de trabalho, basta utilizar a função \texttt{getwd}: \index{base!getwd}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get current directory}
\NormalTok{my\_dir }\OtherTok{\textless{}{-}} \FunctionTok{getwd}\NormalTok{()}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_dir)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] home/msperlin/adfeR/01-Book Content
\end{verbatim}

O resultado do código anterior mostra a pasta onde este livro foi escrito. Esse é o diretório onde os arquivos do livro foram compilados dentro do ambiente Linux.

A mudança de diretório de trabalho é realizada através do comando \texttt{setwd}. Por exemplo, caso quiséssemos mudar o nosso diretório de trabalho para \emph{C:/Minha pesquisa/}, basta digitar no \emph{prompt}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set dir}
\NormalTok{my\_d }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}C:/Minha Pesquisa/\textquotesingle{}}
\FunctionTok{setwd}\NormalTok{(my\_d)}
\end{Highlighting}
\end{Shaded}

Enquanto para casos simples, como o anterior, lembrar o nome do diretório é fácil, em casos práticos o diretório de trabalho pode ser em um lugar mais profundo da raiz de diretórios do sistema de arquivos. Nessa situação, uma estratégia eficiente para descobrir a pasta de trabalho é utilizar um explorador de arquivos, tal como o \emph{Explorer} no Windows. Abra esse aplicativo e vá até o local onde quer trabalhar com o seu \emph{script}. Após isso, coloque o cursor na barra de endereço e selecione todo o endereço. Aperte \emph{control+c} para copiar o endereço para a área de transferência. Volte para o seu código e cole o mesmo no código. \textbf{Atenção nesta etapa, o Windows utiliza a barra invertida para definir endereços no computador, enquanto o R utiliza a barra normal}. Caso tente utilizar a barra invertida, um erro será mostrado na tela. Veja o exemplo a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_d }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}C:\textbackslash{}Minha pesquisa}\SpecialCharTok{\textbackslash{}\textquotesingle{}}
\StringTok{setwd(my\_d)}
\end{Highlighting}
\end{Shaded}

O erro terá a seguinte mensagem:

\begin{verbatim}
Error: '\M' is an unrecognized escape in character string..."
\end{verbatim}

A justificativa para o erro é que a barra invertida \texttt{\textbackslash{}} é um caractere reservado no R e não pode ser utilizado isoladamente. Caso precises, podes definí-lo no objeto de texto com dupla barra, tal como em \texttt{\textbackslash{}\textbackslash{}}. Veja no exemplo a seguir, onde a dupla barra é substituída por uma barra única:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char with \textbackslash{}}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}using }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\textquotesingle{}}

\CommentTok{\# print it}
\FunctionTok{message}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> using \
\end{verbatim}

A solução do problema é simples. Após copiar o endereço, modifique todas as barras para a barra normal, assim como no código a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_d }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}C:/Minha pesquisa/\textquotesingle{}}
\FunctionTok{setwd}\NormalTok{(my\_d)}
\end{Highlighting}
\end{Shaded}

É possível também utilizar barras invertidas duplas \texttt{\textbackslash{}\textbackslash{}} na definição de diretórios, porém não se recomenda essa formatação, pois não é compatível com outros sistemas operacionais.

Outro ponto importante aqui é o uso de endereços relativos. Por exemplo, caso esteja trabalhando em um diretório que contém um subdiretório chamado \texttt{Data}, podes entrar nele com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# change to subfolder}
\FunctionTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}Data\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Outra possibilidade pouco conhecida no uso de \texttt{setwd} é que é possível entrar em níveis inferiores do sistema de diretórios com \texttt{..}, tal como em:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# change to previous level}
\FunctionTok{setwd}\NormalTok{(}\StringTok{\textquotesingle{}..\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Portanto, caso estejas trabalhando no diretório \texttt{C:/My\ Research/} e executar o comando \texttt{setwd(\textquotesingle{}..\textquotesingle{})}, o diretório atual de trabalho viraria \texttt{C:/}, um nível inferior a \texttt{C:/My\ Research/}.

Uma maneira mais moderna e pouco conhecida de definir o diretório de trabalho é usar as funções internas do RStudio. Este é um conjunto de funções que só funcionam dentro do RStudio e fornecem diversas informações sobre o arquivo sendo editado. Para descobrir o caminho do arquivo atual que está sendo editado no RStudio e configurar o diretório de trabalho para lá, você pode escrever:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_path }\OtherTok{\textless{}{-}} \FunctionTok{dirname}\NormalTok{(rstudioapi}\SpecialCharTok{::}\FunctionTok{getActiveDocumentContext}\NormalTok{()}\SpecialCharTok{$}\NormalTok{path)}
\FunctionTok{setwd}\NormalTok{(my\_path)}
\end{Highlighting}
\end{Shaded}

Dessa forma, o \emph{script} mudará o diretório para sua própria localização. Apesar de não ser um código exatamente elegante, ele é bastante funcional. Caso copie o arquivo para outro diretório, o valor de \texttt{my\_path} muda para o novo diretório. Esteja ciente, no entanto, de que esse truque só funciona no editor de rotinas do RStudio e dentro de um arquivo salvo. O código não funcionará a partir do \emph{prompt}. \index{rstudioapi!getActiveDocumentContext} \index{base!dirname}

\begin{rmdimportant}
Outro truque bastante útil para definir diretórios de trabalho no R é
usar o símbolo \texttt{\textasciitilde{}}. Esse define a pasta
\texttt{\textquotesingle{}Documentos\textquotesingle{}} no
\emph{Windows}, a qual é única para cada usuário. Portanto, ao executar
\texttt{setwd(\textquotesingle{}\textasciitilde{}\textquotesingle{})},
irás direcionar o R a uma pasta de fácil acesso e livre modificação pelo
usuário atual do computador.
\end{rmdimportant}

\hypertarget{comentuxe1rios-no-cuxf3digo}{%
\section{Comentários no Código}\label{comentuxe1rios-no-cuxf3digo}}

Comentários são definidos usando o símbolo \texttt{\#}. Qualquer texto a direita desse símbolo não será processado pelo R. Note que até a cor do código a direita do \emph{hashtag} muda no RStudio. Isso dá liberdade para escrever o que for necessário dentro do \emph{script}. Um exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This is a comment}
\CommentTok{\# This is another comment}
\NormalTok{x }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}abc\textquotesingle{}} \CommentTok{\# this is another comment, but mixed with code}

\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{var1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,   }\CommentTok{\# set var 1}
             \AttributeTok{var2 =} \DecValTok{2}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)    }\CommentTok{\# another var}
\end{Highlighting}
\end{Shaded}

\textbf{Os comentários são uma eficiente maneira de comunicar qualquer informação importante que não pode ser inferida diretamente do código}. O uso correto de comentários é tão importante quanto o código em si. Quando bem feitos, aumentam a reproducibilidade, organização e entendimento do código. Em geral, você deve evitar o uso de comentários que são muito óbvios ou muito genéricos. Por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read a csv file}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{ (}\StringTok{\textquotesingle{}MyDataFile.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Como você pode ver, é bastante óbvio que a linha \texttt{df\ \textless{}-\ read.csv(\textquotesingle{}MyDataFile.csv\textquotesingle{})} está lendo um arquivo .csv. O nome da função, \texttt{read.csv} já afirma isso. Então, o comentário não foi bom pois não adicionou novas informações ao usuário. Uma melhor abordagem seria definir o autor, a descrição da funcionalidade do \emph{script} e explicar melhor a origem e a última atualização do arquivo de dados. Vamos dar uma olhada:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Script for reproducing results of JOHN (2018)}
\CommentTok{\# Author: Mr Researcher (dontspamme@emailprovider.com)}
\CommentTok{\# Last script update: 2018{-}01{-}10}
\CommentTok{\#}
\CommentTok{\# File downloaded from www.sitewithdatafiles.com/data{-}files/}
\CommentTok{\# The description of the data goes here}
\CommentTok{\#}
\CommentTok{\# Last file update: 2017{-}12{-}05}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{\textquotesingle{}MyDataFile.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Com esses comentários, o usuário saberá o propósito do \emph{script}, quem o escreveu e a data da última edição. A origem do arquivo e a data de atualização mais recente também estão disponíveis. Se o usuário quiser atualizar os dados, tudo o que ele tem a fazer é ir ao mencionado site e baixar o novo arquivo. Isso facilitará o uso futuro e o compartilhamento do \emph{script}.

Outro uso de comentários é \textbf{definir seções no código}, como em:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Script for reproducing results of JOHN (2018)}
\CommentTok{\# Author: Mr Researcher (dontspamme@emailprovider.com)}
\CommentTok{\# Last script update: 2018{-}01{-}10}
\CommentTok{\#}
\CommentTok{\# File downloaded from www.sitewithdatafiles.com/data{-}files/}
\CommentTok{\# The description of the data goes here}
\CommentTok{\#}
\CommentTok{\# Last file update: 2017{-}12{-}05}

\CommentTok{\# Clean data {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# {-} remove outliers}
\CommentTok{\# {-} remove unnecessary columns}

\CommentTok{\# Create descriptive tables {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}


\CommentTok{\# Estimate models {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}


\CommentTok{\# Report results {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

O uso de uma longa linha de traços (\texttt{-}) é intencional. Isto faz com que o RStudio identifique as seções do código e apresente no espaço abaixo do editor de rotinas um atalho para acessar as correspondentes linhas de cada seção. Teste você mesmo, copie e cole o código acima em um novo script do RStudio, salve o mesmo, e verás que as seções aparecem em um botão entre o editor e o \emph{prompt}. Desta forma, uma vez que você precisa mudar uma parte específica do código, você pode se dirigir rapidamente a seção desejada.

\begin{rmdcaution}
Quando começar a compartilhar código com outras pessoas, logo perceberás
que os comentários são essenciais e esperados. Eles ajudam a transmitir
informações que não estão disponíveis no código. Uma nota aqui, ao longo
do livro você verá que os comentários do código são, na maior parte do
tempo, bastante óbvios. Isso foi intencional, pois mensagens claras e
diretas são importantes para novos usuários, os quais fazem parte da
audiência.
\end{rmdcaution}

\hypertarget{cancelando-a-execuuxe7uxe3o-de-um-cuxf3digo}{%
\section{Cancelando a Execução de um Código}\label{cancelando-a-execuuxe7uxe3o-de-um-cuxf3digo}}

Toda vez que o R estiver executando algum código, uma sinalização visual no formato de um pequeno círculo vermelho no canto direito do \emph{prompt} irá aparecer. Caso conseguir ler (o símbolo é pequeno em monitores modernos), o texto indica o termo \emph{stop}. Esse símbolo não somente indica que o programa ainda está rodando mas também pode ser utilizado para cancelar a execução de um código. Para isso, basta clicar no referido botão. Outra maneira de cancelar uma execução é apontar o mouse no \emph{prompt} e pressionar a tecla \emph{Esc} no teclado.

Para testar o cancelamento de código, copie e cole o código a seguir em um \emph{script} do RStudio. Após salvar, rode o mesmo com \texttt{control+shift+s}.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{) \{}
  \FunctionTok{message}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Running code (please make it stop by hitting esc!)\textquotesingle{}}\NormalTok{)}
  \FunctionTok{Sys.sleep}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

O código anterior usa um comando especial do tipo \texttt{for} para mostrar a mensagem a cada segundo. Neste caso, o código demorará 100 segundos para rodar. Caso não desejes esperar, aperte \texttt{esc} para cancelar a execução. Por enquanto, não se preocupe com as funções utilizadas no exemplo. Iremos discutir o uso do comando \texttt{for} no capítulo \ref{programacao}.

\hypertarget{procurando-ajuda}{%
\section{Procurando Ajuda}\label{procurando-ajuda}}

Uma tarefa muito comum no uso do R é procurar ajuda. A quantidade de funções disponíveis para o R é gigantesca e memorizar todas peculariedades é quase impossível. Assim, até mesmo usuários avançados comumente procuram ajuda sobre tarefas específicas no programa, seja para entender detalhes sobre algumas funções ou estudar um novo procedimento. Portanto, saibas que o uso do sistema de ajuda do R faz parte do cotidiano.

É possível buscar ajuda utilizando tanto o painel de \emph{help} do RStudio como diretamente do \emph{prompt}. Para isso, basta digitar o ponto de interrogação junto ao objeto sobre o qual se deseja ajuda, tal como em \texttt{?mean}. Nesse caso, o objeto \texttt{mean} é uma função e o uso do comando irá abrir o painel de ajuda sobre ela. \index{base!?}

No R, toda tela de ajuda de uma função é igual, conforme se vê na Figura \ref{fig:ExemploAjuda} apresentada a seguir. Esta mostra uma descrição da função \texttt{mean}, seus argumentos de entrada explicados e também o seu objeto de saída. A tela de ajuda segue com referências e sugestões para outras funções relacionadas. Mais importante, os \textbf{exemplos de uso da função} aparecem por último e podem ser copiados e colados para acelerar o aprendizado no uso da função.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/ExemploAjuda} 

}

\caption{Tela de ajuda da função mean}\label{fig:ExemploAjuda}
\end{figure}

Caso quiséssemos procurar um termo nos arquivos de ajuda, bastaria utilizar o comando \texttt{??"standard\ deviation"}. Essa operação irá procurar a ocorrência do termo em todos os pacotes do R e é muito útil para aprender como realizar alguma operação, nesse caso o cálculo de desvio padrão.

Como sugestão, o ponto inicial e mais direto para aprender uma nova função é observando o seu exemplo de uso, localizada no final da página de ajuda. Com isto, podes verificar quais tipos de objetos de entrada a mesma aceita e qual o formato e o tipo de objeto na sua saída. Após isso, leia atentamente a tela de ajuda para entender se a mesma faz exatamente o que esperas e quais são as suas opções de uso nas respectivas entradas. Caso a função realizar o procedimento desejado, podes copiar e colar o exemplo de uso para o teu próprio \emph{script}, ajustando onde for necessário.

Outra fonte muito importante de ajuda é a própria internet. Sites como \href{http://stackoverflow.com/}{\emph{stackoverflow.com}} e \emph{mailing lists} específicos do R, cujo conteúdo também está na internet, são fontes preciosas de informação. Havendo alguma dúvida que não foi possível solucionar via leitura dos arquivos de ajuda do R, vale o esforço de procurar uma solução via mecanismo de busca na internet. Em muitas situações, o seu problema, por mais específico que seja, já ocorreu e já foi solucionado por outros usuários.

Caso estiver recebendo uma mensagem de erro enigmática, outra dica é copiar e colar a mesma para uma pesquisa no Google. Aqui apresenta-se outro benefício do uso da língua inglesa. É mais provável que encontres a solução se o erro for escrito em inglês, dado o maior número de usuários na comunidade global. Caso não encontrar uma solução desta forma, podes inserir uma pergunta no \href{http://stackoverflow.com/}{stackoverflow} ou no \href{https://www.facebook.com/groups/1410023525939155/}{grupo Brasileiro do R no Facebook}.

\begin{rmdcaution}
Toda vez que for pedir ajuda na internet, procure sempre 1) descrever
claramente o seu problema e 2) adicionar um código reproduzível do seu
problema. Assim, o leitor pode facilmente verificar o que está
acontecendo ao rodar o exemplo no seu computador. Não tenho dúvida que,
se respeitar ambas regras, logo uma pessoa caridosa lhe ajudará com o
seu problema.
\end{rmdcaution}

\hypertarget{utilizando-code-completion-com-a-tecla-tab}{%
\section{\texorpdfstring{Utilizando \emph{Code Completion} com a Tecla \emph{tab}}{Utilizando Code Completion com a Tecla tab}}\label{utilizando-code-completion-com-a-tecla-tab}}

Um dos recursos mais úteis do RStudio é o preenchimento automático de código (\emph{code completion}). Essa é uma ferramenta de edição que facilita o encontro de nomes de objetos, nome de pacotes, nome de arquivos e nomes de entradas em funções. O seu uso é muito simples. Após digitar um texto qualquer, basta apertar a tecla \emph{tab} e uma série de opções aparecerá. Veja a Figura \ref{fig:autocomplete} apresentada a seguir, em que, após digitar a letra \emph{f} e apertar \emph{tab}, aparece uma janela com uma lista de objetos que iniciam com a respectiva letra.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/autocomplete_objetos} 

}

\caption{Uso do autocomplete para objetos}\label{fig:autocomplete}
\end{figure}

Essa ferramenta também funciona para pacotes. Para verificar, digite \texttt{library(r)} no \emph{prompt} ou no editor, coloque o cursor entre os parênteses e aperte \emph{tab}. O resultado deve ser algo parecido com a figura \ref{fig:autocomplete-pacotes}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/autocomplete_pacotes} 

}

\caption{Uso do autocomplete para pacotes}\label{fig:autocomplete-pacotes}
\end{figure}

Observe que uma descrição do pacote ou objeto também é oferecida. Isso facilita bastante o dia a dia, pois a memorização das funcionalidades e dos nomes dos pacotes e os objetos do R não é uma tarefa fácil. O uso do \emph{tab} diminui o tempo de investigação dos nomes e evita possíveis erros de digitação na definição destes.

O uso dessa ferramenta torna-se ainda mais benéfico quando os objetos são nomeados com algum tipo de padrão. No restante do livro observarás que os objetos tendem a ser nomeados com o prefixo \emph{my}, como em \texttt{my\_x}, \texttt{my\_num}. O uso desse padrão facilita o encontro futuro do nome dos objetos, pois basta digitar \emph{my}, apertar \emph{tab} e uma lista de todos os objetos criados pelo usuário aparecerá.

Outro uso do \emph{tab} é no encontro de arquivos e pastas no computador. Basta criar uma variável como \texttt{my\_file\ \textless{}-\ "\ "}, apontar o cursor para o meio das aspas e apertar a tecla \emph{tab}. Uma tela com os arquivos e pastas do diretório atual de trabalho aparecerá, conforme mostrado na figura \ref{fig:autocomplete-arquivos}. Nesse caso específico, o R estava direcionado para a minha pasta de códigos, em que é possível enxergar diversos trabalhos realizados no passado.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/autocomplete_arquivos} 

}

\caption{Uso do autocomplete para arquivos}\label{fig:autocomplete-arquivos}
\end{figure}

Uma dica aqui é utilizar o \emph{tab} com a raiz do computador. Assumindo que o disco do seu computador está alocado para \texttt{C:/}, digite \texttt{my\_file\ \textless{}-\ "C:/"} e pressione \emph{tab} após o símbolo \texttt{/}. Uma tela com os arquivos da raiz do computador aparecerá no RStudio. Podes facilmente navegar o sistema de arquivos utilizando as setas e \emph{enter}.

O \emph{autocomplete} também funciona para encontrar e definir as entradas de uma função. Por se tratar de um tópico mais avançado, deixamos o seu uso e demonstração para o capítulo \ref{programacao}.

\begin{rmdimportant}
O \emph{autocomplete} é uma das ferramentas mais importantes do RStudio,
funcionando para encontro de objetos, locais no disco rígido, pacotes e
funções. Acostume-se a utilizar a tecla \emph{tab} o quanto antes e logo
verá como fica mais fácil escrever código rapidamente, e sem erros de
digitação.
\end{rmdimportant}

\hypertarget{interagindo-com-arquivos-e-o-sistema-operacional}{%
\section{Interagindo com Arquivos e o Sistema Operacional}\label{interagindo-com-arquivos-e-o-sistema-operacional}}

Em muitas situações de uso do R será necessário interagir com os arquivos do computador, seja criando novas pastas, descompactando e compactando arquivos, listando e removendo arquivos do disco rígido do computador ou qualquer outro tipo de operação. Na grande maioria dos casos, o interesse é na manipulação de arquivos contendo dados.

\hypertarget{listando-arquivos-e-pastas}{%
\subsection{Listando Arquivos e Pastas}\label{listando-arquivos-e-pastas}}

Para listar arquivos do computador, basta utilizar o função \texttt{list.files}. O argumento \texttt{path} define o diretório para listar os arquivos. Na construção deste livro foi criado um diretório chamado \emph{00-text-resources/data}, onde alguns dados são salvos. Pode-se verificar os arquivos nessa pasta com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_f }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\AttributeTok{path =} \StringTok{"00{-}text{-}resources/data"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_f[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "00-text-resources/data/AdjustedPrices-InternacionalIndices.RDATA"
R> [2] "00-text-resources/data/BovStocks_2011-12-01_2016-11-29.csv"      
R> [3] "00-text-resources/data/BovStocks_2011-12-01_2016-11-29.RData"    
R> [4] "00-text-resources/data/example_gethfdata.RDATA"                  
R> [5] "00-text-resources/data/FileWithLatinChar_ISO-8859-9.txt"
\end{verbatim}

Observe que nesse diretório encontram-se vários arquivos \emph{.csv}, \emph{.rds} e \emph{.xlsx}. Esses contêm dados que serão utilizados em capítulos futuros. Recomenda-se utilizar o argumento \texttt{full.names} como \texttt{TRUE}, o qual faz com que o retorno da função \texttt{list.files} contenha o caminho completo do arquivo. Isso facilita, por exemplo, uma possível importação de dados em que é necessário indicar não somente o nome do arquivo, mas a sua localização completa no computador. Destaca-se que também é possível listar os arquivos de forma recursiva, isto é, listar os arquivos de subpastas do endereço original. Para verificar, tente utilizar o seguinte código no seu computador:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# list all files recursively}
\FunctionTok{list.files}\NormalTok{(}\AttributeTok{path =} \FunctionTok{getwd}\NormalTok{(), }\AttributeTok{recursive =}\NormalTok{ T, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O comando anterior irá listar todos os arquivos existentes na pasta atual e subpastas de trabalho. Dependendo de onde o comando foi executado, pode levar um certo tempo para o término do processo. Caso precisar cancelar a execução, aperte \emph{esc} no teclado.

Para listar pastas (diretórios) do computador, basta utilizar o comando \texttt{list.dirs}. Veja a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# list directories}
\NormalTok{my\_dirs }\OtherTok{\textless{}{-}} \FunctionTok{list.dirs}\NormalTok{(}\AttributeTok{recursive =}\NormalTok{ F)}
\FunctionTok{print}\NormalTok{(my\_dirs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "./_book"                     
R>  [2] "./_bookdown_files"           
R>  [3] "./.Rproj.user"               
R>  [4] "./00-code-resources"         
R>  [5] "./00-text-resources"         
R>  [6] "./adfeR_pt_ed03_cache"       
R>  [7] "./adfeR_pt_ed03_files"       
R>  [8] "./adfeR_pt_ed03-ONLINE_cache"
R>  [9] "./adfeR_pt_ed03-ONLINE_files"
R> [10] "./gdfpd2_cache"              
R> [11] "./gfred_cache"               
R> [12] "./many_datafiles"            
R> [13] "./quandl_cache"              
R> [14] "./tabs"                      
R> [15] "./TD Files"
\end{verbatim}

No caso anterior, o comando lista todos os diretórios do trabalho atual sem recursividade. A saída do comando mostra os diretórios que utilizei para escrever este livro. Isso inclui o diretório de saída do livro (\texttt{./\_book}), entre diversos outros. Nesse mesmo diretório, encontram-se os capítulos do livro, organizados por arquivos e baseados na linguagem \emph{RMarkdown} (\texttt{.Rmd}). Para listar somente os arquivos com extensão \texttt{.Rmd}, utiliza-se o argumento \texttt{pattern} da função \texttt{list.files}, como a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{list.files}\NormalTok{(}\AttributeTok{path =} \FunctionTok{getwd}\NormalTok{(), }\AttributeTok{pattern =} \StringTok{"*.Rmd$"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "_BemVindo.Rmd"                             
R>  [2] "00a-Sobre-NovaEdicao.Rmd"                  
R>  [3] "00b-Prefacio.Rmd"                          
R>  [4] "01-Introducao.Rmd"                         
R>  [5] "02-Operacoes-Basicas.Rmd"                  
R>  [6] "03-Scripts-Pesquisa.Rmd"                   
R>  [7] "04-Importacao-Exportacao-Local.Rmd"        
R>  [8] "05-Importacao-Internet.Rmd"                
R>  [9] "06-Objetos-Armazenamento.Rmd"              
R> [10] "07-Objetos-Basicos.Rmd"                    
R> [11] "08-Programacao-com-R--ONLINE.Rmd"          
R> [12] "09-Limpando-Estruturando-Dados--ONLINE.Rmd"
R> [13] "10-Figuras--ONLINE.Rmd"                    
R> [14] "11-Modelagem--ONLINE.Rmd"                  
R> [15] "12-Reportando-resultados--ONLINE.Rmd"      
R> [16] "13-Otimizacao-código--ONLINE.Rmd"          
R> [17] "14-Referencias.Rmd"                        
R> [18] "adfeR_pt_ed03-ONLINE.Rmd"                  
R> [19] "index.Rmd"
\end{verbatim}

O texto \texttt{*.Rmd\$} orienta o R a procurar todos arquivos que terminam o seu nome com o texto \emph{.Rmd}. Os símbolos \texttt{\textquotesingle{}*\textquotesingle{}\textquotesingle{}} e \texttt{\textquotesingle{}\$\textquotesingle{}} são operadores específicos para o encontro de padrões em texto em uma linguagem chamada regex (\emph{regular expressions}) e, nesse caso, indicam que o usuário quer encontrar todos arquivos com extensão \emph{.Rmd}. O símbolo '*' diz para ignorar qualquer texto anterior a `.Rmd' e `\$' indica o fim do nome do arquivo. Os arquivos apresentados anteriormente contêm todo o conteúdo deste livro, incluindo este próprio parágrafo, localizado no arquivo \texttt{02-OperacoesBasicas.Rmd}!

\hypertarget{apagando-arquivos-e-diretuxf3rios}{%
\subsection{Apagando Arquivos e Diretórios}\label{apagando-arquivos-e-diretuxf3rios}}

A remoção de arquivos é realizada através do comando \texttt{file.remove}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create temporary file}
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}MyTemp.csv\textquotesingle{}}
\FunctionTok{write.csv}\NormalTok{(}\AttributeTok{x =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{),}
          \AttributeTok{file =}\NormalTok{ my\_file)}

\CommentTok{\# delete it}
\FunctionTok{file.remove}\NormalTok{(my\_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

Lembre-se que deves ter permissão do seu sistema operacional para apagar um arquivo. Para o nosso caso, o retorno \texttt{TRUE} mostra que a operação teve sucesso.

Para deletar diretórios e todos os seus elementos, utilizamos \texttt{unlink}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create temp dir}
\FunctionTok{dir.create}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{)}

\CommentTok{\# fill it with file}
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}temp/tempfile.csv\textquotesingle{}}
\FunctionTok{write.csv}\NormalTok{(}\AttributeTok{x =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{),}
          \AttributeTok{file =}\NormalTok{ my\_file)}

\FunctionTok{unlink}\NormalTok{(}\AttributeTok{x =} \StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{, }\AttributeTok{recursive =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A função, neste caso, não retorna nada. Podes checar se o diretório existe com \texttt{dir.exists}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dir.exists}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE
\end{verbatim}

\begin{rmdcaution}
Não preciso nem dizer, \textbf{tenha muito cuidado} com comandos
\texttt{file.remove} e \texttt{unlink}, principalmente quando utilizar a
recursividade (\texttt{recursive\ =\ TRUE}). Uma execução errada e
partes importantes do seu disco rídigo podem ser apagadas, deixando o
seu computador inoperável. Vale salientar que o R \textbf{realmente
apaga} os arquivos e não somente manda para a lixeira. Portanto, ao
apagar diretórios com \texttt{unlink}, não poderás recuperar os
arquivos.
\end{rmdcaution}

\hypertarget{utilizando-arquivos-e-diretuxf3rios-temporuxe1rios}{%
\subsection{Utilizando Arquivos e Diretórios Temporários}\label{utilizando-arquivos-e-diretuxf3rios-temporuxe1rios}}

Um aspecto interessante do R é que ele possui uma pasta temporária que é criado na inicialização do programa. Esse diretório serve para guardar quaisquer arquivos descartáveis gerados pelo R. A cada nova sessão do R, um novo diretório temporário é criado. Ao inicializarmos o computador, essa pasta temporária é deletada.

O endereço do diretório temporário de uma sessão do R é verificado com \texttt{tempdir}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_tempdir }\OtherTok{\textless{}{-}} \FunctionTok{tempdir}\NormalTok{()}
\FunctionTok{message}\NormalTok{(}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{\textquotesingle{}My tempdir is \{my\_tempdir\}\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> My tempdir is /tmp/RtmpN2n71F
\end{verbatim}

O último texto do diretório, neste caso RtmpN2n71F é aleatóriamente definido e irá trocar a cada nova sessão do R.

A mesma dinâmica é encontrada para nomes de arquivos. Caso queira, por algum motivo, utilizar um nome temporário e aleatório para algum arquivo com extensão \emph{.txt}, utilize \texttt{tempfile} e defina a entrada \texttt{fileext}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_tempfile }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.txt\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_tempfile)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> /tmp/RtmpN2n71F/file11cf6322e075.txt
\end{verbatim}

Note que o nome do arquivo -- file11cf6322e075.txt -- é totalmente aleatório e mudará a cada chamada de \texttt{tempfile}.

\hypertarget{baixando-arquivos-da-internet}{%
\subsection{Baixando Arquivos da Internet}\label{baixando-arquivos-da-internet}}

O R pode baixar arquivos da Internet diretamente no código. Isso é realizado com a função \texttt{download.file}. Veja o exemplo a seguir, onde baixamos uma planilha de Excel do site da Microsoft para um arquivo temporário:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set link}
\NormalTok{link\_dl }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}go.microsoft.com/fwlink/?LinkID=521962\textquotesingle{}}
\NormalTok{local\_file }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.xlsx\textquotesingle{}}\NormalTok{) }\CommentTok{\# name of local file}

\FunctionTok{download.file}\NormalTok{(}\AttributeTok{url =}\NormalTok{ link\_dl,}
              \AttributeTok{destfile =}\NormalTok{ local\_file)}
\end{Highlighting}
\end{Shaded}

O uso de \texttt{download.file} é bastante prático quando se está trabalhando com dados da Internet que são constantemente atualizados. Basta baixar e atualizar o arquivo com dados no início do \emph{script}. Poderíamos continuar a rotina lendo o arquivo baixado e realizando a nossa análise dos dados disponíveis.

Um exemplo nesse caso é a tabela de empresas listadas na bolsa divulgada pela CVM (comissão de valores mobiliários). A tabela está disponível em um arquivo no \href{http://dados.cvm.gov.br/dados/CIA_ABERTA/CAD/DADOS/cad_cia_aberta.csv}{site}. Podemos baixar o arquivo e, logo em seguida, ler os dados.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set destination link and file}
\NormalTok{my\_link }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}http://dados.cvm.gov.br/dados/CIA\_ABERTA/CAD/DADOS/cad\_cia\_aberta.csv\textquotesingle{}}
\NormalTok{my\_destfile }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# download file}
\FunctionTok{download.file}\NormalTok{(my\_link, }
              \AttributeTok{destfile =}\NormalTok{ my\_destfile, }
              \AttributeTok{mode =} \StringTok{"wb"}\NormalTok{)}

\CommentTok{\# read it}
\NormalTok{df\_cvm }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(my\_destfile,}
                     \CommentTok{\#delim = \textquotesingle{}\textbackslash{}t\textquotesingle{},}
                     \AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{encoding =} \StringTok{\textquotesingle{}Latin1\textquotesingle{}}\NormalTok{),}
                     \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> i Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check available columns}
\FunctionTok{print}\NormalTok{(}\FunctionTok{names}\NormalTok{(df\_cvm))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "CNPJ_CIA"           "DENOM_SOCIAL"      
R>  [3] "DENOM_COMERC"       "DT_REG"            
R>  [5] "DT_CONST"           "DT_CANCEL"         
R>  [7] "MOTIVO_CANCEL"      "SIT"               
R>  [9] "DT_INI_SIT"         "CD_CVM"            
R> [11] "SETOR_ATIV"         "TP_MERC"           
R> [13] "CATEG_REG"          "DT_INI_CATEG"      
R> [15] "SIT_EMISSOR"        "DT_INI_SIT_EMISSOR"
R> [17] "CONTROLE_ACIONARIO" "TP_ENDER"          
R> [19] "LOGRADOURO"         "COMPL"             
R> [21] "BAIRRO"             "MUN"               
R> [23] "UF"                 "PAIS"              
R> [25] "CEP"                "DDD_TEL"           
R> [27] "TEL"                "DDD_FAX"           
R> [29] "FAX"                "EMAIL"             
R> [31] "TP_RESP"            "RESP"              
R> [33] "DT_INI_RESP"        "LOGRADOURO_RESP"   
R> [35] "COMPL_RESP"         "BAIRRO_RESP"       
R> [37] "MUN_RESP"           "UF_RESP"           
R> [39] "PAIS_RESP"          "CEP_RESP"          
R> [41] "DDD_TEL_RESP"       "TEL_RESP"          
R> [43] "DDD_FAX_RESP"       "FAX_RESP"          
R> [45] "EMAIL_RESP"         "CNPJ_AUDITOR"      
R> [47] "AUDITOR"
\end{verbatim}

Existem diversas informações interessantes nestes dados incluindo nome e CNPJ de empresas listadas (ou deslistadas) da bolsa de valores Brasileira. E, mais importante, o arquivo está sempre atualizado. O código anterior estará sempre buscando os dados mais recentes a cada execução.

\hypertarget{exerc-operacoes-basicas}{%
\section{Exercícios}\label{exerc-operacoes-basicas}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Crie um novo \emph{script}, salve o mesmo em uma pasta pessoal. Agora, escreva os comandos no script que definam dois objetos: um contendo uma sequência entre 1 e 100 e outro com o texto do seu nome (ex. \texttt{\textquotesingle{}Ricardo\textquotesingle{}}). Execute o código com os atalhos no teclado.

02 -
No \emph{script} criado anteriormente, use função \texttt{message} para mostrar a seguinte frase no \emph{prompt} do R: \texttt{"My\ name\ is\ ...."}.

03 -
Dentro do mesmo script, mostre o diretório atual de trabalho (veja função \texttt{getwd}, tal como em \texttt{print(getwd())}). Agora, modifique o seu diretório de trabalho para o \emph{Desktop} (\emph{Área de Trabalho}) e mostre a seguinte mensagem na tela do \emph{prompt}: \texttt{\textquotesingle{}My\ desktop\ address\ is\ ....\textquotesingle{}}. Dica: use e abuse da ferramenta \emph{autocomplete} do RStudio para rapidamente encontrar a pasta do \emph{desktop}.

04 -
Utilize o R para baixar o arquivo compactado com o material do livro, disponível nesse \href{https://www.msperlin.com/files/adfer-files/adfeR-code-and-data.zip}{link}\footnote{\url{https://www.msperlin.com/files/adfer-files/adfeR-code-and-data.zip}}. Salve o mesmo como um arquivo na pasta temporária da sessão (veja função \texttt{tempfile}).

05 -
Utilize a função \texttt{unzip} para descompactar o arquivo baixado na questão anterior para um diretório chamado \texttt{\textquotesingle{}adfeR-Files\textquotesingle{}} dentro da pasta do ``Desktop''. Quantos arquivos estão disponíveis na pasta resultante? Dica: use o argumento \texttt{recursive\ =\ TRUE} com \texttt{list.files} para procurar também todos subdiretórios disponíveis.

06 -
Toda vez que o usuário instala um pacote do R, os arquivos particulares ao pacote são armazenados localmente em uma pasta específica do computador. Utilizando comando \texttt{Sys.getenv(\textquotesingle{}R\_LIBS\_USER\textquotesingle{})} e \texttt{list.dirs}, liste todos os diretórios desta pasta. Quantos pacotes estão disponíveis nesta pasta do seu computador?

07 -
No mesmo assunto do exercício anterior, liste todos os arquivos em todas as subpastas do diretório contendo os arquivos dos diferentes pacotes. Em média, quantos arquivos são necessários para cada pacote?

08 -
Use função \texttt{install.packages} para instalar o pacote \texttt{BatchGetSymbols} no seu computador. Após a instalação, use função \texttt{BatchGetSymbols::BatchGetSymbols} para baixar dados de preços para a ação da Petrobrás -- PETR3 (PETR3.SA no Yahoo finance) -- nos últimos 15 dias. Dicas: 1) use função \texttt{Sys.Date()} para definir data atual e \texttt{Sys.Date()\ -\ 15} para calcular a data localizada 15 dias no passado; 2) note que a saída de \texttt{BatchGetSymbols} é uma lista, um tipo especial de objeto, e o que os dados de preços estão localizados no segundo elemento dessa lista.

09 -
O pacote \texttt{cranlogs} permite o acesso a estatísticas de \emph{downloads} de pacotes do CRAN. Após instalar o \texttt{cranlogs} no seu computador, use função \texttt{cranlogs::cran\_top\_downloads} para verificar quais são os 10 pacotes mais instalados pela comunidade global no último mês. Qual o pacote em primeiro lugar? Dica: Defina a entrada da função \texttt{cran\_top\_downloads} como sendo \texttt{when\ =\ \textquotesingle{}last-month\textquotesingle{}}. Também note que a resposta aqui pode não ser a mesma que obteve pois esta depende do dia em que foi executado o código.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  dplyr
\item
  vctrs
\item
  ggplot2
\item
  cli
\item
  ragg
\end{enumerate}

10 -
Utilizando pacote \texttt{devtools}, instale a versão de desenvolvimento do pacote \texttt{ggplot2}, disponível no repositório de \href{https://github.com/hadley}{Hadley Hickman}. Carregue o pacote usando \texttt{library} e crie uma figura simples com o código \texttt{qplot(y\ =\ rnorm(10),\ x\ =\ 1:10)}.

11 -
Utilizando sua capacidade de programação, verifique no seu computador qual pasta, a partir do diretório de ``Documentos'' (atalho = \texttt{\textasciitilde{}}), possui o maior número de arquivos. Apresente na tela do R as cinco pastas com maior número de arquivos.

\hypertarget{scripts-pesquisa}{%
\chapter{Desenvolvendo Rotinas de Pesquisa}\label{scripts-pesquisa}}

No capítulo anterior aprendemos a utilizar o R e RStudio para operações básicas tal como a criação de \emph{scripts}, manipulação de objetos no R, mudança de diretório de trabalho, entre outras. Antes de passarmos para a importação de dados, é necessário discutirmos como organizar uma rotina de pesquisa no seu computador.

Neste capítulo iremos tratar das etapas de pesquisa e a organização de arquivos no computador, incluindo dados e rotinas. O principal objetivo aqui é mostrar e justificar um formato de trabalho que facilite o desenvolvimento e compartilhamento de código. Por exemplo, ao abrir um diretório de projeto antigo, a própria estrutura dos arquivos e pastas já indicará como o mesmo funciona e quais as suas entradas e saídas.

\hypertarget{etapas-de-uma-pesquisa}{%
\section{Etapas de uma Pesquisa}\label{etapas-de-uma-pesquisa}}

Um \emph{script} de pesquisa pode ser organizado em quatro etapas consecutivas:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{Importação dos dados}: Dados crus (originais) do mundo real são importados para a sua sessão do R, seja de arquivo local ou da internet. Neste momento, nenhum tipo de manipulação de dados ou reformatação manual deve acontecer. Como regra de bolso, \textbf{dados crus nunca devem ser tocados}. Deixe toda e qualquer manipulação para a etapa seguinte.
\item
  \textbf{Limpeza e estruturação dos dados}: Dados importados na fase anterior são processados em uma etapa de limpeza e estruturação. Registros anormais e erros em observações são eliminados ou tratados das tabelas originais. Novas variáveis de interesse são criadas com base nos dados importados. A estrutura dos dados originais também pode ser refeita de acordo com a necessidade. O resultado final dessa etapa deve ser, preferencialmente, uma tabela final com todos os dados necessários para a análise do problema.
\item
  \textbf{Visualização de dados e teste de hipóteses}: Após limpar e estruturar os dados, o próximo passo é realizar a análise em si, a qual será visual, através da criação de diversas figuras, ou então com a estimação de modelos e testes de hipótese. Essa etapa refere-se ao próprio problema da pesquisa. Na grande maioria dos casos, essa é a fase que exigirá maior trabalho, visto que representa o coração da pesquisa. Essa etapa termina com a criação de arquivos, tal como uma figura com extensão \emph{.png}, que serão utilizados na etapa seguinte.
\item
  \textbf{Reportando os resultados}: A última etapa é a criação dos objetos de interesse a serem reportados no artigo ou relatório. Esses objetos geralmente referem-se a tabelas e figuras, que podem ser exportados como arquivos externos e futuramente importados em um relatório.
\end{enumerate}

Cada uma das etapas anteriores pode ser estruturada em um único arquivo \emph{.R} ou em vários arquivos separados. O uso de vários arquivos é preferível quando as etapas de cada pesquisa demandarem muito tempo de processamento. Por exemplo, na importação e organização de uma base de dados de grande volume, vale a pena separar os procedimentos em arquivos diferentes. Isto facilita o encontro de erros e manutenção do código.

Um caso prático seria a análise de dados volumosos de transações financeiras no mercado de capitais. A importação e limpeza desses dados leva muito tempo. Uma organização inteligente da estrutura da pesquisa seria dividir as etapas em diferentes \emph{scripts} do R e, usando arquivos locais de dados como ``pontes'', lincar um script com outro. Assim, a rotina de importação e limpeza de dados salva um arquivo \emph{.rds} no final de sua execução, o qual é importando no \emph{script} de teste de hipóteses. Desta forma, uma mudança na modelagem do problema não exige que todo o processo de limpeza dos dados seja refeito. Essa simples organização de arquivos economiza bastante tempo. A lógica é clara: isole as partes da pesquisa que exigem muito tempo de execução -- e pouco de desenvolvimento --, e conecte as mesmas com o resto do código usando arquivos externos de dados, tal como arquivos \emph{.rds} e \emph{.csv}.

Caso você for trabalhar com diversos arquivos, uma sugestão é criar uma estrutura de nomenclatura que defina as etapas da pesquisa. Um exemplo seria nomear o código de importação de dados como \texttt{01-Import-and-clean-data.R}, o código de modelagem como \texttt{02-build-report-models.R} e assim sucessivamente. O efeito prático é que o uso de um contador na primeira letra do nome do arquivo faz com que a ordem de execução do programa fique clara. Indo além, você pode criar um \emph{script} mestre chamado \texttt{00-run-it-all.R} que roda (comando \texttt{source}) todos as outras rotinas. Assim, toda vez que realizar uma atualização nos dados originais, você pode simplesmente executar \texttt{00-run-it-all.R} e terá os novos resultados, sem necessitar rodar cada \emph{script} individualmente.

\hypertarget{diretorios}{%
\section{A Estrutura de Diretórios}\label{diretorios}}

Uma estrutura de organização de diretórios também beneficia a reprodutibilidade e organização da pesquisa. Para rotinas simples, com uma base de dados única e um baixo número de procedimentos, não é necessário dispender muito tempo pensando na organização dos arquivos nos diretórios. Para programas mais complexos, onde existem diversas etapas de pesquisa e diversas bases de dados, uma segmentação dos diretórios é não somente recomendada como essencial.

Uma estrutura de diretórios que considero eficiente é criar um diretório único para a pesquisa e, dentro dele, criar subdiretórios para cada elemento de entrada e saída. Por exemplo, você pode criar um subdiretório chamado \texttt{data}, onde todos os dados originais serão guardados, um diretório \texttt{figs} e um \texttt{tables}, para onde figuras e tabelas com resultados de interesse serão exportadas. Para funções utilizadas na pesquisa, você pode também criar um diretório chamado \texttt{R-Fcts}. Todos os \emph{scripts} principais da pesquisa, e nada mais, devem ficar na raiz do diretório de pesquisa. Um exemplo da estrutura de arquivos seria:

\begin{verbatim}
/Capital Markets and Inflation/
    /data/
        stock_indices.csv
        inflation_data.csv
    /figs/
        SP500_and_inflation.png
    /tables/
        Table1_descriptive_table.tex
        Table2_model_results.tex
    /R-Fcts/
        fct_models.R
        fct_clean_data.R
    0-run-it-all.R
    1-import-and-clean-data.R
    2-run-research.R
\end{verbatim}

O código de pesquisa também deve ser independente, com todos os arquivos disponíveis em uma subpasta do diretório raiz. Se você estiver usando muitos pacotes diferentes, é aconselhável adicionar um comentário nas primeiras linhas de \texttt{0-run-it-all.R} que indica quais pacotes são necessários para executar o código. A forma mais amigável de informar é adicionando uma linha comentada que instala todos os pacotes necessários, como em \texttt{\#\ install.packages\ (\textquotesingle{}pkg1\textquotesingle{},\ \textquotesingle{}pkg2\textquotesingle{},\ ...)}. Portanto, quando alguém recebe o código pela primeira vez, tudo o que ele (ou ela) precisa fazer é retirar o símbolo de comentário e executar a rotina. Dependências externas e etapas para a instalação correta do software também devem ser informadas.

Os benefícios deste formato de diretório são os seguintes. Se você precisar compartilhar o código com outros pesquisadores, basta compactar o diretório em um único arquivo e enviá-lo ao destinatário. Após descompactar o arquivo, a estrutura da pasta informa imediatamente ao usuário onde deve alterar os dados originais, a ordem de execução dos scripts na pasta raiz e onde as saídas são salvas. O mesmo benefício acontece quando você reutiliza seu código no futuro, digamos, daqui a três anos. Ao trabalhar de forma mais inteligente, você será mais produtivo, gastando menos tempo com etapas repetitivas e desnecessárias.

Seguindo a sugestão de um \emph{script} mestre, um exemplo comentado para o conteúdo do arquivo \texttt{00-run-it-all.R} seria:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# clean up workspace}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list=}\FunctionTok{ls}\NormalTok{())}

\CommentTok{\# close all figure windows created with x11()}
\FunctionTok{graphics.off}\NormalTok{()}

\CommentTok{\# load packages}
\FunctionTok{library}\NormalTok{(pkg1)}
\FunctionTok{library}\NormalTok{(pkg2)}
\FunctionTok{library}\NormalTok{(pkg3)}

\CommentTok{\# change directory}
\NormalTok{my\_dir }\OtherTok{\textless{}{-}} \FunctionTok{dirname}\NormalTok{(rstudioapi}\SpecialCharTok{::}\FunctionTok{getActiveDocumentContext}\NormalTok{()}\SpecialCharTok{$}\NormalTok{path)}
\FunctionTok{setwd}\NormalTok{(my.d)}

\CommentTok{\# list  functions in \textquotesingle{}R{-}Fcts\textquotesingle{}}
\NormalTok{my\_R\_files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\AttributeTok{path=}\StringTok{\textquotesingle{}R{-}Fcts\textquotesingle{}}\NormalTok{,}
                         \AttributeTok{pattern =} \StringTok{\textquotesingle{}*.R\textquotesingle{}}\NormalTok{,}
                         \AttributeTok{full.names=}\ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# Load all functions in R}
\FunctionTok{sapply}\NormalTok{(my\_R\_files,source)}

\CommentTok{\# Import data script}
\FunctionTok{source}\NormalTok{(}\StringTok{\textquotesingle{}01{-}import{-}and{-}clean{-}data.R\textquotesingle{}}\NormalTok{)}

\CommentTok{\# run models and report results}
\FunctionTok{source}\NormalTok{(}\StringTok{\textquotesingle{}02{-}run{-}research.R\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Essa é a primeira vez que usamos as funções \texttt{graphics.off} e \texttt{sapply}. A primeira fecha todas janelas de gráficos abertas. Essas tendem a acumular no decorrer do trabalho e devem ser fechadas no início de um novo \emph{script}. O comando \texttt{sapply} aplica uma função, nesse caso \texttt{source}, para uma série de elementos. O efeito prático em \texttt{sapply(my\_R\_files,\ source)} é que todos arquivos com extensão \emph{.R} localizados na pasta \texttt{R-Fct} serão executados. Ou seja, todas funções que escrevermos nos arquivos \texttt{fct\_models.R} e \texttt{fct\_clean\_data.R} serão carregadas em nossa sessão de trabalho. Futuramente, capítulos \ref{figuras} e \ref{programacao}, iremos voltar ao assunto de uso de funções customizadas.

Note que, assumindo que todos os pacotes já estão instalados no computador, o script \texttt{00-run-it-all.R} é facilmente compartilhável e irá rodar em outro computador com nenhum problema. Caso o leitor quiser ir um passo além, pode também utilizar a função \texttt{file.copy} para copiar todos os arquivos de figuras para a pasta de escrita do artigo ou documento acadêmico. A partir disso, crie um link no texto para cada arquivo copiado anteriormente. Como exemplo, no LaTex você pode incluir um arquivo de figura com o comando \texttt{\textbackslash{}includegraphics\{filenamehere\}}. Pode também criar um link direto entre o arquivo de escrita e a figura da pesquisa, apesar de esse método não ser recomendado, uma vez que ele cria uma dependência externa ao arquivo de escrita. Em ambas as formas, todas as figuras da pesquisa serão automaticamente atualizadas no texto e estarão sincronizadas com os arquivos provenientes do código da pesquisa. Para tabelas, a importação não é tão simples, pois uma tabela pode ser escrita em diversos formatos. Existem, porém, pacotes específicos para lidar com isso. No capítulo \ref{reportando-resultados} estudaremos uma forma eficiente de reportar resultados utilizando os pacotes \texttt{xtable} \citep{R-xtable}, \texttt{texreg} \citep{R-texreg}, entre outros.

\hypertarget{pontos-importantes-em-uma-pesquisa}{%
\section{Pontos Importantes em uma Pesquisa}\label{pontos-importantes-em-uma-pesquisa}}

Aproveitando o tópico de execução de pesquisa, vou colocar aqui algumas sugestões para a realização de pesquisas com o R. Deixo claro que essas são posições pessoais, oriundas das minha experiência de trabalho. Muitos pontos levantados aqui são específicos para o ambiente acadêmico, porém podem ser facilmente estendíveis para a prática de pesquisa fora das universidades.

\textbf{Em primeiro lugar, conheça os seus dados!} Entendo que o primeiro instinto ao se deparar com uma nova base de dados é instantaneamente importá-la no R e sair realizando análises. Aqui, um certo nível de cautela é necessário. Toda vez que se deparar com um conjunto de dados novos, se pergunte o quanto você \textbf{realmente} conhece esses dados:

\begin{itemize}
\tightlist
\item
  Como os dados foram coletados? Para que fim?
\item
  Como estes dados se comparam com dados já utilizados em outros trabalhos?
\item
  Existe alguma possibilidade de viés na forma de coleta dos dados?
\end{itemize}

Lembre-se que o propósito final de qualquer pesquisa é a comunicação. Certamente irás reportar os resultados para pessoas que irão ter algum tipo de opinião informada sobre a pesquisa. É provável que os avaliadores terão mais experiência que você no assunto, incluindo sobre as fontes e individualidades dos dados. Não desejo para ninguém estar em uma situação onde um esforço de pesquisa, com investimento de 3 a 6 meses de trabalho entre programação e escrita, é anulado por um simples lapso na checagem dos dados. Infelizmente, isso não é incomum.

Portanto, \textbf{seja muito cauteloso sobre os dados que estás utilizando}. Um detalhe que passa despercebido pode invalidar toda uma pesquisa. Caso tiver sorte e a base de dados vier acompanhada de um manual escrito, destrinche o mesmo até os últimos detalhes. Elenque as principais dúvidas em relação aos dados e, em caso das informações não estarem claras, não seja tímido em enviar os questionamentos para o responsável.

O segundo ponto é o código. Após terminar de ler este livro, o seu computador se tornará um poderoso aliado em fazer realidade as suas ideias de pesquisa, por mais gigantescas e mirabolantes que forem. Porém, \textbf{um grande poder vem acompanhado de grande responsabilidade}. Um erro de código pode facilmente inviabilizar ou tendenciar a sua pesquisa.

Lembre que analisar dados é a sua profissão e a \textbf{sua reputação é o seu maior ativo}. Caso não tenhas confiança no código produzido, não publique ou comunique os seus resultados. O código de sua pesquisa é de total responsabilidade sua e de mais ninguém. Verifique e questione o mesmo quantas vezes for necessário. Seja, sempre, o avaliador mais criterioso do seu trabalho:

\begin{itemize}
\tightlist
\item
  As estatísticas descritivas das variáveis relatam fielmente a base de dados?
\item
  Existe alguma relação entre as variáveis que pode ser verificada na tabela descritiva?
\item
  Os resultados encontrados fazem sentido para a literatura atual do assunto? Caso não, como explicá-los?
\item
  É possível que um \emph{bug} no código tenha produzido o resultado encontrado?
\end{itemize}

Ainda me surpreendo como pesquisas submetidas a respeitados periódicos podem ser negadas a publicação baseado em uma simples análise da tabela descritiva dos dados construídos. Erros básicos de cálculos de variáveis são facilmente encontrados para um olho treinado, que sabe onde procurar. Esse processo de avaliação contínua da sua pesquisa não somente o deixará mais forte como pesquisador(a) mas também servirá de treino para a prática de avaliação de pares, muito utilizada na pesquisa acadêmica. Caso não tenhas confiança suficiente para reportar os resultados, teste o seu código ostensivamente. Caso já o tenha feito e ainda não estás confiante, identifique as linhas de código que tens mais dificuldade e busque ajuda com um colega ou o seu orientador, caso existir. Este último é um forte aliado que pode ajudá-lo com a sua maior experiência.

Todo o trabalho de pesquisa é, de certa forma, baseado em trabalhos já existentes. Atualmente é extremamente difícil realizar algum tipo de pesquisa que seja totalmente inovadora. O conhecimento é construído na forma de blocos, um sobre o outro. Sempre existe uma parcela de literatura que deve ser consultada. Particularmente para o caso de pesquisa em dados, deves sempre comparar os seus resultados com os resultados já apresentados na literatura do assunto, principalmente quando é um estudo replicado. Caso os resultados principais não forem semelhantes aos encontrados na literatura, questione-se o porquê disso. Será que um erro de código pode ter criado esse resultado?

Deixo claro que é possível sim que resultados de uma pesquisa sejam diferentes dos da literatura, porém, o contrário é mais provável. O conhecimento disso demanda cuidado com o seu código. \emph{Bugs} e erros de código são bastante comuns, principalmente nas primeiras versões das rotinas. É importante reconhecer este risco e saber administrá-lo.

\hypertarget{exerc-scripts-pesquisa}{%
\section{Exercícios}\label{exerc-scripts-pesquisa}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Imagine uma pesquisa envolvendo a análise do seu orçamento doméstico ao longo do tempo. Dados estão disponíveis em planilhas eletrônicas separadas por mês, durante 10 anos. O objetivo da pesquisa é entender se é possível a compra de um imóvel daqui a cinco anos. A partir disso, detalhe em texto os elementos em cada etapa do estudo, desde importação dos dados até a construção do relatório.

02 -
Com base no estudo proposto anteriormente, crie uma estrutura de diretórios em seu computador para acomodar a pesquisa. Em um arquivo texto na pasta raiz da pesquisa, assinale arquivos fictícios para cada subdiretório (veja estrutura de diretórios no início da seção \ref{diretorios}). Note que a criação dos diretórios pode ser realizada pelo próprio R.

\hypertarget{importacao-exportacao}{%
\chapter{Importação e Exportação de Dados Locais}\label{importacao-exportacao}}

Sem dúvida, a primeira etapa de um \emph{script} de pesquisa é carregar os seus dados em uma sessão do R. Neste capítulo iremos aprender a importar e exportar dados contidos em arquivos locais. Apesar de não ser uma tarefa particularmente difícil, um analista de dados deve entender as diferentes características de cada formato de arquivo e como tirar vantagem deste conhecimento em cada situação. Enquanto algumas facilitam a colaboração e troca de dados, outras podem oferecer um ganho significativo em tempo de execução na leitura e gravação.

Aqui iremos traçar uma lista abrangente com os seguintes formatos e extensões de arquivos:

\begin{itemize}
\tightlist
\item
  Dados delimitados em texto (\emph{csv});
\item
  Microsoft Excel (\emph{xls}, \emph{xlsx});
\item
  Arquivos de dados nativos do R (\emph{RData} e \emph{rds})
\item
  Formato \texttt{fst} (\emph{fst})
\item
  SQLite (\emph{SQLITE})
\item
  Texto não estruturado (\emph{txt}).
\end{itemize}

A primeira lição na importação de dados para o R é que o local do arquivo deve ser indicado explicitamente no código. Este endereço é passado para a função que irá ler o arquivo. Veja a definição a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}C:/Data/MyData.csv\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Note o uso de barras (\texttt{/}) para designar o diretório do arquivo. Referências relativas também funcionam, tal como em:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Data/MyData.csv\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Neste caso, assume-se que na pasta atual de trabalho existe um diretório chamado \texttt{Data} e, dentro desse, um arquivo denominado \texttt{MyData.csv}. Se o endereço do arquivo é simplesmente o seu nome, assume-se que o mesmo encontra-se na raiz da pasta de trabalho. Para verificar o endereço atual de trabalho, utilize a função \texttt{getwd}. \index{base!getwd}

\begin{rmdimportant}
Aqui novamente reforço o uso do \emph{tab} e \emph{autocomplete} do
RStudio. É muito mais \textbf{fácil e prático} encontrar arquivos do
disco rígido do computador usando a navegação via \emph{tab} do que
copiar e colar o endereço do seu explorador de arquivos. Para usar, abra
aspas no RStudio, coloque o cursor do \emph{mouse} entre as aspas e
aperte \emph{tab}.
\end{rmdimportant}

Um ponto importante aqui é que os \textbf{dados serão importados e exportados no R como objetos do tipo \texttt{dataframe}}. Isto é, uma tabela contida em um arquivo Excel ou \emph{.csv} se transformará em um objeto do tipo \texttt{dataframe} no ambiente de trabalho do R. Quando exportarmos dados, o formato mais comum é esse mesmo tipo de objeto. Convenientemente, \texttt{dataframes} são nada mais que tabelas, com linhas e colunas.

Cada coluna do \texttt{dataframe} importado terá a sua própria classe, sendo as mais comuns numérica (\emph{numeric}), texto (\emph{character}), fator (\emph{factor}) e data (\emph{Date}). Quando realizando a importação, \textbf{é de fundamental importância que os dados sejam representados na classe correta}. Uma vasta quantidade de erros podem ser evitados pela simples checagem das classes das colunas no \texttt{dataframe} resultante do processo de importação. Por enquanto somente é necessário entender esta propriedade básica de \texttt{dataframes}. Estudaremos esse objeto mais profundamente no capítulo \ref{classe-estrutura}.

\hypertarget{pacote-adfer}{%
\section{\texorpdfstring{Pacote \texttt{adfeR}}{Pacote adfeR}}\label{pacote-adfer}}

Nas seções futuras iremos utilizar o pacote do livro -- \texttt{adfeR} -- para carregar diversos exemplos de arquivos. Se você seguiu as instruções da seção \emph{Material Suplementar} localizada no prefácio do livro, já deves ter o pacote instalado. Caso contrário, execute o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install devtools (if not installed)}
\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{require}\NormalTok{(devtools)) }\FunctionTok{install.packages}\NormalTok{ (}\StringTok{\textquotesingle{}devtools\textquotesingle{}}\NormalTok{)}

\CommentTok{\# install book package}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{ (}\StringTok{\textquotesingle{}msperlin/adfeR\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Uma vez que você instalou o pacote \texttt{adfeR}, todos os arquivos de dados usados no livro foram baixados. Podemos verificar os cinco primeiros arquivos disponíveis com o comando \texttt{adfeR::list\_available\_data}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# list available data files}
\FunctionTok{print}\NormalTok{(adfeR}\SpecialCharTok{::}\FunctionTok{list\_available\_data}\NormalTok{()[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "batchgetsymbols_parallel_example.rds"
R> [2] "Brazil_footbal_games.csv"            
R> [3] "example_tsv.csv"                     
R> [4] "FileWithLatinChar_Latin1.txt"        
R> [5] "FileWithLatinChar_UTF-8.txt"
\end{verbatim}

Os arquivos anteriores estão salvos na pasta de instalação dos pacote \texttt{adfeR}. Para ter o caminho completo, basta usar função \texttt{adfeR::get\_data\_file} tendo o nome do arquivo como entrada:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get location of file}
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}grunfeld.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_f)}
\end{Highlighting}
\end{Shaded}

A partir de agora iremos usar a função \texttt{adfeR::get\_data\_file} para obter o caminho dos arquivos utilizados nos exemplos. Note que, desde que tenha o pacote \texttt{adfeR} instalado, podes facilmente reproduzir todos os exemplos do livro no seu computador.

\hypertarget{arquivos-csv}{%
\section{\texorpdfstring{Arquivos \emph{csv}}{Arquivos csv}}\label{arquivos-csv}}

Considere o arquivo de dados no formato \texttt{csv} chamado \texttt{\textquotesingle{}Ibov.csv\textquotesingle{}}, pertencente ao repositório do livro. Vamos copiar o mesmo para a pasta ``Meus Documentos'' com o uso do tilda (\texttt{\textasciitilde{}}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get location of file}
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}Ibov.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# copy to \textasciitilde{}}
\FunctionTok{file.copy}\NormalTok{(}\AttributeTok{from =}\NormalTok{ my\_f, }
          \AttributeTok{to =} \StringTok{\textquotesingle{}\textasciitilde{}\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

Caso seja a primeira vez trabalhando com arquivos do tipo \emph{.csv}, sugiro usar o explorador de arquivos do Windows e abrir Ibov.csv com qualquer editor de texto instalado, tal como o \emph{Notepad} (veja figura \ref{fig:notepad}). Observe que as primeiras linhas do arquivo definem os nomes das colunas: ``ref.date'' e ``price.close''. Conforme notação internacional, as linhas são definidas pela quebra do texto e as colunas pelo uso da vírgula (\texttt{,}).

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{00-text-resources/figs/example_csv_notepad} 

}

\caption{Ibov.csv no Notepad}\label{fig:notepad}
\end{figure}

\begin{rmdcaution}
Quando trabalhando com dados brasileiros, a notação internacional pode
gerar uma confusão desnecessária. Dados locais tendem a usar a vírgula
para indicar valores decimais em números. Assim, é comum que dados
locais do Brasil sejam exportados usando a semi-vírgula (\texttt{;})
como separador de colunas e a própria vírgula como símbolo de decimais.
Como regra de bolso, \textbf{nunca mude o formato no arquivo de texto
original}. Deixe esse serviço para o próprio R e seus pacotes.
\end{rmdcaution}

O conteúdo de Ibov.csv é bastante conservador e não será difícil importar o seu conteúdo. Porém, saiba que muitas vezes o arquivo \emph{.csv} vem com informações extras de cabeçalho -- o chamado \emph{metadata} -- ou diferentes formatações que exigem adaptações. Como sugestão para evitar problemas, antes de prosseguir para a importação de dados em um arquivo \emph{.csv}, abra o arquivo em um editor de texto qualquer e siga os seguintes passos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  Verifique a existência de texto antes dos dados e a necessidade de ignorar algumas linhas iniciais. A maioria dos arquivos .csv não contém cabeçalho, porém deves sempre checar. No R, a função de leitura de arquivos \emph{.csv} possui uma opção para ignorar um definido número de linhas antes de começar a leitura do arquivo;
\item
  Verifique a existência ou não dos nomes das colunas na primeira linha com os dados. Em caso negativo, verifique com o autor qual o nome (e significado) das colunas;
\item
  Verifique qual o símbolo de separador de colunas. Comumente, seguindo notação internacional, será a vírgula, porém nunca se tem certeza sem checar;
\item
  Para dados numéricos, verifique o símbolo de decimal, o qual deve ser o ponto (\texttt{.}) tal como em \texttt{2.5}. Caso necessário, podes ajustar o símbolo na própria função de leitura;
\item
  Verifique a codificação do arquivo de texto. Normalmente é UTF-8, Latin1 (ISO-8859) ou windows1252. Esses são formatos amplos e devem ser suficientes para a maioria dos idiomas. Sempre que você encontrar símbolos estranhos nas colunas de texto do \texttt{dataframe} resultante, o problema é devido a uma diferença na codificação entre o arquivo e o R. Os usuários do Windows podem verificar a codificação de um arquivo de texto abrindo-o no software \href{https://notepad-plus-plus.org/}{Notepad++}\footnote{\url{https://notepad-plus-plus.org/}}. As informações sobre a codificação estarão disponíveis no canto inferior direito do editor. No entanto, você precisa estar ciente de que o Notepad++ não faz parte da instalação do Windows e pode ser necessário instalá-lo em seu computador. Os usuários de Linux e Mac podem encontrar as mesmas informações em qualquer software editor de texto avançado, como o \href{https://kate-editor.org/}{Kate}\footnote{\url{https://kate-editor.org/}}.
\end{enumerate}

\begin{rmdimportant}
Sempre que você encontrar uma estrutura de texto inesperada em um
arquivo \emph{.csv}, use os argumentos da função de leitura \emph{csv}
para importar as informações corretamente. Repetindo, \textbf{nunca
modifique dados brutos manualmente}. É muito mais eficiente usar o
código R para lidar com diferentes estruturas de arquivos em
\emph{.csv}. Pode parecer mais trabalhoso, mas essa política vai
economizar muito tempo no futuro, pois, em algumas semanas, você
provavelmente esquecerá como limpou manualmente aquele arquivo
\emph{.csv} utilizado em pesquisa passada. Com o uso de código para a
adaptação da importação de dados, sempre que você precisar atualizar o
arquivo de dados, o código irá resolver todos os problemas,
automatizando o processo.
\end{rmdimportant}

\hypertarget{importauxe7uxe3o-de-dados}{%
\subsection{Importação de Dados}\label{importauxe7uxe3o-de-dados}}

O R possui uma função nativa chamada \texttt{base::read.csv} para importar dados de arquivos \emph{.csv}. Porém, esse é um dos muitos casos em que a alternativa do \texttt{tidyverse} -- \texttt{readr::read\_csv} -- é mais eficiente e mais fácil de trabalhar. Resumindo, \texttt{readr::read\_csv} lê arquivos mais rapidamente que \texttt{base::read.csv}, além de usar regras mais inteligentes para definir as classes das colunas importadas.

Este é a primeira vez que usamos um pacote do \texttt{tidyverse}, neste caso o \texttt{readr}. Antes de fazer isso, é necessário instalá-lo em sua sessão R. Uma maneira simples de instalar todos os pacotes pertencentes ao \texttt{tidyverse} é instalar o módulo de mesmo nome:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}tidyverse\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Após executar o código anterior, todos os pacotes \texttt{tidyverse} serão instalados em seu computador. Você também deve ter em mente que alguns aspectos dessa instalação podem demorar um pouco. Assim que terminar, carregue o conjunto de pacotes \texttt{tidyverse}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load library}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

De volta à importação de dados de arquivos \emph{.csv}, use a função \texttt{readr::read\_csv} para carregar o conteúdo do arquivo Ibov.csv no R: \index{readr} \index{readr!read\_csv}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set file to read}
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}Ibov.csv\textquotesingle{}}\NormalTok{)}

\CommentTok{\# read data}
\NormalTok{my\_df\_ibov }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(my\_f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2716 Columns: 2
R> -- Column specification ------------------------------------
R> Delimiter: ","
R> dbl  (1): price.close
R> date (1): ref.date
R> 
R> i Use `spec()` to retrieve the full column specification for this data.
R> i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

O conteúdo do arquivo importado é convertido para um objeto do tipo \texttt{dataframe} no R. Conforme mencionado no capítulo anterior, cada coluna de um \texttt{dataframe} tem uma classe. Podemos verificar as classes de \texttt{my\_df\_ibov} usando a função \texttt{glimpse} do pacote \texttt{dplyr}, que também faz parte do \texttt{tidyverse}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check content}
\FunctionTok{glimpse}\NormalTok{(my\_df\_ibov)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,716
R> Columns: 2
R> $ ref.date    <date> 2010-01-04, 2010-01-05, 2010-01-06, 2~
R> $ price.close <dbl> 70045, 70240, 70729, 70451, 70263, 704~
\end{verbatim}

Observe que a coluna de datas (\texttt{ref.date}) foi importada como um vetor \texttt{Date} e os preços de fechamento como numéricos (\texttt{dbl}, precisão dupla). Isso é exatamente o que esperávamos. Internamente, a função \texttt{read\_csv} identifica as classes das colunas de acordo com seu conteúdo.

Observe também como o código anterior apresentou a mensagem ``Parsed with column specification: \ldots{}''. Essa mensagem mostra como a função identifica as classes das colunas lendo as primeiras 1000 linhas do arquivo. Regras inteligentes tentam prever a classe com base no conteúdo importado. Podemos usar essas informações em nosso próprio código copiando o texto e atribuindo-o a uma variável: \index{readr!cols}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set cols from readr import message}
\NormalTok{my\_cols }\OtherTok{\textless{}{-}} \FunctionTok{cols}\NormalTok{(}
  \AttributeTok{price.close =} \FunctionTok{col\_double}\NormalTok{(),}
  \AttributeTok{ref.date =} \FunctionTok{col\_date}\NormalTok{(}\AttributeTok{format =} \StringTok{""}\NormalTok{)}
\NormalTok{)}

\CommentTok{\# read file with readr::read\_csv}
\NormalTok{my\_df\_ibov }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(my\_f,}
                       \AttributeTok{col\_types =}\NormalTok{ my\_cols)}
\end{Highlighting}
\end{Shaded}

Como um exercício, vamos importar os mesmos dados, porém usando a classe \texttt{character} (texto) para colunas \texttt{ref.date}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set cols from readr import message}
\NormalTok{my\_cols }\OtherTok{\textless{}{-}} \FunctionTok{cols}\NormalTok{(}
  \AttributeTok{price.close =} \FunctionTok{col\_double}\NormalTok{(),}
  \AttributeTok{ref.date =} \FunctionTok{col\_character}\NormalTok{()}
\NormalTok{)}

\CommentTok{\# read file with readr::read\_csv}
\NormalTok{my\_df\_ibov }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(my\_f,}
                       \AttributeTok{col\_types =}\NormalTok{ my\_cols)}

\CommentTok{\# check content}
\FunctionTok{glimpse}\NormalTok{(my\_df\_ibov)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,716
R> Columns: 2
R> $ ref.date    <chr> "2010-01-04", "2010-01-05", "2010-01-0~
R> $ price.close <dbl> 70045, 70240, 70729, 70451, 70263, 704~
\end{verbatim}

Como esperado, a coluna de datas -- \texttt{ref.date} -- agora foi importada como texto. Assim, o uso de \texttt{readr::read\_csv} pode ser resumido em duas etapas: 1) leia o arquivo sem argumentos em \texttt{read\_csv}; 2) copie o texto das classes de coluna padrão da mensagem de saída e adicione como entrada \texttt{col\_types}. O conjunto de passos anterior é suficiente para a grande maioria dos casos. O uso da mensagem com as classes das colunas é particularmente útil quando o arquivo importado tem várias colunas e a definição manual de cada classe exige muita digitação.

Uma alternativa mais prática no uso do \texttt{read\_csv} é confiar na heurística da função e usar a definição padrão das colunas automaticamente. Para isto, basta definir a entrada \texttt{col\_types} como \texttt{cols()}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read file with readr::read\_csv}
\NormalTok{my\_df\_ibov }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(my\_f,}
                       \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

Agora, vamos estudar um caso mais anormal de arquivo \emph{.csv}. No pacote do livro temos um arquivo chamado \texttt{funky\_csv\_file.csv} onde:

\begin{itemize}
\tightlist
\item
  o cabeçalho possui texto com informações dos dados;
\item
  o arquivo usará a vírgula como decimal;
\item
  o texto do arquivo conterá caracteres latinos.
\end{itemize}

As primeiras 10 linhas dos arquivos contém o seguinte conteúdo:

\begin{verbatim}
R> Exemplo de arquivo .csv com formato alternativo:
R> - colunas separadas por ";"
R> - decimal como ","
R> 
R> Dados retirados em 2021-01-13
R> Origem: www.funkysite.com.br
R> 
R> COD.UF;COD;NOME;state;SIGLA;number_col
R> 35;3546306;Santa Cruz das Palmeiras;São Paulo; SP;1,90208656713367
R> 21;2103109;Cedral;Maranhão; MA;69,8087496915832
\end{verbatim}

Note a existência do cabeçalho até linha de número 7 e as colunas sendo separadas pela semi-vírgula (``;'').

Ao importar os dados com opções padrões (e erradas), teremos o resultado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}funky\_csv\_file.csv\textquotesingle{}}\NormalTok{)}

\NormalTok{df\_funky }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(my\_f, }
                     \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{())}

\FunctionTok{glimpse}\NormalTok{(df\_funky)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2
R> Columns: 1
R> $ `Exemplo de arquivo .csv com formato alternativo:` <chr> ~
\end{verbatim}

Claramente a importação deu errado, com a emissão de diversas mensagens de \emph{warning}. Para resolver, utilizamos o seguinte código, estruturando todas as particularidades do arquivo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_not\_funky }\OtherTok{\textless{}{-}} \FunctionTok{read\_delim}\NormalTok{(}\AttributeTok{file =}\NormalTok{ my\_f, }
                           \AttributeTok{skip =} \DecValTok{7}\NormalTok{, }\CommentTok{\# how many lines do skip}
                           \AttributeTok{delim =} \StringTok{\textquotesingle{};\textquotesingle{}}\NormalTok{, }\CommentTok{\# column separator}
                           \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{(), }\CommentTok{\# column types}
                           \AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{decimal\_mark =} \StringTok{\textquotesingle{},\textquotesingle{}}\NormalTok{)}\CommentTok{\# locale}
\NormalTok{)}

\FunctionTok{glimpse}\NormalTok{(df\_not\_funky)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 100
R> Columns: 6
R> $ COD.UF     <dbl> 35, 21, 35, 35, 41, 31, 31, 21, 29, 26,~
R> $ COD        <dbl> 3546306, 2103109, 3514700, 3538105, 411~
R> $ NOME       <chr> "Santa Cruz das Palmeiras", "Cedral", "~
R> $ state      <chr> "São Paulo", "Maranhão", "São Paulo", "~
R> $ SIGLA      <chr> " SP", " MA", " SP", " SP", " PR", " MG~
R> $ number_col <dbl> 1.902087, 69.808750, 81.509312, 56.8400~
\end{verbatim}

Veja que agora os dados foram corretamente importados, com as classes corretas das colunas. Para isso, usamos a função alternativa \texttt{readr::read\_delim}. O pacote \texttt{readr} também possui várias outras funções para situações específicas de importação. Caso a função \texttt{read\_csv} não resolva o seu problema na leitura de algum arquivo de dados estruturado em texto, certamente outra função desse pacote resolverá.

\hypertarget{exportauxe7uxe3o-de-dados}{%
\subsection{Exportação de Dados}\label{exportauxe7uxe3o-de-dados}}

Para exportar tabelas em um arquivo \emph{.csv}, basta utilizar a função \texttt{readr::write\_csv}. No próximo exemplo iremos criar dados artificiais, salvar em um dataframe e exportar para um arquivo \emph{.csv} temporário. Veja a seguir: \index{readr!write\_csv}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}

\CommentTok{\# set number of observations}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{100}

\CommentTok{\# create dataframe with random data}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{runif}\NormalTok{(N),}
                    \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, N))}

\CommentTok{\# write to file}
\NormalTok{f\_out }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{)}
\FunctionTok{write\_csv}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df, }\AttributeTok{file =}\NormalTok{ f\_out)}
\end{Highlighting}
\end{Shaded}

No exemplo anterior, salvamos o \texttt{dataframe} chamado \texttt{my\_df} para o arquivo file11cf2f714b38.csv, localizado na pasta temporária do computador. Podemos verificar o arquivo importando o seu conteúdo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(f\_out,}
                  \AttributeTok{col\_types =} \FunctionTok{cols}\NormalTok{(}\AttributeTok{y =} \FunctionTok{col\_double}\NormalTok{(),}
                                   \AttributeTok{z =} \FunctionTok{col\_character}\NormalTok{() ) )}
\FunctionTok{print}\NormalTok{(}\FunctionTok{head}\NormalTok{(my\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 2
R>         y z    
R>     <dbl> <chr>
R> 1 0.770   a    
R> 2 0.185   a    
R> 3 0.504   a    
R> 4 0.843   a    
R> 5 0.976   a    
R> 6 0.00403 a
\end{verbatim}

O resultado está conforme o esperado, um dataframe com duas colunas, a primeira com números e a segunda com texto.

Note que toda exportação com função \texttt{write\_csv} irá ser formatada, por padrão, com a notação internacional. Caso quiser algo diferentes, verifique as opções disponíveis na função \texttt{write\_delim}, a qual é muito mais flexível.

\hypertarget{arquivos-excel-xls-e-xlsx}{%
\section{\texorpdfstring{Arquivos \emph{Excel} (\emph{xls} e \emph{xlsx})}{Arquivos Excel (xls e xlsx)}}\label{arquivos-excel-xls-e-xlsx}}

Em Finanças e Economia, é bastante comum encontrarmos dados salvos em arquivos do tipo Microsoft Excel, com extensão \emph{.xls} ou \emph{.xlsx}. Apesar de não ser um formato de armazenamento de dados eficiente, esse é um programa de planilhas bastante popular devido às suas funcionalidades. É muito comum que informações sejam armazenadas e distribuídas dessa forma. Por exemplo, dados históricos do Tesouro Direto são disponibilizados como arquivos \emph{.xls} no \href{http://www.tesouro.gov.br/tesouro-direto-balanco-e-estatisticas}{site do tesouro nacional}. A CVM (Comissão de Valores Mobiliários) e ANBIMA (Associação Brasileira das Entidades dos Mercados Financeiro e de Capitais) também tem preferência por esse tipo de formato em alguns dados publicados em seu \emph{site}.

A desvantagem de usar arquivos do Excel para armazenar dados é sua baixa portabilidade e o maior tempo necessário para leitura e gravação. Isso pode não ser um problema para tabelas pequenas, mas ao lidar com um grande volume de dados, o uso de arquivos Excel é frustrante e não aconselhável. Se possível, evite o uso de arquivos do Excel em seu ciclo de trabalho.

\hypertarget{importauxe7uxe3o-de-dados-1}{%
\subsection{Importação de Dados}\label{importauxe7uxe3o-de-dados-1}}

O R não possui uma função nativa para importar dados do Excel e, portanto, deve-se instalar e utilizar certos pacotes para realizar essa operação. Existem diversas opções, porém, os principais pacotes são \texttt{XLConnect} \citep{R-XLConnect}, \texttt{xlsx} \citep{R-xlsx}, \texttt{readxl} \citep{R-readxl} e \texttt{tidyxl} \citep{R-tidyxl}. \index{XLConnet} \index{xlsx} \index{readxl} \index{tidyxl}.

Apesar de os pacotes anteriores terem objetivos semelhantes, cada um tem suas peculiaridades. Caso a leitura de arquivos do Excel seja algo importante no seu trabalho, aconselho-o fortemente a estudar as diferenças entre esses pacotes. Por exemplo, pacote \texttt{tidyxl} permite a leitura de dados não-estruturados de um arquivo Excel, enquanto \texttt{XLConnect} possibilita a abertura de uma conexão ativa entre o R e o Excel, onde o usuário pode transmitir dados entre um e o outro, formatar células, criar gráficos no Excel e muito mais.

Nesta seção, daremos prioridade para funções do pacote \texttt{readxl}, que é um dos mais fáceis e diretos de se utilizar, além de não necessitar de outros softwares instalados (tal como o \emph{Java}). Para instalar o referido pacote, basta utilizar a função \texttt{install.packages}: \index{readxl}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}readxl\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Imagine agora a existência de um arquivo chamado \texttt{Ibov\_xls.xlsx} que contenha os mesmos dados do Ibovespa que importamos na seção anterior. A importação das informações contidas nesse arquivo para o R será realizada através da função \texttt{read\_excel}: \index{readxl!read\_excel}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set file}
\NormalTok{my\_f }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/Ibov\_xlsx.xlsx\textquotesingle{}}

\CommentTok{\# read xlsx into dataframe}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(my\_f, }\AttributeTok{sheet =} \StringTok{\textquotesingle{}Sheet1\textquotesingle{}}\NormalTok{)}

\CommentTok{\# glimpse contents}
\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,721
R> Columns: 2
R> $ ref.date    <dttm> 2010-01-04, 2010-01-05, 2010-01-06, 2~
R> $ price.close <dbl> 70045, 70240, 70729, 70451, 70263, 704~
\end{verbatim}

Observe que, nesse caso, as datas já foram importadas com a formatação correta na classe \texttt{dttm} (\emph{datetime}). Essa é uma vantagem ao utilizar arquivos do Excel: a classe dos dados do arquivo original é levada em conta no momento da importação. O lado negativo desse formato é a baixa portabilidade dos dados e o maior tempo necessário para a execução da importação. Como regra geral, dados importados do Excel apresentarão um tempo de carregamento mais alto do que dados importados de arquivos \emph{.csv}.

\hypertarget{exportauxe7uxe3o-de-dados-1}{%
\subsection{Exportação de Dados}\label{exportauxe7uxe3o-de-dados-1}}

A exportação para arquivo Excel também é fácil. Assim como para a importação, não existe uma função nativa do R que execute esse procedimento. Para tal tarefa, temos pacotes \texttt{xlsx} e \texttt{writexl} \citep{R-writexl}. Uma diferença aqui é que o pacote \texttt{xlsx} oferece mais funcionalidade mas exige a instalação do Java JDK no sistema operacional. No caso do Windows, basta visitar o \href{https://www.java.com/pt_BR/}{site do Java} e instalar o software na versão 64 bits (opção \emph{Windows Off-line (64 bits)}). Logo após, instale o pacote \texttt{xlsx} normalmente no R com o comando \texttt{install.packages(\textquotesingle{}xlsx\textquotesingle{})}. \index{xlsx}

Vamos começar com um exemplo para \texttt{xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(xlsx)}

\CommentTok{\# set number of rows}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{50}

\CommentTok{\# create random dataframe}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                    \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,N))}

\CommentTok{\# write to xlsx}
\NormalTok{f\_out }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.xlsx\textquotesingle{}}\NormalTok{)}
\FunctionTok{write.xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df,}
           \AttributeTok{file =}\NormalTok{ f\_out,}
           \AttributeTok{sheetName =} \StringTok{"my df"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\index{xlsx!write.xlsx}

Note que uma diferença nos argumentos da função \texttt{write.xlsx} é que é necessário incluir o nome da aba do arquivo Excel onde os dados da tabela serão exportados. Para exportar várias informações para um mesmo arquivo, é necessário utilizar o argumento \texttt{append} da função \texttt{write.xlsx}. Caso contrário, a função irá criar um novo arquivo em cada chamada da mesma. Veja o exemplo a seguir, onde exportamos dois dataframes para duas abas diferentes do mesmo arquivo Excel:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set number of rows}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{25}

\CommentTok{\# create random dfs}
\NormalTok{my\_df\_A }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                      \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,N))}

\NormalTok{my\_df\_B }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{,N))}

\CommentTok{\# write both df to single file}
\NormalTok{f\_out }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.xlsx\textquotesingle{}}\NormalTok{)}
\FunctionTok{write.xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df\_A,}
           \AttributeTok{file =}\NormalTok{ f\_out,}
           \AttributeTok{sheetName =} \StringTok{"Tabela A"}\NormalTok{)}

\FunctionTok{write.xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df\_B,}
           \AttributeTok{file =}\NormalTok{ f\_out,}
           \AttributeTok{sheetName =} \StringTok{"Tabela B"}\NormalTok{,}
           \AttributeTok{append =} \ConstantTok{TRUE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

Após a exportação, podes verificar as abas disponíveis no arquivo exportado com função \texttt{xlsx::getSheets}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{readxl}\SpecialCharTok{::}\FunctionTok{excel\_sheets}\NormalTok{(f\_out)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Tabela A" "Tabela B"
\end{verbatim}

O diferencial do pacote \texttt{writexl} em relação a \texttt{xlsx} é a não necessidade do Java, e a rapidez de execução. O lado negativo é que, na versão atual (1.4.1 -- 2022-11-23), não permite a escrita em arquivos já existentes. Veja a seguir: \index{writexl!write\_xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(writexl)}
\CommentTok{\# set number of rows}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{25}

\CommentTok{\# create random dfs}
\NormalTok{my\_df\_A }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                      \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,N))}

\FunctionTok{write\_xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df\_A,}
           \AttributeTok{file =}\NormalTok{ f\_out)}
\end{Highlighting}
\end{Shaded}

Para comparar o desempenho, vamos verificar a diferença de tempo de execução entre um e outro:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(writexl)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(xlsx)}

\CommentTok{\# set number of rows}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{2500}

\CommentTok{\# create random dfs}
\NormalTok{my\_df\_A }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                      \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,N))}

\CommentTok{\# set files}
\NormalTok{my\_file\_1 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/temp\_writexl.xlsx\textquotesingle{}}
\NormalTok{my\_file\_2 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/temp\_xlsx.xlsx\textquotesingle{}}

\CommentTok{\# test export}
\NormalTok{time\_write\_writexl }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{write\_xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df\_A,}
                                             \AttributeTok{path =}\NormalTok{ my\_file\_1))}

\NormalTok{time\_write\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{write.xlsx}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df\_A,}
                                          \AttributeTok{file =}\NormalTok{ my\_file\_2))}

\CommentTok{\# test read}
\NormalTok{time\_read\_readxl }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{read\_xlsx}\NormalTok{(}\AttributeTok{path =}\NormalTok{ my\_file\_1 ))}
\NormalTok{time\_read\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{read.xlsx}\NormalTok{(}\AttributeTok{file =}\NormalTok{ my\_file\_2,}
                                        \AttributeTok{sheetIndex =} \DecValTok{1}\NormalTok{ ))}
\end{Highlighting}
\end{Shaded}

Após a execução, vamos verificar a diferença de tempo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# results}
\NormalTok{my\_formats }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}xlsx\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}readxl\textquotesingle{}}\NormalTok{)}
\NormalTok{results\_read }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(time\_read\_xlsx[}\DecValTok{3}\NormalTok{], time\_read\_readxl[}\DecValTok{3}\NormalTok{])}
\NormalTok{results\_write}\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(time\_write\_xlsx[}\DecValTok{3}\NormalTok{], time\_write\_writexl[}\DecValTok{3}\NormalTok{])}

\CommentTok{\# print text}
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Time to WRITE dataframe with \textquotesingle{}}\NormalTok{,}
\NormalTok{                  my\_formats, }\StringTok{\textquotesingle{}: \textquotesingle{}}\NormalTok{,}
                  \FunctionTok{format}\NormalTok{(results\_write, }\AttributeTok{digits =} \DecValTok{4}\NormalTok{),}
                  \StringTok{\textquotesingle{} seconds\textquotesingle{}}\NormalTok{, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to WRITE dataframe with xlsx: 1.598 seconds
R> Time to WRITE dataframe with readxl: 0.012 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Time to READ dataframe with \textquotesingle{}}\NormalTok{,}
\NormalTok{                  my\_formats, }\StringTok{\textquotesingle{}: \textquotesingle{}}\NormalTok{,}
                  \FunctionTok{format}\NormalTok{(results\_read, }\AttributeTok{digits =} \DecValTok{4}\NormalTok{),}
                  \StringTok{\textquotesingle{} seconds\textquotesingle{}}\NormalTok{, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to READ dataframe with xlsx: 2.577 seconds
R> Time to READ dataframe with readxl: 0.007 seconds
\end{verbatim}

Como podemos ver, mesmo para dados de pouco volume, um dataframe com 2500 linhas e 2 colunas, a diferença de tempo de execução é significativa. Caso estiveres trabalhando com grandes planilhas, o uso de pacotes \texttt{readxl} e \texttt{writexl} é fortemente recomendado. Porém, como já mostrado anteriormente, as funções de \texttt{xlsx} oferecem algumas funcionalidades extras.

\hypertarget{formato-.rdata-e-.rds}{%
\section{\texorpdfstring{Formato \emph{.RData} e \emph{.rds}}{Formato .RData e .rds}}\label{formato-.rdata-e-.rds}}

O R possui dois formatos nativos para salvar objetos de sua área de trabalho para um arquivo local com extensão \emph{RData} ou \emph{rds}. O grande benefício, em ambos os casos, é que o arquivo resultante é compacto e o seu acesso é muito rápido. A desvantagem é que os dados perdem portabilidade para outros programas. A diferença entre um formato e outro é que arquivos \emph{RData} podem salvar mais de um objeto, enquanto o formato \emph{.rds} salva apenas um. Na prática, porém, essa não é uma restrição forte. No R existe um objeto do tipo \emph{lista} que incorpora outros. Portanto, caso salvarmos uma \emph{lista} em um arquivo \emph{.rds}, podemos gravar no disco quantos objetos forem necessário.

\hypertarget{importauxe7uxe3o-de-dados-2}{%
\subsection{Importação de Dados}\label{importauxe7uxe3o-de-dados-2}}

Para carregar os dados de um aquivo \texttt{RData}, utilizamos a função \texttt{load}: \index{base!load}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set a object}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}

\CommentTok{\# set temp name of RData file}
\NormalTok{my\_file }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}temp.RData\textquotesingle{}}\NormalTok{)}

\CommentTok{\# load it}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =}\NormalTok{ my\_file)}
\end{Highlighting}
\end{Shaded}

O arquivo temp.RData possui dois objetos, \texttt{my\_x} e \texttt{my\_y}, os quais se tornam disponíveis na área de trabalho depois da chamada de \texttt{load}.

O processo de importação para arquivos \emph{.rds} é muito semelhante. A diferença é no uso da função \texttt{readr::read\_rds}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set file path}
\NormalTok{my\_file }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}temp.rds\textquotesingle{}}\NormalTok{)}

\CommentTok{\# load content into workspace}
\NormalTok{my\_x }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\AttributeTok{file =}\NormalTok{ my\_file)}
\end{Highlighting}
\end{Shaded}

Comparando o código entre o uso de arquivos \texttt{.RData} e \texttt{.rds}, note que um benefício no uso de \texttt{.rds} é a explícita definição do objeto na área de trabalho. Isto é, o conteúdo de \texttt{my\_file} em \texttt{readr::read\_rds} é explicitamente salvo em \texttt{my\_x}. Quando usamos a função \texttt{load}, no código não fica claro qual o nome do objeto que foi importado. Isso é particularmente inconveniente quando é necessário modificar o nome do objeto importado.

\begin{rmdimportant}
Como sugestão, dê preferência ao uso do formato \emph{.rds}, o qual
resulta em códigos mais transparentes. A diferença de velocidade de
acesso e gravação entre um e outro é mínima. O benefício de importar
vários objetos em um mesmo arquivo com o formato \texttt{RData} torna-se
irrelevante quando no uso de objetos do tipo lista, os quais podem
incorporar outros objetos no seu conteúdo.
\end{rmdimportant}

\hypertarget{exportauxe7uxe3o-de-dados-2}{%
\subsection{Exportação de Dados}\label{exportauxe7uxe3o-de-dados-2}}

Para criar um novo arquivo \emph{RData}, utilizamos a função \texttt{save}. Veja o exemplo a seguir, onde criamos um arquivo \emph{RData} com dois objetos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vars}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}
\NormalTok{my\_y }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}

\CommentTok{\# write to RData}
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.RData\textquotesingle{}}\NormalTok{)}
\FunctionTok{save}\NormalTok{(}\AttributeTok{list =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}my\_x\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}my\_y\textquotesingle{}}\NormalTok{),}
     \AttributeTok{file =}\NormalTok{ my\_file)}
\end{Highlighting}
\end{Shaded}

Podemos verificar a existência do arquivo com a função \texttt{file.exists}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{file.exists}\NormalTok{(my\_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

Observe que o arquivo file11cf1c670b24.RData está disponível na pasta temporária.

Já para arquivos \emph{.rds}, salvamos o objeto com função \texttt{saveRDS}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set data and file}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{100}
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/temp.rds\textquotesingle{}}

\CommentTok{\# save as .rds}
\FunctionTok{saveRDS}\NormalTok{(}\AttributeTok{object =}\NormalTok{ my\_x,}
        \AttributeTok{file =}\NormalTok{ my\_file)}

\CommentTok{\# read it}
\NormalTok{my\_x2 }\OtherTok{\textless{}{-}} \FunctionTok{readRDS}\NormalTok{(}\AttributeTok{file =}\NormalTok{ my\_file)}

\CommentTok{\# test equality}
\FunctionTok{print}\NormalTok{(}\FunctionTok{identical}\NormalTok{(my\_x, my\_x2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

O comando \texttt{identical} testa a igualdade entre os objetos e, como esperado, verificamos que \texttt{my\_x} e \texttt{my\_x2} são exatamente iguais.

\hypertarget{arquivos-fst-pacote-fst}{%
\section{\texorpdfstring{Arquivos \emph{fst} (pacote \texttt{fst})}{Arquivos fst (pacote fst)}}\label{arquivos-fst-pacote-fst}}

O formato \href{http://www.fstpackage.org/}{\emph{fst}} foi especialmente desenhado para possibilitar a gravação e leitura de dados tabulares de forma rápida e com mínimo uso do espaço no disco. O uso deste formato é particularmente benéfico quando se está trabalhando com volumosas bases de dados em computadores potentes. \textbf{O grande truque do formato \emph{fst} é usar todos núcleos do computador para importar e exportar dados}, enquanto todos os demais formatos se utilizam de apenas um. Como logo veremos, o ganho em velocidade é bastante significativo. \index{fst}

\hypertarget{importauxe7uxe3o-de-dados-3}{%
\subsection{Importação de Dados}\label{importauxe7uxe3o-de-dados-3}}

O uso do formato \emph{fst} é bastante simples. Utilizamos a função \texttt{read\_fst} para ler arquivos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(fst)}

\NormalTok{my\_file }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}temp.fst\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{read\_fst}\NormalTok{(my\_file)}

\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,000
R> Columns: 1
R> $ x <dbl> 0.70968891, 0.83903044, 0.70026554, 0.78120026, ~
\end{verbatim}

Assim como para os demais casos, os dados estão disponíveis na área de trabalho após a importação.

\hypertarget{exportauxe7uxe3o-de-dados-3}{%
\subsection{Exportação de Dados}\label{exportauxe7uxe3o-de-dados-3}}

Utilizamos a função \texttt{write\_fst} para gravar arquivos no formato \emph{fst}, :

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(fst)}

\CommentTok{\# create dataframe}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{1000}
\NormalTok{my\_file }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.fst\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \FunctionTok{runif}\NormalTok{(N))}

\CommentTok{\# write to fst}
\FunctionTok{write\_fst}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_df, }\AttributeTok{path =}\NormalTok{ my\_file)}
\end{Highlighting}
\end{Shaded}

\hypertarget{testando-o-tempo-de-execuuxe7uxe3o-do-formato-fst}{%
\subsection{\texorpdfstring{Testando o Tempo de Execução do Formato \emph{fst}}{Testando o Tempo de Execução do Formato fst}}\label{testando-o-tempo-de-execuuxe7uxe3o-do-formato-fst}}

Como um teste do potencial do pacote \texttt{fst}, a seguir vamos cronometrar o tempo de leitura e gravação entre \emph{fst} e \emph{rds} para um dataframe com grande quantidade de dados: 5,000,000 linhas e 2 colunas. Iremos reportar também o tamanho do arquivo resultante.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(fst)}

\CommentTok{\# set number of rows}
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{5000000}

\CommentTok{\# create random dfs}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                    \AttributeTok{z =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,N))}

\CommentTok{\# set files}
\NormalTok{my\_file\_1 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/temp\_rds.rds\textquotesingle{}}
\NormalTok{my\_file\_2 }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}00{-}text{-}resources/data/temp\_fst.fst\textquotesingle{}}

\CommentTok{\# test write}
\NormalTok{time\_write\_rds }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{write\_rds}\NormalTok{(my\_df, my\_file\_1 ))}
\NormalTok{time\_write\_fst }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{write\_fst}\NormalTok{(my\_df, my\_file\_2 ))}

\CommentTok{\# test read}
\NormalTok{time\_read\_rds }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{readRDS}\NormalTok{(my\_file\_1))}
\NormalTok{time\_read\_fst }\OtherTok{\textless{}{-}} \FunctionTok{system.time}\NormalTok{(}\FunctionTok{read\_fst}\NormalTok{(my\_file\_2))}

\CommentTok{\# test file size (MB)}
\NormalTok{file\_size\_rds }\OtherTok{\textless{}{-}} \FunctionTok{file.size}\NormalTok{(my\_file\_1)}\SpecialCharTok{/}\DecValTok{1000000}
\NormalTok{file\_size\_fst }\OtherTok{\textless{}{-}} \FunctionTok{file.size}\NormalTok{(my\_file\_2)}\SpecialCharTok{/}\DecValTok{1000000}
\end{Highlighting}
\end{Shaded}

Após a execução, vamos verificar o resultado:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# results}
\NormalTok{my\_formats }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}.rds\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}.fst\textquotesingle{}}\NormalTok{)}
\NormalTok{results\_read }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(time\_read\_rds[}\DecValTok{3}\NormalTok{], time\_read\_fst[}\DecValTok{3}\NormalTok{])}
\NormalTok{results\_write}\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(time\_write\_rds[}\DecValTok{3}\NormalTok{], time\_write\_fst[}\DecValTok{3}\NormalTok{])}
\NormalTok{results\_file\_size }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(file\_size\_rds , file\_size\_fst)}

\CommentTok{\# print text}
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Time to WRITE dataframe with \textquotesingle{}}\NormalTok{,}
\NormalTok{                  my\_formats, }\StringTok{\textquotesingle{}: \textquotesingle{}}\NormalTok{,}
\NormalTok{                  results\_write, }\StringTok{\textquotesingle{} seconds\textquotesingle{}}\NormalTok{, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to WRITE dataframe with .rds: 1.1579999999999 seconds
R> Time to WRITE dataframe with .fst: 0.0929999999998472 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Time to READ dataframe with \textquotesingle{}}\NormalTok{,}
\NormalTok{                  my\_formats, }\StringTok{\textquotesingle{}: \textquotesingle{}}\NormalTok{,}
\NormalTok{                  results\_read, }\StringTok{\textquotesingle{} seconds\textquotesingle{}}\NormalTok{, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to READ dataframe with .rds: 1.01900000000001 seconds
R> Time to READ dataframe with .fst: 0.09699999999998 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{Resulting FILE SIZE for \textquotesingle{}}\NormalTok{,}
\NormalTok{                  my\_formats, }\StringTok{\textquotesingle{}: \textquotesingle{}}\NormalTok{,}
\NormalTok{                  results\_file\_size, }\StringTok{\textquotesingle{} MBs\textquotesingle{}}\NormalTok{, }\AttributeTok{collapse =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Resulting FILE SIZE for .rds: 65.01011 MBs
R> Resulting FILE SIZE for .fst: 14.791938 MBs
\end{verbatim}

A diferença é gritante! O formato \texttt{fst} não somente lê e grava com mais rapidez mas o arquivo resultante também é menor. Porém, saiba que os resultados anteriores foram compilados em um computador com 16 núcleos. É possível que a diferença de tempo para um computador mais modesto não seja tão significativa.

\begin{rmdimportant}
Devido ao uso de todos os núcleos do computador, o formato \emph{fst} é
altamente recomendado quando estiver trabalhando com dados volumosos em
um computador potente. Não somente os arquivos resultantes serão
menores, mas o processo de gravação e leitura será consideravelmente
mais rápido.
\end{rmdimportant}

\hypertarget{arquivos-sqlite}{%
\section{\texorpdfstring{Arquivos \emph{SQLite}}{Arquivos SQLite}}\label{arquivos-sqlite}}

O uso de arquivos \emph{csv}, \emph{rds} e \emph{fst} para armazenar conjuntos de dados tem seus limites a medida que o tamanho dos arquivos aumenta e os dados fragmentam-se em várias tabelas. Se você está esperando muito tempo para ler apenas uma tabela de um arquivo com várias tabelas, deves procurar alternativas mais eficientes. Da mesma forma, se você estiver trabalhando em uma rede de computadores e muitas pessoas estão usando os mesmos dados, faz sentido manter e distribuir as informações de um servidor central. Dessa forma, cada usuário pode ter acesso à mesma informação, simultaneamente.

Isso nos leva ao tópico de programas de armazenamento e distribuição de banco de dados. Esses programas específicos geralmente funcionam com uma linguagem de consulta chamada \emph{SQL} (\emph{Structured Query Language}), e permitem ao usuário ler partes dos dados e mesmo manipulá-lo de forma eficiente. Existem muitas opções de software de banco de dados que se integra muito bem com R. A lista inclui \textbf{mySQL}, \textbf{SQLite} e \textbf{MariaDB}. Aqui, forneceremos um tutorial rápido sobre esse tópico usando o SQLite, que é o mais fácil de usar, uma vez que não precisa de nenhuma configuração do servidor e todos dados estão contidos em um único arquivo. \index{mySQL} \index{SQLite} \index{MariaDB}

Antes de irmos para os exemplos, precisamos entender como se usa o \emph{software} de banco de dados. Primeiro, um banco de dados deve existir em seu computador ou rede. Segundo, o R se conectará ao banco de dados e retornará um objeto de conexão. Com base nessa conexão, enviaremos consultas para importar dados desse banco de dados usando a linguagem \emph{SQL}. A principal vantagem é que podemos ter um grande banco de dados de, digamos, 10 GB e carregar apenas uma pequena porção dele na área de trabalho do R. Essa operação também é muito rápida, permitindo um acesso eficiente às tabelas disponíveis.

\hypertarget{importauxe7uxe3o-de-dados-4}{%
\subsection{Importação de Dados}\label{importauxe7uxe3o-de-dados-4}}

Assumindo a existência de um arquivo com formato SQLite, podemos importar suas tabelas com o pacote \texttt{RSQLite}: \index{RSQLite!dbReadTable} \index{RSQLite!dbConnect}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RSQLite)}

\CommentTok{\# set name of SQLITE file}
\NormalTok{f\_sqlite }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}SQLite\_db.SQLITE\textquotesingle{}}\NormalTok{)}

\CommentTok{\# open connection}
\NormalTok{my\_con }\OtherTok{\textless{}{-}} \FunctionTok{dbConnect}\NormalTok{(}\AttributeTok{drv =} \FunctionTok{SQLite}\NormalTok{(), f\_sqlite)}

\CommentTok{\# read table}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{dbReadTable}\NormalTok{(}\AttributeTok{conn =}\NormalTok{ my\_con,}
                     \AttributeTok{name =} \StringTok{\textquotesingle{}MyTable1\textquotesingle{}}\NormalTok{) }\CommentTok{\# name of table in sqlite}

\CommentTok{\# print with str}
\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,000,000
R> Columns: 2
R> $ x <dbl> 0.007504194, 0.439465174, 0.178387480, 0.9857759~
R> $ G <chr> "B", "B", "B", "B", "A", "B", "A", "B", "B", "B"~
\end{verbatim}

Outro exemplo do uso do SQLITE é com instruções de um comando \emph{SQL}. Observe que, no código anterior, usamos função \texttt{dbReadTable} para obter o conteúdo de todas as linhas da tabela \texttt{MyTable1}. Agora, vamos usar o comando \texttt{dbGetQuery} para obter dados da tabela \texttt{myTable2} apenas quando a coluna \texttt{G} é igual a \texttt{A}: \index{RSQLite!dbGetQuery}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set sql statement}
\NormalTok{my\_SQL\_statement }\OtherTok{\textless{}{-}} \StringTok{"select * from myTable2 where G=\textquotesingle{}A\textquotesingle{}"}

\CommentTok{\# get query}
\NormalTok{my\_df\_A }\OtherTok{\textless{}{-}} \FunctionTok{dbGetQuery}\NormalTok{(}\AttributeTok{conn =}\NormalTok{ my\_con, }
                      \AttributeTok{statement =}\NormalTok{ my\_SQL\_statement)}

\CommentTok{\# disconnect from db}
\FunctionTok{dbDisconnect}\NormalTok{(my\_con)}

\CommentTok{\# print with str}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str}\NormalTok{(my\_df\_A))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 'data.frame':    499522 obs. of  2 variables:
R>  $ x: num  0.0637 0.1982 0.2894 0.7389 0.0669 ...
R>  $ G: chr  "A" "A" "A" "A" ...
R> NULL
\end{verbatim}

Nesse exemplo simples podemos ver como é fácil criar uma conexão com um banco de dados, recuperar tabelas e desconectar. Se você estiver trabalhando com dados volumosos e diversas tabelas, vale a pena utilizar um software de banco de dados apropriado. Caso existir um servidor de banco de dados disponível em seu local de trabalho, eu recomendo fortemente aprender a conectar-se a ele e carregar dados diretamente de uma sessão do R.

\hypertarget{exportauxe7uxe3o-de-dados-4}{%
\subsection{Exportação de Dados}\label{exportauxe7uxe3o-de-dados-4}}

Como exemplo, vamos criar dois dataframes com dados aleatórios e salvar ambos em um arquivo SQLite usando pacote \texttt{RSQLite}. \index{RSQLite}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RSQLite)}

\CommentTok{\# set number of rows in df}
\NormalTok{N }\OtherTok{=} \DecValTok{10}\SpecialCharTok{\^{}}\DecValTok{6} 

\CommentTok{\# create simulated dataframe}
\NormalTok{my\_large\_df\_1 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\FunctionTok{runif}\NormalTok{(N), }
                            \AttributeTok{G=} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{),}
                                      \AttributeTok{size =}\NormalTok{ N,}
                                      \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{))}

\NormalTok{my\_large\_df\_2 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\FunctionTok{runif}\NormalTok{(N), }
                            \AttributeTok{G =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{),}
                                       \AttributeTok{size =}\NormalTok{ N,}
                                       \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{))}

\CommentTok{\# set name of SQLITE file}
\NormalTok{f\_sqlite }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.SQLITE\textquotesingle{}}\NormalTok{)}

\CommentTok{\# open connection}
\NormalTok{my\_con }\OtherTok{\textless{}{-}} \FunctionTok{dbConnect}\NormalTok{(}\AttributeTok{drv =} \FunctionTok{SQLite}\NormalTok{(), f\_sqlite)}

\CommentTok{\# write df to sqlite}
\FunctionTok{dbWriteTable}\NormalTok{(}\AttributeTok{conn =}\NormalTok{ my\_con, }\AttributeTok{name =} \StringTok{\textquotesingle{}MyTable1\textquotesingle{}}\NormalTok{, }
             \AttributeTok{value =}\NormalTok{ my\_large\_df\_1)}
\FunctionTok{dbWriteTable}\NormalTok{(}\AttributeTok{conn =}\NormalTok{ my\_con, }\AttributeTok{name =} \StringTok{\textquotesingle{}MyTable2\textquotesingle{}}\NormalTok{, }
             \AttributeTok{value =}\NormalTok{ my\_large\_df\_2)}

\CommentTok{\# disconnect}
\FunctionTok{dbDisconnect}\NormalTok{(my\_con)}
\end{Highlighting}
\end{Shaded}

A saída \texttt{TRUE} de \texttt{dbWriteTable} indica que tudo ocorreu bem. Uma conexão foi aberta usando a função \texttt{dbConnect} e os dataframes foram escritos em um arquivo SQLITE temporário chamado file11cf7e9dbfad.SQLITE. É boa política de programação sempre se desconectar do banco de dados após a utilização. Fizemos isso com a função \texttt{dbDisconnect}. \index{RSQLite!dbWriteTable} \index{RSQLite!dbConnect} \index{RSQLite!dbDisconnect}

\hypertarget{dados-nuxe3o-estruturados-e-outros-formatos}{%
\section{Dados Não-Estruturados e Outros Formatos}\label{dados-nuxe3o-estruturados-e-outros-formatos}}

Os pacotes e formatos anteriores são suficientes para resolver o problema de importação de dados na grande maioria das situações. Apesar disso, vale destacar que o R possui outras funções específicas para diferentes formatos. Isso inclui arquivos exportados de outros softwares, tal como SPSS, Matlab, entre vários outros. Se esse for o seu caso, sugiro um estudo aprofundado do pacote \texttt{foreign} \citep{R-foreign}.

Em alguns casos nos deparamos com dados armazenados de uma forma não estruturada, tal como um texto qualquer. Pode-se importar o conteúdo de um arquivo de texto linha por linha através da função \texttt{readr::read\_lines}. Veja o exemplo a seguir, onde importamos o conteúdo inteiro do livro \emph{Pride and Prejudice}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set file to read}
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}pride\_and\_prejudice.txt\textquotesingle{}}\NormalTok{)}

\CommentTok{\# read file line by line}
\NormalTok{my\_txt }\OtherTok{\textless{}{-}} \FunctionTok{read\_lines}\NormalTok{(my\_f)}

\CommentTok{\# print 50 characters of first fifteen lines}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_txt[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{15}\NormalTok{], }
              \AttributeTok{start =} \DecValTok{1}\NormalTok{, }
              \AttributeTok{end =} \DecValTok{50}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "The Project Gutenberg EBook of Pride and Prejudice"
R>  [2] ""                                                  
R>  [3] "This eBook is for the use of anyone anywhere at no"
R>  [4] "almost no restrictions whatsoever.  You may copy i"
R>  [5] "re-use it under the terms of the Project Gutenberg"
R>  [6] "with this eBook or online at www.gutenberg.org"    
R>  [7] ""                                                  
R>  [8] ""                                                  
R>  [9] "Title: Pride and Prejudice"                        
R> [10] ""                                                  
R> [11] "Author: Jane Austen"                               
R> [12] ""                                                  
R> [13] "Posting Date: August 26, 2008 [EBook #1342]"       
R> [14] "Release Date: June, 1998"                          
R> [15] "Last Updated: March 10, 2018"
\end{verbatim}

Neste exemplo, arquivo pride\_and\_prejudice.txt contém todo o conteúdo do livro \emph{Pride and Prejudice} de Jane Austen, disponível gratuitamente pelo projeto \href{http://www.gutenberg.org/}{Gutenberg}\footnote{\url{http://www.gutenberg.org/}}. Importamos todo o conteúdo do arquivo como um vetor de texto denominado \texttt{my\_txt}. Cada elemento de \texttt{my\_txt} é uma linha do arquivo do texto original. Com base nisso, podemos calcular o número de linhas do livro e o número de vezes que o nome \texttt{\textquotesingle{}Bennet\textquotesingle{}}, um dos protagonistas, aparece no texto:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# count number of lines}
\NormalTok{n\_lines }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(my\_txt)}

\CommentTok{\# set target text}
\NormalTok{name\_to\_search }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Bennet\textquotesingle{}}

\CommentTok{\# set function for counting words}
\NormalTok{fct\_count\_bennet }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(str\_in, target\_text) \{}
  
  \FunctionTok{require}\NormalTok{(stringr)}
  
  
\NormalTok{  n\_words }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{str\_locate\_all}\NormalTok{(}\AttributeTok{string =}\NormalTok{ str\_in, }
                                   \AttributeTok{pattern =}\NormalTok{ target\_text)[[}\DecValTok{1}\NormalTok{]])}
  
  \FunctionTok{return}\NormalTok{(n\_words)}
\NormalTok{\}}

\CommentTok{\# use fct for all lines of Pride and Prejudice}
\NormalTok{n\_times }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\AttributeTok{X =}\NormalTok{ my\_txt, }
                      \AttributeTok{FUN =}\NormalTok{ fct\_count\_bennet, }
                      \AttributeTok{target\_text =}\NormalTok{ name\_to\_search))}

\CommentTok{\# print results}
\NormalTok{my\_msg }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}The number of lines found in the file is \textquotesingle{}}\NormalTok{, }
\NormalTok{                 n\_lines, }\StringTok{\textquotesingle{}.}\SpecialCharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{,}
                 \StringTok{\textquotesingle{}The word "\textquotesingle{}}\NormalTok{, name\_to\_search, }\StringTok{\textquotesingle{}" appears \textquotesingle{}}\NormalTok{, }
\NormalTok{                 n\_times, }\StringTok{\textquotesingle{} times in the book.\textquotesingle{}}\NormalTok{)}
\FunctionTok{message}\NormalTok{(my\_msg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The number of lines found in the file is 13427.
R> The word "Bennet" appears 664 times in the book.
\end{verbatim}

No exemplo, mais uma vez usamos \texttt{sapply}. Neste caso, a função nos permitiu usar outra função para cada elemento de \texttt{my\_txt}. Neste caso, procuramos e contamos o número de vezes que a palavra ``Bennet'' foi encontrada no texto. Observe que poderíamos simplesmente mudar \texttt{name\_to\_search} por qualquer outro nome, caso quiséssemos.

\hypertarget{exportando-de-dados-nuxe3o-estruturados}{%
\subsection{Exportando de Dados Não-Estruturados}\label{exportando-de-dados-nuxe3o-estruturados}}

Em algumas situações, é necessário exportar algum tipo de texto para um arquivo. Por exemplo: quando se precisa salvar o registro de um procedimento em um arquivo de texto; ou quando se precisa gravar informações em um formato específico não suportado pelo R. Esse procedimento é bastante simples. Junto à função \texttt{readr::write\_lines}, basta indicar um arquivo de texto para a saída com o argumento \texttt{file}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set file}
\NormalTok{my\_f }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.txt\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set some string}
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Today is \textquotesingle{}}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{, }
                  \StringTok{\textquotesingle{}Tomorrow is \textquotesingle{}}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{()}\SpecialCharTok{+}\DecValTok{1}\NormalTok{)}

\CommentTok{\# save string to file}
\FunctionTok{write\_lines}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_text, }\AttributeTok{file =}\NormalTok{ my\_f, }\AttributeTok{append =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

No exemplo, criamos um objeto de texto com uma mensagem sobre a data atual e gravamos a saída no arquivo temporário file11cf3fe46972.txt. Podemos checar o resultado com a função \texttt{readr::read\_lines}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{read\_lines}\NormalTok{(my\_f))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Today is 2022-11-23"    "Tomorrow is 2022-11-24"
\end{verbatim}

\hypertarget{selecionando-o-formato}{%
\section{Selecionando o Formato}\label{selecionando-o-formato}}

Após entendermos a forma de salvar e carregar dados de arquivos locais em diferentes formatos, é importante discutirmos sobre a escolha do formato. O usuário deve levar em conta três pontos nessa decisão:

\begin{itemize}
\tightlist
\item
  velocidade de importação e exportação;
\item
  tamanho do arquivo resultante;
\item
  compatibilidade com outros programas e sistemas.
\end{itemize}

Na grande maioria das situações, o uso de arquivos \emph{csv} satisfaz esses quesitos. Ele nada mais é do que um arquivo de texto que pode ser aberto, visualizado e importado em qualquer programa. Desse modo, fica muito fácil compartilhar dados compatíveis com outros usuários. Além disso, o tamanho de arquivos \emph{csv} geralmente não é exagerado em computadores modernos. Caso necessário, podes compactar o arquivo .csv usando o programa \href{https://www.7-zip.org/}{\emph{7zip}}, por exemplo, o qual irá diminuir consideravelmente o tamanho do arquivo. Por esses motivos, \textbf{o uso de arquivos \emph{csv} para importações e exportações é preferível na grande maioria das situações}. \index{utils!zip}

Existem casos, porém, onde a velocidade de importação e exportação pode fazer diferença. Caso abrir mão de portabilidade não faça diferença ao projeto, o formato \emph{rds} é ótimo e prático. Se este não foi suficiente, então a melhor alternativa é partir para o \emph{fst}, o qual usa maior parte do \emph{hardware} do computador para importar os dados. Como sugestão, caso puder, apenas \textbf{evite o formato do Excel}, o qual é o menos eficiente de todos.

\hypertarget{exerc-importacao-exportacao}{%
\section{Exercícios}\label{exerc-importacao-exportacao}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Crie um dataframe com o código a seguir:

\begin{verbatim}
library(dplyr)

my_N <- 10000
my_df <- tibble(x = 1:my_N,
                y = runif(my_N))
\end{verbatim}

Exporte o dataframe resultante para cada um dos cinco formatos: csv, rds, xlsx, fst. Qual dos formatos ocupou maior espaço na memória do computador? Dica: \texttt{file.size} calcula o tamanho de arquivos dentro do próprio R.

02 -
Melhore o código anterior com a mensuração do tempo de execução necessário para gravar os dados nos diferentes formatos. Qual formato teve a gravação mais rápida? Dica: use função \texttt{system.time} ou pacote \texttt{tictoc} para calcular os tempos de execução.

03 -
Para o código anterior, redefina o valor de \texttt{my\_N} para \texttt{1000000}. Esta mudança modifica as respostas das duas últimas perguntas?

04 -
Use função \texttt{adfeR::get\_data\_file} para acessar o arquivo \texttt{SP500.csv} no repositório de dados do livro. Importe o conteúdo do arquivo no R com função \texttt{readr::read\_csv}. Quantas linhas existem no \texttt{dataframe} resultante?

05 -
No link \url{https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv} você encontrará um arquivo \emph{.csv} para os dados \emph{Grunfeld}. Esta é uma tabela particularmente famosa devido ao seu uso como dados de referência em modelos econométricos. Usando função \texttt{readr::read\_csv}, leia este arquivo usando o link direto como entrada em \texttt{read\_csv}. Quantas colunas você encontra no \texttt{dataframe} resultante?

06 -
Use função \texttt{adfeR::get\_data\_file} para acessar o arquivo \texttt{example\_tsv.csv} no repositório de dados do livro. Note que as colunas dos dados estão separadas pelo símbolo de tabulação (\texttt{\textquotesingle{}\textbackslash{}t\textquotesingle{}}). Após ler o manual do \texttt{readr::read\_delim}, importe as informações deste arquivo para o seu computador. Quantas linhas o arquivo contém?

07 -
No pacote do livro existe um arquivo de dados chamado \texttt{\textquotesingle{}funky\_csv2.csv\textquotesingle{}}. Este possui um formato particularmente bizarro para os dados. Abra o mesmo em um editor de texto e procure entender como as colunas são separadas e qual o símbolo para o decimal. Após isso, veja as entradas da função \texttt{read.table} e importe a tabela na sessão do R. Caso somarmos o número de linhas com o número de colunas da tabela importada, qual o resultado?

\hypertarget{importacao-pacotes}{%
\chapter{Importação de Dados via Pacotes}\label{importacao-pacotes}}

Uma das grandes vantagens de se utilizar o R é a quantidade de dados que podem ser importados através da internet. Isso é especialmente prático pois uma base de dados pode ser atualizada através de um simples comando, evitando o tedioso trabalho de coleta manual. Ao usarmos pacotes para importar dados, esta etapa da pesquisa se torna reproduzível e mais rápida, facilitando o compartilhamento e futura execução do nosso código.

Neste capítulo vou descrever e dar exemplos de importação de dados para os mais importantes e estáveis pacotes especializados na importação de para dados financeiros e econômicos no Brasil e exterior. A lista inclui:

\begin{description}
\tightlist
\item[\texttt{GetQuandlData} \citep{R-GetQuandlData}]
Importa dados econômicos e financeiros do vasto repositório de dados da plataforma \emph{Quandl}.
\item[\texttt{BatchGetSymbols} \citep{R-BatchGetSymbols}]
Importa dados de preços diários de ações e índices do \emph{Yahoo Finance}.
\item[\texttt{GetTDData} \citep{R-GetTDData}]
Importa dados de títulos de dívida pública do Brasil diretamente do site do Tesouro Direto.
\item[\texttt{GetBCBData} \citep{R-GetBCBData}]
Importa dados do grande repositório de séries temporais do Banco Central do Brasil, local obrigatório para qualquer economista que trabalha com dados.
\item[\texttt{GetDFPData2} \citep{R-GetDFPData2}]
Importa dados do sistema DFP -- Demonstrativos Financeiros Padronizados -- de empresas negociadas na B3, a bolsa Brasileira. O repositório inclui documentos financeiros tal como o balanço patrimonial, demonstrativos de resultados, entre vários outros.
\item[\texttt{GetFREData} \citep{R-GetFREData}]
Importa dados do sistema FRE -- Formulário de Referência -- da bolsa Brasileira. Esta inclui diversos eventos e informações corporativas tal como composição do conselho e diretoria, remuneração dos conselheiros, entre outras.
\end{description}

\hypertarget{quandl}{%
\section{\texorpdfstring{Pacote \texttt{GetQuandlData}}{Pacote GetQuandlData}}\label{quandl}}

\emph{Quandl} é um repositório de dados abrangente, fornecendo acesso a uma série de tabelas gratuitas e pagas disponibilizadas por diversas instituições de pesquisa. Como ponto inicial, recomendo fortemente que você navegue nas tabelas disponíveis no \href{https://www.quandl.com/}{site da Quandl}\footnote{\url{https://www.quandl.com/}}. Verás que uma grande proporção dos repositórios de dados abertos em economia e finanças também estão disponíveis no Quandl. \index{Quandl}

Pacote \texttt{Quandl} \citep{R-Quandl} é a extensão oficial oferecida pela empresa e disponível no CRAN. No entanto, o pacote tem alguns problemas quanto a estrutura de dados de saída\footnote{Veja \href{https://www.msperlin.com/post/2019-10-01-new-package-getquandldata/}{postagem no blog}} e, para resolver, escrevi o meu próprio pacote \texttt{GetQuandlData} \citep{R-GetQuandlData}. O diferencial de \texttt{GetQuandlData} é a saída de dados já estruturados, prontos para uma posterior análise.

A \textbf{primeira e obrigatória} etapa no uso de \texttt{GetQuandlData} é registrar o usuário no \href{https://www.quandl.com/}{site}. Logo em seguida, vá para \emph{Account Settings} e procure pela seção \emph{You API Key}. Este local deve mostrar uma senha, tal como \texttt{Asv8Ac7zuZzJSCGxynfG}. Copie o texto para a área de transferência (\emph{control + c}) e, no R, defina um objeto de contendo o conteúdo copiado da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set FAKE api key to quandl}
\NormalTok{my\_api\_key }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Asv8Ac7zuZzJSCGxynfG\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Essa chave API é exclusiva para cada usuário e a apresentada aqui \textbf{não funcionará no seu computador}. Você precisará obter sua própria chave de API para executar os exemplos do livro. Depois de encontrar e definir sua chave, vá para o \href{https://www.quandl.com/search}{site do Quandl} e use a caixa de pesquisa para procurar o símbolo da série temporal de interesse.

Como exemplo, usaremos dados do \href{https://www.quandl.com/data/LBMA/GOLD-Gold-Price-London-Fixing}{preço do ouro} no mercado Londrino. O código para esta série no Quandl é \texttt{\textquotesingle{}LBMA/GOLD\textquotesingle{}}. Observe que a estrutura de um identificador de tabelas no Quandl é sempre a mesma, com o nome do banco de dados primeiro e o nome da tabela depois, separados por uma barra (/).

Agora, com a chave API e o identificador da tabela, usamos a função \texttt{get\_Quandl\_series} para baixar os dados de 1980-01-01 a 2021-01-01: \index{Quandl} \index{GetQuandlData}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetQuandlData)}
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# set symbol and dates}
\NormalTok{my\_symbol }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}GOLD\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}LBMA/GOLD\textquotesingle{}}\NormalTok{)}
\NormalTok{first\_date }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}1980{-}01{-}01\textquotesingle{}}
\NormalTok{last\_date }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}

\CommentTok{\# get data!}
\NormalTok{df\_quandl }\OtherTok{\textless{}{-}} \FunctionTok{get\_Quandl\_series}\NormalTok{(}\AttributeTok{id\_in =}\NormalTok{ my\_symbol,}
                               \AttributeTok{api\_key =}\NormalTok{ my\_api\_key, }
                               \AttributeTok{first\_date =}\NormalTok{ first\_date,}
                               \AttributeTok{last\_date =}\NormalTok{ last\_date)}

\CommentTok{\# check it}
\FunctionTok{glimpse}\NormalTok{(df\_quandl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 10,763
R> Columns: 9
R> $ `USD (AM)`  <chr> "1766.6", "1772.9", "1766.75", "1758.9~
R> $ `USD (PM)`  <chr> "1761.25", "1779.75", "1772.4", "1753.~
R> $ `GBP (AM)`  <chr> "1450.03", "1452.36", "1443.26", "1447~
R> $ `GBP (PM)`  <chr> "1451.62", "1457.26", "1444.86", "1451~
R> $ `EURO (AM)` <chr> "1734.09", "1732.3", "1722.23", "1724.~
R> $ `EURO (PM)` <chr> "1735.54", "1743.62", "1727.91", "1725~
R> $ series_name <chr> "GOLD", "GOLD", "GOLD", "GOLD", "GOLD"~
R> $ ref_date    <date> 2022-08-03, 2022-08-02, 2022-08-01, 2~
R> $ id_quandl   <chr> "LBMA/GOLD", "LBMA/GOLD", "LBMA/GOLD",~
\end{verbatim}

Observe como definimos o nome da série temporal em linha \texttt{id\_in\ =\ \ c(\textquotesingle{}GOLD\textquotesingle{}\ =\ \textquotesingle{}LBMA/GOLD\textquotesingle{})}. O nome do elemento -- \texttt{GOLD} -- se torna uma coluna chamada \texttt{series\_name} no \texttt{dataframe} de saída. Se tivéssemos mais séries temporais, elas seriam empilhadas na mesma tabela.

Para verificar os dados, vamos criar um gráfico com os preços do ouro ao longo do tempo. Aqui, usaremos o pacote \texttt{ggplot2} para criar a figura. Por enquanto você não precisa se preocupar com o código de criação de gráficos. Teremos o capítulo \ref{figuras} inteiro dedicado ao tópico.

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-171-1} \end{center}

De modo geral, os preços do ouro permaneceram relativamente estáveis entre 1980 e 2000, atingindo um pico após 2010. Uma possível explicação é a maior demanda por ativos mais seguros, como o ouro, após a crise financeira de 2009. No entanto, o ouro nunca foi um investimento eficiente a longo prazo. Para mostrar isso, vamos calcular seu retorno anual composto de 1980-01-02 a 2022-08-03:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sort the rows}
\NormalTok{df\_quandl }\OtherTok{\textless{}{-}}\NormalTok{ df\_quandl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{USD =} \FunctionTok{as.numeric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{USD (AM)}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(ref\_date)}

\NormalTok{total\_ret }\OtherTok{\textless{}{-}} \FunctionTok{last}\NormalTok{(df\_quandl}\SpecialCharTok{$}\NormalTok{USD)}\SpecialCharTok{/}\FunctionTok{first}\NormalTok{(df\_quandl}\SpecialCharTok{$}\NormalTok{USD) }\SpecialCharTok{{-}} \DecValTok{1}
\NormalTok{total\_years }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{max}\NormalTok{(df\_quandl}\SpecialCharTok{$}\NormalTok{ref\_date) }\SpecialCharTok{{-}} 
                            \FunctionTok{min}\NormalTok{(df\_quandl}\SpecialCharTok{$}\NormalTok{ref\_date) )}\SpecialCharTok{/}\DecValTok{365}

\NormalTok{comp\_ret\_per\_year }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ total\_ret)}\SpecialCharTok{\^{}}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\NormalTok{total\_years) }\SpecialCharTok{{-}} \DecValTok{1}

\FunctionTok{print}\NormalTok{(comp\_ret\_per\_year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.02737004
\end{verbatim}

Encontramos o resultado de que os preços do ouro em USD apresentam um retorno composto equivalente a 2,74\% ao ano. Este não é um resultado de investimento impressionante de forma alguma. Como comparação, a inflação anual para os EUA no mesmo período é de 3,22\% ao ano. Isso significa que, ao comprar ouro em 1980, o investidor recebeu menos que a inflação como retorno nominal, resultando em perda de poder de compra.

\hypertarget{importando-muxfaltiplas-suxe9ries}{%
\subsection{Importando Múltiplas Séries}\label{importando-muxfaltiplas-suxe9ries}}

Ao solicitar várias séries temporais do Quandl, pacote \texttt{GetQuandlData} empilha todos os dados em um único \texttt{dataframe}, tornando mais fácil trabalhar com as ferramentas do \texttt{tidyverse}. Como exemplo, vamos olhar para o banco de dados \texttt{RATEINF}, o qual contém séries temporais das taxas de inflação ao redor do mundo. Primeiro, precisamos ver quais são os conjuntos de dados disponíveis:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetQuandlData)}
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# databse to get info}
\NormalTok{db\_id }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}RATEINF\textquotesingle{}}

\CommentTok{\# get info }
\NormalTok{df\_db }\OtherTok{\textless{}{-}} \FunctionTok{get\_database\_info}\NormalTok{(db\_id, my\_api\_key)}

\FunctionTok{glimpse}\NormalTok{(df\_db)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 26
R> Columns: 8
R> $ code         <chr> "CPI_ARG", "CPI_AUS", "CPI_CAN", "CPI~
R> $ name         <chr> "Consumer Price Index - Argentina", "~
R> $ description  <chr> "Please visit <a href=http://www.rate~
R> $ refreshed_at <dttm> 2020-10-10 02:03:32, 2022-11-19 02:0~
R> $ from_date    <date> 1988-01-31, 1948-09-30, 1989-01-31, ~
R> $ to_date      <date> 2013-12-31, 2022-09-30, 2022-10-31, ~
R> $ quandl_code  <chr> "RATEINF/CPI_ARG", "RATEINF/CPI_AUS",~
R> $ quandl_db    <chr> "RATEINF", "RATEINF", "RATEINF", "RAT~
\end{verbatim}

Coluna \texttt{name} contém a descrição das tabelas com os seguintes nomes:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{unique}\NormalTok{(df\_db}\SpecialCharTok{$}\NormalTok{name))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Consumer Price Index - Argentina"  
R>  [2] "Consumer Price Index - Australia"  
R>  [3] "Consumer Price Index - Canada"     
R>  [4] "Consumer Price Index - Switzerland"
R>  [5] "Consumer Price Index - Germany"    
R>  [6] "Consumer Price Index - Euro Area"  
R>  [7] "Consumer Price Index - France"     
R>  [8] "Consumer Price Index - UK"         
R>  [9] "Consumer Price Index - Italy"      
R> [10] "Consumer Price Index - Japan"      
R> [11] "Consumer Price Index - New Zealand"
R> [12] "Consumer Price Index - Russia"     
R> [13] "Consumer Price Index - USA"        
R> [14] "Inflation YOY - Argentina"         
R> [15] "Inflation YOY - Australia"         
R> [16] "Inflation YOY - Canada"            
R> [17] "Inflation YOY - Switzerland"       
R> [18] "Inflation YOY - Germany"           
R> [19] "Inflation YOY - Euro Area"         
R> [20] "Inflation YOY - France"            
R> [21] "Inflation YOY - UK"                
R> [22] "Inflation YOY - Italy"             
R> [23] "Inflation YOY - Japan"             
R> [24] "Inflation YOY - New Zealand"       
R> [25] "Inflation YOY - Russia"            
R> [26] "Inflation YOY - USA"
\end{verbatim}

O que estamos buscando são as séries \texttt{\textquotesingle{}Inflation\ YOY\ -\ *\textquotesingle{}}, as quais contém a inflação ano-ao-ano (\emph{Year On Year} -- \emph{YOY}) de diferentes países. Vamos agora filtrar o \texttt{dataframe} para manter apenas as séries de inflação anual para quatro países selecionados:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{selected\_series }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Inflation YOY {-} USA\textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}Inflation YOY {-} Canada\textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}Inflation YOY {-} Euro Area\textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}Inflation YOY {-} Australia\textquotesingle{}}\NormalTok{)}

\CommentTok{\# filter selected countries}
\NormalTok{idx }\OtherTok{\textless{}{-}}\NormalTok{ df\_db}\SpecialCharTok{$}\NormalTok{name }\SpecialCharTok{\%in\%}\NormalTok{ selected\_series}
\NormalTok{df\_db }\OtherTok{\textless{}{-}}\NormalTok{ df\_db[idx, ]}
\end{Highlighting}
\end{Shaded}

Agora importamos as séries usando \texttt{get\_Quandl\_series}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_id }\OtherTok{\textless{}{-}}\NormalTok{ df\_db}\SpecialCharTok{$}\NormalTok{quandl\_code}
\FunctionTok{names}\NormalTok{(my\_id) }\OtherTok{\textless{}{-}}\NormalTok{ df\_db}\SpecialCharTok{$}\NormalTok{name}
\NormalTok{first\_date }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}
\NormalTok{last\_date }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}

\NormalTok{df\_inflation }\OtherTok{\textless{}{-}} \FunctionTok{get\_Quandl\_series}\NormalTok{(}\AttributeTok{id\_in =}\NormalTok{ my\_id, }
                                  \AttributeTok{api\_key =}\NormalTok{ my\_api\_key,}
                                  \AttributeTok{first\_date =}\NormalTok{ first\_date,}
                                  \AttributeTok{last\_date =}\NormalTok{ last\_date)}

\FunctionTok{glimpse}\NormalTok{(df\_inflation)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 500
R> Columns: 4
R> $ series_name <chr> "Inflation YOY - Australia", "Inflatio~
R> $ ref_date    <date> 2022-06-30, 2022-03-31, 2021-12-31, 2~
R> $ value       <dbl> 6.1, 5.1, 3.5, 3.0, 3.8, 1.1, 0.9, 0.7~
R> $ id_quandl   <chr> "RATEINF/INFLATION_AUS", "RATEINF/INFL~
\end{verbatim}

Por fim, construimos um gráfico para vizualizar as séries de inflação:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-178-1} \end{center}

Como podemos ver, com algumas linhas de código do R conseguimos importar dados atualizados da inflação de diferentes regiões do mundo. O retorno de um \texttt{dataframe} no formato empilhado facilitou o processo de análise pois essa é a estrutura de dados que o \texttt{ggplot2} espera.

\hypertarget{pacote-batchgetsymbols}{%
\section{\texorpdfstring{Pacote \texttt{BatchGetSymbols}}{Pacote BatchGetSymbols}}\label{pacote-batchgetsymbols}}

\index{BatchGetSymbols}

Pacote \texttt{BatchGetSymbols} faz a comunicação do R com os dados financeiros disponíveis no \emph{Yahoo Finance}. Essa gigantesca base de dados inclui valores agregados de preços e volumes negociados de ações na B3 e outras bolsas internacionais na frequência diária. Tudo que se precisa saber para acessar a base de dados são os identificadores das ações (\emph{tickers}) e um período de tempo.

Os diferenciais do \texttt{BatchGetSymbols} são:

\textbf{Limpeza e organização}: todos os dados financeiros de diferentes \emph{tickers} são mantidos no mesmo \texttt{dataframe}, facilitando a análise futura com as ferramentas do \texttt{tidyverse}.

\textbf{Controle de erros de importação}: todos erros de \emph{download} são registrados na saída do programa. Caso uma ação em particular não exista no \emph{Yahoo Finance}, esta será ignorada e apenas as demais disponíveis serão retornadas na saída do código;

\textbf{Comparação de datas a um \emph{benchmark}}: os dados de ativos individuais são comparados com dados disponíveis para um ativo \emph{benchmark}, geralmente um índice de mercado. Caso o número de datas faltantes seja maior que um determinado limite imposto pelo usuário, a ação é retirada do \texttt{dataframe} final.

\textbf{Uso de sistema de cache}: no momento de acesso aos dados, os mesmos são salvos localmente no computador do usuário e são persistentes para cada sessão. Caso o usuário requisitar os mesmos dados na mesma sessão do R, o sistema de cache será utilizado. Se os dados desejados não estão disponíveis no cache, a função irá comparar e baixar apenas as informações que faltam. Isso aumenta significativamente a velocidade de acesso aos dados, ao mesmo tempo em que minimiza o uso da conexão a Internet;

\begin{rmdimportant}
Desde versão 2.6 (2020-11-22) de \texttt{BatchGetSymbols} a pasta
\emph{default} de cache do \texttt{BatchGetSymbols} se localiza no
diretório temporário da sessão do R. Assim, o cache é persistente apenas
para a sessão do usuário. Esta mudança foi motivada por quebras
estruturais nos dados do \emph{Yahoo Finance}, onde os dados passados
registrados em cache não mais estavam corretos devido a eventos
coporativos. O usuário, porém, pode trocar a pasta de cache usando a
entrada \texttt{cache.folder}.
\end{rmdimportant}

\textbf{Acesso a \emph{tickers} em índices de mercado}: O pacote inclui funções para baixar a composição dos índices Ibovespa, SP500 e FTSE100. Isso facilita a importação de dados para uma grande quantidade de ações. Podes, por exemplo, baixar cotações de todas as ações que fazem parte de certo índice.

\textbf{Processamento paralelo}: Caso o usuário estiver baixando um grande volume de dados do \emph{Yahoo Finance}, uma opção para execução paralela está disponível. Isto é, ao invés de usar apenas um núcleo na requisição dos dados, usamos vários ao mesmo tempo. O efeito prático é, dependendo do número de núcleos do computador, uma diminuição significativa no tempo total de importação.

\textbf{Flexibilidade de formato}: O pacote também oferece funções para modificar o formato dos dados. Caso o usuário deseje uma saída do \texttt{dataframe} no formato largo, onde \emph{tickers} são colunas e as linhas os preços/retornos, basta chamar função \texttt{BatchGetSymbols::reshape.wide}. Da mesma forma, uma transformação temporal também é possível. Se o usuário desejar dados na frequência semanal, mensal ou anual, basta indicar na entrada \texttt{freq.data} da função.

Como exemplo de uso, vamos baixar dados financeiros referentes a quatro ações no último ano (360 dias) usando a função de mesmo nome do pacote. Os \emph{tickers} de cada ação podem ser encontrados nos próprios sites do \href{https://br.financas.yahoo.com/}{\emph{Yahoo Finance}}. Note que adicionamos texto \texttt{.SA} a cada um deles. Essa é uma notação específica do site e vale para qualquer ação Brasileira.

Na chamada da função \texttt{BatchGetSymbols}, utilizamos um valor de \texttt{0.95} (95\%) para o \emph{input} \texttt{thresh.bad.data} e \texttt{\textquotesingle{}\^{}BVSP\textquotesingle{}} para \texttt{bench.ticker}. Isso faz com que a função compare as datas obtidas para cada ativo em relação ao nosso \emph{benchmark}, o índice Ibovespa, cujo \emph{ticker} no \emph{Yahoo Finance} é \texttt{\^{}BVSP}. Se, durante o processo de importação, uma ação individual não apresenta mais de 95\% de casos válidos em relação ao \emph{benchmark}, esta é retirada da saída.

\index{BatchGetSymbols!BatchGetSymbols}
\index{base!Sys.Date}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(BatchGetSymbols)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set tickers}
\NormalTok{my\_tickers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}PETR4.SA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CIEL3.SA\textquotesingle{}}\NormalTok{,}
                \StringTok{\textquotesingle{}GGBR4.SA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}GOAU4.SA\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set dates and other inputs}
\NormalTok{first\_date }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}\SpecialCharTok{{-}}\DecValTok{360}
\NormalTok{last\_date }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}
\NormalTok{thresh\_bad\_data }\OtherTok{\textless{}{-}} \FloatTok{0.95}   \CommentTok{\# sets percent threshold for bad data}
\NormalTok{bench\_ticker }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}\^{}BVSP\textquotesingle{}}   \CommentTok{\# set benchmark as ibovespa}

\NormalTok{l\_out }\OtherTok{\textless{}{-}} \FunctionTok{BatchGetSymbols}\NormalTok{(}\AttributeTok{tickers =}\NormalTok{ my\_tickers,}
                         \AttributeTok{first.date =}\NormalTok{ first\_date,}
                         \AttributeTok{last.date =}\NormalTok{ last\_date,}
                         \AttributeTok{bench.ticker =}\NormalTok{ bench\_ticker,}
                         \AttributeTok{thresh.bad.data =}\NormalTok{ thresh\_bad\_data)}
\end{Highlighting}
\end{Shaded}

A saída de \texttt{BatchGetSymbols} é um objeto do tipo lista, ainda não visto no livro. Por enquanto, tudo que precisas saber é que uma lista é um objeto flexível, acomodando outros objetos em sua composição. O acesso a cada elemento de uma lista pode ser feito pelo operador \texttt{\$}. No capítulo \ref{classe-estrutura} iremos estudar melhor esta classe de objetos.

\begin{rmdcaution}
Note que as entradas da função \texttt{BatchGetSymbols::BatchGetSymbols}
usam o ``.'' em seus nomes, tal como \texttt{thresh.bad.data}, e
\texttt{bench.ticker}, enquanto o livro está escrito usando o traço
baixo (\texttt{\_}), tal como \texttt{thresh\_bad\_data}, e
\texttt{bench\_ticker}. Esta diferença pode resultar em problemas se, na
falta de atenção, o usuário trocar um pelo outro. Como regra, procure
dar prioridade para o uso de traço baixo nos nomes de objetos.
Infelizmente algumas funções escritas no passado acabaram ficando com a
estrutura antiga e, para não prejudicar os usuários, os nomes das
entradas foram mantidos.
\end{rmdcaution}

Voltando ao nosso exemplo, função \texttt{BatchGetSymbols} retorna uma lista com dois elementos: um \texttt{dataframe} com o resultado do processo de importação -- \texttt{df\_control} -- e outro \texttt{dataframe} com os dados das ações -- \texttt{df\_tickers}. Vamos checar o conteúdo do primeiro dataframe.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print result of download process}
\FunctionTok{print}\NormalTok{(l\_out}\SpecialCharTok{$}\NormalTok{df.control)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 4 x 6
R>   ticker   src   download.status total.obs perc.be~1 thres~2
R>   <chr>    <chr> <chr>               <int>     <dbl> <chr>  
R> 1 PETR4.SA yahoo OK                    246         1 KEEP   
R> 2 CIEL3.SA yahoo OK                    246         1 KEEP   
R> 3 GGBR4.SA yahoo OK                    246         1 KEEP   
R> 4 GOAU4.SA yahoo OK                    246         1 KEEP   
R> # ... with abbreviated variable names
R> #   1: perc.benchmark.dates, 2: threshold.decision
\end{verbatim}

Objeto \texttt{df.control} mostra que todos \emph{tickers} foram válidos, com um total de 246 observações para cada ativo. Note que as datas batem 100\% com o Ibovespa (coluna \texttt{perc.benchmark.dates}).

Quanto aos dados financeiros, esses estão contidos em \texttt{l\_out\$df.tickers}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print df\_tickers}
\FunctionTok{glimpse}\NormalTok{(l\_out}\SpecialCharTok{$}\NormalTok{df.tickers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 984
R> Columns: 10
R> $ price.open          <dbl> 29.36, 29.30, 29.84, 26.99, 28~
R> $ price.high          <dbl> 29.82, 29.64, 30.67, 28.49, 28~
R> $ price.low           <dbl> 28.81, 28.86, 29.48, 26.20, 28~
R> $ price.close         <dbl> 29.47, 29.43, 29.60, 28.36, 28~
R> $ volume              <dbl> 84672200, 129384600, 135078600~
R> $ price.adjusted      <dbl> 15.33113, 15.31032, 15.39875, ~
R> $ ref.date            <date> 2021-11-29, 2021-11-30, 2021-~
R> $ ticker              <chr> "PETR4.SA", "PETR4.SA", "PETR4~
R> $ ret.adjusted.prices <dbl> NA, -0.0013573042, 0.005776432~
R> $ ret.closing.prices  <dbl> NA, -0.0013572786, 0.005776418~
\end{verbatim}

Como esperado, a informação sobre preços, retornos e volumes está lá, com as devidas classes de colunas: \emph{dbl} (\emph{double}) para valores numéricos e \emph{date} para as datas. Observe que uma coluna chamada \texttt{ticker} também está incluída. Essa indica em que linhas da tabela os dados de uma ação começam e terminam. Mais tarde, no capítulo \ref{limpando-estruturando}, usaremos essa coluna para fazer diversos cálculos para cada ação.

\hypertarget{baixando-dados-da-composiuxe7uxe3o-do-ibovespa}{%
\subsection{Baixando Dados da Composição do Ibovespa}\label{baixando-dados-da-composiuxe7uxe3o-do-ibovespa}}

Outra função útil do pacote é \texttt{BatchGetSymbols::GetIbovStocks}, a qual importa a composição atual do índice Ibovespa diretamente do site da B3. Esse índice é um termômetro do mercado local e as ações que o compõem são selecionadas devido sua alta negociabilidade. Portanto, sequenciando o uso de \texttt{GetIbovStocks} e \texttt{BatchGetSymbols}, podemos facilmente baixar uma volumosa quantidade de dados de ações para o mercado Brasileiro. Considere o seguinte fragmento de código, onde realizamos essa operação: \index{BatchGetSymbols!GetIbovStocks}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(BatchGetSymbols)}

\CommentTok{\# set tickers}
\NormalTok{df\_ibov }\OtherTok{\textless{}{-}} \FunctionTok{GetIbovStocks}\NormalTok{()}
\NormalTok{my\_tickers }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(df\_ibov}\SpecialCharTok{$}\NormalTok{tickers,}\StringTok{\textquotesingle{}.SA\textquotesingle{}}\NormalTok{)}


\CommentTok{\# set dates and other inputs}
\NormalTok{first\_date }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}\SpecialCharTok{{-}}\DecValTok{30}
\NormalTok{last\_date }\OtherTok{\textless{}{-}} \FunctionTok{Sys.Date}\NormalTok{()}
\NormalTok{thresh\_bad\_data }\OtherTok{\textless{}{-}} \FloatTok{0.95}   \CommentTok{\# sets percent threshold for bad data}
\NormalTok{bench\_ticker }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}\^{}BVSP\textquotesingle{}}   \CommentTok{\# set benchmark as ibovespa}
\NormalTok{cache\_folder }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}data/BGS\_Cache\textquotesingle{}} \CommentTok{\# set folder for cache}


\NormalTok{l\_out }\OtherTok{\textless{}{-}} \FunctionTok{BatchGetSymbols}\NormalTok{(}\AttributeTok{tickers =}\NormalTok{ my\_tickers,}
                         \AttributeTok{first.date =}\NormalTok{ first\_date,}
                         \AttributeTok{last.date =}\NormalTok{ last\_date,}
                         \AttributeTok{bench.ticker =}\NormalTok{ bench\_ticker,}
                         \AttributeTok{thresh.bad.data =}\NormalTok{ thresh\_bad\_data,}
                         \AttributeTok{cache.folder =}\NormalTok{ cache\_folder)}
\end{Highlighting}
\end{Shaded}

Note que utilizamos a função \texttt{paste0} para adicionar o texto \texttt{\textquotesingle{}.SA\textquotesingle{}} para cada \emph{ticker} em \texttt{df\_ibov\$tickers}. A saída do código anterior não foi mostrada para não encher páginas e páginas com as mensagens do processamento. Destaco que, caso necessário, poderíamos facilmente exportar os dados em \texttt{l\_out} para um arquivo \texttt{.rds} e futuramente carregá-los localmente para realizar algum tipo de análise.

\begin{rmdcaution}
Saiba que \textbf{os preços do Yahoo Finance não são ajustados a
dividendos}. O ajuste realizado pelo sistema é apenas para
desdobramentos das ações. Isso significa que, ao olhar séries de preços
em um longo período, existe um viés de retorno para baixo. Ao comparar
com outro software que faça o ajustamento dos preços por dividendos,
verás uma grande diferença na rentabilidade total das ações. Como regra,
em uma pesquisa formal, \textbf{evite usar dados de ações individuais no
Yahoo Finance para períodos longos}. A excessão é para índices
financeiros, tal como o Ibovespa, onde os dados do Yahoo Finance são
bastante confiáveis uma vez que índices não sofrem os mesmos
ajustamentos que ações individuais.
\end{rmdcaution}

\hypertarget{pacote-gettddata}{%
\section{\texorpdfstring{Pacote \texttt{GetTDData}}{Pacote GetTDData}}\label{pacote-gettddata}}

Arquivos com informações sobre preços e retornos de títulos emitidos pelo governo brasileiro podem ser baixados manualmente no site do \href{https://www.tesourodireto.com.br/}{Tesouro Nacional}. O tesouro direto é um tipo especial de mercado onde pessoa física pode comprar e vender dívida pública. Os contratos de dívida vendidos na plataforma são bastante populares devido a atratividade das taxas de retorno e a alta liquidez oferecida ao investidor comum.

Pacote \texttt{GetTDData} importa os dados das planilhas em Excel do site do Tesouro Nacional e os organiza. O resultado é um \texttt{dataframe} com dados empilhados. Como exemplo, vamos baixar dados de um título prefixado do tipo LTN com vencimento em 2021-01-01. Esse é o tipo de contrato de dívida mais simples que o governo brasileiro emite, não pagando nenhum cupom\footnote{O cupom é um pagamento intermediário pago periodicamente durante a validade do contrato financeiro.} durante sua validade e, na data de vencimento, retorna 1.000 R\$ ao comprador. Para baixar os dados da internet, basta usar o código a seguir:

\index{GetTDData} \index{GetTDData!download.TD.data} \index{GetTDData!read.TD.files}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetTDData)}

\NormalTok{asset\_codes }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}LTN\textquotesingle{}}   \CommentTok{\# Identifier of assets}
\NormalTok{maturity }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}010121\textquotesingle{}}  \CommentTok{\# Maturity date as string (ddmmyy)}

\CommentTok{\# download}
\NormalTok{my\_flag }\OtherTok{\textless{}{-}} \FunctionTok{download.TD.data}\NormalTok{(}\AttributeTok{asset.codes =}\NormalTok{ asset\_codes)}

\CommentTok{\# read files}
\NormalTok{df\_TD }\OtherTok{\textless{}{-}} \FunctionTok{read.TD.files}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Vamos checar o conteúdo do dataframe:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check content}
\FunctionTok{glimpse}\NormalTok{(df\_TD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 24,733
R> Columns: 5
R> $ ref.date   <date> 2002-03-18, 2002-03-19, 2002-03-20, 20~
R> $ yield.bid  <dbl> 0.1977, 0.1975, 0.1967, 0.2005, 0.1983,~
R> $ price.bid  <dbl> 720.96, 721.70, 723.09, 719.48, 722.38,~
R> $ asset.code <chr> "LTN 070104", "LTN 070104", "LTN 070104~
R> $ matur.date <date> 2004-01-07, 2004-01-07, 2004-01-07, 20~
\end{verbatim}

Temos informações sobre data de referência (\texttt{ref.date}), retorno contratado (\texttt{yield.bid}), preço do contrato na data (\texttt{price.bid}), nome do contrato (\texttt{asset.code}) e dia de maturidade (\texttt{matur.date}). No gráfico a seguir checamos os dados:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-188-1} \end{center}

Como esperado de um título de dívida pré-fixado, os preços possuem uma tendência positiva ao longo do tempo, chegando ao valor esperado de 1000 R\$ no vencimento em 2021-01-01. Podemos também visualizar as mudanças do \emph{yield} do título:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-189-1} \end{center}

Os retornos do título tiveram forte queda ao longo dos anos. Este resultado é esperado pois o juros do mercado -- taxa SELIC -- caiu bastante nos últimos cinco anos.

As funções do \texttt{GetTDData} também funcionam com vários argumentos como \texttt{asset.codes} e \texttt{maturity}. Suponhamos que desejamos visualizar todos os preços de todos os prazos disponíveis para títulos do tipo LTN a partir de 2010. Tudo o que precisamos fazer é adicionar o valor \texttt{NULL} ao argumento \texttt{maturity} e filtrar as datas:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetTDData)}

\NormalTok{asset\_codes }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}LTN\textquotesingle{}}   \CommentTok{\# Name of asset}
\NormalTok{maturity }\OtherTok{\textless{}{-}} \ConstantTok{NULL}      \CommentTok{\# = NULL, downloads all maturities}

\CommentTok{\# download data}
\NormalTok{my\_flag }\OtherTok{\textless{}{-}} \FunctionTok{download.TD.data}\NormalTok{(}\AttributeTok{asset.codes =}\NormalTok{ asset\_codes,}
                            \AttributeTok{do.clean.up =}\NormalTok{ F)}

\CommentTok{\# reads data}
\NormalTok{df\_TD }\OtherTok{\textless{}{-}} \FunctionTok{read.TD.files}\NormalTok{()}

\CommentTok{\# remove data prior to 2010}
\NormalTok{df\_TD }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df\_TD,}
\NormalTok{                       ref.date }\SpecialCharTok{\textgreater{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Após a importação das informações, plotamos os preços dos diferentes ativos:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-191-1} \end{center}

Note como todos contratos do tipo LTN terminam com valor R\$ 1.000 em sua data de expiração e possuem uma dinâmica linear de crescimento de preço ao longo do tempo.

Outra funcionalidade do pacote \texttt{GetTDData} é o acesso a curva de juros atual do sistema financeiro brasileiro diretamente do \href{https://www.anbima.com.br/pt_br/informar/curvas-de-juros-fechamento.htm}{site da Anbima}. Para isso, basta utilizar a função \texttt{get.yield.curve}:

\index{GetTDData!get.yield.curve}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetTDData)}

\CommentTok{\# get yield curve}
\NormalTok{df\_yield }\OtherTok{\textless{}{-}} \FunctionTok{get.yield.curve}\NormalTok{()}

\CommentTok{\# check result}
\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{glimpse}\NormalTok{(df\_yield)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 114
R> Columns: 5
R> $ n.biz.days   <dbl> 126, 252, 378, 504, 630, 756, 882, 10~
R> $ type         <chr> "real_return", "real_return", "real_r~
R> $ value        <dbl> 6.1355, 6.6490, 6.7057, 6.6214, 6.512~
R> $ ref.date     <date> 2023-05-24, 2023-11-23, 2024-05-27, ~
R> $ current.date <date> 2022-11-22, 2022-11-22, 2022-11-22, ~
\end{verbatim}

Os dados incluem a curva de juros nominal, juros real e da inflação. Para melhor visualizar as informações, vamos plotá-las em um gráfico:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-193-1} \end{center}

A curva de juros é uma ferramente utilizada no mercado financeiro com o propósito de representar graficamente a expectatica do mercado sobre juros futuro. Baseada nos preços dos títulos públicos, calcula-se e extrapola-se o juros implícito para cada período futuro. Uma curva ascendente, o formato esperado, indica que é mais caro (maior o juro) tomar dinheiro emprestado no longo prazo.

\hypertarget{pacote-getbcbdata}{%
\section{\texorpdfstring{Pacote \texttt{GetBCBData}}{Pacote GetBCBData}}\label{pacote-getbcbdata}}

O Banco Central Brasileiro (BCB) disponibiliza em seu \href{https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries}{Sistema de Séries Temporais (SGS)} uma vasta quantidade de tabelas relativas a economia do Brasil. Mais importante, estas tabelas são atualizadas constantemente e o acesso é gratuito e sem necessidade de registro.

Como um exemplo, vamos usar o pacote para estudar a inadimplência de crédito no sistema financeiro Brasileiro. O primeiro passo no uso de \texttt{GetBCBData} é procurar o símbolo da série de interesse. Acessando o \href{https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries}{sistema de séries temporais do BCB}, vemos que o código identificador para o percentual total de inandimplência no Brasil é 21082.

No código, basta indicar a série de interesse e o período de tempo desejado:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetBCBData)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set ids and dates}
\NormalTok{id\_series }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{perc\_default =} \DecValTok{21082}\NormalTok{)}
\NormalTok{first\_date }\OtherTok{=} \StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}

\CommentTok{\# get series from bcb}
\NormalTok{df\_cred }\OtherTok{\textless{}{-}} \FunctionTok{gbcbd\_get\_series}\NormalTok{(}\AttributeTok{id =}\NormalTok{ id\_series,}
                            \AttributeTok{first.date =}\NormalTok{ first\_date,}
                            \AttributeTok{last.date =} \FunctionTok{Sys.Date}\NormalTok{(), }
                            \AttributeTok{use.memoise =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Fetching perc_default [21082] from BCB-SGS from Online API 
R>   Found 139 observations
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check it}
\FunctionTok{glimpse}\NormalTok{(df\_cred)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 139
R> Columns: 4
R> $ ref.date    <date> 2011-03-01, 2011-04-01, 2011-05-01, 2~
R> $ value       <dbl> 3.17, 3.24, 3.37, 3.32, 3.42, 3.45, 3.~
R> $ id.num      <dbl> 21082, 21082, 21082, 21082, 21082, 210~
R> $ series.name <chr> "perc_default", "perc_default", "perc_~
\end{verbatim}

Note que indicamos o nome da coluna na própria definição da entrada \texttt{id}. Assim, coluna \texttt{series.name} toma o nome de \texttt{perc.default}. Esta configuração é importante pois irá diferenciar os dados no caso da importação de diversas séries diferentes. O gráfico apresentado a seguir mostra o valor da série no tempo:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-195-1} \end{center}

Como podemos ver, a percentagem de inadimplência aumentou a partir de 2015. Para ter uma idéia mais clara do problema, vamos incluir no gráfico a percentagem para pessoa física e pessoa jurídica. Olhando novamente o sistema do BCB, vemos que o símbolos de interesse são 21083 e 21084, respectivamente. O próximo código baixa os dados das duas séries.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set ids}
\NormalTok{id.series }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{credit\_default\_people =} \DecValTok{21083}\NormalTok{,}
               \AttributeTok{credit\_default\_companies =} \DecValTok{21084}\NormalTok{)}
\NormalTok{first.date }\OtherTok{=} \StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}

\CommentTok{\# get series from bcb}
\NormalTok{df\_cred }\OtherTok{\textless{}{-}} \FunctionTok{gbcbd\_get\_series}\NormalTok{(}\AttributeTok{id =}\NormalTok{ id.series,}
                            \AttributeTok{first.date =}\NormalTok{ first.date,}
                            \AttributeTok{last.date =} \FunctionTok{Sys.Date}\NormalTok{(), }
                            \AttributeTok{use.memoise =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Fetching credit_default_people [21083] from BCB-SGS from Online API 
R>   Found 139 observations
R> Fetching credit_default_companies [21084] from BCB-SGS from Online API 
R>   Found 139 observations
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check output}
\FunctionTok{glimpse}\NormalTok{(df\_cred)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 278
R> Columns: 4
R> $ ref.date    <date> 2011-03-01, 2011-04-01, 2011-05-01, 2~
R> $ value       <dbl> 1.96, 2.04, 2.15, 2.09, 2.18, 2.15, 2.~
R> $ id.num      <dbl> 21083, 21083, 21083, 21083, 21083, 210~
R> $ series.name <chr> "credit_default_people", "credit_defau~
\end{verbatim}

A diferença na saída do código anterior é que agora temos duas séries temporais empilhadas no mesmo \texttt{dataframe}. Partimos então para a visualização das séries

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-197-1} \end{center}

Como podemos ver, a inadimplência de crédito para pessoa física aumentou muito mais do que a para pessoa jurídica (empresas) nos últimos anos. Poderiámos, facilmente, integrar o código anterior para uma análise mais completa dos dados em algum problema de pesquisa.

\begin{rmdimportant}
O sistema BCB-SGS é local obrigatório para qualquer economista sério. A
quantidade e variedade de dados é imensa. Podes usar os dados do sistema
para automatizar qualquer tipo de relatório econômico.
\end{rmdimportant}

\hypertarget{pacote-getdfpdata2}{%
\section{\texorpdfstring{Pacote \texttt{GetDFPData2}}{Pacote GetDFPData2}}\label{pacote-getdfpdata2}}

Pacote \texttt{GetDFPData2} \citep{R-GetDFPData2} é uma evolução do pacote \texttt{GetDFPData} \citep{R-GetDFPData} e fornece uma interface aberta para todas as demonstrações financeiras distribuídas pela B3 e pela CVM nos sistemas DFP (dados anuais) e ITR (dados trimestrais). Ele não só faz o \emph{download} dos dados, mas também ajusta à inflação e torna as tabelas prontas para pesquisa dentro de um formato tabular. Os diferenciais do pacote em relação a outros distribuidores de dados comerciais são: livre acesso, facilidade para baixar dados em larga escala e a variedade de dados disponíveis.

\begin{rmdimportant}
Uma versão web de \texttt{GetDFPData2} foi desenvolvida e publicada na
internet como um aplicativo \emph{shiny} em
\url{http://www.msperlin.com/shiny/GetDFPData/}. Esse fornece uma
interface gráfica direta e simples para as principais funcionalidade do
pacote. Usuários podem selecionar as empresas disponíveis, o intervalo
de datas e baixar os dados como uma planilha do Excel ou um arquivo
compactado com vários arquivos \emph{csv}.

Saiba também que dados históricos completos e atualizados a partir de
2010 do DFP e ITR estão disponibilizados na seção
\href{https://www.msperlin.com/data/}{Data} do meu site pessoal.
\end{rmdimportant}

O ponto de partida no uso de \texttt{GetDFPData2} é baixar informações atuais sobre empresas disponíveis. O acesso a tabela é possível com a função \texttt{get\_info\_companies}: \index{GetDFPData2} \index{GetDFPData2!get.info.companies}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetDFPData2)}

\CommentTok{\# get info for companies in B3}
\NormalTok{df\_info }\OtherTok{\textless{}{-}} \FunctionTok{get\_info\_companies}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Fetching info on B3 companies
\end{verbatim}

\begin{verbatim}
R>  Found cache file. Loading data..
\end{verbatim}

\begin{verbatim}
R>  Got 2559 lines for 2425 companies [Actives = 701 Inactives = 1736]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check it}
\FunctionTok{names}\NormalTok{(df\_info)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "CNPJ"               "DENOM_SOCIAL"      
R>  [3] "DENOM_COMERC"       "DT_REG"            
R>  [5] "DT_CONST"           "DT_CANCEL"         
R>  [7] "MOTIVO_CANCEL"      "SIT_REG"           
R>  [9] "DT_INI_SIT"         "CD_CVM"            
R> [11] "SETOR_ATIV"         "TP_MERC"           
R> [13] "CATEG_REG"          "DT_INI_CATEG"      
R> [15] "SIT_EMISSOR"        "DT_INI_SIT_EMISSOR"
R> [17] "CONTROLE_ACIONARIO" "TP_ENDER"          
R> [19] "LOGRADOURO"         "COMPL"             
R> [21] "BAIRRO"             "MUN"               
R> [23] "UF"                 "PAIS"              
R> [25] "CEP"                "DDD_TEL"           
R> [27] "TEL"                "DDD_FAX"           
R> [29] "FAX"                "EMAIL"             
R> [31] "TP_RESP"            "RESP"              
R> [33] "DT_INI_RESP"        "LOGRADOURO_RESP"   
R> [35] "COMPL_RESP"         "BAIRRO_RESP"       
R> [37] "MUN_RESP"           "UF_RESP"           
R> [39] "PAIS_RESP"          "CEP_RESP"          
R> [41] "DDD_TEL_RESP"       "TEL_RESP"          
R> [43] "DDD_FAX_RESP"       "FAX_RESP"          
R> [45] "EMAIL_RESP"         "CNPJ_AUDITOR"      
R> [47] "AUDITOR"
\end{verbatim}

Essa tabela disponibiliza os identificadores numéricos das empresas, setores de atividades, atual segmento de governança, \emph{tickers} negociados na bolsa e situação atual (ativa ou não). O número atual de empresas ativas e inativas, a partir de 2022-11-23, está disponível na coluna \texttt{SIT\_REG}. Observa-se 786 empresas ativas e 1771 canceladas. Essa é uma excelente fonte de informação para um estudo exploratório. Pode-se facilmente filtrar empresas para datas, setores, \emph{tickers} ou segmentos de governança corporativa.

Toda empresa no banco de dados é identificada pelo seu número único da CVM. Função \texttt{search\_company} permite que o usuário procure o identificador de uma empresa através de seu nome. Dado um texto de entrada -- o nome da empresa --, a função procurará uma correspondência parcial com os nomes de todas as empresas disponíveis no banco de dados. Em seu uso, caracteres latinos e maiúsculas e minúsculas são ignorados. Vamos encontrar o nome oficial nome da Grendene, uma das maiores empresas do Brasil. Para isso, basta usar o comando \texttt{search\_company(\textquotesingle{}grendene\textquotesingle{})}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_search }\OtherTok{\textless{}{-}} \FunctionTok{search\_company}\NormalTok{(}\StringTok{\textquotesingle{}grendene\textquotesingle{}}\NormalTok{)}

\FunctionTok{print}\NormalTok{(df\_search)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 1 x 47
R>   CNPJ      DENOM~1 DENOM~2 DT_REG     DT_CONST   DT_CANCEL
R>   <chr>     <chr>   <chr>   <date>     <date>     <date>   
R> 1 89.850.3~ GRENDE~ GRENDE~ 2004-10-26 1971-02-25 NA       
R> # ... with 41 more variables: MOTIVO_CANCEL <chr>,
R> #   SIT_REG <chr>, DT_INI_SIT <date>, CD_CVM <dbl>,
R> #   SETOR_ATIV <chr>, TP_MERC <chr>, CATEG_REG <chr>,
R> #   DT_INI_CATEG <date>, SIT_EMISSOR <chr>,
R> #   DT_INI_SIT_EMISSOR <date>, CONTROLE_ACIONARIO <chr>,
R> #   TP_ENDER <chr>, LOGRADOURO <chr>, COMPL <chr>,
R> #   BAIRRO <chr>, MUN <chr>, UF <chr>, PAIS <chr>, ...
\end{verbatim}

Vemos que existe um registro para a Grendene: ``GRENDENE SA'', com código identificador equivalente a 19615. \index{GetDFPData2!search\_company}

Com o identificador da empresa disponível, usamos a função principal do pacote, \texttt{get\_dfp\_data}, para baixar os dados. Definimos o nome oficial da empresa como entrada \texttt{companies\_cvm\_codes} e o período de tempo como entradas \texttt{first\_year} e \texttt{last\_year}.

\index{GetDFPData2!get\_dfp\_data}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetDFPData2)}
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set options}
\NormalTok{id\_companies }\OtherTok{\textless{}{-}} \DecValTok{19615}
\NormalTok{first\_year }\OtherTok{\textless{}{-}} \DecValTok{2017}
\NormalTok{last\_year  }\OtherTok{\textless{}{-}} \DecValTok{2018}

\CommentTok{\# download data}
\NormalTok{l\_dfp }\OtherTok{\textless{}{-}} \FunctionTok{get\_dfp\_data}\NormalTok{(}\AttributeTok{companies\_cvm\_codes =}\NormalTok{ id\_companies,}
                      \AttributeTok{type\_docs =} \StringTok{\textquotesingle{}*\textquotesingle{}}\NormalTok{, }\CommentTok{\# get all docs  }
                      \AttributeTok{type\_format =} \StringTok{\textquotesingle{}con\textquotesingle{}}\NormalTok{, }\CommentTok{\# consolidated}
                      \AttributeTok{first\_year =}\NormalTok{ first\_year,}
                      \AttributeTok{last\_year =}\NormalTok{ last\_year)}
\end{Highlighting}
\end{Shaded}

As mensagens de \texttt{GetDFPData2::get\_dfp\_data} relatam os estágios do processo, desde a aquisição de dados da tabela de referência ao download e leitura dos arquivos da B3. Observe que os arquivos de três sistemas são acessados: DFP (\emph{Demostrativos Financeiros Padronizados}), FRE (\emph{Formulário de Referência}) e FCA (\emph{Formulário Cadastral}). Observe também o uso de um sistema de cache, o qual acelera significativamente o uso do software ao salvar localmente as informações importadas.

Explicando as demais entradas da função \texttt{GetDFPData2::get\_dfp\_data}:

\begin{description}
\tightlist
\item[companies\_cvm\_codes]
Código numérico das empresas (encontrado via \texttt{GetDFPData2::search\_company(\textquotesingle{}ambev\textquotesingle{})})
\item[type\_docs]
Símbolo do tipo de documento financeiro a ser retornado. Definições: '*' = retorna todos documentos, `BPA' = Ativo, `BPP' = passivo, `DRE' = demonstrativo de resultados do exercício, `DFC\_MD' = fluxo de caixa pelo metodo direto, `DFC\_MI' = fluxo de caixa pelo metodo indireto, `DMPL' = mutacoes do patrimonio liquido, `DVA' = demonstrativo de valor agregado.
\item[type\_format]
Tipo de formato dos documentos: consolidado (`con') ou individual (`ind'). Como regra, dê preferência ao tipo consolidado, o qual incluirá dados completos de subsidiárias.
\item[first\_year]
Primeiro ano para os dados
\item[last\_year]
Último ano para os dados
\end{description}

O objeto resultante de \texttt{get\_dfp\_data} é uma \texttt{lista} com diversas tabelas. Vamos dar uma olhada no conteúdo de \texttt{l\_dfp} ao buscar os nomes dos itens da lista, limitando o número de caracteres:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stringr}\SpecialCharTok{::}\FunctionTok{str\_sub}\NormalTok{(}\FunctionTok{names}\NormalTok{(l\_dfp), }\DecValTok{1}\NormalTok{, }\DecValTok{40}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "DF Consolidado - Balanço Patrimonial Ati"
R> [2] "DF Consolidado - Balanço Patrimonial Pas"
R> [3] "DF Consolidado - Demonstração das Mutaçõ"
R> [4] "DF Consolidado - Demonstração de Valor A"
R> [5] "DF Consolidado - Demonstração do Fluxo d"
R> [6] "DF Consolidado - Demonstração do Resulta"
\end{verbatim}

Como podemos ver, os dados retornados são vastos. Cada item da lista em \texttt{l\_dfp} é um tabela indexada ao tempo. A explicação de cada coluna não cabe aqui mas, para fins de exemplo, vamos dar uma olhada no balanço patrimonial da empresa, disponível em \texttt{l\_dfp\$"DF\ Consolidado\ -\ Balanço\ Patrimonial\ Ativo"}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# save assets in df}
\NormalTok{fr\_assets }\OtherTok{\textless{}{-}}\NormalTok{ l\_dfp}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{DF Consolidado {-} Balanço Patrimonial Ativo}\StringTok{\textasciigrave{}}

\CommentTok{\# check it}
\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{glimpse}\NormalTok{(fr\_assets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 122
R> Columns: 16
R> $ CNPJ_CIA     <chr> "89.850.341/0001-60", "89.850.341/000~
R> $ CD_CVM       <dbl> 19615, 19615, 19615, 19615, 19615, 19~
R> $ DT_REFER     <date> 2017-12-31, 2017-12-31, 2017-12-31, ~
R> $ DT_INI_EXERC <date> NA, NA, NA, NA, NA, NA, NA, NA, NA, ~
R> $ DT_FIM_EXERC <date> 2017-12-31, 2017-12-31, 2017-12-31, ~
R> $ DENOM_CIA    <chr> "GRENDENE S.A.", "GRENDENE S.A.", "GR~
R> $ VERSAO       <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~
R> $ GRUPO_DFP    <chr> "DF Consolidado - Balanço Patrimonial~
R> $ MOEDA        <chr> "REAL", "REAL", "REAL", "REAL", "REAL~
R> $ ESCALA_MOEDA <chr> "MIL", "MIL", "MIL", "MIL", "MIL", "M~
R> $ ORDEM_EXERC  <chr> "ÚLTIMO", "ÚLTIMO", "ÚLTIMO", "ÚLTIMO~
R> $ CD_CONTA     <chr> "1", "1.01", "1.01.01", "1.01.02", "1~
R> $ DS_CONTA     <chr> "Ativo Total", "Ativo Circulante", "C~
R> $ VL_CONTA     <dbl> 3576008, 2846997, 30119, 1537477, 836~
R> $ COLUNA_DF    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
R> $ source_file  <chr> "dfp_cia_aberta_BPA_con_2017.csv", "d~
\end{verbatim}

A exportação dos dados para o Excel também é fácil, basta usar função \texttt{GetDFPData2::export\_xlsx}: \index{GetDFPData2!export\_xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{\textquotesingle{}.xlsx\textquotesingle{}}\NormalTok{)}

\FunctionTok{export\_xlsx}\NormalTok{(}\AttributeTok{l\_dfp =}\NormalTok{ l\_dfp, }\AttributeTok{f\_xlsx =}\NormalTok{ temp\_xlsx)}
\end{Highlighting}
\end{Shaded}

O arquivo Excel resultante conterá cada tabela de \texttt{l\_dpf} em uma aba diferente da planilha, com uma truncagem nos nomes. Podemos checar o resultado com função \texttt{readxl::excel\_sheets}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{readxl}\SpecialCharTok{::}\FunctionTok{excel\_sheets}\NormalTok{(temp\_xlsx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "DF Consolidado - Balanço Pat"  
R> [2] "DF Consolidado - Balanço Pat_1"
R> [3] "DF Consolidado - Demonstraçã"  
R> [4] "DF Consolidado - Demonstraçã_1"
R> [5] "DF Consolidado - Demonstraçã_2"
R> [6] "DF Consolidado - Demonstraçã_3"
\end{verbatim}

\hypertarget{pacote-getfredata}{%
\section{\texorpdfstring{Pacote \texttt{GetFREData}}{Pacote GetFREData}}\label{pacote-getfredata}}

O pacote \texttt{GetFREData} importa dados do sistema FRE -- Formulário de Referência -- da bolsa Brasileira, incluindo eventos e informações corporativas tal como composição do conselho e diretoria, remuneração dos conselhos, entre outras.

A estrutura de uso e a saída das funções de \texttt{GetFREData} são muito semelhante as do pacote \texttt{GetDFPData2}. Veja a seguir um exemplo de uso.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(GetFREData)}

\CommentTok{\# set options}
\NormalTok{id\_companies }\OtherTok{\textless{}{-}} \DecValTok{23264}
\NormalTok{first\_year }\OtherTok{\textless{}{-}} \DecValTok{2017}
\NormalTok{last\_year  }\OtherTok{\textless{}{-}} \DecValTok{2018}

\CommentTok{\# download data}
\NormalTok{l\_fre }\OtherTok{\textless{}{-}} \FunctionTok{get\_fre\_data}\NormalTok{(}\AttributeTok{companies\_cvm\_codes =}\NormalTok{ id\_companies,}
                      \AttributeTok{first\_year =}\NormalTok{ first\_year,}
                      \AttributeTok{last\_year =}\NormalTok{ last\_year)}
\end{Highlighting}
\end{Shaded}

Note que o tempo de execução de \texttt{get\_fre\_data} é significativo. Isto deve-se ao \emph{download} e leitura dos arquivos do sistema FRE direto da bolsa. Cada tabela do FRE é importada na lista de saída:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(l\_fre)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "df_stockholders"            
R>  [2] "df_capital"                 
R>  [3] "df_stock_values"            
R>  [4] "df_mkt_value"               
R>  [5] "df_increase_capital"        
R>  [6] "df_capital_reduction"       
R>  [7] "df_compensation"            
R>  [8] "df_compensation_summary"    
R>  [9] "df_transactions_related"    
R> [10] "df_other_events"            
R> [11] "df_stock_repurchases"       
R> [12] "df_debt_composition"        
R> [13] "df_board_composition"       
R> [14] "df_committee_composition"   
R> [15] "df_family_relations"        
R> [16] "df_family_related_companies"
R> [17] "df_auditing"                
R> [18] "df_responsible_docs"        
R> [19] "df_stocks_details"          
R> [20] "df_dividends_details"       
R> [21] "df_intangible_details"
\end{verbatim}

Por exemplo, vamos verificar conteúdo da tabela \texttt{df\_board\_composition}, a qual contém informações sobre os componentes dos conselhos das empresas:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(l\_fre}\SpecialCharTok{$}\NormalTok{df\_board\_composition)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 59
R> Columns: 22
R> $ CNPJ_CIA                 <chr> "07.526.557/0001-00", "07~
R> $ DENOM_CIA                <chr> "AMBEV S.A.", "AMBEV S.A.~
R> $ DT_REFER                 <date> 2017-01-01, 2017-01-01, ~
R> $ CD_CVM                   <dbl> 23264, 23264, 23264, 2326~
R> $ ID_DOC                   <dbl> 74969, 74969, 74969, 7496~
R> $ VERSAO                   <dbl> 10, 10, 10, 10, 10, 10, 1~
R> $ person.name              <chr> "Paula Nogueira Lindenber~
R> $ person.cpf               <dbl> 26712117836, 25661215835,~
R> $ person.profession        <chr> "Administradora", "Engenh~
R> $ person.cv                <chr> "Nos últimos 5 anos, ocup~
R> $ person.dob               <date> NA, NA, NA, NA, NA, NA, ~
R> $ code.type.board          <chr> "1", "1", "1", "1", "1", ~
R> $ desc.type.board          <chr> "Director", "Director", "~
R> $ desc.type.board2         <chr> "Diretora de Marketing", ~
R> $ code.type.job            <chr> "19", "19", "19", "19", "~
R> $ desc.job                 <chr> "Não aplicável, uma vez q~
R> $ date.election            <date> 2016-05-11, 2016-05-11, ~
R> $ date.effective           <date> 2016-05-11, 2016-05-11, ~
R> $ mandate.duration         <chr> "11/05/2019", "30/06/2018~
R> $ ellected.by.controller   <lgl> TRUE, TRUE, TRUE, TRUE, T~
R> $ qtd.consecutive.mandates <dbl> 2, 2, 2, 2, 2, 1, 2, 1, 1~
R> $ percentage.participation <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0~
\end{verbatim}

Como podemos ver, para um pesquisador de finanças corporativas, o sistema FRE oferece uma série de informações interessantes. Discutir o conteúdo de cada tabela, porém, vai muito além do propósito dessa seção. Aos interessados, mais detalhes sobre as tabelas do FRE estão disponíveis em \citet{perlin2018accessing}.

\begin{rmdimportant}
Note que a importação dos dados do FRE inclui uma versão dos arquivos.
Toda vez que uma empresa modifica as informações oficiais no sistema da
B3, uma nova versão do FRE é criada. Devido a isso, é bastante comum que
os dados de um ano para uma empresa possua diferentes versões. Para
resolver este problema, o código do \texttt{GetFREData}, por
\emph{default}, importa a versão mais antiga para cada ano. Caso o
usuário queira mudar, basta utilizar a entrada \texttt{fre\_to\_read}.
\end{rmdimportant}

\hypertarget{outros-pacotes}{%
\section{Outros Pacotes}\label{outros-pacotes}}

Nas seções anteriores destacamos os principais pacotes gratuitos para aquisição de dados financeiros e econômicos no Brasil. Muitos desses foram escritos pelo próprio autor do livro e representam uma pequena parcela da totalidade. Não seria justo ignorar o trabalho de outros autores. Assim, reporto abaixo uma seleção de pacotes que vale a pena conhecer:

\hypertarget{pacotes-de-acesso-gratuito}{%
\subsection{Pacotes de Acesso Gratuito}\label{pacotes-de-acesso-gratuito}}

\begin{description}
\tightlist
\item[\texttt{BETS} \citep{R-BETS}]
Pacote construído e mantido pela equipe da \href{http://portal.fgv.br/en}{FGV}. Permite o acesso aos dados do BCB (Banco Central do Brasil) e IBGE (Instituto Brasileiro de Geografia e Estatística). Também inclui ferramentas para a administração, análise e manipulação dos dados em relatórios técnicos.
\item[\texttt{simfinapi} \citep{R-simfinapi}]
Pacote para acesso ao projeto \href{https://simfin.com/}{simfin}, incluindo dados financeiros de diversas empresas internacionais. O acesso livre é restrito a um número de chamadas diárias.
\end{description}

\hypertarget{pacotes-comerciais}{%
\subsection{Pacotes Comerciais}\label{pacotes-comerciais}}

\begin{description}
\tightlist
\item[\texttt{Rblpapi} \citep{R-Rblpapi}]
Permite acesso aos dados da \href{https://www.bloomberg.com/}{Bloomberg}, sendo necessário uma conta comercial.
\item[\texttt{IBrokers} \citep{R-IBrokers}]
API para o acesso aos dados da \href{https://www.interactivebrokers.com/en/home.php}{Interactive Brokers}. Também é necessário uma conta comercial.
\end{description}

No CRAN você encontrará muitos outros. A interface para fontes de dados comerciais também é possível. Várias empresas fornecem APIs para facilitar o envio de dados aos seus clientes. Se a empresa de fornecimento de dados que você usa no trabalho não for apresentada aqui, a \href{https://cran.r-project.org/}{lista de pacotes CRAN} pode ajudá-lo a encontrar uma alternativa viável.

\hypertarget{acessando-dados-de-puxe1ginas-na-internet-webscraping}{%
\section{\texorpdfstring{Acessando Dados de Páginas na Internet (\emph{Webscraping})}{Acessando Dados de Páginas na Internet (Webscraping)}}\label{acessando-dados-de-puxe1ginas-na-internet-webscraping}}

Os pacotes destacados anteriormente são muito úteis pois facilitam a importação de dados específicos diretamente da internet. Em muitos casos, porém, os dados de interesse não estão disponíveis via API formal, mas sim em uma página na internet - geralmente no formato de uma tabela. O processo de extrair informações de páginas da internet chama-se \emph{webscraping} (raspagem de dados). Dependendo da estrutura e da tecnologia da página da \emph{web} acessada, importar essas informações diretamente para o R pode ser um procedimento trivial -- mas também pode se tornar um processo extremamente trabalhoso. Como um exemplo, a seguir vamos raspar dados do Wikipedia sobre a composição do índice SP500.

\hypertarget{raspando-dados-do-wikipedia}{%
\subsection{Raspando Dados do Wikipedia}\label{raspando-dados-do-wikipedia}}

Em seu site, a Wikipedia oferece uma \href{https://en.wikipedia.org/wiki/List_of_S\%26P_500_companies}{seção}\footnote{\url{https://en.wikipedia.org/wiki/List_of_S\%26P_500_companies}} com os componentes do Índice SP500. Essas informações são apresentadas em um formato tabular, Figura \ref{fig:SP500-wikipedia}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{00-text-resources/figs/SP500-Wikipedia} 

}

\caption{Imagem da página do Wikipedia}\label{fig:SP500-wikipedia}
\end{figure}

As informações desta página são constantemente atualizadas, e podemos utilizá-las para importar informações sobre as ações pertencentes ao índice SP500. Antes de nos aprofundarmos no código R, precisamos entender como uma página da web funciona. Resumidamente, uma página da web nada mais é do que uma árvore com nódulos, representada por um código HTML (\emph{Hypertext Markup Language}) extenso interpretado pelo seu navegador. Um valor numérico ou texto apresentado no site geralmente pode ser encontrado dentro do próprio código. Este código tem uma estrutura particular em forma de árvore com ramificações, classes, nomes e identificadores. Além disso, cada elemento de uma página da web possui um endereço, denominado \emph{xpath}. Nos navegadores Chrome e Firefox, você pode ver o código HTML de uma página da web usando o mouse. Para isto, basta clicar com o botão direito em qualquer parte da página e selecionar \emph{View Page Source} (ou ``Ver Código Fonte'').

A primeira etapa do processo de raspagem de dados é descobrir a localização das informações de que você precisa. No navegador Chrome, você pode fazer isso clicando com o botão direito no local específico do número/texto no site e selecionando \emph{inspect}. Isso abrirá uma janela extra no navegador a direita. Depois de fazer isso, clique com o botão direito na seleção e escolha \emph{copy} e \emph{copy xpath}. Na Figura \ref{fig:SP500-Wikipedia-webscraping}, vemos um espelho do que você deve estar vendo em seu navegador.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{00-text-resources/figs/SP500-Wikipedia_webscraping} 

}

\caption{Encontrando o xpath da tabela}\label{fig:SP500-Wikipedia-webscraping}
\end{figure}

Aqui, o texto copiado é:

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{\textquotesingle{}//*[@id="mw{-}content{-}text"]/table[1]/thead/tr/th[2]\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Este é o endereço do cabeçalho da tabela. Para todo o conteúdo da tabela, incluindo cabeçalho, linhas e colunas, precisamos definir um nível superior da árvore. Isso é equivalente ao endereço \texttt{//*{[}@id\ ="\ mw-content-text"{]}/table{[}1{]}}.

Agora que temos a localização do que queremos, vamos carregar o pacote \texttt{rvest} \citep{R-rvest} e usar as funções \texttt{read\_html}, \texttt{html\_nodes} e\texttt{html\_table} para importar a tabela desejada para o R: \index{rvest} \index{rvest! read\_html} \index{rvest!html\_nodes} \index{rvest!html\_table}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rvest)}

\CommentTok{\# set url and xpath}
\NormalTok{my\_url }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}https://en.wikipedia.org/wiki/List\_of\_S\%26P\_500\_companies\textquotesingle{}}
\NormalTok{my\_xpath }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}//*[@id="mw{-}content{-}text"]/div/table[1]\textquotesingle{}}

\CommentTok{\# get nodes from html}
\NormalTok{out\_nodes }\OtherTok{\textless{}{-}} \FunctionTok{html\_nodes}\NormalTok{(}\FunctionTok{read\_html}\NormalTok{(my\_url),}
                        \AttributeTok{xpath =}\NormalTok{ my\_xpath)}

\CommentTok{\# get table from nodes (each element in }
\CommentTok{\# list is a table)}
\NormalTok{df\_SP500\_comp }\OtherTok{\textless{}{-}} \FunctionTok{html\_table}\NormalTok{(out\_nodes)}

\CommentTok{\# isolate it }
\NormalTok{df\_SP500\_comp }\OtherTok{\textless{}{-}}\NormalTok{ df\_SP500\_comp[[}\DecValTok{1}\NormalTok{]]}

\CommentTok{\# change column names (remove space)}
\FunctionTok{names}\NormalTok{(df\_SP500\_comp) }\OtherTok{\textless{}{-}} \FunctionTok{make.names}\NormalTok{(}\FunctionTok{names}\NormalTok{(df\_SP500\_comp))}

\CommentTok{\# print it}
\FunctionTok{glimpse}\NormalTok{(df\_SP500\_comp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 503
R> Columns: 9
R> $ Symbol                <chr> "MMM", "AOS", "ABT", "ABBV",~
R> $ Security              <chr> "3M", "A. O. Smith", "Abbott~
R> $ SEC.filings           <chr> "reports", "reports", "repor~
R> $ GICS.Sector           <chr> "Industrials", "Industrials"~
R> $ GICS.Sub.Industry     <chr> "Industrial Conglomerates", ~
R> $ Headquarters.Location <chr> "Saint Paul, Minnesota", "Mi~
R> $ Date.first.added      <chr> "1976-08-09", "2017-07-26", ~
R> $ CIK                   <int> 66740, 91142, 1800, 1551152,~
R> $ Founded               <chr> "1902", "1916", "1888", "201~
\end{verbatim}

O objeto \texttt{df\_SP500\_comp} contém um espelho dos dados do site da Wikipedia. Os nomes das colunas requerem algum trabalho de limpeza, mas o principal está ali. Observe como a saída é semelhante aos dados da função \texttt{BatchGetSymbols::GetSP500Stocks}. A razão é simples, ambas buscaram a informação na mesma origem. A diferença é que função \texttt{GetSP500Stocks} vai um passo além, limpando os dados importados.

\hypertarget{exerc-importacao-pacotes}{%
\section{Exercícios}\label{exerc-importacao-pacotes}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Using the \texttt{yfR} package, download daily data for ticker MMM from \emph{Yahoo Finance} for the period between 2019-01-01 and 2022-05-24. What is the lowest \textbf{unadjusted closing price (column \texttt{price\_close})} in the analyzed period?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  43.08903
\item
  65.59444
\item
  88.09984
\item
  20.58363
\item
  117.87
\end{enumerate}

02 -
If you have not already done so, create a profile on the \href{https://www.quandl.com/}{Quandl website}\footnote{\url{https://www.quandl.com/}} and download the arabica coffee price data (id = CEPEA/COFFEE\_A) in the CEPEA database (Center for Advanced Studies in Applied Economics) between 2010-01-01 and 2020-12-28. What is the maximum price found?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  \$194.03
\item
  \$50.30
\item
  \$265.90
\item
  \$122.16
\item
  \$349.39
\end{enumerate}

03 -
Utilize pacote \texttt{GetBCBData} para baixar dados do IPCA mensal entre 2010-01-01 e 2020-12-31. Para os dados importados, qual é a data com o maior valor mensal de inflação?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2010-11-01
\item
  2010-10-01
\item
  2011-05-01
\item
  2012-04-01
\item
  2020-12-01
\end{enumerate}

04 -
Use function \texttt{simfinapi::sfa\_get\_entities} to import data about all available companies in \href{https://simfin.com}{Simfin}. How many companies do you find?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  4945
\item
  3229
\item
  4311
\item
  5579
\item
  3677
\end{enumerate}

05 -
With package \texttt{simfinapi}, download the PnL (profit and loss) statement for FY (final year) data for id = 998466) for year 2015. What is the latest ``Net Income'' of the company?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  \$404.96
\item
  \$534.36
\item
  \$469.66
\item
  \$599.07
\item
  \$349.39
\end{enumerate}

06 -
Using again the \texttt{yfR} package, download data between 2019-01-01 and 2021-10-12 for the following tickers:

\begin{itemize}
\tightlist
\item
  AAPL: Apple Inc
\item
  BAC: Bank of America Corporation
\item
  GE: General Electric Company
\item
  TSLA: Tesla, Inc.
\item
  SNAP: Snap Inc.
\end{itemize}

Using the \textbf{adjusted closing price} column, what company provided higher return to the stock holder during the analyzed period?

Tip: this is an advanced exercise that will require some coding. To solve it, check out function \texttt{split} to split the dataframe of price data and \texttt{lapply} to map a function to each dataframe.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  TSLA
\item
  AAPL
\item
  BAC
\item
  SNAP
\item
  GE
\end{enumerate}

07 -
Using package \texttt{GetDFPData2}, download the main table with all available companies. What is the number of active companies currently available?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  1050
\item
  888
\item
  1372
\item
  786
\item
  1211
\end{enumerate}

08 -
Using package \texttt{GetDFPData2}, download net income data (consolidated) for all companies in the year of 2018. What is the sum of profit/loss (in thousands, code 3.11 in DFP) for all companies?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  \$382,399,640
\item
  \$269,132,608
\item
  \$56,155,004
\item
  \$127,147,539
\item
  \$198,140,073
\end{enumerate}

09 -
Using package \texttt{GetTDData}, download all available data for debt contract of type LTN (\emph{pré-fixados}).

What is the maximum yield (column \emph{yield.bid}) found for for contract LTN 010409?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  5.8\%
\item
  20.0\%
\item
  35.2\%
\item
  15.2\%
\item
  10.2\%
\end{enumerate}

\hypertarget{classe-estrutura}{%
\chapter{Dataframes e outros Objetos}\label{classe-estrutura}}

\textbf{No R, tudo é um objeto}. Sempre que chamamos uma função, tal como nos exemplos dos capítulos anteriores, ela nos retorna um objeto. Cada tipo ou classe de objeto terá uma série de propriedades diferentes. Por exemplo, um \texttt{dataframe} pode ser incrementado com novas colunas ou linhas. Uma coluna numérica de um \texttt{dataframe} pode interagir com outros valores numéricos através de operações de multiplicação, divisão e soma. Para colunas com textos, porém, tal propriedade não é válida, uma vez que não faz sentido somar um valor numérico a um texto ou dividir um texto por outro. Entretanto, a classe de texto tem outras propriedades, como a que permite procurar uma determinada sequência textual dentro de um texto maior, a manipulação de partes do texto e a substituição de caracteres específicos, dentre tantas outras possibilidades. \textbf{Um dos aspectos mais importantes no trabalho com o R é o aprendizado das classes de objetos e as suas funcionalidades}.

As classes básicas de objetos no R inclui valores numéricos, caracteres (texto), fatores, datas, entre vários outros casos. Na prática, porém, as classes básicas são armazenadas em estruturas de dados mais complexas, tal como \texttt{dataframes} e listas. Isso organiza e facilita o trabalho. Imagine realizar um estudo sobre as \emph{63} ações que compõem o índice Ibovespa, onde a base de dados é composta por preços e volumes negociados ao longo de um ano. Caso fôssemos criar um vetor numérico de preços e de volumes para cada ação, teríamos uma quantidade de \emph{126} objetos para lidar no nosso \emph{enviromnent}. Apesar de ser possível trabalhar dessa forma, o código resultante seria desorganizado, difícil de entender e passível de uma série de erros.

Uma maneira mais simples de organizar os nossos dados é criar um objeto com o nome \texttt{my\_data} e alocar todos os preços e volumes ali. Todas as informações necessárias para executar a pesquisa estariam nesse objeto, facilitando a importação e exportação dos dados. Esses objetos que armazenam outros objetos de classe básica constituem a classe de estrutura de dados. Nessa classificação, estão incluídas listas (\texttt{list}), matrizes (\texttt{matrix}) e tabelas (\texttt{dataframes}).

\hypertarget{dataframes}{%
\section{\texorpdfstring{\texttt{Dataframes}}{Dataframes}}\label{dataframes}}

Traduzindo para o português, \texttt{dataframe} significa ``estrutura ou organização de dados''. Grosso modo, um objeto da classe dataframe nada mais é do que uma tabela com linhas e colunas. Sem dúvida, \textbf{o \texttt{dataframe} é o principal objeto utilizado no trabalho com o R e o mais importante de se estudar}. Dados externos são, grande maioria dos casos, importados para o R no formato de tabelas. É na manipulação desses que gastará maior parte do tempo realizando a sua análise. Internamente, um \texttt{dataframe} é um tipo especial de lista, onde cada coluna é um vetor atômico com o mesmo número de elementos, porém com sua própria classe. Podemos organizar em um dataframe dados de texto juntamente com números, por exemplo.

Note que o formato tabular força a sincronização dos dados no sentido de linhas, isto é, cada caso de cada variável deve ser pareado com casos de outras variáveis. Apesar de simples, esse tipo de estruturação de dados é intuitiva e pode acomodar uma variedade de informações. Cada acréscimo de dados (informações) incrementa as linhas e cada novo tipo de informação incrementa as colunas da tabela.

Um dos pontos positivos na utilização do dataframe para a acomodação de dados é que funções de diferentes pacotes irão funcionar a partir dessa classe de objetos. Por exemplo, o pacote de manipulação de dados \texttt{dplyr}, assim como o pacote de criação de figuras \texttt{ggplot2}, funcionam a partir de um \texttt{dataframe}. Esse objeto, portanto, está no centro de uma série de funcionalidades do R e, sem dúvida, é uma classe de objeto extremamente importante para aprender a utilizar corretamente.

O objeto dataframe é uma das classes nativas do R e vem implementado no pacote \texttt{base}. Entretanto, o universe \texttt{tidyverse} oferece sua própria versão de um \texttt{dataframe}, chamada \texttt{tibble}, a qual é utilizada sistematicamente em todos pacotes do \texttt{tidyverse}. A conversão de um dataframe para \texttt{tibble} é interna e automática. O \texttt{tibble} possui propriedades mais flexíveis que \texttt{dataframes} nativos, facilitando de forma significativa o seu uso. Seguindo a nossa preferência para o \texttt{tidyverse}, a partir de agora iremos utilizar \texttt{tibbles} como representantes de \texttt{dataframes}.

\hypertarget{criando-dataframes}{%
\subsection{\texorpdfstring{Criando \texttt{dataframes}}{Criando dataframes}}\label{criando-dataframes}}

A criação de um dataframe do tipo \texttt{tibble} ocorre a partir da função \texttt{tibble}. Note que a criação de um \texttt{dataframe} nativo ocorre com a função \texttt{base::data.frame}, enquanto a criação do \texttt{tibble} parte da função \texttt{tibble::tibble} ou \texttt{dplyr::tibble}. Para manter o código mais limpo, iremos dar preferência a \texttt{dplyr::tibble} e utilizar o nome \emph{dataframe} para se referir a um \texttt{tibble}. Veja o exemplo a seguir, onde criamos uma tabela correspondente a dados financeiros de diferentes ações. \index{tibble} \index{tibble!tibble} \index{tibble!data\_frame} \index{base!data.frame}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tibble)}

\CommentTok{\# set tickers}
\NormalTok{ticker }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}ABEV3\textquotesingle{}}\NormalTok{,}\DecValTok{4}\NormalTok{),}
            \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}BBAS3\textquotesingle{}}\NormalTok{, }\DecValTok{4}\NormalTok{),}
            \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}BBDC3\textquotesingle{}}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\CommentTok{\# set dates}
\NormalTok{ref\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}04\textquotesingle{}}\NormalTok{,}
                          \StringTok{\textquotesingle{}2010{-}01{-}05\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}06\textquotesingle{}}\NormalTok{),}
                        \DecValTok{3}\NormalTok{) )}

\CommentTok{\# set prices}
\NormalTok{price }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{736.67}\NormalTok{, }\FloatTok{764.14}\NormalTok{, }\FloatTok{768.63}\NormalTok{, }\FloatTok{776.47}\NormalTok{,}
           \FloatTok{59.4}\NormalTok{  , }\FloatTok{59.8}\NormalTok{  , }\FloatTok{59.2}\NormalTok{  , }\FloatTok{59.28}\NormalTok{,}
           \FloatTok{29.81}\NormalTok{ , }\FloatTok{30.82}\NormalTok{ , }\FloatTok{30.38}\NormalTok{ , }\FloatTok{30.20}\NormalTok{)}

\CommentTok{\# create tibble/dataframe}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(ticker, ref\_date , price)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 12 x 3
R>    ticker ref_date   price
R>    <chr>  <date>     <dbl>
R>  1 ABEV3  2010-01-01 737. 
R>  2 ABEV3  2010-01-04 764. 
R>  3 ABEV3  2010-01-05 769. 
R>  4 ABEV3  2010-01-06 776. 
R>  5 BBAS3  2010-01-01  59.4
R>  6 BBAS3  2010-01-04  59.8
R>  7 BBAS3  2010-01-05  59.2
R>  8 BBAS3  2010-01-06  59.3
R>  9 BBDC3  2010-01-01  29.8
R> 10 BBDC3  2010-01-04  30.8
R> 11 BBDC3  2010-01-05  30.4
R> 12 BBDC3  2010-01-06  30.2
\end{verbatim}

Observe que utilizamos a função \texttt{rep} para replicar e facilitar a criação dos dados do \texttt{dataframe} anterior. Assim, não é necessário repetir os valores múltiplas vezes. Destaca-se que, no uso dos \texttt{dataframes}, podemos salvar todos os nossos dados em um único objeto, facilitando o acesso e a organização do código resultante.

\begin{rmdimportant}
O conteúdo de \texttt{dataframes} também pode ser visualizado no próprio
RStudio. Para isso, basta clicar no nome do objeto na aba
\emph{environment}, canto superior direito da tela. Após isso, um
visualizador aparecerá na tela principal do programa. Essa operação é
nada mais que uma chamada a função \texttt{utils::View}. Portanto,
poderíamos visualizar o \texttt{dataframe} anterior executando o comando
\texttt{View(my\_df)}.
\end{rmdimportant}

\index{utils!View}

\hypertarget{inspecionando-um-dataframe}{%
\subsection{\texorpdfstring{Inspecionando um \texttt{dataframe}}{Inspecionando um dataframe}}\label{inspecionando-um-dataframe}}

Após a criação do \texttt{dataframe}, o segundo passo é conhecer o seu conteúdo. Particularmente, é importante tomar conhecimento dos seguintes itens em ordem de importância:

\begin{description}
\tightlist
\item[Número de linhas e colunas]
O número de linhas e colunas da tabela resultante indicam se a operação de importação foi executada corretamente. Caso os valores forem diferentes do esperado, deve-se checar o arquivo de importação dos dados e se as opções de importação fazem sentido para o arquivo.
\item[Nomes das colunas]
É importante que a tabela importada tenha nomes que façam sentido e que sejam fáceis de acessar. Portanto, o segundo passo na inspeção de um \texttt{dataframe} é analisar os nomes das colunas e seus respectivos conteúdos. Confirme que cada coluna realmente apresenta um nome intuitivo.
\item[Classes das colunas]
Cada coluna de um \texttt{dataframe} tem sua própria classe. É de suma importância que as classes dos dados estejam corretamente especificadas. Caso contrário, operações futuras podem resultar em um erro. Por exemplo, caso um vetor de valores numéricos seja importado com a classe de texto (\texttt{character}), qualquer operação matemática nesse vetor irá resultar em um erro no R.
\item[Existência de dados omissos (\texttt{NA})]
Devemos também verificar o número de valores \texttt{NA} (\emph{not available}) nas diferentes colunas. Sempre que você encontrar uma grande proporção de valores \texttt{NA} na tabela importada, você deve descobrir o que está acontecendo e se a informação está sendo importada corretamente. Conforme mencionado no capítulo anterior, os valores \texttt{NA} são contagiosos e transformarão qualquer objeto que interagir com um \texttt{NA}, também se tornará um \texttt{NA}.
\end{description}

Uma das funções mais recomendadas para se familiarizar com um \texttt{dataframe} é \texttt{dplyr::glimpse}. Essa mostra na tela o nome e a classe das colunas, além do número de linhas/colunas. Abusamos dessa função nos capítulos anteriores. Veja um exemplo simples a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# check content of my\_df}
\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 3
R> $ ticker   <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS~
R> $ ref_date <date> 2010-01-01, 2010-01-04, 2010-01-05, 2010~
R> $ price    <dbl> 736.67, 764.14, 768.63, 776.47, 59.40, 59~
\end{verbatim}

Em muitas situações, o uso de \texttt{glimpse} é suficiente para entender se o processo de importação de dados ocorreu de forma satisfatória. Porém, uma análise mais profunda é entender qual a variação de cada coluna nos dados importados. Aqui entra o papel da função \texttt{base::summary}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check variation my\_df}
\FunctionTok{summary}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>     ticker             ref_date              price       
R>  Length:12          Min.   :2010-01-01   Min.   : 29.81  
R>  Class :character   1st Qu.:2010-01-03   1st Qu.: 30.71  
R>  Mode  :character   Median :2010-01-04   Median : 59.34  
R>                     Mean   :2010-01-04   Mean   :283.73  
R>                     3rd Qu.:2010-01-05   3rd Qu.:743.54  
R>                     Max.   :2010-01-06   Max.   :776.47
\end{verbatim}

Note que \texttt{summary} interpreta cada coluna de forma diferente. Para o primeiro caso, coluna \texttt{ticker}, mostra apenas o tamanho do vetor. No caso de datas e valores numéricos, essa apresenta o máximo, mínimo, mediana e quartis. Por exemplo, uma observação extrema (\emph{outlier}) poderia ser facilmente identificada na análise da saída textual de \texttt{summary}.

\begin{rmdimportant}
Toda vez que se deparar com um novo \texttt{dataframe} no R, pegue o
hábito de verificar o seu conteúdo com funções \texttt{dplyr::glimpse} e
\texttt{base::summary}. Assim, poderá perceber problemas de importação
e/ou conteúdo dos arquivos lidos. Com experiência irás perceber que
muitos erros futuros em código podem ser sanados por uma simples
inspeção das tabelas importadas.
\end{rmdimportant}

\hypertarget{operador-de-pipeline}{%
\subsection{\texorpdfstring{Operador de \emph{pipeline} (\texttt{\%\textgreater{}\%})}{Operador de pipeline (\%\textgreater\%)}}\label{operador-de-pipeline}}

Uma característica importante do universo \texttt{tidyverse} é o uso extensivo do operador de \emph{pipeline}, primeiro proposto por \citet{R-magrittr} e definido pelo símbolo \texttt{\%\textgreater{}\%}. Esse comando permite que operações de dados sejam realizadas de forma sequencial e modular, como em uma \emph{tubulação}, facilitando a otimização e legibilidade do código resultante.

Imagine uma situação onde temos três funções para aplicar nos dados salvos em um \texttt{dataframe}. Cada função depende da saída de outra função. Isso requer o encadeamento de suas chamadas. Usando o operador de \emph{pipeline}, podemos escrever o procedimento de manipulação \texttt{dataframe} com o seguinte código: \index{dplyr!\%>\%}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_tab }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{fct1}\NormalTok{(arg1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{fct2}\NormalTok{(arg2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{fct3}\NormalTok{(arg3)}
\end{Highlighting}
\end{Shaded}

Usamos símbolo \texttt{\%\textgreater{}\%} no final de cada linha para vincular as operações. As funções \texttt{fct*} são operações realizadas em cada etapa. O resultado de cada linha é passado para a próxima função de forma sequencial. Assim, não há necessidade de criar objetos intermediários. Veja a seguir duas formas alternativas de realizar a mesma operação sem o operador de \emph{pipeline}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# version 1}
\NormalTok{my\_tab }\OtherTok{\textless{}{-}} \FunctionTok{fct3}\NormalTok{(}\FunctionTok{fct2}\NormalTok{(}\FunctionTok{fct1}\NormalTok{(my\_df,}
\NormalTok{                         arg1),}
\NormalTok{                    arg2),}
\NormalTok{               arg1)}

\CommentTok{\# version 2}
\NormalTok{temp1 }\OtherTok{\textless{}{-}} \FunctionTok{fct1}\NormalTok{(my\_df, arg1)}
\NormalTok{temp2 }\OtherTok{\textless{}{-}} \FunctionTok{fct2}\NormalTok{(temp1, arg2)}
\NormalTok{my\_tab }\OtherTok{\textless{}{-}} \FunctionTok{fct3}\NormalTok{(temp1, arg3)}
\end{Highlighting}
\end{Shaded}

Observe como as alternativas formam um código com estrutura estranha e passível a erros. Provavelmente não deves ter notado, mas ambos os códigos possuem erros de digitação. Para o primeiro, o último \texttt{arg1} deveria ser \texttt{arg3} e, no segundo, a função \texttt{fct3} está usando o \texttt{dataframe} \texttt{temp1} e não \texttt{temp2}. Este exemplo deixa claro como o uso de \emph{pipelines} torna o código mais elegante e legível. A partir de agora iremos utilizar o operador \texttt{\%\textgreater{}\%} de forma extensiva.

\hypertarget{acessando-colunas}{%
\subsection{Acessando Colunas}\label{acessando-colunas}}

Um objeto do tipo \texttt{dataframe} utiliza-se de diversos comandos e símbolos que também são usados em matrizes e listas. Para descobrir os nomes das colunas de um \texttt{dataframe}, temos duas funções: \texttt{names} ou \texttt{colnames}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check names of df}
\FunctionTok{names}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ticker"   "ref_date" "price"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ticker"   "ref_date" "price"
\end{verbatim}

Ambas também podem ser usadas para modificar os nomes das colunas:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set temp df}
\NormalTok{temp\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df}

\CommentTok{\# check names}
\FunctionTok{names}\NormalTok{(temp\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ticker"   "ref_date" "price"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# change names}
\FunctionTok{names}\NormalTok{(temp\_df) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{\textquotesingle{}Col\textquotesingle{}}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(temp\_df))}

\CommentTok{\# check names}
\FunctionTok{names}\NormalTok{(temp\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Col1" "Col2" "Col3"
\end{verbatim}

Destaca-se que a forma de usar \texttt{names} é bastante distinta das demais funções do R. Nesse caso, utilizamos a função ao lado esquerdo do símbolo de \texttt{assign} (\texttt{\textless{}-}). Internamente, o que estamos fazendo é definindo um atributo do objeto \texttt{temp\_df}, o nome de suas colunas.

Para acessar uma determinada coluna, podemos utilizar o nome da mesma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# isolate columns of df}
\NormalTok{my\_ticker }\OtherTok{\textless{}{-}}\NormalTok{ my\_df}\SpecialCharTok{$}\NormalTok{ticker}
\NormalTok{my\_prices }\OtherTok{\textless{}{-}}\NormalTok{ my\_df[[}\StringTok{\textquotesingle{}price\textquotesingle{}}\NormalTok{]]}

\CommentTok{\# print contents}
\FunctionTok{print}\NormalTok{(my\_ticker)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "ABEV3" "ABEV3" "ABEV3" "ABEV3" "BBAS3" "BBAS3" "BBAS3"
R>  [8] "BBAS3" "BBDC3" "BBDC3" "BBDC3" "BBDC3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_prices)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 736.67 764.14 768.63 776.47  59.40  59.80  59.20  59.28
R>  [9]  29.81  30.82  30.38  30.20
\end{verbatim}

Note o uso do duplo colchetes (\texttt{{[}{[}{]}{]}}) para selecionar colunas. Vale apontar que, no R, \textbf{um objeto da classe \texttt{dataframe} é representado internamente como uma lista}, onde cada elemento é uma coluna. Isso é importante saber, pois alguns comandos de listas também funcionam para \texttt{dataframes}. Um exemplo é o uso de duplo colchetes (\texttt{{[}{[}{]}{]}}) para selecionar colunas por posição:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_df[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
R>  [5] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
R>  [9] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
\end{verbatim}

Para acessar linhas e colunas específicas de um \texttt{dataframe}, basta utilizar colchetes simples:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 1
R>   ref_date  
R>   <date>    
R> 1 2010-01-01
R> 2 2010-01-04
R> 3 2010-01-05
R> 4 2010-01-06
R> 5 2010-01-01
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>   ticker ref_date  
R>   <chr>  <date>    
R> 1 ABEV3  2010-01-01
R> 2 ABEV3  2010-01-04
R> 3 ABEV3  2010-01-05
R> 4 ABEV3  2010-01-06
R> 5 BBAS3  2010-01-01
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 3
R>   ticker ref_date   price
R>   <chr>  <date>     <dbl>
R> 1 ABEV3  2010-01-01 737. 
R> 2 ABEV3  2010-01-04 764. 
R> 3 ABEV3  2010-01-05 769. 
R> 4 ABEV3  2010-01-06 776. 
R> 5 BBAS3  2010-01-01  59.4
\end{verbatim}

Essa seleção de colunas também pode ser realizada utilizando o nome das mesmas da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_df[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ticker\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}price\textquotesingle{}}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 2
R>   ticker price
R>   <chr>  <dbl>
R> 1 ABEV3   737.
R> 2 ABEV3   764.
R> 3 ABEV3   769.
\end{verbatim}

ou, pelo operador de \emph{pipeline} e a função \texttt{dplyr::select}: \index{dplyr!select}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\NormalTok{my.temp }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(ticker, price) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 2
R> $ ticker <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS3"~
R> $ price  <dbl> 736.67, 764.14, 768.63, 776.47, 59.40, 59.8~
\end{verbatim}

\hypertarget{modificando-um-dataframe}{%
\subsection{\texorpdfstring{Modificando um \texttt{dataframe}}{Modificando um dataframe}}\label{modificando-um-dataframe}}

Para criar novas colunas em um \texttt{dataframe}, basta utilizar a função \texttt{mutate}. Aqui iremos abusar do operador de \emph{pipeline} (\texttt{\%\textgreater{}\%}) para sequenciar as operações:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# add columns with mutate}
\NormalTok{my\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ret =}\NormalTok{ price}\SpecialCharTok{/}\FunctionTok{lag}\NormalTok{(price) }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,}
         \AttributeTok{my\_seq1 =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(my\_df),}
         \AttributeTok{my\_seq2 =}\NormalTok{  my\_seq1 }\SpecialCharTok{+}\DecValTok{9}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 6
R> $ ticker   <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS~
R> $ ref_date <date> 2010-01-01, 2010-01-04, 2010-01-05, 2010~
R> $ price    <dbl> 736.67, 764.14, 768.63, 776.47, 59.40, 59~
R> $ ret      <dbl> NA, 0.037289424, 0.005875887, 0.010199966~
R> $ my_seq1  <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R> $ my_seq2  <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2~
\end{verbatim}

Note que precisamos indicar o \texttt{dataframe} de origem dos dados, nesse caso o objeto \texttt{my\_df}, e as colunas são definidas como argumentos em \texttt{dplyr::mutate}. Observe também que usamos a coluna \texttt{price} na construção de \texttt{ret}, o retorno aritmético dos preços. Um caso especial é a construção de \texttt{my\_seq2} com base em \texttt{my\_seq1}, isto é, antes mesmo dela ser explicitamente calculada já é possível utilizar a nova coluna para criar outra. Vale salientar que a nova coluna deve ter exatamente o mesmo número de elementos que as demais. Caso contrário, o R retorna uma mensagem de erro.

A maneira mais tradicional, e comumente encontrada em código, para criar novas colunas é utilizar o símbolo \texttt{\$}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add new column with base R}
\NormalTok{my\_df}\SpecialCharTok{$}\NormalTok{my\_seq3 }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(my\_df)}

\CommentTok{\# check it}
\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 7
R> $ ticker   <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS~
R> $ ref_date <date> 2010-01-01, 2010-01-04, 2010-01-05, 2010~
R> $ price    <dbl> 736.67, 764.14, 768.63, 776.47, 59.40, 59~
R> $ ret      <dbl> NA, 0.037289424, 0.005875887, 0.010199966~
R> $ my_seq1  <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R> $ my_seq2  <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2~
R> $ my_seq3  <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
\end{verbatim}

Portanto, o operador \texttt{\$} vale tanto para acessar quanto para criar novas colunas.

Para remover colunas de um \texttt{dataframe}, basta usar \texttt{dplyr::select} com operador negativo para o nome das colunas indesejadas:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# removing columns}
\NormalTok{my\_df\_temp }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{my\_seq1, }\SpecialCharTok{{-}}\NormalTok{my\_seq2, }\SpecialCharTok{{-}}\NormalTok{my\_seq3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 4
R> $ ticker   <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS~
R> $ ref_date <date> 2010-01-01, 2010-01-04, 2010-01-05, 2010~
R> $ price    <dbl> 736.67, 764.14, 768.63, 776.47, 59.40, 59~
R> $ ret      <dbl> NA, 0.037289424, 0.005875887, 0.010199966~
\end{verbatim}

No uso de funções nativas do R, a maneira tradicional de remover colunas é alocar o valor nulo (\texttt{NULL}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set temp df}
\NormalTok{temp\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df}

\CommentTok{\# remove cols}
\NormalTok{temp\_df}\SpecialCharTok{$}\NormalTok{price }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{temp\_df}\SpecialCharTok{$}\NormalTok{ref\_date  }\OtherTok{\textless{}{-}} \ConstantTok{NULL}

\CommentTok{\# check it}
\FunctionTok{glimpse}\NormalTok{(temp\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 12
R> Columns: 5
R> $ ticker  <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3", "BBAS3~
R> $ ret     <dbl> NA, 0.037289424, 0.005875887, 0.010199966,~
R> $ my_seq1 <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
R> $ my_seq2 <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20~
R> $ my_seq3 <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
\end{verbatim}

\hypertarget{filtrando-um-dataframe}{%
\subsection{\texorpdfstring{Filtrando um \texttt{dataframe}}{Filtrando um dataframe}}\label{filtrando-um-dataframe}}

Uma operação bastante comum no R é filtrar linhas de uma tabela de acordo com uma ou mais condições. Por exemplo, caso quiséssemos apenas os dados da ação \texttt{ABEV3}, poderíamos utilizar a função \texttt{dplyr::filter} para filtrar a tabela: \index{dplyr!filter}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# filter df for single stock}
\NormalTok{my\_df\_temp }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ticker }\SpecialCharTok{==} \StringTok{\textquotesingle{}ABEV3\textquotesingle{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 4
R> Columns: 7
R> $ ticker   <chr> "ABEV3", "ABEV3", "ABEV3", "ABEV3"
R> $ ref_date <date> 2010-01-01, 2010-01-04, 2010-01-05, 2010-~
R> $ price    <dbl> 736.67, 764.14, 768.63, 776.47
R> $ ret      <dbl> NA, 0.037289424, 0.005875887, 0.010199966
R> $ my_seq1  <int> 1, 2, 3, 4
R> $ my_seq2  <dbl> 10, 11, 12, 13
R> $ my_seq3  <int> 1, 2, 3, 4
\end{verbatim}

A função também aceita mais de uma condição. Veja a seguir onde filtramos os dados para \texttt{\textquotesingle{}ABEV3\textquotesingle{}} em datas após ou igual a \texttt{\textquotesingle{}2010-01-05\textquotesingle{}}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\CommentTok{\# filter df for single stock and date}
\NormalTok{my\_df\_temp }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ticker }\SpecialCharTok{==} \StringTok{\textquotesingle{}ABEV3\textquotesingle{}}\NormalTok{,}
\NormalTok{         ref\_date }\SpecialCharTok{\textgreater{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2010{-}01{-}05\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2
R> Columns: 7
R> $ ticker   <chr> "ABEV3", "ABEV3"
R> $ ref_date <date> 2010-01-05, 2010-01-06
R> $ price    <dbl> 768.63, 776.47
R> $ ret      <dbl> 0.005875887, 0.010199966
R> $ my_seq1  <int> 3, 4
R> $ my_seq2  <dbl> 12, 13
R> $ my_seq3  <int> 3, 4
\end{verbatim}

Aqui utilizamos o símbolo \texttt{==} para testar uma igualdade. Iremos estudar mais profundamente a classe de testes lógicos no capítulo \ref{classes-basicas}.

\hypertarget{ordenando-um-dataframe}{%
\subsection{\texorpdfstring{Ordenando um \texttt{dataframe}}{Ordenando um dataframe}}\label{ordenando-um-dataframe}}

Após a criação ou importação de um \texttt{dataframe}, pode-se ordenar seus componentes de acordo com os valores de alguma coluna. Um caso bastante comum em que é necessário realizar uma ordenação explícita é quando importamos dados financeiros em que as datas não estão em ordem crescente. Na grande maioria das situações, dados temporais devem estar ordenados de acordo com a antiguidade, isto é, dados mais recentes são alocados na última linha da tabela. Essa operação é realizada através do uso da função \texttt{base::order} ou \texttt{dplyr::arrange}. \index{dplyr!arrange} \index{base!order}

Como exemplo, considere a criação de um \texttt{dataframe} com os valores a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# set df}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{),}
                \AttributeTok{col2 =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{),}
                \AttributeTok{col3 =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{))}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     4     1 a    
R> 2     1     1 b    
R> 3     2     3 c
\end{verbatim}

A função \texttt{order} retorna os índices relativos à ordenação dos valores dados como entrada. Para o caso da primeira coluna de \texttt{my\_df}, os índices dos elementos formadores do novo vetor, com seus valores ordenados em forma crescente, são:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idx }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(my\_df}\SpecialCharTok{$}\NormalTok{col1)}
\FunctionTok{print}\NormalTok{(idx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2 3 1
\end{verbatim}

Portanto, ao utilizar a saída da função \texttt{order} como indexador do \texttt{dataframe}, acaba-se ordenando o mesmo de acordo com os valores da coluna \texttt{col1}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_df\_2 }\OtherTok{\textless{}{-}}\NormalTok{ my\_df[}\FunctionTok{order}\NormalTok{(my\_df}\SpecialCharTok{$}\NormalTok{col1), ]}
\FunctionTok{print}\NormalTok{(my\_df\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     2     3 c    
R> 3     4     1 a
\end{verbatim}

Essa operação de ordenamento também pode ser realizada levando em conta mais de uma coluna. Veja o exemplo a seguir, onde se ordena o \texttt{dataframe} pelas colunas \texttt{col2} e \texttt{col1}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idx }\OtherTok{\textless{}{-}} \FunctionTok{order}\NormalTok{(my\_df}\SpecialCharTok{$}\NormalTok{col2, my\_df}\SpecialCharTok{$}\NormalTok{col1)}
\NormalTok{my\_df\_3 }\OtherTok{\textless{}{-}}\NormalTok{ my\_df[idx, ]}
\FunctionTok{print}\NormalTok{(my\_df\_3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     4     1 a    
R> 3     2     3 c
\end{verbatim}

No \texttt{tidyverse}, a forma de ordenar \texttt{dataframes} é pelo uso da função \texttt{arrange}. No caso de ordenamento decrescente, encapsulamos o nome das colunas com \texttt{desc}: \index{dplyr!desc}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sort ascending, by col1 and col2}
\NormalTok{my\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(col1, col2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     2     3 c    
R> 3     4     1 a
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sort descending, col1 and col2}
\NormalTok{my\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(col1), }\FunctionTok{desc}\NormalTok{(col2)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     4     1 a    
R> 2     2     3 c    
R> 3     1     1 b
\end{verbatim}

O resultado prático no uso de \texttt{arrange} é o mesmo de \texttt{order}. Um dos seus benefícios é a possibilidade de encadeamento de operações através do uso do \emph{pipeline}.

\hypertarget{combinando-e-agregando-dataframes}{%
\subsection{\texorpdfstring{Combinando e Agregando \texttt{dataframes}}{Combinando e Agregando dataframes}}\label{combinando-e-agregando-dataframes}}

Em muitas situações de análise de dados será necessário juntar \texttt{dataframes} distintos em um único objeto. Tabelas diferentes são importadas no R e, antes de analisar os dados, precisamos combinar as informações em um único objeto. Nos casos mais simples, onde as tabelas a serem agregadas possuem o mesmo formato, nós as juntamos de acordo com as linhas, verticalmente, ou colunas, horizontalmente. Para esse fim, temos as funções \texttt{dplyr::bind\_rows} e \texttt{dlyr::bind\_cols} no tidyverse e \texttt{base::rbind} e \texttt{base::cbind} nas funções nativas do R. Observe o exemplo a seguir. \index{dplyr!bind\_rows} \index{dplyr!bind\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# set dfs}
\NormalTok{my\_df\_1 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                  \AttributeTok{col2 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\NormalTok{my\_df\_2 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \DecValTok{6}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{col2 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\DecValTok{5}\NormalTok{),}
                  \AttributeTok{col3 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\CommentTok{\# bind by row}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(my\_df\_1, my\_df\_2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 10
R> Columns: 3
R> $ col1 <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
R> $ col2 <chr> "a", "a", "a", "a", "a", "b", "b", "b", "b", ~
R> $ col3 <chr> NA, NA, NA, NA, NA, "c", "c", "c", "c", "c"
\end{verbatim}

Note que, no exemplo anterior, os nomes das colunas são os mesmos. De fato, a função \texttt{dplyr::bind\_rows} procura os nomes iguais em ambos os objetos para fazer a junção dos \texttt{dataframes} corretamente. As colunas que não ocorrem em ambos objetos, tal como \texttt{col3} no exemplo, saem como \texttt{NA} no objeto final. Já para o caso de \texttt{bind\_cols}, os nomes das colunas devem ser diferentes, porém o número de linhas deve ser o mesmo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set dfs}
\NormalTok{my\_df\_1 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{col2 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\NormalTok{my\_df\_2 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col3 =} \DecValTok{6}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{col4 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\CommentTok{\# bind by column}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(my\_df\_1, my\_df\_2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 5
R> Columns: 4
R> $ col1 <int> 1, 2, 3, 4, 5
R> $ col2 <chr> "a", "a", "a", "a", "a"
R> $ col3 <int> 6, 7, 8, 9, 10
R> $ col4 <chr> "b", "b", "b", "b", "b"
\end{verbatim}

Para casos mais complexos, onde a junção deve ser realizada de acordo com algum índice tal como uma data, é possível juntar \texttt{dataframes} diferentes com o uso das funções da família \texttt{dplyr::join*} tal como \texttt{dplyr::inner\_join} \texttt{dplyr::left\_join}, \texttt{dplyr::full\_join}, entre outras. A descrição de todas elas não cabe aqui. Iremos descrever apenas o caso mais provável, \texttt{inner\_join}. Essa combina os dados, mantendo apenas os casos onde existe o índice em ambos.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set df}
\NormalTok{my\_df\_1 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}01\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{11}\NormalTok{)}

\NormalTok{my\_df\_2 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}05\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{11}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Note que os \texttt{dataframes} criados possuem uma coluna em comum, \texttt{date}. A partir desta coluna que agregamos as tabelas com \texttt{inner\_join}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# aggregate tables}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(my\_df\_1, my\_df\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Joining, by = "date"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 7
R> Columns: 3
R> $ date <date> 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-~
R> $ x    <int> 5, 6, 7, 8, 9, 10, 11
R> $ y    <dbl> 20, 21, 22, 23, 24, 25, 26
\end{verbatim}

O R automaticamente verifica a existência de colunas com mesmo nome nos \texttt{dataframes} e realiza a junção por essas. Caso quiséssemos juntar \texttt{dataframes} onde os nomes das colunas para utilizar o índice não são iguais, temos duas soluções: modificar os nomes das colunas ou então utilizar argumento \texttt{by} em \texttt{dplyr::inner\_join}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set df}
\NormalTok{my\_df\_3 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{ref\_date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}01\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{11}\NormalTok{)}

\NormalTok{my\_df\_4 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{my\_date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}05\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{11}\NormalTok{))}

\CommentTok{\# join by my\_df\_3$ref\_date and my\_df\_4$my\_date}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(my\_df\_3, my\_df\_4,}
                    \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ref\_date\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}my\_date\textquotesingle{}}\NormalTok{))}

\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 7
R> Columns: 3
R> $ ref_date <date> 2016-01-05, 2016-01-06, 2016-01-07, 2016~
R> $ x        <int> 5, 6, 7, 8, 9, 10, 11
R> $ y        <dbl> 20, 21, 22, 23, 24, 25, 26
\end{verbatim}

Para o caso de uso da função nativa de agregação de \texttt{dataframes}, \texttt{base::merge}, temos que indicar explicitamente o nome da coluna com argumento \texttt{by}: \index{base!merge}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# aggregation with base R}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(my\_df\_1, my\_df\_2, }\AttributeTok{by =} \StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{)}

\FunctionTok{glimpse}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 7
R> Columns: 3
R> $ date <date> 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-~
R> $ x    <int> 5, 6, 7, 8, 9, 10, 11
R> $ y    <dbl> 20, 21, 22, 23, 24, 25, 26
\end{verbatim}

Note que, nesse caso, o \texttt{dataframe} resultante manteve apenas as informações compartilhadas entre ambos os objetos, isto é, aquelas linhas onde as datas em \texttt{date} eram iguais. Esse é o mesmo resultado quando no uso do \texttt{dplyr::inner\_join}.

As demais funções de agregação de tabelas -- \texttt{left\_join}, \texttt{right\_join}, \texttt{outer\_join} e \texttt{full\_join} -- funcionam de forma muito semelhante a \texttt{inner\_join}, exceto na escolha da saída. Por exemplo, \texttt{full\_join} retorna todos os casos/linhas entre tabela 1 e 2, incluindo aqueles onde não tem o índice compartilhado. Para estes casos, a coluna do índice sairá como \texttt{NA}. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set df}
\NormalTok{my\_df\_5 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{ref\_date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}01\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{11}\NormalTok{)}

\NormalTok{my\_df\_6 }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{ref\_date =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}05\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
                  \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{11}\NormalTok{))}

\CommentTok{\# combine with full\_join}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{full\_join}\NormalTok{(my\_df\_5, my\_df\_6)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Joining, by = "ref_date"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 15 x 3
R>    ref_date       x     y
R>    <date>     <int> <dbl>
R>  1 2016-01-01     1    NA
R>  2 2016-01-02     2    NA
R>  3 2016-01-03     3    NA
R>  4 2016-01-04     4    NA
R>  5 2016-01-05     5    20
R>  6 2016-01-06     6    21
R>  7 2016-01-07     7    22
R>  8 2016-01-08     8    23
R>  9 2016-01-09     9    24
R> 10 2016-01-10    10    25
R> 11 2016-01-11    11    26
R> 12 2016-01-12    NA    27
R> 13 2016-01-13    NA    28
R> 14 2016-01-14    NA    29
R> 15 2016-01-15    NA    30
\end{verbatim}

\hypertarget{extensuxf5es-ao-dataframe}{%
\subsection{\texorpdfstring{Extensões ao \texttt{dataframe}}{Extensões ao dataframe}}\label{extensuxf5es-ao-dataframe}}

Como já foi relatado nos capítulos anteriores, um dos grandes benefícios no uso do R é a existência de pacotes para lidar com os problemas específicos dos usuários. Enquanto um objeto tabular do tipo \texttt{tibble} é suficiente para a maioria dos casos, existem benefícios no uso de uma classe alternativa. Ao longo do tempo, diversas soluções foram disponibilizadas por desenvolvedores.

Por exemplo, é muito comum trabalharmos com dados exclusivamente numéricos que são indexados ao tempo. Isto é, situações onde cada informação pertence a um índice temporal - um objeto da classe data/tempo. As linhas dessa tabela representam um ponto no tempo, enquanto as colunas indicam variáveis numéricas de interesse. Nesse caso, faria sentido representarmos os nossos dados como objetos do tipo \texttt{xts} \citep{R-xts}. O grande benefício dessa opção é que a agregação e a manipulação de variáveis em função do tempo é muito fácil. Por exemplo, podemos transformar dados de frequência diária para a frequência semanal com apenas uma linha de comando. Além disso, diversas outras funções reconhecem automaticamente que os dados são indexados ao tempo. Um exemplo é a criação de uma figura com esses dados. Nesse caso, o eixo horizontal da figura é automaticamente organizado com as datas.

Veja um caso a seguir, onde carregamos os dados anteriores como um objeto \texttt{xts}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(xts)}

\CommentTok{\# set data}
\NormalTok{ticker }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABEV3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}BBAS3\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}BBDC3\textquotesingle{}}\NormalTok{)}

\NormalTok{date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}04\textquotesingle{}}\NormalTok{,}
                  \StringTok{\textquotesingle{}2010{-}01{-}05\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}06\textquotesingle{}}\NormalTok{))}

\NormalTok{price\_ABEV3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{736.67}\NormalTok{, }\FloatTok{764.14}\NormalTok{, }\FloatTok{768.63}\NormalTok{, }\FloatTok{776.47}\NormalTok{)}
\NormalTok{price\_BBAS3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{59.4}\NormalTok{, }\FloatTok{59.8}\NormalTok{, }\FloatTok{59.2}\NormalTok{, }\FloatTok{59.28}\NormalTok{)}
\NormalTok{price\_BBDC3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{29.81}\NormalTok{, }\FloatTok{30.82}\NormalTok{, }\FloatTok{30.38}\NormalTok{, }\FloatTok{30.20}\NormalTok{)}

\CommentTok{\# build matrix}
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(price\_BBDC3, price\_BBAS3, price\_ABEV3),}
                 \AttributeTok{nrow =} \FunctionTok{length}\NormalTok{(date) )}

\CommentTok{\# set xts object}
\NormalTok{my\_xts }\OtherTok{\textless{}{-}} \FunctionTok{xts}\NormalTok{(my\_mat,}
              \AttributeTok{order.by =}\NormalTok{ date)}

\CommentTok{\# set correct colnames}
\FunctionTok{colnames}\NormalTok{(my\_xts) }\OtherTok{\textless{}{-}}\NormalTok{ ticker}

\CommentTok{\# check it!}
\FunctionTok{print}\NormalTok{(my\_xts)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>            ABEV3 BBAS3  BBDC3
R> 2010-01-01 29.81 59.40 736.67
R> 2010-01-04 30.82 59.80 764.14
R> 2010-01-05 30.38 59.20 768.63
R> 2010-01-06 30.20 59.28 776.47
\end{verbatim}

O código anterior pode dar a impressão de que o objeto \texttt{my\_xts} é semelhante a um \texttt{dataframe}, porém, não se engane. Por estar indexado a um vetor de tempo, objeto \texttt{xts} pode ser utilizado para uma série de procedimentos temporais, tal como uma agregação por período temporal. Veja o exemplo a seguir, onde agregamos duas variáveis de tempo através do cálculo de uma média a cada semana.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{500}

\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, N), }\FunctionTok{seq}\NormalTok{(N, }\DecValTok{1}\NormalTok{)), }\AttributeTok{nrow=}\NormalTok{N)}

\NormalTok{my\_xts }\OtherTok{\textless{}{-}} \FunctionTok{xts}\NormalTok{(my\_mat, }\AttributeTok{order.by =} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}01{-}01\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}\DecValTok{1}\SpecialCharTok{:}\NormalTok{N)}

\NormalTok{my\_xts.weekly.mean }\OtherTok{\textless{}{-}} \FunctionTok{apply.weekly}\NormalTok{(my\_xts, mean)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{head}\NormalTok{(my\_xts.weekly.mean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>             X.1   X.2
R> 2016-01-03  1.5 499.5
R> 2016-01-10  6.0 495.0
R> 2016-01-17 13.0 488.0
R> 2016-01-24 20.0 481.0
R> 2016-01-31 27.0 474.0
R> 2016-02-07 34.0 467.0
\end{verbatim}

Em Finanças e Economia, as agregações com objetos \texttt{xts} são extremamente úteis quando se trabalha com dados em frequências de tempo diferentes. Por exemplo, é muito comum que se agregue dados de transação no mercado financeiro em alta frequência para intervalos maiores. Assim, dados que ocorrem a cada segundo são agregados para serem representados de 15 em 15 minutos. Esse tipo de procedimento é facilmente realizado no R através da correta representação dos dados como objetos \texttt{xts}. Existem diversas outras funcionalidades desse pacote. Encorajo os usuários a ler o manual e aprender o que pode ser feito.

Indo além, existem diversos outros tipos de \texttt{dataframes} customizados. Por exemplo, o \texttt{dataframe} proposto pelo pacote \texttt{data.table} \citep{R-data.table} prioriza o tempo de operação nos dados e o uso de uma notação compacta para acesso e processamento. O \texttt{tibbletime} \citep{R-tibbletime} é uma versão orientada pelo tempo para \texttt{tibbles}. Caso o usuário esteja necessitando realizar operações de agregação de tempo, o uso deste pacote é fortemente recomendado.

\hypertarget{outras-funuxe7uxf5es-uxfateis}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis}}

\textbf{head} - Retorna os primeiros \texttt{n} elementos de um \texttt{dataframe}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5000}\NormalTok{, }\AttributeTok{col2 =} \FunctionTok{rep}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\DecValTok{5000}\NormalTok{))}
\FunctionTok{head}\NormalTok{(my\_df, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    col1 col2 
R>   <int> <chr>
R> 1     1 a    
R> 2     2 a    
R> 3     3 a    
R> 4     4 a    
R> 5     5 a
\end{verbatim}

\textbf{tail} - Retorna os últimos \texttt{n} elementos de um \texttt{dataframe}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tail}\NormalTok{(my\_df, }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    col1 col2 
R>   <int> <chr>
R> 1  4996 a    
R> 2  4997 a    
R> 3  4998 a    
R> 4  4999 a    
R> 5  5000 a
\end{verbatim}

\textbf{complete.cases} - Retorna um vetor lógico que testa se as linhas contêm apenas valores existentes e nenhum \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\NormalTok{my\_y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\ConstantTok{NA}\NormalTok{)}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(my\_x, my\_y)}

\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 7 x 2
R>    my_x  my_y
R>   <dbl> <int>
R> 1     1     5
R> 2     2     6
R> 3     3     7
R> 4     4     8
R> 5     5     9
R> 6    NA    10
R> 7    10    NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{complete.cases}\NormalTok{(my\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{which}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{complete.cases}\NormalTok{(my\_df)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6 7
\end{verbatim}

\textbf{na.omit} - Retorna um \texttt{dataframe} sem as linhas onde valores \texttt{NA} são encontrados.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{na.omit}\NormalTok{(my\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    my_x  my_y
R>   <dbl> <int>
R> 1     1     5
R> 2     2     6
R> 3     3     7
R> 4     4     8
R> 5     5     9
\end{verbatim}

\textbf{unique} - Retorna um \texttt{dataframe} onde todas as linhas duplicadas são eliminadas e somente os casos únicos são mantidos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}
                \AttributeTok{col2 =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{))}

\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 7 x 2
R>    col1 col2 
R>   <dbl> <chr>
R> 1     1 A    
R> 2     1 A    
R> 3     2 A    
R> 4     3 C    
R> 5     3 C    
R> 6     4 B    
R> 7     5 D
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{unique}\NormalTok{(my\_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    col1 col2 
R>   <dbl> <chr>
R> 1     1 A    
R> 2     2 A    
R> 3     3 C    
R> 4     4 B    
R> 5     5 D
\end{verbatim}

\hypertarget{listas}{%
\section{Listas}\label{listas}}

Uma lista (\texttt{list}) é uma classe de objeto extremamente flexível e já tivemos contato com ela nos capítulos anteriores. Ao contrário de vetores atômicos, a lista não apresenta restrição alguma em relação aos tipos de elementos nela contidos. Podemos agrupar valores numéricos com caracteres, fatores com datas e até mesmo listas dentro de listas. Quando agrupamos vetores, também não é necessário que os mesmos tenham um número igual de elementos. Além disso, podemos dar um nome a cada elemento. Essas propriedades fazem da lista o objeto mais flexível para o armazenamento e estruturação de dados no R. Não é acidental o fato de que listas são muito utilizadas como retorno de funções.

\hypertarget{criando-listas}{%
\subsection{Criando Listas}\label{criando-listas}}

Uma lista pode ser criada através do comando \texttt{base::list}, seguido por seus elementos separados por vírgula: \index{base!list}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# create list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
             \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{),}
             \FunctionTok{factor}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{),}
             \FunctionTok{tibble}\NormalTok{(}\AttributeTok{col1 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{))}

\CommentTok{\# use base::print}
\FunctionTok{print}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] 1 2 3
R> 
R> [[2]]
R> [1] "a" "b"
R> 
R> [[3]]
R> [1] <NA>
R> Levels: C
R> 
R> [[4]]
R> # A tibble: 5 x 1
R>    col1
R>   <int>
R> 1     1
R> 2     2
R> 3     3
R> 4     4
R> 5     5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# use dplyr::glimpse}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 4
R>  $ : num [1:3] 1 2 3
R>  $ : chr [1:2] "a" "b"
R>  $ : Factor w/ 1 level "C": NA
R>  $ : tibble [5 x 1] (S3: tbl_df/tbl/data.frame)
R>   ..$ col1: int [1:5] 1 2 3 4 5
\end{verbatim}

Note que juntamos no mesmo objeto um vetor atômico numérico, outro de texto, um fator e um \texttt{tibble}. A apresentação de listas com o comando \texttt{print} é diferente dos casos anteriores. Os elementos são separados verticalmente e os seus índices aparecem com duplo colchete (\texttt{{[}{[}\ {]}{]}}). Conforme será explicado logo a seguir, é dessa forma que os elementos de uma lista são armazenados e acessados.

Assim como para os demais tipos de objeto, os elementos de uma lista também podem ter nomes, o que facilita o entendimento e a interpretação das informações do problema em análise. Por exemplo, considere o caso de uma base de dados com informações sobre determinada ação negociada na bolsa. Nesse caso, podemos definir uma lista como:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set named list}
\NormalTok{my\_named\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{ticker =} \StringTok{\textquotesingle{}TICK4\textquotesingle{}}\NormalTok{,}
                   \AttributeTok{market =} \StringTok{\textquotesingle{}Bovespa\textquotesingle{}}\NormalTok{,}
                   \AttributeTok{df\_prices =} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{P =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{1.5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\FloatTok{2.3}\NormalTok{),}
                                      \AttributeTok{ref\_date =} \FunctionTok{Sys.Date}\NormalTok{()}\SpecialCharTok{+}\DecValTok{0}\SpecialCharTok{:}\DecValTok{3}\NormalTok{))}

\CommentTok{\# check content}
\FunctionTok{glimpse}\NormalTok{(my\_named\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ ticker   : chr "TICK4"
R>  $ market   : chr "Bovespa"
R>  $ df_prices: tibble [4 x 2] (S3: tbl_df/tbl/data.frame)
R>   ..$ P       : num [1:4] 1 1.5 2 2.3
R>   ..$ ref_date: Date[1:4], format: "2022-11-23" ...
\end{verbatim}

\begin{rmdimportant}
Toda vez que for trabalhar com listas, facilite a sua vida ao nomear
todos os elementos de forma intuitiva. Isso facilita o acesso e evito
possíveis erros no código.
\end{rmdimportant}

\hypertarget{acessando-os-elementos-de-uma-lista}{%
\subsection{Acessando os Elementos de uma Lista}\label{acessando-os-elementos-de-uma-lista}}

Os elementos de uma lista podem ser acessados através do uso de duplo colchete (\texttt{{[}{[}\ {]}{]}}), tal como em:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# accessing elements from list}
\FunctionTok{print}\NormalTok{(my\_named\_l[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Bovespa"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_named\_l[[}\DecValTok{3}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 4 x 2
R>       P ref_date  
R>   <dbl> <date>    
R> 1   1   2022-11-23
R> 2   1.5 2022-11-24
R> 3   2   2022-11-25
R> 4   2.3 2022-11-26
\end{verbatim}

Também é possível acessar os elementos com um colchete simples (\texttt{{[}\ {]}}), porém, tome cuidado com essa operação, pois o resultado não vai ser o objeto em si, mas uma outra lista. Esse é um equívoco muito fácil de passar despercebido, resultando em erros no código. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}
             \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
             \FunctionTok{factor}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{))}

\CommentTok{\# check classes}
\FunctionTok{class}\NormalTok{(my\_l[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(my\_l[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "list"
\end{verbatim}

Caso tentarmos somar um elemento a \texttt{my\_l{[}2{]}}, teremos uma mensagem de erro:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_l[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error in my_l[2] + 1: non-numeric argument to binary operator
\end{verbatim}

Esse erro ocorre devido ao fato de que uma lista não tem operador de soma. Para corrigir, basta utilizar o duplo colchete, tal como em \texttt{my\_l{[}{[}2{]}{]}+1}. O acesso a elementos de uma lista com colchete simples somente é útil quando estamos procurando uma sublista dentro de uma lista maior. No exemplo anterior, caso quiséssemos obter o primeiro e o segundo elemento da lista \texttt{my\_l}, usaríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set new list}
\NormalTok{my\_new\_l }\OtherTok{\textless{}{-}}\NormalTok{ my\_l[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)]}

\CommentTok{\# check contents}
\FunctionTok{print}\NormalTok{(my\_new\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "a"
R> 
R> [[2]]
R> [1] 1 2 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(my\_new\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "list"
\end{verbatim}

No caso de listas com elementos nomeados, os mesmos podem ser acessados por seu nome através do uso do símbolo \texttt{\$} tal como em \texttt{my\_named\_l\$df\_prices} ou \texttt{{[}{[}\textquotesingle{}nome\textquotesingle{}{]}{]}}, tal como em \texttt{my\_named\_l{[}{[}\textquotesingle{}df\_prices\textquotesingle{}{]}{]}}. Em geral, essa é uma forma mais eficiente e recomendada de interagir com os elementos de uma lista. Como regra geral no uso do R, sempre dê preferência ao acesso de elementos através de seus nomes, seja em listas, vetores ou \texttt{dataframes}. Isso evita erros, pois, ao modificar os dados e adicionar algum outro objeto na lista, é possível que o ordenamento interno mude e, portanto, a posição de determinado objeto pode acabar sendo modificada.

\begin{rmdimportant}
Saiba que a ferramenta de \emph{autocomplete} do RStudio também funciona
para listas. Para usar, digite o nome da lista seguido de \texttt{\$} e
aperte \emph{tab}. Uma caixa de diálogo com todos os elementos
disponíveis na lista irá aparecer. A partir disso, basta selecionar
apertando \emph{enter}.
\end{rmdimportant}

Veja os exemplos a seguir, onde são apresentadas as diferentes formas de se acessar uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# different ways to access a list}
\NormalTok{my\_named\_l}\SpecialCharTok{$}\NormalTok{ticker}
\NormalTok{my\_named\_l}\SpecialCharTok{$}\NormalTok{price}
\NormalTok{my\_named\_l[[}\StringTok{\textquotesingle{}ticker\textquotesingle{}}\NormalTok{]]}
\NormalTok{my\_named\_l[[}\StringTok{\textquotesingle{}price\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

Vale salientar que também é possível acessar diretamente os elementos de um vetor que esteja dentro de uma lista através de colchetes encadeados. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# accessing elements of a vector in a list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
             \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{))}

\FunctionTok{print}\NormalTok{(my\_l[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_l[[}\DecValTok{2}\NormalTok{]][}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a"
\end{verbatim}

Tal operação é bastante útil quando interessa apenas um elemento dentro de um objeto maior criado por alguma função.

\hypertarget{adicionando-e-removendo-elementos-de-uma-lista}{%
\subsection{Adicionando e Removendo Elementos de uma Lista}\label{adicionando-e-removendo-elementos-de-uma-lista}}

A remoção, adição e substituição de elementos de uma lista também são procedimentos fáceis. Para adicionar ou substituir, basta definir um novo objeto na posição desejada da lista:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ : chr "a"
R>  $ : num 1
R>  $ : num 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add new elements to list}
\NormalTok{my\_l[[}\DecValTok{4}\NormalTok{]] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{my\_l[[}\DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 4
R>  $ : chr "a"
R>  $ : chr "b"
R>  $ : num 3
R>  $ : int [1:5] 1 2 3 4 5
\end{verbatim}

A operação também é possível com o uso de nomes e operador \texttt{\$}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{elem1 =} \StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\AttributeTok{name1=}\DecValTok{5}\NormalTok{)}

\CommentTok{\# set new element}
\NormalTok{my\_l}\SpecialCharTok{$}\NormalTok{name2 }\OtherTok{\textless{}{-}} \DecValTok{10}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ elem1: chr "a"
R>  $ name1: num 5
R>  $ name2: num 10
\end{verbatim}

Para remover elementos de uma lista, basta definir o elemento para o símbolo reservado \texttt{NULL} (nulo):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{text =} \StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\AttributeTok{num1 =} \DecValTok{2}\NormalTok{, }\AttributeTok{num2 =} \DecValTok{4}\NormalTok{)}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ text: chr "b"
R>  $ num1: num 2
R>  $ num2: num 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# remove elements}
\NormalTok{my\_l[[}\DecValTok{3}\NormalTok{]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 2
R>  $ text: chr "b"
R>  $ num1: num 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_l}\SpecialCharTok{$}\NormalTok{num1 }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 1
R>  $ text: chr "b"
\end{verbatim}

Outra maneira de retirar elementos de uma lista é utilizando um índice negativo para os elementos indesejados. Observe a seguir, onde eliminamos o segundo elemento de uma lista:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \StringTok{\textquotesingle{}texto\textquotesingle{}}\NormalTok{)}

\CommentTok{\# remove second element}
\FunctionTok{glimpse}\NormalTok{(my\_l[[}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  num 1
\end{verbatim}

Assim como no caso de vetores atômicos, essa remoção também pode ser realizada por condições lógicas. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}

\CommentTok{\# remove elements by condition}
\NormalTok{my\_l[my\_l }\SpecialCharTok{\textgreater{}} \DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\FunctionTok{glimpse}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 2
R>  $ : num 1
R>  $ : num 2
\end{verbatim}

Porém, note que esse atalho só funciona porque todos os elementos de \texttt{my\_l} são numéricos.

\hypertarget{processando-os-elementos-de-uma-lista}{%
\subsection{Processando os Elementos de uma Lista}\label{processando-os-elementos-de-uma-lista}}

Um ponto importante a ser destacado a respeito de listas é que os seus elementos podem ser processados e manipulados individualmente através de funções específicas. Este é um tópico particular de programação com o R, mas que vale a apresentação aqui.

Por exemplo, imagine uma lista com vetores numéricos de diferentes tamanhos, tal como a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set list}
\NormalTok{my\_l\_num }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
                 \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{50}\NormalTok{),}
                 \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Caso quiséssemos calcular a média de cada elemento de \texttt{my\_l\_num} e apresentar o resultado na tela como um vetor, poderíamos fazer isso através de um procedimento simples, processando cada elemento individualmente:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# calculate mean of vectors}
\NormalTok{mean\_1 }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_l\_num[[}\DecValTok{1}\NormalTok{]])}
\NormalTok{mean\_2 }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_l\_num[[}\DecValTok{2}\NormalTok{]])}
\NormalTok{mean\_3 }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_l\_num[[}\DecValTok{3}\NormalTok{]])}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(}\FunctionTok{c}\NormalTok{(mean\_1, mean\_2, mean\_3))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2.0 25.5  0.0
\end{verbatim}

O código anterior funciona, porém não é recomendado devido sua falta de escabilidade. Isto é, caso aumentássemos o volume de dados ou objetos, o código não funcionaria corretamente. Se, por exemplo, tivéssemos um quarto elemento em \texttt{my\_l\_num} e quiséssemos manter essa estrutura do código, teríamos que adicionar uma nova linha \texttt{mean\_4\ \textless{}-\ mean(my\_l\_num{[}{[}4{]}{]})} e modificar o comando de saída na tela para \texttt{print(c(mean\_1,\ mean\_2,\ mean\_3,\ mean\_4))}.

Uma maneira mais fácil, elegante e inteligente seria utilizar a função \texttt{sapply}. Nela, basta indicar o nome do objeto de tipo lista e a função que queremos utilizar para processar cada elemento. Internamente, os cálculos são realizados automaticamente. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# using sapply}
\NormalTok{my\_mean }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(my\_l\_num, mean)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2.0 25.5  0.0
\end{verbatim}

O uso da função \texttt{sapply} é preferível por ser mais compacto e eficiente do que a alternativa -- a criação de \texttt{mean\_1}, \texttt{mean\_2} e \texttt{mean\_3}. Note que o primeiro código, com médias individuais, só funciona para uma lista com três elementos. A função \texttt{sapply}, ao contrário, funcionaria da mesma forma em listas de qualquer tamanho. Caso tivéssemos mais elementos, nenhuma modificação seria necessária no código anterior, o que o torna extensível a chegada de novos dados.

Essa visão e implementação de código voltado a procedimentos genéricos é um dos lemas para tornar o uso do R mais eficiente. \textbf{A regra é simples: sempre escreva códigos que sejam adaptáveis a chegada de novos dados}. Em inglês, isso é chamado de regra \emph{DRY} (\emph{don't repeat yourself}). Caso você esteja repetindo códigos e abusando do \emph{control + c/control + v}, como no exemplo anterior, certamente existe uma solução mais elegante e flexível que poderia ser utilizada. No R, existem diversas outras funções da família \texttt{apply} para esse objetivo. Essas funções serão explicadas com maiores detalhes no capítulo \ref{programacao}.

\hypertarget{outras-funuxe7uxf5es-uxfateis-1}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-1}}

\textbf{unlist} - Retorna os elementos de uma lista em um único vetor atômico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_named\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{ticker =} \StringTok{\textquotesingle{}XXXX4\textquotesingle{}}\NormalTok{,}
                   \AttributeTok{price =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{1.5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
                   \AttributeTok{market =} \StringTok{\textquotesingle{}Bovespa\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_unlisted }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(my\_named\_l)}
\FunctionTok{print}\NormalTok{(my\_unlisted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>    ticker    price1    price2    price3    price4    market 
R>   "XXXX4"       "1"     "1.5"       "2"       "3" "Bovespa"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(my\_unlisted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\textbf{as.list} - Converte um objeto para uma lista, tornando cada elemento um elemento da lista.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{13}
\NormalTok{my\_x\_as\_list }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(my\_x\_as\_list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] 10
R> 
R> [[2]]
R> [1] 11
R> 
R> [[3]]
R> [1] 12
R> 
R> [[4]]
R> [1] 13
\end{verbatim}

\textbf{names} - Retorna ou define os nomes dos elementos de uma lista. Assim como para o caso de nomear elementos de um vetor atômico, usa-se a função \texttt{names} alocada ao lado esquerdo do símbolo \texttt{\textless{}-}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{value1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{value2 =} \DecValTok{2}\NormalTok{, }\AttributeTok{value3 =} \DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{names}\NormalTok{(my\_l))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "value1" "value2" "value3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\FunctionTok{names}\NormalTok{(my\_l) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}num1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}num2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}num3\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $num1
R> [1] 1
R> 
R> $num2
R> [1] 2
R> 
R> $num3
R> [1] 3
\end{verbatim}

\hypertarget{matrizes}{%
\section{Matrizes}\label{matrizes}}

Como você deve lembrar das aulas de matemática, uma matriz é uma representação bidimensional de diversos valores, arranjados em linhas e colunas. O uso de matrizes é uma poderosa maneira de representar dados numéricos em duas dimensões e, em certos casos, funções matriciais podem simplificar operações matemáticas complexas.

No R, matrizes são objetos com duas dimensões, onde todos os elementos devem ser da mesma classe. Além disso, as linhas e colunas também podem ter nomes. Assim como para listas e \texttt{dataframes}, isso facilita a interpretação e contextualização dos dados.

Um claro exemplo do uso de matrizes em Finanças seria a representação dos preços de diferentes ações ao longo do tempo. Nesse caso, teríamos as linhas representando as diferentes datas e as colunas representando cada ativo, tal como a seguir:

\begin{longtable}[]{@{}llll@{}}
\toprule()
Data & ABEV3 & BBAS3 & BBDC3 \\
\midrule()
\endhead
2010-01-01 & 736.67 & 59.4 & 29.81 \\
2010-01-04 & 764.14 & 59.8 & 30.82 \\
2010-01-05 & 768.63 & 59.2 & 30.38 \\
2010-01-06 & 776.47 & 59.28 & 30.20 \\
\bottomrule()
\end{longtable}

A matriz anterior poderia ser criada da seguinte forma no R:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create matrix}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{736.67}\NormalTok{, }\FloatTok{764.14}\NormalTok{, }\FloatTok{768.63}\NormalTok{, }\FloatTok{776.47}\NormalTok{,}
          \FloatTok{59.4}\NormalTok{, }\FloatTok{59.8}\NormalTok{, }\FloatTok{59.2}\NormalTok{, }\FloatTok{59.28}\NormalTok{,}
          \FloatTok{29.81}\NormalTok{, }\FloatTok{30.82}\NormalTok{, }\FloatTok{30.38}\NormalTok{, }\FloatTok{30.20}\NormalTok{)}

\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(data, }\AttributeTok{nrow =} \DecValTok{4}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}

\CommentTok{\# set names of cols and rows}
\FunctionTok{colnames}\NormalTok{(my\_mat) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABEV3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}BBAS3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}BBDC3\textquotesingle{}}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(my\_mat) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}2010{-}01{-}01\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}04\textquotesingle{}}\NormalTok{,}
                      \StringTok{\textquotesingle{}2010{-}01{-}05\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2010{-}01{-}06\textquotesingle{}}\NormalTok{)}

\FunctionTok{print}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>             ABEV3 BBAS3 BBDC3
R> 2010-01-01 736.67 59.40 29.81
R> 2010-01-04 764.14 59.80 30.82
R> 2010-01-05 768.63 59.20 30.38
R> 2010-01-06 776.47 59.28 30.20
\end{verbatim}

Observe que, na construção da matriz, definimos o número de linhas e colunas explicitamente com os argumentos \texttt{nrow\ =\ 4} e \texttt{ncol\ =\ 3}. Já os nomes das linhas e colunas são definidos pelos comandos \texttt{colnames} e \texttt{rownames}. Destaca-se, novamente, que a forma de utilizá-los é bastante distinta das demais funções do R. Nesse caso, utilizamos a função ao lado esquerdo do símbolo de \texttt{assign} (\texttt{\textless{}-}). Poderíamos, porém, recuperar os nomes das linhas e colunas com as mesmas funções. Veja a seguir: \index{base!colnames} \index{base!rownames}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABEV3" "BBAS3" "BBDC3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rownames}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2010-01-01" "2010-01-04" "2010-01-05" "2010-01-06"
\end{verbatim}

No momento em que temos essa nossa matriz criada, podemos utilizar todas as suas propriedades numéricas. Um exemplo simples é o cálculo do valor de um portfólio de investimento ao longo do tempo. Caso um investidor tenha 200 ações da ABEV3, 300 da BBAS3 e 100 da BBDC3, o valor do seu portfólio ao longo do tempo poderá ser calculado assim:

\[V _t = \sum _{i=1} ^{3} N _i P_{i,t}\]

Onde \emph{Ni} é o número de ações compradas para ativo \emph{i} e \emph{Pit} é o preço da ação \emph{i} na data \emph{t}. Essa é uma operação bastante simples de ser efetuada com uma multiplicação matricial. Traduzindo o procedimento para o R, temos:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my.w }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{300}\NormalTok{, }\DecValTok{100}\NormalTok{), }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{)}
\NormalTok{my\_port }\OtherTok{\textless{}{-}}\NormalTok{ my\_mat }\SpecialCharTok{\%*\%}\NormalTok{ my.w}
\FunctionTok{print}\NormalTok{(my\_port)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>              [,1]
R> 2010-01-01 168135
R> 2010-01-04 173850
R> 2010-01-05 174524
R> 2010-01-06 176098
\end{verbatim}

Nesse último exemplo, utilizamos o símbolo \texttt{\%*\%}, o qual permite a multiplicação matricial entre os objetos. O objeto \texttt{my\_port} indica o valor desse portfólio ao longo das datas, resultando em um leve lucro para o investidor.

Um ponto importante a ressaltar é que uma matriz no R não precisa necessariamente ser composta por valores. É possível, também, criar matrizes de caracteres (texto). Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat\_char }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{), }\DecValTok{3}\NormalTok{) ,}
                      \AttributeTok{nrow =} \DecValTok{3}\NormalTok{,}
                      \AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,] "a"  "a"  "a" 
R> [2,] "b"  "b"  "b" 
R> [3,] "c"  "c"  "c"
\end{verbatim}

Essa flexibilidade dos objetos matriciais possibilita a fácil representação e visualização de seus dados em casos específicos.

\hypertarget{selecionando-valores-de-uma-matriz}{%
\subsection{Selecionando Valores de uma Matriz}\label{selecionando-valores-de-uma-matriz}}

Tal como no caso dos vetores atômicos, também é possível selecionar pedaços de uma matriz através de indexação. Uma diferença aqui é que os objetos de matrizes possuem duas dimensões, enquanto vetores possuem apenas uma.\footnote{Para evitar confusão, vale salientar que, no R, vetores atômicos não possuem dimensão no sentido estrito da função. Ao usar a função \texttt{dim} em um vetor atômico, tal como em \texttt{dim(c(1,2,4))}, o resultado é nulo (\texttt{NULL}). Fora do ambiente computacional, porém, vetores atômicos podem ser entendidos como unidimensionais pois se expandem em apenas um sentido.} Essa dimensão extra requer a indexação não apenas de linhas mas também de colunas. Os elementos de uma matriz podem ser acessados pela notação \texttt{{[}i,j{]}}, onde \emph{i} representa a linha e \emph{j} a coluna. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4
\end{verbatim}

Para selecionar colunas ou linhas inteiras, basta deixar o índice vazio, tal como no exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_mat[ , }\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 5 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_mat[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 4 7
\end{verbatim}

Observe que a indexação retorna um vetor atômico da classe dos dados. Caso quiséssemos que o pedaço da matriz mantivesse a sua classe e orientação vertical ou horizontal, poderíamos forçar essa conversão pelo uso de \texttt{matrix}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{as.matrix}\NormalTok{(my\_mat[ ,}\DecValTok{2}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]
R> [1,]    4
R> [2,]    5
R> [3,]    6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(my\_mat[}\DecValTok{1}\NormalTok{, ], }\AttributeTok{nrow=}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
\end{verbatim}

Pedaços da matriz também podem ser selecionados via indexadores. Caso quiséssemos uma matriz formada a partir da seleção dos elementos da segunda linha e primeira coluna até a terceira linha e segunda coluna, usaríamos o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_mat[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]    2    5
R> [2,]    3    6
\end{verbatim}

Por fim, o uso de testes lógicos para selecionar valores de matrizes também é possível. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat }\SpecialCharTok{\textgreater{}}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>       [,1]  [,2] [,3]
R> [1,] FALSE FALSE TRUE
R> [2,] FALSE FALSE TRUE
R> [3,] FALSE  TRUE TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_mat[my\_mat }\SpecialCharTok{\textgreater{}}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6 7 8 9
\end{verbatim}

\hypertarget{outras-funuxe7uxf5es-uxfateis-2}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-2}}

\textbf{as.matrix} - Transforma dados para a classe \texttt{matrix}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]
R> [1,]    1
R> [2,]    2
R> [3,]    3
R> [4,]    4
R> [5,]    5
\end{verbatim}

\textbf{t} - Retorna a transposta da matriz.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{20}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{6}\NormalTok{), }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]   10   16
R> [2,]   12   18
R> [3,]   14   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{t}\NormalTok{(my\_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]   10   12   14
R> [2,]   16   18   20
\end{verbatim}

\textbf{rbind} - Retorna a junção (cola) vertical de matrizes, orientando-se pelas linhas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat\_1 }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    2    3    4    5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat\_2 }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{14}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]   10   11   12   13   14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my.rbind.mat }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(my\_mat\_1, my\_mat\_2)}
\FunctionTok{print}\NormalTok{(my.rbind.mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    2    3    4    5
R> [2,]   10   11   12   13   14
\end{verbatim}

\textbf{cbind} - Retorna a junção (cola) horizontal de matrizes, orientando-se pelas colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat\_1 }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]    1    3
R> [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mat\_2 }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{13}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_mat\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]   10   12
R> [2,]   11   13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_cbind\_mat }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(my\_mat\_1, my\_mat\_2)}
\FunctionTok{print}\NormalTok{(my\_cbind\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4]
R> [1,]    1    3   10   12
R> [2,]    2    4   11   13
\end{verbatim}

\hypertarget{exerc-classe-estrutura}{%
\section{Exercícios}\label{exerc-classe-estrutura}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

\hypertarget{classes-basicas}{%
\chapter{As Classes Básicas de Objetos}\label{classes-basicas}}

\textbf{As classes básicas são os elementos mais primários na representação de dados no R}. Nos capítulos anteriores utilizamos as classes básicas como colunas em uma tabela. Dados numéricos viraram uma coluna do tipo \texttt{numeric}, enquanto dados de texto viraram um objeto do tipo \texttt{character}.

Neste capítulo iremos estudar mais a fundo as classes básicas de objetos do R, incluindo a sua criação até a manipulação do seu conteúdo. Este capítulo é de suma importância pois mostrará quais operações são possíveis com cada classe de objeto e como podes manipular as informações de forma eficiente. Os tipos de objetos tratados aqui serão:

\begin{itemize}
\tightlist
\item
  Numéricos (\texttt{numeric})
\item
  Texto (\texttt{character})
\item
  Fatores (\texttt{factor})
\item
  Valores lógicos (\texttt{logical})
\item
  Datas e tempo (\texttt{Date} e \texttt{timedate})
\item
  Dados Omissos (\texttt{NA})
\end{itemize}

\hypertarget{objetos-numuxe9ricos}{%
\section{Objetos Numéricos}\label{objetos-numuxe9ricos}}

Uma das classes mais utilizadas em pesquisa empírica. Os valores numéricos são representações de uma quantidade. Por exemplo: o preço de uma ação em determinada data, o volume negociado de um contrato financeiro em determinado dia, a inflação anual de um país, entre várias outras possibilidades.

\hypertarget{criando-e-manipulando-vetores-numuxe9ricos}{%
\subsection{Criando e Manipulando Vetores Numéricos}\label{criando-e-manipulando-vetores-numuxe9ricos}}

A criação e manipulação de valores numéricos é fácil e direta. Os símbolos de operações matemáticas seguem o esperado, tal como soma (\texttt{+}), diminuição (\texttt{-}), divisão (\texttt{/}) e multiplicação (\texttt{*}). Todas as operações matemáticas são efetuadas com a orientação de elemento para elemento e possuem notação vetorial. Isso significa, por exemplo, que podemos manipular vetores inteiros em uma única linha de comando. Veja a seguir, onde se cria dois vetores e realiza-se diversas operações entre eles.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create numeric vectors}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{2}\SpecialCharTok{:}\DecValTok{6}

\CommentTok{\# print sum}
\FunctionTok{print}\NormalTok{(x}\SpecialCharTok{+}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  3  5  7  9 11
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print multiplication}
\FunctionTok{print}\NormalTok{(x}\SpecialCharTok{*}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2  6 12 20 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print division}
\FunctionTok{print}\NormalTok{(x}\SpecialCharTok{/}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.5000000 0.6666667 0.7500000 0.8000000 0.8333333
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print exponentiation}
\FunctionTok{print}\NormalTok{(x}\SpecialCharTok{\^{}}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]     1     8    81  1024 15625
\end{verbatim}

Um diferencial do R em relação a outras linguagens é que, nele, são aceitas operações entre vetores diferentes. Por exemplo, podemos somar um vetor numérico de quatro elementos com outro de apenas dois. Nesse caso, aplica-se a chamada \textbf{regra de reciclagem} (\emph{recycling rule}). Ela define que, se dois vetores de tamanho diferente estão interagindo, o vetor menor é repetido tantas vezes quantas forem necessárias para obter-se o mesmo número de elementos do vetor maior. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x with 4 elements and y with 2}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{2}\SpecialCharTok{:}\DecValTok{1}

\CommentTok{\# print sum}
\FunctionTok{print}\NormalTok{(x }\SpecialCharTok{+}\NormalTok{ y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3 3 5 5
\end{verbatim}

O resultado de \texttt{x\ +\ y} é equivalente a \texttt{1:4\ +\ c(2,\ 1,\ 2,\ 1)}. Caso interagirmos vetores em que o tamanho do maior não é múltiplo do menor, o R realiza o mesmo procedimento de reciclagem, porém emite uma mensagem de \texttt{warning}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set x = 4 elements and y with 3}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{\# print sum (recycling rule)}
\FunctionTok{print}\NormalTok{(x }\SpecialCharTok{+}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Warning in x + y: longer object length is not a multiple of
R> shorter object length
\end{verbatim}

\begin{verbatim}
R> [1] 2 4 6 5
\end{verbatim}

Os três primeiros elementos de \texttt{x} foram somados aos três primeiros elementos de \texttt{y}. O quarto elemento de \texttt{x} foi somado ao primeiro elemento de \texttt{y}. Uma vez que não havia um quarto elemento em \texttt{y}, o ciclo reinicia, resgatando o primeiro elemento de \texttt{y} e resultando em uma soma igual a 5.

Os elementos de um vetor numérico também podem ser nomeados quando na criação do vetor:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create named vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{item1 =} \DecValTok{10}\NormalTok{,}
       \AttributeTok{item2 =} \DecValTok{14}\NormalTok{,}
       \AttributeTok{item3 =} \DecValTok{9}\NormalTok{,}
       \AttributeTok{item4 =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item1 item2 item3 item4 
R>    10    14     9     2
\end{verbatim}

Para nomear os elementos após a criação, podemos utilizar a função \texttt{names}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create unnamed vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\CommentTok{\# set names of elements}
\FunctionTok{names}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}item1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}item2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}item3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}item4\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item1 item2 item3 item4 
R>    10    14     9     2
\end{verbatim}

Vetores numéricos vazios também podem ser criados. Em algumas situações de desenvolvimento de código faz sentido pré-alocar o vetor antes de preenchê-lo com valores. Nesse caso, utilize a função \texttt{numeric}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create empty numeric vector of length 10}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(}\AttributeTok{length =} \DecValTok{10}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 0 0 0 0 0 0 0 0 0 0
\end{verbatim}

Observe que, nesse caso, os valores de \texttt{my\_x} são definidos como zero.

\hypertarget{criando-sequuxeancias-de-valores}{%
\subsubsection{Criando Sequências de Valores}\label{criando-sequuxeancias-de-valores}}

Existem duas maneiras de criar uma sequência de valores no R. A primeira, que já foi utilizada nos exemplos anteriores, é o uso do operador \texttt{:}. Por exemplo, \texttt{my\_seq\ \textless{}-\ 1:10} ou \texttt{my\_seq\ \textless{}-\ -5:5}. Esse método é bastante prático, pois a notação é clara e direta.

Porém, o uso do operador \texttt{:} limita as possibilidades. A diferença entre os valores adjacentes é sempre \emph{1} para sequências ascendentes e \emph{-1} para sequências descendentes. Uma versão mais poderosa para a criação de sequências é o uso da função \texttt{seq}. Com ela, é possível definir os intervalos entre cada valor com o argumento \texttt{by}. Veja a seguir: \index{base!seq}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set sequence}
\NormalTok{my\_seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \SpecialCharTok{{-}}\DecValTok{10}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_seq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10
\end{verbatim}

Outro atributo interessante da função \texttt{seq} é a possibilidade de criar vetores com um valor inicial, um valor final e o número de elementos desejado. Isso é realizado com o uso da opção \texttt{length.out}. Observe o código a seguir, onde cria-se um vetor de \emph{0} até \emph{10} com \emph{20} elementos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set sequence with fixed size}
\NormalTok{my\_seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{0}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{20}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_seq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0.0000000  0.5263158  1.0526316  1.5789474  2.1052632
R>  [6]  2.6315789  3.1578947  3.6842105  4.2105263  4.7368421
R> [11]  5.2631579  5.7894737  6.3157895  6.8421053  7.3684211
R> [16]  7.8947368  8.4210526  8.9473684  9.4736842 10.0000000
\end{verbatim}

No caso anterior, o tamanho final do vetor foi definido e a própria função se encarregou de descobrir qual a variação necessária entre cada valor de \texttt{my\_seq}.

\hypertarget{criando-vetores-com-elementos-repetidos}{%
\subsubsection{Criando Vetores com Elementos Repetidos}\label{criando-vetores-com-elementos-repetidos}}

Outra função interessante é a que cria vetores com o uso de repetição. Por exemplo: imagine que estamos interessado em um vetor preenchido com o valor 1 dez vezes. Para isso, basta utilizar a função \texttt{rep}: \index{base!rep}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# repeat vector three times}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{times =} \DecValTok{10}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 1 1 1 1 1 1 1 1 1 1
\end{verbatim}

A função também funciona com vetores. Considere uma situação onde temos um vetor com os valores \texttt{c(1,2)} e gostaríamos de criar um vetor maior com os elementos \texttt{c(1,\ 2,\ 1,\ 2,\ 1,\ 2)} - isto é, repetindo o vetor menor três vezes. Veja o resultado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# repeat vector three times}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{times =} \DecValTok{3}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 1 2 1 2
\end{verbatim}

\hypertarget{criando-vetores-com-nuxfameros-aleatuxf3rios}{%
\subsubsection{Criando Vetores com Números Aleatórios}\label{criando-vetores-com-nuxfameros-aleatuxf3rios}}

Em muitas situações será necessário a criação de números aleatórios. Esse procedimento numérico é bastante utilizado para simular modelos matemáticos em Finanças. Por exemplo, o método de simulação de preços de ativos de Monte Carlo parte da simulação de números aleatórios \citep{mcleish2011monte}. No R, existem diversas funções que criam números aleatórios para diferentes distribuições estatísticas. As mais utilizadas, porém, são as funções \texttt{rnorm} e \texttt{runif}. \index{base!rnorn} \index{base!runif}

A função \texttt{rnorm} gera números aleatórios da distribuição Normal, com opções para a média (tendência) e o desvio padrão (variabilidade). Veja o seu uso a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# generate 10000 random numbers from a Normal distribution}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n =} \DecValTok{10000}\NormalTok{,}
                    \AttributeTok{mean =} \DecValTok{0}\NormalTok{,}
                    \AttributeTok{sd =} \DecValTok{1}\NormalTok{)}

\CommentTok{\# print first 20 elements}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  1.1194299  1.0155929 -1.2027493  0.5309199 -1.0571733
R>  [6] -1.1854921 -0.4107645  1.5315372 -1.9588221  1.0565205
R> [11] -0.6458420 -1.2922453  1.0599906 -1.4601082  1.5176087
R> [16]  0.1781568  0.3274256  1.4443136  1.4512198  0.2217988
\end{verbatim}

O código anterior gera uma grande quantidade de números aleatórios de uma distribuição Normal com média zero e desvio padrão igual a um. Podemos verificar a distribuição dos números gerados com um histograma:

\begin{center}\includegraphics{adfeR_pt_ed03-ONLINE_files/figure-latex/unnamed-chunk-306-1} \end{center}

Como esperado, temos o formato de sino que caracteriza uma distribuição do tipo Normal. Como exercício, podes trocar as entradas \texttt{mean} e \texttt{sd} e confirmar como isso afeta a figura gerada.

Já a função \texttt{runif} gera valores aleatórios da distribuição uniforme entre um valor máximo e um valor mínimo. Ela é geralmente utilizada para simular probabilidades. A função \texttt{runif} tem três parâmetros de entrada: o número de valores aleatórios desejado, o valor mínimo e o valor máximo. Veja exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a random vector with minimum and maximum}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{,}
                    \AttributeTok{min =} \SpecialCharTok{{-}}\DecValTok{5}\NormalTok{,}
                    \AttributeTok{max =} \DecValTok{5}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] -1.203942 -2.608231 -2.733635  4.457898 -1.748036
R>  [6] -4.378253  4.576698  2.310536 -2.136151  3.209011
\end{verbatim}

Observe que ambas as funções anteriores são limitadas à sua respectiva distribuição. Uma maneira alternativa e flexível de gerar valores aleatórios é utilizar a função \texttt{sample}. Essa tem como entrada um vetor qualquer e retorna uma versão embaralhada de seus elementos. A sua flexibilidade reside no fato de que o vetor de entrada pode ser qualquer coisa. Por exemplo, caso quiséssemos criar um vetor aleatório com os números \texttt{c(0,\ 5,\ 15,\ 20,\ 25)} apenas, poderíamos fazê-lo da seguinte forma: \index{base!sample}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create sequence}
\NormalTok{my\_vec }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{0}\NormalTok{, }\AttributeTok{to =} \DecValTok{25}\NormalTok{, }\AttributeTok{by=}\DecValTok{5}\NormalTok{)}

\CommentTok{\# sample sequence}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(my\_vec)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 15  0 20 25  5 10
\end{verbatim}

A função \texttt{sample} também permite a seleção aleatória de um certo número de termos. Por exemplo, caso quiséssemos selecionar aleatoriamente apenas um elemento de \texttt{my\_vec}, escreveríamos o código da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sample one element of my\_vec}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(my\_vec, }\AttributeTok{size =} \DecValTok{1}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5
\end{verbatim}

Caso quiséssemos dois elementos, escreveríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sample two elements of my\_vec}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(my\_vec, }\AttributeTok{size =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 25  0
\end{verbatim}

Também é possível selecionar valores de uma amostra menor para a criação de um vetor maior. Por exemplo, considere o caso em que se tem um vetor com os números \texttt{c(10,\ 15,\ 20)} e deseja-se criar um vetor aleatório com dez elementos retirados desse vetor menor, com repetição. Para isso, podemos utilizar a opção \texttt{replace\ =\ TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create vector}
\NormalTok{my\_vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)}

\CommentTok{\# sample}
\NormalTok{my\_rnd\_vec }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_vec, }\AttributeTok{size =} \DecValTok{10}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 15 10 10  5  5 10  5  5 15 10
\end{verbatim}

Vale destacar que a função \texttt{sample} funciona para qualquer tipo ou objeto, não sendo, portanto, exclusiva para vetores numéricos. Poderíamos, também, escolher elementos aleatórios de um vetor de texto ou então uma lista:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# example of sample with characters}
\FunctionTok{print}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}elem 1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}elem 2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}elem 3\textquotesingle{}}\NormalTok{),}
             \AttributeTok{size =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "elem 3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# example of sample with list}
\FunctionTok{print}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}
                  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{)),}
             \AttributeTok{size =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $x
R> [1] 1 1 1
\end{verbatim}

É importante ressaltar que a geração de valores aleatórios no R (ou qualquer outro programa) \textbf{não é totalmente aleatória!} De fato, o próprio computador escolhe os valores dentre uma fila de valores possíveis. Cada vez que funções tal como \texttt{rnorm}, \texttt{runif} e \texttt{sample} são utilizadas, o computador escolhe um lugar diferente dessa fila de acordo com vários parâmetros, incluindo a data e horário atual. Portanto, do ponto de vista do usuário, os valores são gerados de forma imprevisível. Para o computador, porém, essa seleção é completamente determinística e guiada por regras claras.

Uma propriedade interessante no R é a possibilidade de selecionar uma posição específica na fila de valores aleatórios utilizando função \texttt{set.seed}. É ela que \textbf{fixa a semente} para gerar os valores. Na prática, o resultado é que todos os números e seleções aleatórias realizadas pelo código serão iguais em cada execução. O uso de \texttt{set.seed} é bastante recomendado para manter a reprodutibilidade dos códigos envolvendo aleatoriedade. Veja o exemplo a seguir, onde utiliza-se essa função. \index{base!set.seed}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fix seed}
\FunctionTok{set.seed}\NormalTok{(}\AttributeTok{seed =} \DecValTok{10}\NormalTok{)}

\CommentTok{\# set vec and print}
\NormalTok{my\_rnd\_vec\_1 }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec\_1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.50747820 0.30676851 0.42690767 0.69310208 0.08513597
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vec and print}
\NormalTok{my\_rnd\_vec\_2 }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_rnd\_vec\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.2254366 0.2745305 0.2723051 0.6158293 0.4296715
\end{verbatim}

No código anterior, o valor de \texttt{set.seed} é um inteiro escolhido pelo usuário. Após a chamada de \texttt{set.seed}, todas as seleções e números aleatórios irão iniciar do mesmo ponto e, portanto, serão iguais. Motivo o leitor a executar o código anterior no R. Verás que os valores de \texttt{my\_rnd\_vec\_1} e \texttt{my\_rnd\_vec\_2} serão exatamente iguais aos valores colocados aqui.

O uso de \texttt{set.seed} também funciona para o caso de \texttt{sample}. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fix seed}
\FunctionTok{set.seed}\NormalTok{(}\AttributeTok{seed =} \DecValTok{15}\NormalTok{)}

\CommentTok{\# print vectors}
\FunctionTok{print}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  5  2  1  6  8 10  3  7  9  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 13 15 10 17 20 14 19 12 11 18 16
\end{verbatim}

Novamente, execute os comandos anteriores no R e verás que o resultado na tela bate com o apresentado aqui.

\hypertarget{acessando-elementos-de-um-vetor-numuxe9rico}{%
\subsection{Acessando Elementos de um Vetor Numérico}\label{acessando-elementos-de-um-vetor-numuxe9rico}}

Todos os elementos de um vetor numérico podem ser acessados através do uso de colchetes (\texttt{{[}\ {]}}). Por exemplo, caso quiséssemos apenas o primeiro elemento de \texttt{x}, teríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\CommentTok{\# get first element}
\NormalTok{first\_elem\_x }\OtherTok{\textless{}{-}}\NormalTok{ x[}\DecValTok{1}\NormalTok{]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(first\_elem\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -1
\end{verbatim}

A mesma notação é válida para extrair porções de um vetor. Caso quiséssemos um subvetor de \texttt{x} com o primeiro e o segundo elemento, faríamos essa operação da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sub{-}vector of x}
\NormalTok{sub\_x }\OtherTok{\textless{}{-}}\NormalTok{ x[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(sub\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -1  4
\end{verbatim}

Para acessar elementos nomeados de um vetor numérico, basta utilizar seu nome junto aos colchetes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set named vector}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{item1 =} \DecValTok{10}\NormalTok{, }\AttributeTok{item2 =} \DecValTok{14}\NormalTok{, }\AttributeTok{item3 =} \SpecialCharTok{{-}}\DecValTok{9}\NormalTok{, }\AttributeTok{item4 =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{)}

\CommentTok{\# access elements by name}
\FunctionTok{print}\NormalTok{(x[}\StringTok{\textquotesingle{}item2\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item2 
R>    14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(x[}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}item2\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}item4\textquotesingle{}}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item2 item4 
R>    14    -2
\end{verbatim}

O acesso aos elementos de um vetor numérico também é possível através de testes lógicos. Por exemplo, caso tivéssemos interesse em saber quais os valores de \texttt{x} que são maiores do que \emph{0}, o código resultante seria da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find all values of x higher than zero}
\FunctionTok{print}\NormalTok{(x[x }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item1 item2 
R>    10    14
\end{verbatim}

Os usos de regras de segmentação dos dados de acordo com algum critério é chamado de indexação lógica. Os objetos do tipo \texttt{logical} serão tratados mais profundamente em seção futura deste capítulo.

\hypertarget{modificando-e-removendo-elementos-de-um-vetor-numuxe9rico}{%
\subsection{Modificando e Removendo Elementos de um Vetor Numérico}\label{modificando-e-removendo-elementos-de-um-vetor-numuxe9rico}}

A modificação de um vetor numérico é muito simples. Basta indicar a posição dos elementos e os novos valores com o símbolo de \emph{assign} (\texttt{\textless{}-}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}

\CommentTok{\# modify first element to 5}
\NormalTok{my\_x[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{5}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 2 3 4
\end{verbatim}

Essa modificação também pode ser realizada em bloco:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\DecValTok{5}

\CommentTok{\# set the first three elements to 5}
\NormalTok{my\_x[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{5}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 5 5 3 4 5
\end{verbatim}

O uso de condições para definir elementos é realizada pela indexação:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{5}\SpecialCharTok{:}\DecValTok{5}

\CommentTok{\# set any value lower than 2 to 0}
\NormalTok{my\_x[my\_x}\SpecialCharTok{\textless{}}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 0 0 0 0 0 0 0 2 3 4 5
\end{verbatim}

A remoção de elementos é realizada com o uso de índices negativos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{5}\SpecialCharTok{:}\DecValTok{5}

\CommentTok{\# remove first and second element of my\_x}
\NormalTok{my\_x }\OtherTok{\textless{}{-}}\NormalTok{ my\_x[}\SpecialCharTok{{-}}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{)]}

\CommentTok{\# show result}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -3 -2 -1  0  1  2  3  4  5
\end{verbatim}

Note como o uso do índice negativo em \texttt{my\_x{[}-(1:2){]}} retorna o vetor original sem o primeiro e segundo elemento.

\hypertarget{criando-grupos}{%
\subsection{Criando Grupos}\label{criando-grupos}}

Em algumas situações será necessário entender quantos casos da amostra estão localizados entre um determinado intervalo. Por exemplo, imagine o vetor dos retornos diários de uma ação, isto é, a variação percentual dos preços de fechamento entre um dia e outro. Uma possível análise de risco que pode ser realizada é dividir o intervalo de retornos em cinco partes e verificar o percentual de ocorrência dos valores em cada um dos intervalos. Essa análise numérica é bastante semelhante à construção e visualização de histogramas.

A função \texttt{cut} serve para criar grupos de intervalos a partir de um vetor numérico. Veja o exemplo a seguir, onde cria-se um vetor aleatório oriundo da distribuição Normal e cinco grupos a partir de intervalos definidos pelos dados. \index{base!cut}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set rnd vec}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}

\CommentTok{\# "cut" it into 5 pieces}
\NormalTok{my\_cut }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_x, }\AttributeTok{breaks =} \DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] (-1.57,-1.12]  (0.252,0.71]   (-1.12,-0.66] 
R>  [4] (-0.204,0.252] (-0.66,-0.204] (-1.57,-1.12] 
R>  [7] (0.252,0.71]   (-0.204,0.252] (0.252,0.71]  
R> [10] (-0.204,0.252]
R> 5 Levels: (-1.57,-1.12] (-1.12,-0.66] ... (0.252,0.71]
\end{verbatim}

Observe que os nomes dos elementos da variável \texttt{my\_cut} são definidos pelos intervalos e o resultado é um objeto do tipo fator. Em seções futuras, iremos explicar melhor esse tipo de objeto e as suas propriedades.

No exemplo anterior, os intervalos para cada grupo foram definidos automaticamente. No uso da função \texttt{cut}, também é possível definir quebras customizadas nos dados e nos nomes dos grupos. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set random vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}

\CommentTok{\# create groups with 5 breaks}
\NormalTok{my\_cut }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_x, }\AttributeTok{breaks =} \DecValTok{5}\NormalTok{)}

\CommentTok{\# print it!}
\FunctionTok{print}\NormalTok{(my\_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] (-1.3,-0.3]  (-0.3,0.697] (-0.3,0.697] (-2.3,-1.3] 
R>  [5] (-0.3,0.697] (0.697,1.69] (0.697,1.69] (0.697,1.69]
R>  [9] (-1.3,-0.3]  (1.69,2.7]  
R> 5 Levels: (-2.3,-1.3] (-1.3,-0.3] ... (1.69,2.7]
\end{verbatim}

Note que os nomes dos elementos em \texttt{my\_cut} foram definidos como intervalos e o resultado é um objeto do tipo fator. É possível também definir intervalos e nomes customizados para cada grupo com o uso dos argumentos \texttt{labels} e \texttt{breaks}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create random vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}

\CommentTok{\# define breaks manually}
\NormalTok{my\_breaks }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{min}\NormalTok{(my\_x)}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FunctionTok{max}\NormalTok{(my\_x)}\SpecialCharTok{+}\DecValTok{1}\NormalTok{)}

\CommentTok{\# define labels manually}
\NormalTok{my\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Low\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Normal\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}High\textquotesingle{}}\NormalTok{)}

\CommentTok{\# create group from numerical vector}
\NormalTok{my\_cut }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_x, }\AttributeTok{breaks =}\NormalTok{ my\_breaks, }\AttributeTok{labels =}\NormalTok{ my\_labels)}

\CommentTok{\# print both!}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0.5981759  1.6113647 -0.4373813  1.3526206  0.4705685
R>  [6]  0.4702481  0.3963088 -0.7304926  0.6531176  1.2279598
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] Normal High   Normal High   Normal Normal Normal Normal
R>  [9] Normal High  
R> Levels: Low Normal High
\end{verbatim}

Como podemos ver, os nomes dos grupos estão mais amigáveis para uma futura análise.

\hypertarget{outras-funuxe7uxf5es-uxfateis-3}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-3}}

\textbf{as.numeric} - Converte determinado objeto para numérico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{)}
\FunctionTok{class}\NormalTok{(my\_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(my\_text)}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\textbf{sum} - Soma os elementos de um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{50}
\NormalTok{my\_sum }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(my\_sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1275
\end{verbatim}

\textbf{max} - Retorna o máximo valor numérico do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{max\_x }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(x)}
\FunctionTok{print}\NormalTok{(max\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 14
\end{verbatim}

\textbf{min} - Retorna o mínimo valor numérico do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{min\_x }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(x)}
\FunctionTok{print}\NormalTok{(min\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2
\end{verbatim}

\textbf{which.max} - Retorna a posição do máximo valor numérico do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{141}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{which.max\_x }\OtherTok{\textless{}{-}} \FunctionTok{which.max}\NormalTok{(x)}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}The position of the maximum value of x is \textquotesingle{}}\NormalTok{, which.max\_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The position of the maximum value of x is  2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{\textquotesingle{} and its value is \textquotesingle{}}\NormalTok{, x[which.max\_x])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  and its value is  141
\end{verbatim}

\textbf{which.min} - Retorna a posição do mínimo valor numérico do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{which.min\_x }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(x)}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}The position of the minimum value of x is \textquotesingle{}}\NormalTok{,}
\NormalTok{          which.min\_x, }\StringTok{\textquotesingle{} and its value is \textquotesingle{}}\NormalTok{, x[which.min\_x]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The position of the minimum value of x is  4  and its value is  2
\end{verbatim}

\textbf{sort} - Retorna uma versão ordenada de um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{sort}\NormalTok{(x, }\AttributeTok{decreasing =} \ConstantTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.1623069 0.8347800 0.8553657 0.9099027 0.9935257
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{sort}\NormalTok{(x, }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.9935257 0.9099027 0.8553657 0.8347800 0.1623069
\end{verbatim}

\textbf{cumsum} - Soma os elementos de um vetor de forma cumulativa.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{25}
\NormalTok{my\_cumsum }\OtherTok{\textless{}{-}} \FunctionTok{cumsum}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(my\_cumsum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]   1   3   6  10  15  21  28  36  45  55  66  78  91 105
R> [15] 120 136 153 171 190 210 231 253 276 300 325
\end{verbatim}

\textbf{prod} - Realiza o produto de todos os elementos de um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{my\_prod }\OtherTok{\textless{}{-}} \FunctionTok{prod}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(my\_prod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3628800
\end{verbatim}

\textbf{cumprod} - Calcula o produto cumulativo de todos os elementos de um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{my\_prod }\OtherTok{\textless{}{-}} \FunctionTok{cumprod}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(my\_prod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]       1       2       6      24     120     720    5040
R>  [8]   40320  362880 3628800
\end{verbatim}

\hypertarget{classe-de-caracteres-texto}{%
\section{Classe de Caracteres (texto)}\label{classe-de-caracteres-texto}}

A classe de caracteres, ou texto, serve para armazenar informações textuais. Um exemplo prático em Finanças seria o reconhecimento de uma ação através dos seus símbolos de identificação (\emph{tickers}) ou então por sua classe de ação: ordinária ou preferencial. Este tipo de dado tem sido utilizado cada vez mais em pesquisa empírica \citep{gentzkow2017text}, resultando em uma diversidade de pacotes.

O R possui vários recursos que facilitam a criação e manipulação de objetos de tipo texto. As funções básicas fornecidas com a instalação de R são abrangentes e adequadas para a maioria dos casos. No entanto, pacote \texttt{stringr} \citep{R-stringr} do \texttt{tidyverse} fornece muitas funções que expandem a funcionalidade básica do R na manipulação de texto.

Um aspecto positivo de \texttt{stringr} é que as funções começam com o nome \texttt{str\_} e possuem nomes informativos. Combinando isso com o recurso de preenchimento automático (\emph{autocomplete}) pela tecla \emph{tab}, fica fácil de localizar os nomes das funções do pacote. Seguindo a prioridade ao universo do \texttt{tidyverse}, esta seção irá dar preferência ao uso das funções do pacote \texttt{stringr}. As rotinas nativas de manipulação de texto serão apresentadas, porém de forma limitada. \index{stringr}

\hypertarget{criando-um-objeto-simples-de-caracteres}{%
\subsection{Criando um Objeto Simples de Caracteres}\label{criando-um-objeto-simples-de-caracteres}}

Todo objeto de caracteres é criado através da encapsulação de um texto por aspas duplas (\texttt{"\ "}) ou simples (\texttt{\textquotesingle{}\ \textquotesingle{}}). Para criar um vetor de caracteres com \emph{tickers} de ações, podemos fazê-lo com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_assets }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}PETR3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}VALE4\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}GGBR4\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_assets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "PETR3" "VALE4" "GGBR4"
\end{verbatim}

Confirma-se a classe do objeto com a função \texttt{class}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(my\_assets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\hypertarget{criando-objetos-estruturados-de-texto}{%
\subsection{Criando Objetos Estruturados de Texto}\label{criando-objetos-estruturados-de-texto}}

Em muitos casos no uso do R, estaremos interessados em criar vetores de texto com algum tipo de estrutura própria. Por exemplo, o vetor \texttt{c("text\ 1",\ "text\ 2",\ ...,\ "text\ 20")} possui um lógica de criação clara. Computacionalmente, podemos definir a sua estrutura como sendo a junção do texto \texttt{text} e um vetor de sequência, de 1 até 20.

Para criar um vetor textual capaz de unir texto com número, utilizamos a função \texttt{stringr::str\_c} ou \texttt{base::paste}. Veja o exemplo a seguir, onde replica-se o caso anterior com e sem espaço entre número e texto: \index{stringr!str\_c}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\CommentTok{\# create sequence}
\NormalTok{my\_seq }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{20}

\CommentTok{\# create character}
\NormalTok{my\_text }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}text\textquotesingle{}}

\CommentTok{\# paste objects together (without space)}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(my\_text, my\_seq)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "text1"  "text2"  "text3"  "text4"  "text5"  "text6" 
R>  [7] "text7"  "text8"  "text9"  "text10" "text11" "text12"
R> [13] "text13" "text14" "text15" "text16" "text17" "text18"
R> [19] "text19" "text20"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# paste objects together (with space)}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(my\_text, my\_seq, }\AttributeTok{sep =} \StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "text 1"  "text 2"  "text 3"  "text 4"  "text 5" 
R>  [6] "text 6"  "text 7"  "text 8"  "text 9"  "text 10"
R> [11] "text 11" "text 12" "text 13" "text 14" "text 15"
R> [16] "text 16" "text 17" "text 18" "text 19" "text 20"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# paste objects together (with space)}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(my\_text, my\_seq)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "text 1"  "text 2"  "text 3"  "text 4"  "text 5" 
R>  [6] "text 6"  "text 7"  "text 8"  "text 9"  "text 10"
R> [11] "text 11" "text 12" "text 13" "text 14" "text 15"
R> [16] "text 16" "text 17" "text 18" "text 19" "text 20"
\end{verbatim}

O mesmo procedimento também pode ser realizado com vetores de texto. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set character value}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}My name is\textquotesingle{}}

\CommentTok{\# set character vector}
\NormalTok{my\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Marcelo\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Ricardo\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Tarcizio\textquotesingle{}}\NormalTok{)}

\CommentTok{\# paste and print}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str\_c}\NormalTok{(my\_x, my\_names, }\AttributeTok{sep =} \StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "My name is Marcelo"  "My name is Ricardo" 
R> [3] "My name is Tarcizio"
\end{verbatim}

Outra possibilidade de construção de textos estruturados é a repetição do conteúdo de um objeto do tipo caractere. No caso de texto, utiliza-se a função \texttt{stringr::str\_dup}/\texttt{base::strrep} para esse fim. Observe o exemplo a seguir: \index{stringr!str\_dup}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_dup}\NormalTok{(}\AttributeTok{string =} \StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{, }\AttributeTok{times =} \DecValTok{5}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "abcabcabcabcabc"
\end{verbatim}

\hypertarget{objetos-constantes-de-texto}{%
\subsection{Objetos Constantes de Texto}\label{objetos-constantes-de-texto}}

O R também possibilita o acesso direto a todas as letras do alfabeto. Esses estão guardadas nos objetos reservados chamados \texttt{letters} e \texttt{LETTERS}: \index{constants!letters} \index{constants!LETTERS}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print all letters in alphabet (no cap)}
\FunctionTok{print}\NormalTok{(letters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n"
R> [15] "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print all letters in alphabet (WITH CAP)}
\FunctionTok{print}\NormalTok{(LETTERS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N"
R> [15] "O" "P" "Q" "R" "S" "T" "U" "V" "W" "X" "Y" "Z"
\end{verbatim}

Observe que em ambos os casos não é necessário criar os objetos. Por serem constantes embutidas automaticamente na área de trabalho do R, elas já estão disponíveis para uso. Podemos sobrescrever o nome do objeto com outro conteúdo, porém isso não é aconselhável. Nunca se sabe onde esse objeto constante está sendo usado. Outros objetos de texto constantes no R incluem \texttt{month.abb} e \texttt{month.name}. Veja a seguir o seu conteúdo: \index{constants!month.abb} \index{constants!month.name}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print abreviation and full names of months}
\FunctionTok{print}\NormalTok{(month.abb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep"
R> [10] "Oct" "Nov" "Dec"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(month.name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "January"   "February"  "March"     "April"    
R>  [5] "May"       "June"      "July"      "August"   
R>  [9] "September" "October"   "November"  "December"
\end{verbatim}

\hypertarget{selecionando-pedauxe7os-de-um-texto}{%
\subsection{Selecionando Pedaços de um Texto}\label{selecionando-pedauxe7os-de-um-texto}}

Um erro comum praticado por iniciantes é tentar selecionar pedaços de um texto através do uso de colchetes. Observe o código abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDE\textquotesingle{}}

\CommentTok{\# print its second character: \textquotesingle{}B\textquotesingle{} (WRONG {-} RESULT is NA)}
\FunctionTok{print}\NormalTok{(my\_char[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] NA
\end{verbatim}

O resultado \texttt{NA} indica que o segundo elemento de \texttt{my\_char} não existe. Isso acontece porque o uso de colchetes refere-se ao acesso de \textbf{elementos} de um vetor atômico, e não de caracteres dentro de um texto maior. Observe o que acontece quando utilizamos \texttt{my\_char{[}1{]}}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(my\_char[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABCDE"
\end{verbatim}

O resultado é simplesmente o texto \emph{ABCDE}, que está localizado no primeiro item de \texttt{my\_char}. Para selecionar pedaços de um texto, devemos utilizar a função específica \texttt{stringr::str\_sub}/\texttt{base::substr}: \index{stringr!str\_sub}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print third and fourth characters}
\NormalTok{my\_substr }\OtherTok{\textless{}{-}} \FunctionTok{str\_sub}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char,}
                     \AttributeTok{start =} \DecValTok{4}\NormalTok{,}
                     \AttributeTok{end =} \DecValTok{4}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_substr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "D"
\end{verbatim}

Essa função também funciona para vetores atômicos. Vamos assumir que você importou dados de texto e o conjunto de dados bruto contém um identificador de 3 dígitos de uma empresa, sempre na mesma posição do texto. Vamos simular a situação no R:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# build char vec}
\NormalTok{my\_char\_vec }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}123\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}231\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}321\textquotesingle{}}\NormalTok{),}
                      \StringTok{\textquotesingle{} {-} other ignorable text\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "123 - other ignorable text"
R> [2] "231 - other ignorable text"
R> [3] "321 - other ignorable text"
\end{verbatim}

Só estamos interessados na informação das três primeiras letras de cada elemento em \texttt{my\_char\_vec}. Para selecioná-los, podemos usar as mesmas funções que antes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get ids with stringr::str\_sub}
\NormalTok{ids.vec }\OtherTok{\textless{}{-}} \FunctionTok{str\_sub}\NormalTok{(my\_char\_vec, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\FunctionTok{print}\NormalTok{(ids.vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "123" "231" "321"
\end{verbatim}

\begin{rmdimportant}
\textbf{Operações vetorizadas são comuns e esperadas no R}. Quase tudo o
que você pode fazer para um único elemento pode ser expandido para
vetores. Isso facilita o desenvolvimento de rotinas pois pode-se
facilmente realizar tarefas complicadas em uma série de elementos, em
uma única linha de código.
\end{rmdimportant}

\hypertarget{localizando-e-substituindo-pedauxe7os-de-um-texto}{%
\subsection{Localizando e Substituindo Pedaços de um Texto}\label{localizando-e-substituindo-pedauxe7os-de-um-texto}}

Uma operação útil na manipulação de textos é a localização de letras e padrões específicos com funções \texttt{stringr::str\_locate}/\texttt{base::regexpr} e \texttt{stringr::str\_locate\_all}/\texttt{base::gregexpr}. É importante destacar que, por \emph{default}, essas funções utilizam de expressões do tipo \emph{regex} - expressões regulares \citep{thompson1968programming}. Essa é uma linguagem específica para processar textos. Diversos símbolos são utilizados para estruturar, procurar e isolar padrões textuais. Quando utilizada corretamente, o \emph{regex} é bastante útil e de extrema valia. \index{stringr!locate} \index{stringr!locate\_all}

Usualmente, o caso mais comum em pesquisa é verificar a posição ou a existência de um texto menor dentro de um texto maior. Isto é, um padrão explícito e fácil de entender. Por isso, a localização e substituição de caracteres no próximo exemplo será do tipo fixo, sem o uso de \emph{regex}. Tal informação pode ser passada às funções do pacote \texttt{stringr} através de outra função chamada \texttt{stringr::fixed}. \index{stringr!fixed}

O exemplo a seguir mostra como encontrar o caractere \emph{D} dentre uma série de caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDEF{-}ABCDEF{-}ABC\textquotesingle{}}
\NormalTok{pos }\OtherTok{=} \FunctionTok{str\_locate}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char, }\AttributeTok{pattern =} \FunctionTok{fixed}\NormalTok{(}\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{) )}
\FunctionTok{print}\NormalTok{(pos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      start end
R> [1,]     4   4
\end{verbatim}

Observe que a função \texttt{str\_locate} retorna apenas a primeira ocorrência de \emph{D}. Para resgatar todas as ocorrências, devemos utilizar a função \texttt{str\_locate\_all}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDEF{-}ABCDEF{-}ABC\textquotesingle{}}

\CommentTok{\# find position of ALL \textquotesingle{}D\textquotesingle{} using str\_locate\_all}
\NormalTok{pos }\OtherTok{=} \FunctionTok{str\_locate\_all}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char, }\AttributeTok{pattern =} \FunctionTok{fixed}\NormalTok{(}\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(pos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R>      start end
R> [1,]     4   4
R> [2,]    11  11
\end{verbatim}

Observe também que as funções \texttt{regexp} e \texttt{grepexpr} retornam objetos com propriedades específicas, apresentando-as na tela.

Para substituir caracteres em um texto, basta utilizar a função \texttt{stringr::str\_replace} ou \texttt{base::sub} e \texttt{str\_replace\_all} ou \texttt{base::gsub}. Vale salientar que \texttt{str\_replace} substitui a primeira ocorrência do caractere, enquanto \texttt{str\_replace\_all} executa uma substituição global - isto é, aplica-se a todas as ocorrências. Veja a diferença a seguir: \index{stringr!str\_replace} \index{stringr!str\_replace\_all}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDEF{-}ABCDEF{-}ABC\textquotesingle{}}

\CommentTok{\# substitute the FIRST \textquotesingle{}ABC\textquotesingle{} for \textquotesingle{}XXX\textquotesingle{} with sub}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{sub}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_char,}
               \AttributeTok{pattern =} \StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{,}
               \AttributeTok{replacement =} \StringTok{\textquotesingle{}XXX\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF-ABCDEF-ABC"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# substitute the FIRST \textquotesingle{}ABC\textquotesingle{} for \textquotesingle{}XXX\textquotesingle{} with str\_replace}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDEF{-}ABCDEF{-}ABC\textquotesingle{}}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char,}
                       \AttributeTok{pattern =} \FunctionTok{fixed}\NormalTok{(}\StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{),}
                       \AttributeTok{replacement =} \StringTok{\textquotesingle{}XXX\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF-ABCDEF-ABC"
\end{verbatim}

E agora fazemos uma substituição global dos caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCDEF{-}ABCDEF{-}ABC\textquotesingle{}}

\CommentTok{\# substitute the FIRST \textquotesingle{}ABC\textquotesingle{} for \textquotesingle{}XXX\textquotesingle{} with str\_replace}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char,}
                           \AttributeTok{pattern =} \StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{,}
                           \AttributeTok{replacement =} \StringTok{\textquotesingle{}XXX\textquotesingle{}}\NormalTok{)}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF-XXXDEF-XXX"
\end{verbatim}

Mais uma vez, vale ressaltar que as operações de substituição também funcionam em vetores. Dê uma olhada no próximo exemplo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char object}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABCDEF\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}DBCFE\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{)}

\CommentTok{\# create an example of vector}
\NormalTok{my\_char\_vec }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(}\FunctionTok{sample}\NormalTok{(my\_char, }\DecValTok{5}\NormalTok{, }\AttributeTok{replace =}\NormalTok{ T),}
                     \FunctionTok{sample}\NormalTok{(my\_char, }\DecValTok{5}\NormalTok{, }\AttributeTok{replace =}\NormalTok{ T),}
                     \AttributeTok{sep =} \StringTok{\textquotesingle{} {-} \textquotesingle{}}\NormalTok{)}

\CommentTok{\# show it}
\FunctionTok{print}\NormalTok{(my\_char\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABCDEF - ABC"    "ABCDEF - ABCDEF" "ABCDEF - ABC"   
R> [4] "ABCDEF - DBCFE"  "DBCFE - ABCDEF"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# substitute all occurrences of \textquotesingle{}ABC\textquotesingle{}}
\NormalTok{my\_char\_vec }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(}\AttributeTok{string =}\NormalTok{ my\_char\_vec,}
                               \AttributeTok{pattern =} \StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{,}
                               \AttributeTok{replacement =} \StringTok{\textquotesingle{}XXX\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_char\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF - XXX"    "XXXDEF - XXXDEF" "XXXDEF - XXX"   
R> [4] "XXXDEF - DBCFE"  "DBCFE - XXXDEF"
\end{verbatim}

\hypertarget{separando-textos}{%
\subsection{Separando Textos}\label{separando-textos}}

Em algumas situações, principalmente no processamento de textos, é possível que se esteja interessado em quebrar um texto de acordo com algum separador. Por exemplo, o texto \texttt{abc\ ;\ bcd\ ;\ adf} apresenta informações demarcadas pelo símbolo \texttt{;}. Para separar um texto em várias partes, utilizamos a função \texttt{stringr::str\_split}/\texttt{base::strsplit}. Essas quebram o texto em diversas partes de acordo com algum caractere escolhido. Observe os exemplos a seguir: \index{stringr!str\_split}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}ABCXABCXBCD\textquotesingle{}}

\CommentTok{\# split it based on \textquotesingle{}X\textquotesingle{} and using stringr::str\_split}
\NormalTok{split\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_split}\NormalTok{(my\_char, }\StringTok{\textquotesingle{}X\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(split\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "ABC" "ABC" "BCD"
\end{verbatim}

A saída dessa função é um objeto do tipo lista. Para acessar os elementos de uma lista, deve-se utilizar o operador \texttt{{[}{[}\ {]}{]}}. Por exemplo, para acessar o texto \texttt{bcd} da lista \texttt{split\_char}, executa-se o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(split\_char[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC"
\end{verbatim}

Para visualizar um exemplo de dividir textos em vetores, veja o próximo código.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char}
\NormalTok{my\_char\_vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABCDEF\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}DBCFE\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ABFC\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ACD\textquotesingle{}}\NormalTok{)}

\CommentTok{\# split it based on \textquotesingle{}B\textquotesingle{} and using stringr::strsplit}
\NormalTok{split\_char }\OtherTok{\textless{}{-}} \FunctionTok{str\_split}\NormalTok{(my\_char\_vec, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(split\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "A"    "CDEF"
R> 
R> [[2]]
R> [1] "D"   "CFE"
R> 
R> [[3]]
R> [1] "A"  "FC"
R> 
R> [[4]]
R> [1] "ACD"
\end{verbatim}

Observe como, novamente, um objeto do tipo \texttt{list} é retornado. Cada elemento é correspondente ao processo de quebra de texto em \texttt{my\_char}.

\hypertarget{descobrindo-o-nuxfamero-de-caracteres-de-um-texto}{%
\subsection{Descobrindo o Número de Caracteres de um Texto}\label{descobrindo-o-nuxfamero-de-caracteres-de-um-texto}}

Para descobrir o número de caracteres de um texto, utilizamos a função \texttt{stringr::str\_length}/\texttt{base::nchar}. Ela também funciona para vetores atômicos de texto. Veja os exemplos mostrados a seguir: \index{stringr!str\_length}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}abcdef\textquotesingle{}}

\CommentTok{\# print number of characters using stringr::str\_length}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str\_length}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6
\end{verbatim}

E agora um exemplo com vetores.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#set char}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}ab\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print number of characters using stringr::str\_length}
\FunctionTok{print}\NormalTok{(}\FunctionTok{str\_length}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

\hypertarget{gerando-combinauxe7uxf5es-de-texto}{%
\subsection{Gerando Combinações de Texto}\label{gerando-combinauxe7uxf5es-de-texto}}

Um truque útil no R é usar as funções \texttt{base::outer} e \texttt{base::expand.grid} para criar todas as combinações possíveis de elementos em diferentes objetos. Isso é útil quando você quer criar um vetor de texto combinando todos os elementos possíveis de diferentes vetores. Por exemplo, se quisermos criar um vetor com todas as combinações entre \texttt{c(\textquotesingle{}a\textquotesingle{}\ ,\ \textquotesingle{}b\textquotesingle{})} e \texttt{c(\textquotesingle{}A\textquotesingle{},\ \textquotesingle{}B\textquotesingle{})} como \texttt{c(\textquotesingle{}a-A\textquotesingle{},\ \textquotesingle{}a-B\textquotesingle{},\ ...)}, podemos escrever: \index{base!outer} \index{base!expand.grid}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set char vecs}
\NormalTok{my\_vec\_1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_vec\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{)}

\CommentTok{\# combine in matrix}
\NormalTok{comb.mat }\OtherTok{\textless{}{-}} \FunctionTok{outer}\NormalTok{(my\_vec\_1,}
\NormalTok{                  my\_vec\_2,}
\NormalTok{                  paste,}\AttributeTok{sep =} \StringTok{\textquotesingle{}{-}\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print it!}
\FunctionTok{print}\NormalTok{(comb.mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]  [,2] 
R> [1,] "a-A" "a-B"
R> [2,] "b-A" "b-B"
\end{verbatim}

A saída de \texttt{outer} é um objeto do tipo matriz. Se quisermos mudar \texttt{comb.mat} para um vetor atômico, podemos usar a função \texttt{as.character}: \index{base!as.character}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(comb.mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a-A" "b-A" "a-B" "b-B"
\end{verbatim}

Outra maneira de atingir o mesmo objetivo é usar a função \texttt{expand.grid}. Veja o próximo exemplo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}

\CommentTok{\# set vectors}
\NormalTok{my\_vec\_1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}John \textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Claire \textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Adam \textquotesingle{}}\NormalTok{)}
\NormalTok{my\_vec\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}is fishing.\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}is working.\textquotesingle{}}\NormalTok{)}

\CommentTok{\# create df with all combinations}
\NormalTok{my\_df }\OtherTok{\textless{}{-}} \FunctionTok{expand.grid}\NormalTok{(}\AttributeTok{name =}\NormalTok{ my\_vec\_1,}
                     \AttributeTok{verb =}\NormalTok{ my\_vec\_2)}

\CommentTok{\# print df}
\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      name        verb
R> 1   John  is fishing.
R> 2 Claire  is fishing.
R> 3   Adam  is fishing.
R> 4   John  is working.
R> 5 Claire  is working.
R> 6   Adam  is working.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# paste columns together in tibble}
\NormalTok{my\_df }\OtherTok{\textless{}{-}}\NormalTok{ my\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{phrase =} \FunctionTok{paste0}\NormalTok{(name, verb) )}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      name        verb             phrase
R> 1   John  is fishing.   John is fishing.
R> 2 Claire  is fishing. Claire is fishing.
R> 3   Adam  is fishing.   Adam is fishing.
R> 4   John  is working.   John is working.
R> 5 Claire  is working. Claire is working.
R> 6   Adam  is working.   Adam is working.
\end{verbatim}

Aqui, usamos a função \texttt{expand.grid} para criar um \texttt{dataframe} contendo todas as combinações possíveis de \texttt{my\_vec\_1} e \texttt{my\_vec\_2}. Posteriormente, colamos o conteúdo das colunas do \texttt{dataframe} usando \texttt{str\_c}.

\hypertarget{codificauxe7uxe3o-de-objetos-character}{%
\subsection{\texorpdfstring{Codificação de Objetos \texttt{character}}{Codificação de Objetos character}}\label{codificauxe7uxe3o-de-objetos-character}}

Para o R, um \emph{string} de texto é apenas uma sequência de \emph{bytes}. A tradução de \emph{bytes} para caracteres é realizada de acordo com uma estrutura de codificação. Para a maioria dos casos de uso do R, especialmente em países de língua inglesa, a codificação de caracteres não é um problema pois os textos importados no R já possuem a codificação correta. Ao lidar com dados de texto em diferentes idiomas, tal como Português do Brasil, a codificação de caracteres é algo que você deve entender pois eventualmente precisará lidar com isso.

Vamos explorar um exemplo. Aqui, vamos importar dados de um arquivo de texto com a codificação \texttt{\textquotesingle{}ISO-8859-9\textquotesingle{}} e verificar o resultado.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read text file}
\NormalTok{my\_f }\OtherTok{\textless{}{-}}\NormalTok{ adfeR}\SpecialCharTok{::}\FunctionTok{get\_data\_file}\NormalTok{(}\StringTok{\textquotesingle{}FileWithLatinChar\_Latin1.txt\textquotesingle{}}\NormalTok{)}

\NormalTok{my\_char }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_lines}\NormalTok{(my\_f)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A casa \xe9 bonita e tem muito espa\xe7o"
\end{verbatim}

O conteúdo original do arquivo é um texto em português. Como você pode ver, a saída de \texttt{readr::read\_lines} mostra todos os caracteres latinos com símbolos estranhos. Isso ocorre pois a codificação foi manualmente trocada para \texttt{\textquotesingle{}ISO-8859-9\textquotesingle{}}, enquanto a função \texttt{read\_lines} utiliza \texttt{\textquotesingle{}UTF-8\textquotesingle{}} como \emph{default}. A solução mais fácil e direta é modificar a codificação esperada do arquivo nas entradas de \texttt{read\_lines}. Veja a seguir, onde importamos um arquivo com a codificação correta (\texttt{\textquotesingle{}Latin1\textquotesingle{}}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_char }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_lines}\NormalTok{(my\_f, }
                             \AttributeTok{locale =}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{locale}\NormalTok{(}\AttributeTok{encoding=}\StringTok{\textquotesingle{}Latin1\textquotesingle{}}\NormalTok{))}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A casa é bonita e tem muito espaço"
\end{verbatim}

Os caracteres latinos agora estão corretos pois a codificação em \texttt{read\_lines} é a mesma do arquivo, \texttt{\textquotesingle{}Latin1\textquotesingle{}}. Uma boa política neste tópico é sempre verificar a codificação de arquivos de texto importados e combiná-lo em R. A maioria das funções de importação tem uma opção para fazê-lo. Quando possível, sempre dê preferência para \texttt{\textquotesingle{}UTF-8\textquotesingle{}}. Caso necessário, programas de edição de texto, tal como o \href{https://notepad-plus-plus.org/}{notepad++}, possuem ferramentas para verificar e trocar a codificação de um arquivo.

\hypertarget{outras-funuxe7uxf5es-uxfateis-4}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-4}}

\texttt{stringr::str\_to\_lower}/\texttt{base::tolower} - Converte um objeto de texto para letras minúsculas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_to\_lower}\NormalTok{(}\StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "abc"
\end{verbatim}

\texttt{stringr::str\_to\_upper/base::toupper} - Convertem um texto em letras maiúsculas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{toupper}\NormalTok{(}\StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_to\_upper}\NormalTok{(}\StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC"
\end{verbatim}

\hypertarget{fatores}{%
\section{Fatores}\label{fatores}}

A classe de fatores (\texttt{factor}) é utilizada para representar grupos ou categorias dentro de uma base de dados no formato tabular. Por exemplo, imagine um banco de informações com os gastos de diferentes pessoas ao longo de um ano. Nessa base de dados existe um item que define o gênero do indivíduo: masculino ou feminino (M ou F). Essa respectiva coluna pode ser importada e representada como texto, porém, no R, a melhor maneira de representá-la é através do objeto fator, uma vez que a mesma representa uma categoria.

A classe de fatores oferece um significado especial para denotar grupos dentro dos dados. Essa organização é integrada aos pacotes e facilita muito a vida do usuário. Por exemplo, caso quiséssemos criar um gráfico para cada grupo dentro da nossa base de dados, poderíamos fazer o mesmo simplesmente indicando a existência de uma variável de fator para a função de criação da figura. Outra possibilidade é determinar se as diferentes médias de uma variável numérica são estatisticamente diferentes para os grupos dos nossos dados. Podemos também estimar um determinado modelo estatístico para cada grupo. Quando os dados de categorias são representados apropriadamente, o uso das funções do R torna-se mais fácil e eficiente.

\hypertarget{criando-fatores}{%
\subsection{Criando Fatores}\label{criando-fatores}}

A criação de fatores dá-se através da função \texttt{factor}: \index{base!factor}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(my\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] M F M M F
R> Levels: F M
\end{verbatim}

Observe, no exemplo anterior, que a apresentação de fatores com a função \texttt{print} mostra os seus elementos e também o item chamado \texttt{Levels}. Esse último identifica os possíveis grupos que abrangem o vetor - nesse caso apenas \texttt{M} e \texttt{F}. Se tivéssemos um número maior de grupos, o item \texttt{Levels} aumentaria. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ND\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(my\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] M  F  M  M  F  ND
R> Levels: F M ND
\end{verbatim}

Um ponto importante na criação de fatores é que os \texttt{Levels} são inferidos através dos dados criados, e isso pode não corresponder à realidade. Por exemplo, observe o seguinte exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_status }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(my\_status)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] Solteiro Solteiro Solteiro
R> Levels: Solteiro
\end{verbatim}

Nota-se que, por ocasião, os dados mostram apenas uma categoria: \texttt{Solteiro}. Entretanto, sabe-se que outra categoria do tipo \texttt{Casado} é esperada. No caso de utilizarmos o objeto \texttt{my\_status} da maneira que foi definida anteriormente, omitiremos a informação de outros gêneros, e isso pode ocasionar problemas no futuro tal como a criação de gráficos incompletos. Nessa situação, o correto é definir os \texttt{Levels} manualmente da seguinte maneira:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_status }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{),}
                    \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Solteiro\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Casado\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(my\_status)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] Solteiro Solteiro Solteiro
R> Levels: Solteiro Casado
\end{verbatim}

\hypertarget{modificando-fatores}{%
\subsection{Modificando Fatores}\label{modificando-fatores}}

Um ponto importante sobre os objetos do tipo fator é que seus \texttt{Levels} são \textbf{imutáveis e não atualizam-se com a entrada de novos dados}. Em outras palavras, não é possível modificar os valores dos \texttt{Levels} após a criação do objeto. Toda nova informação que não for compatível com os \texttt{Levels} do objeto será transformada em \texttt{NA} (\emph{Not available}) e uma mensagem de \texttt{warning} irá aparecer na tela. Essa limitação pode parecer estranha a primeira vista porém, na prática, ela evita possíveis erros no código. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set factor}
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{))}

\CommentTok{\# change first element of a factor to \textquotesingle{}c\textquotesingle{}}
\NormalTok{my\_factor[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}c\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Warning in `[<-.factor`(`*tmp*`, 1, value = "c"): invalid
R> factor level, NA generated
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] <NA> b    a    b   
R> Levels: a b
\end{verbatim}

Nesse caso, a maneira correta de proceder é primeiro transformar o objeto da classe fator para a classe caractere e depois realizar a conversão:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set factor}
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{))}

\CommentTok{\# change factor to character}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(my\_factor)}

\CommentTok{\# change first element}
\NormalTok{my\_char[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}c\textquotesingle{}}

\CommentTok{\# mutate it back to class factor}
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(my\_char)}

\CommentTok{\# show result}
\FunctionTok{print}\NormalTok{(my\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] c b a b
R> Levels: a b c
\end{verbatim}

Utilizando essas etapas temos o resultado desejado no vetor \texttt{my\_factor}, com a definição de três \texttt{Levels}: \texttt{a}, \texttt{b} e \texttt{c}.

O universo \texttt{tidyverse} também possui um pacote próprio para manipular fatores, o \texttt{forcats}. Para o problema atual de modificação de fatores, podemos utilizar função \texttt{forcats::fct\_recode}. Veja um exemplo a seguir, onde trocamos as siglas dos fatores: \index{forcats!fct\_recode}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(forcats)}

\CommentTok{\# set factor}
\NormalTok{my.fct }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}M\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}N\textquotesingle{}}\NormalTok{))}

\CommentTok{\# modify factors}
\NormalTok{my.fct }\OtherTok{\textless{}{-}} \FunctionTok{fct\_recode}\NormalTok{(my.fct,}
                     \StringTok{\textquotesingle{}D\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}E\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{,}
                     \StringTok{\textquotesingle{}F\textquotesingle{}} \OtherTok{=} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my.fct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] D E F D F M N
R> Levels: D E F M N
\end{verbatim}

Observe como o uso da função \texttt{forcats::fct\_recode} é intuitivo. Basta indicar o novo nome dos grupos com o operador de igualdade.

\hypertarget{convertendo-fatores-para-outras-classes}{%
\subsection{Convertendo Fatores para Outras Classes}\label{convertendo-fatores-para-outras-classes}}

Outro ponto importante no uso de fatores é a sua conversão para outras classes, especialmente a numérica. Quando convertemos um objeto de tipo fator para a classe caractere, o resultado é o esperado:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create factor}
\NormalTok{my\_char }\OtherTok{\textless{}{-}}\FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{))}

\CommentTok{\# convert and print}
\FunctionTok{print}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c"
\end{verbatim}

Porém, quando fazemos o mesmo procedimento para a classe numérica, o que o R retorna é \textbf{longe do esperado}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set factor}
\NormalTok{my\_values }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\DecValTok{5}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{\# convert to numeric (WRONG)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(my\_values))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 4 5 6
\end{verbatim}

Esse resultado pode ser explicado pelo fato de que, internamente, fatores são armazenados como índices, indo de 1 até o número total de \texttt{Levels}. Essa simplificação minimiza o uso da memória do computador. Quando pedimos ao R para transformar esses fatores em números, ele entende que buscamos o número do índice e não do valor. Para contornar, é fácil: basta transformar o objeto fator em caractere e, depois, em numérico, conforme mostrado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# converting factors to character and then to numeric}
\FunctionTok{print}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(my\_values)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  5  6  7  8  9 10
\end{verbatim}

\begin{rmdcaution}
Tenha muito cuidado ao transformar fatores em números. Lembre-se sempre
de que o retorno da conversão direta serão os índices dos
\texttt{levels} e não os valores em si. Esse é um \emph{bug} bem
particular que pode ser difícil de identificar em um código complexo.
\end{rmdcaution}

\hypertarget{criando-tabelas-de-continguxeancia}{%
\subsection{Criando Tabelas de Contingência}\label{criando-tabelas-de-continguxeancia}}

Após a criação de um fator, podemos calcular a ocorrência de cada fator com a função \texttt{table}. Essa também é chamada de tabela de contingência. Em um caso simples, com apenas um fator, a função \texttt{table} conta o número de ocorrências de cada categoria, como a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create factor}
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Pref\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Ord\textquotesingle{}}\NormalTok{),}
                           \AttributeTok{size =} \DecValTok{20}\NormalTok{,}
                           \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{))}

\CommentTok{\# print contingency table}
\FunctionTok{print}\NormalTok{(}\FunctionTok{table}\NormalTok{(my\_factor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> my_factor
R>  Ord Pref 
R>    9   11
\end{verbatim}

Um caso mais avançado do uso de \texttt{table} é utilizar mais de um fator para a criação da tabela. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set factors}
\NormalTok{my\_factor\_1 }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Pref\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Ord\textquotesingle{}}\NormalTok{),}
                             \AttributeTok{size =} \DecValTok{20}\NormalTok{,}
                             \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{))}

\NormalTok{my\_factor\_2 }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}Grupo\textquotesingle{}}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{),}
                             \AttributeTok{size =} \DecValTok{20}\NormalTok{,}
                             \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{))}

\CommentTok{\# print contingency table with two factors}
\FunctionTok{print}\NormalTok{(}\FunctionTok{table}\NormalTok{(my\_factor\_1, my\_factor\_2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>            my_factor_2
R> my_factor_1 Grupo 1 Grupo 2 Grupo 3
R>        Ord        2       4       3
R>        Pref       3       4       4
\end{verbatim}

A tabela criada anteriormente mostra o número de ocorrências para cada combinação de fator. Essa é uma ferramenta descritiva simples, mas bastante informativa para a análise de grupos de dados.

\hypertarget{outras-funuxe7uxf5es}{%
\subsection{Outras Funções}\label{outras-funuxe7uxf5es}}

\textbf{levels} - Retorna os \texttt{Levels} de um objeto da classe fator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{levels}\NormalTok{(my\_factor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A" "B" "C"
\end{verbatim}

\textbf{as.factor} - Transforma um objeto para a classe fator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(my\_y)}
\FunctionTok{print}\NormalTok{(my\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] a b c c a
R> Levels: a b c
\end{verbatim}

\textbf{split} - Com base em um objeto de fator, cria uma lista com valores de outro objeto. Esse comando é útil para separar dados de grupos diferentes e aplicar alguma função com \texttt{sapply} ou \texttt{lapply}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{))}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(my\_factor)}

\NormalTok{my\_l }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_x, }\AttributeTok{f =}\NormalTok{ my\_factor)}

\FunctionTok{print}\NormalTok{(my\_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $A
R> [1] 1
R> 
R> $B
R> [1] 2 6
R> 
R> $C
R> [1] 3 4 5
\end{verbatim}

\hypertarget{valores-luxf3gicos}{%
\section{Valores Lógicos}\label{valores-luxf3gicos}}

Testes lógicos em dados são centrais no uso do R. Em uma única linha de código podemos testar condições para uma grande quantidade de casos. Esse cálculo é muito utilizado para encontrar casos extremos nos dados (\emph{outliers}) e também para separar diferentes amostras de acordo com algum critério.

\hypertarget{criando-valores-luxf3gicos}{%
\subsection{Criando Valores Lógicos}\label{criando-valores-luxf3gicos}}

Em uma sequência de 1 até 10, podemos verificar quais são os elementos maiores que 5 com o seguinte código: \index{base!which}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set numerical}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}

\CommentTok{\# print a logical test}
\FunctionTok{print}\NormalTok{(my\_x }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
R> [10]  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print position of elements from logical test}
\FunctionTok{print}\NormalTok{(}\FunctionTok{which}\NormalTok{(my\_x }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  6  7  8  9 10
\end{verbatim}

A função \texttt{which} do exemplo anterior retorna os índices onde a condição é verdadeira (\texttt{TRUE}). O uso do \texttt{which} é recomendado quando se quer saber a posição de elementos que satisfazem alguma condição.

Para realizar testes de igualdade, basta utilizar o símbolo de igualdade duas vezes (\texttt{==}).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create char}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}bcd\textquotesingle{}}\NormalTok{), }\DecValTok{5}\NormalTok{)}

\CommentTok{\# print its contents}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc"
R> [10] "bcd"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print logical test}
\FunctionTok{print}\NormalTok{(my\_char }\SpecialCharTok{==} \StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE
R> [10] FALSE
\end{verbatim}

Para o teste de inigualdades, utilizamos o símbolo \texttt{!=}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print inequality test}
\FunctionTok{print}\NormalTok{(my\_char }\SpecialCharTok{!=} \StringTok{\textquotesingle{}abc\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
R> [10]  TRUE
\end{verbatim}

Destaca-se que também é possível testar condições múltiplas, isto é, a ocorrência simultânea de eventos. Utilizamos o operador \texttt{\&} para esse propósito. Por exemplo: se quiséssemos verificar quais são os valores de uma sequência de 1 a 10 que são maiores que 4 \textbf{e} menores que 7, escreveríamos:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}

\CommentTok{\# print logical for values higher than 4 and lower than 7}
\FunctionTok{print}\NormalTok{((my\_x }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{)}\SpecialCharTok{\&}\NormalTok{(my\_x }\SpecialCharTok{\textless{}} \DecValTok{7}\NormalTok{) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
R> [10] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print the actual values}
\NormalTok{idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{( (my\_x }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{)}\SpecialCharTok{\&}\NormalTok{(my\_x }\SpecialCharTok{\textless{}} \DecValTok{7}\NormalTok{) )}
\FunctionTok{print}\NormalTok{(my\_x[idx])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 6
\end{verbatim}

Para testar condições não simultâneas, isto é, ocorrências de um ou outro evento, utilizamos o operador \texttt{\textbar{}}. Por exemplo: considerando a sequência anterior, acharíamos os valores maiores que 7 \textbf{ou} menores que 4 escrevendo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# location of elements higher than 7 or lower than 4}
\NormalTok{idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{( (my\_x }\SpecialCharTok{\textgreater{}} \DecValTok{7}\NormalTok{)}\SpecialCharTok{|}\NormalTok{(my\_x }\SpecialCharTok{\textless{}} \DecValTok{4}\NormalTok{) )}

\CommentTok{\# print elements from previous condition}
\FunctionTok{print}\NormalTok{(my\_x[idx])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  1  2  3  8  9 10
\end{verbatim}

Observe que, em ambos os casos de uso de testes lógicos, utilizamos parênteses para encapsular as condições lógicas. Poderíamos ter escrito \texttt{idx\ \textless{}-\ which(\ my\_x\ \textgreater{}\ 7\textbar{}my\_x\ \textless{}\ 4\ )}, porém o uso do parênteses deixa o código mais claro ao isolar os testes de condições e sinalizar que o resultado da operação será um vetor lógico. Em alguns casos, porém, o uso do parênteses indica hierarquia na ordem das operações e portanto não pode ser ignorado.

Outro uso interessante de objetos lógicos é o teste para saber se um item ou mais pertence a um vetor ou não. Para isso utilizamos o operador \texttt{\%in\%}. Por exemplo, imagine que tens os \emph{tickers} de duas ações, \texttt{c(\textquotesingle{}ABC\textquotesingle{},\ \textquotesingle{}DEF\textquotesingle{})} e queres saber se é possível encontrar esses tickers na coluna de outra base de dados. Essa é uma operação semelhante ao uso do teste de igualdade, porém em notação vetorial. Veja um exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\CommentTok{\# location of elements higher than 7 or lower than 4}
\NormalTok{my\_tickers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DEF\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set df}
\NormalTok{n\_obs }\OtherTok{\textless{}{-}} \DecValTok{100}
\NormalTok{df\_temp }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{tickers =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}ABC\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}DEF\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}GHI\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}JKL\textquotesingle{}}\NormalTok{),}
                                   \AttributeTok{size =}\NormalTok{ n\_obs,}
                                   \AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{),}
                  \AttributeTok{ret =} \FunctionTok{rnorm}\NormalTok{(n\_obs, }\AttributeTok{sd =} \FloatTok{0.05}\NormalTok{) )}

\CommentTok{\# find rows with selected tickers}
\NormalTok{idx }\OtherTok{\textless{}{-}}\NormalTok{ df\_temp}\SpecialCharTok{$}\NormalTok{tickers }\SpecialCharTok{\%in\%}\NormalTok{ my\_tickers}

\CommentTok{\# print elements from previous condition}
\FunctionTok{glimpse}\NormalTok{(df\_temp[idx, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 43
R> Columns: 2
R> $ tickers <chr> "ABC", "ABC", "ABC", "DEF", "DEF", "ABC", ~
R> $ ret     <dbl> 0.042864781, 0.017056405, 0.011198439, 0.0~
\end{verbatim}

O \texttt{dataframe} mostrado na tela possui dados apenas para ações em \texttt{my\_tickers}.

\hypertarget{datas-e-tempo}{%
\section{Datas e Tempo}\label{datas-e-tempo}}

A representação e manipulação de datas é um importante aspecto das pesquisas em Finanças e Economia. Manipular datas e horários de forma correta, levando em conta mudanças decorridas de horário de verão, feriados locais, em diferentes zonas de tempo, não é uma tarefa fácil! Felizmente, o R fornece um grande suporte para qualquer tipo de operação com datas e tempo.

Nesta seção estudaremos as funções e classes nativas que representam e manipulam o tempo em R. Aqui, daremos prioridade as funções do pacote \texttt{lubridate} \citep{R-lubridate}. Existem, no entanto, muitos pacotes que podem ajudar o usuário a processar objetos do tipo data e tempo de forma mais avançada. Caso alguma operação com data e tempo não for encontrada aqui, sugiro o estudo dos pacotes \texttt{chron} \citep{R-chron}, \texttt{timeDate} \citep{R-timeDate} e \texttt{bizdays} \citep{R-bizdays}. \index{timeDate} \index{bizdays} \index{chron}

Antes de começarmos, vale relembrar que toda data no R segue o formato \href{https://www.iso.org/iso-8601-date-and-time-format.html}{ISO 8601} (\texttt{YYYY-MM-DD}), onde \texttt{YYYY} é o ano em quatro números, \texttt{MM} é o mês e \texttt{DD} é o dia. Por exemplo, uma data em ISO 8601 é 2022-11-23. Deves familiarizar-se com esse formato pois toda importação de dados com formato de datas diferente desta notação exigirá conversão. Felizmente, essa operação é bastante simples de executar com o \texttt{lubridate}.

\hypertarget{criando-datas-simples}{%
\subsection{Criando Datas Simples}\label{criando-datas-simples}}

No R, existem diversas classes que podem representar datas. A escolha entre uma classe de datas e outra baseia-se na necessidade da pesquisa. Em muitas situações não é necessário saber o horário, enquanto que em outras isso é extremamente pertinente pois os dados são coletados ao longo de um dia.

A classe mais básica de datas é \texttt{Date}. Essa indica dia, mês e ano, apenas. No \texttt{lubridate}, criamos datas verificando o formato da data de entrada e as funções \texttt{ymd} (year-month-date), \texttt{dmy} (day-month-year) e \texttt{mdy} (month-day-year). Veja a seguir: \index{lubridate!ymd} \index{lubridate!dmy} \index{lubridate!mdy}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}06{-}24\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{dmy}\NormalTok{(}\StringTok{\textquotesingle{}24{-}06{-}2021\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{mdy}\NormalTok{(}\StringTok{\textquotesingle{}06{-}24{-}2021\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

Note que as funções retornam exatamente o mesmo objeto. A diferença no uso é somente pela forma que a data de entrada está estruturada com a posição do dia, mês e ano.

Um benefício no uso das funções do pacote \texttt{lubridate} é que as mesmas são inteligentes ao lidar com formatos diferentes. Observe no caso anterior que definimos os elementos das datas com o uso do traço (\texttt{-}) como separador e valores numéricos. Outros formatos também são automaticamente reconhecidos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021/06/24\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021\&06\&24\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021 june 24\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{dmy}\NormalTok{(}\StringTok{\textquotesingle{}24 of june 2021\textquotesingle{}}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

Isso é bastante útil pois o formato de datas no Brasil é \texttt{dia/mês/ano} (DD/MM/YYYY). Ao usar \texttt{dmy} para uma data brasileira, a conversão é correta:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date from dd/mm/yyyy}
\NormalTok{my\_date }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{\textquotesingle{}24/06/2021\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

Já no pacote \texttt{base}, a função correspondente é \texttt{as.Date}. O formato da data, porém, deve ser explicitamente definido com argumento \texttt{format}, conforme mostrado a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set Date from dd/mm/yyyy with the definition of format}
\NormalTok{my\_date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{\textquotesingle{}24/06/2021\textquotesingle{}}\NormalTok{, }\AttributeTok{format =} \StringTok{\textquotesingle{}\%d/\%m/\%Y\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

Os símbolos utilizados na entrada \texttt{format}, tal como \texttt{\%d} e \texttt{\%Y}, são indicadores de formato, os quais definem a forma em que a data a ser convertida está estruturada. Nesse caso, os símbolos \texttt{\%Y}, \texttt{\%m} e \texttt{\%d} definem ano, mês e dia, respectivamente. Existem diversos outros símbolos que podem ser utilizados para processar datas em formatos específicos. Um panorama das principais codificações é apresentado a seguir:

\begin{longtable}[]{@{}ccc@{}}
\toprule()
Código & Valor & Exemplo \\
\midrule()
\endhead
\%d & dia do mês (decimal) & 0 \\
\%m & mês (decimal) & 12 \\
\%b & mês (abreviado) & Abr \\
\%B & mês (nome completo) & Abril \\
\%y & ano (2 dígitos) & 16 \\
\%Y & ano (4 dígitos) & 2021 \\
\bottomrule()
\end{longtable}

Os símbolos anteriores permitem a criação de datas a partir de variados formatos. Observe como a utilização das funções do \texttt{lubridate}, em relação a \texttt{base}, são mais simples e fáceis de utilizar, justificando a nossa escolha.

\hypertarget{criando-sequuxeancias-de-datas}{%
\subsection{Criando Sequências de Datas}\label{criando-sequuxeancias-de-datas}}

Um aspecto interessante no uso de objetos do tipo \texttt{Date} é que eles interagem com operações de adição de valores numéricos e com testes lógicos de comparação de datas. Por exemplo: caso quiséssemos adicionar um dia à data \texttt{my\_date} criada anteriormente, bastaria somar o valor 1 ao objeto:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create date}
\NormalTok{my\_date }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}06{-}24\textquotesingle{}}\NormalTok{)}

\CommentTok{\# find next day}
\NormalTok{my\_date\_2 }\OtherTok{\textless{}{-}}\NormalTok{ my\_date }\SpecialCharTok{+} \DecValTok{1}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date\_2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-25"
\end{verbatim}

A propriedade também funciona com vetores, o que deixa a criação de sequências de datas muito fácil. Nesse caso, o próprio R encarrega-se de verificar o número de dias em cada mês.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a sequence of Dates}
\NormalTok{my\_date\_vec }\OtherTok{\textless{}{-}}\NormalTok{ my\_date }\SpecialCharTok{+} \DecValTok{0}\SpecialCharTok{:}\DecValTok{15}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_date\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2021-06-24" "2021-06-25" "2021-06-26" "2021-06-27"
R>  [5] "2021-06-28" "2021-06-29" "2021-06-30" "2021-07-01"
R>  [9] "2021-07-02" "2021-07-03" "2021-07-04" "2021-07-05"
R> [13] "2021-07-06" "2021-07-07" "2021-07-08" "2021-07-09"
\end{verbatim}

Uma maneira mais customizável de criar sequências de datas é utilizar a função \texttt{seq}. Com ela, é possível definir intervalos diferentes de tempo e até mesmo o tamanho do vetor de saída. Caso quiséssemos uma sequência de datas de dois em dois dias, poderíamos utilizar o seguinte código: \index{base!seq}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set first and last Date}
\NormalTok{my\_date\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}03{-}07\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_date\_2 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}03{-}20\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set sequence}
\NormalTok{my\_date\_date }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ my\_date\_1,}
                    \AttributeTok{to =}\NormalTok{ my\_date\_2,}
                    \AttributeTok{by =} \StringTok{\textquotesingle{}2 days\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date\_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-07" "2021-03-09" "2021-03-11" "2021-03-13"
R> [5] "2021-03-15" "2021-03-17" "2021-03-19"
\end{verbatim}

Caso quiséssemos de duas em duas semanas, escreveríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set first and last Date}
\NormalTok{my\_date\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}03{-}07\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_date\_2 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}04{-}20\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set sequence}
\NormalTok{my\_date\_date }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ my\_date\_1,}
                    \AttributeTok{to =}\NormalTok{ my\_date\_2,}
                    \AttributeTok{by =} \StringTok{\textquotesingle{}2 weeks\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date\_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-07" "2021-03-21" "2021-04-04" "2021-04-18"
\end{verbatim}

Outra forma de utilizar \texttt{seq} é definir o tamanho desejado do objeto de saída. Por exemplo, caso quiséssemos um vetor de datas com 10 elementos, usaríamos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set first and last Date}
\NormalTok{my\_date\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}03{-}07\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_date\_2 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}10{-}20\textquotesingle{}}\NormalTok{)}

\CommentTok{\# set sequence}
\NormalTok{my\_date\_vec }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =}\NormalTok{ my\_date\_1,}
                    \AttributeTok{to =}\NormalTok{ my\_date\_2,}
                    \AttributeTok{length.out =} \DecValTok{10}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_date\_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2021-03-07" "2021-04-01" "2021-04-26" "2021-05-21"
R>  [5] "2021-06-15" "2021-07-11" "2021-08-05" "2021-08-30"
R>  [9] "2021-09-24" "2021-10-20"
\end{verbatim}

O intervalo entre as datas em \texttt{my\_date\_vec} é definido automaticamente pelo R.

\hypertarget{operauxe7uxf5es-com-datas}{%
\subsection{Operações com Datas}\label{operauxe7uxf5es-com-datas}}

É possível descobrir a diferença de dias entre datas simplesmente diminuindo uma data da outra:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set dates}
\NormalTok{my\_date\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2015{-}06{-}24\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_date\_2 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}06{-}24\textquotesingle{}}\NormalTok{)}

\CommentTok{\# calculate difference}
\NormalTok{diff\_date }\OtherTok{\textless{}{-}}\NormalTok{ my\_date\_2 }\SpecialCharTok{{-}}\NormalTok{ my\_date\_1}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(diff\_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Time difference of 366 days
\end{verbatim}

A saída da operação de subtração é um objeto da classe \texttt{diffdate}, o qual possui a classe de lista como sua estrutura básica. Destaca-se que a notação de acesso aos elementos da classe \texttt{diffdate} é a mesma utilizada para listas. O valor numérico do número de dias está contido no primeiro elemento de \texttt{diff\_date}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print difference of days as numerical value}
\FunctionTok{print}\NormalTok{(diff\_date[[}\DecValTok{1}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 366
\end{verbatim}

Podemos testar se uma data é maior do que outra com o uso das operações de comparação:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set date and vector}
\NormalTok{my\_date\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}06{-}20\textquotesingle{}}\NormalTok{)}
\NormalTok{my\_date\_vec }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}06{-}20\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{)}

\CommentTok{\# test which elements of my\_date\_vec are older than my\_date\_1}
\NormalTok{my\_test }\OtherTok{\textless{}{-}}\NormalTok{ (my\_date\_vec }\SpecialCharTok{\textgreater{}}\NormalTok{ my\_date\_1)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_test)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
R> [10]  TRUE  TRUE
\end{verbatim}

A operação anterior é bastante útil quando se está buscando filtrar um determinado período de tempo nos dados. Nesse caso, basta buscar nas datas o período específico em que estamos interessados e utilizar o objeto lógico da comparação para selecionar os elementos. Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# set first and last dates}
\NormalTok{first\_date }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}06{-}01\textquotesingle{}}\NormalTok{)}
\NormalTok{last\_date }\OtherTok{\textless{}{-}} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}06{-}15\textquotesingle{}}\NormalTok{)}

\CommentTok{\# create \textasciigrave{}dataframe\textasciigrave{} and glimpse it}
\NormalTok{my\_temp\_df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{date\_vec =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2016{-}05{-}25\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{30}\NormalTok{),}
                     \AttributeTok{prices=}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{,}
                                \AttributeTok{length.out =} \FunctionTok{length}\NormalTok{(date\_vec)))}

\FunctionTok{glimpse}\NormalTok{(my\_temp\_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 31
R> Columns: 2
R> $ date_vec <date> 2016-05-25, 2016-05-26, 2016-05-27, 2016~
R> $ prices   <dbl> 1.0, 1.3, 1.6, 1.9, 2.2, 2.5, 2.8, 3.1, 3~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# find dates that are between the first and last date}
\NormalTok{my\_idx }\OtherTok{\textless{}{-}}\NormalTok{ (my\_temp\_df}\SpecialCharTok{$}\NormalTok{date\_vec }\SpecialCharTok{\textgreater{}=}\NormalTok{ first\_date) }\SpecialCharTok{\&}
\NormalTok{  (my\_temp\_df}\SpecialCharTok{$}\NormalTok{date\_vec }\SpecialCharTok{\textless{}=}\NormalTok{ last\_date)}

\CommentTok{\# use index to filter \textasciigrave{}dataframe\textasciigrave{}}
\NormalTok{my\_temp\_df\_filtered }\OtherTok{\textless{}{-}}\NormalTok{ my\_temp\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(my\_idx) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 15
R> Columns: 2
R> $ date_vec <date> 2016-06-01, 2016-06-02, 2016-06-03, 2016~
R> $ prices   <dbl> 3.1, 3.4, 3.7, 4.0, 4.3, 4.6, 4.9, 5.2, 5~
\end{verbatim}

Nesse caso, o vetor final de preços da coluna \texttt{prices} contém apenas informações para o período entre \texttt{first\_date} e \texttt{last\_date}.

\hypertarget{lidando-com-data-e-tempo}{%
\subsection{Lidando com Data e Tempo}\label{lidando-com-data-e-tempo}}

O uso da classe \texttt{Date} é suficiente quando se está lidando apenas com datas. Em casos em que é necessário levar em consideração o horário, temos que utilizar um objeto do tipo \texttt{datetime}.

No pacote \texttt{base}, uma das classes utilizadas para esse fim é a \texttt{POSIXlt}, a qual armazena o conteúdo de uma data na forma de uma lista. Outra classe que também é possível utilizar é a \texttt{POSIXct}, que armazena as datas como segundos contados a partir de \texttt{1970-01-01}. Devido ao seu formato de armazenamento, a classe \texttt{POSIXct} ocupa menos memória do computador. Junto ao \texttt{lubridate}, a classe utilizada para representar data-tempo é \texttt{POSIXct} e portanto daremos prioridade a essa. Vale destacar que todos os exemplos apresentados aqui também podem ser replicados para objetos do tipo \texttt{POSIXlt}.

O formato tempo/data também segue a norma \href{https://www.iso.org/iso-8601-date-and-time-format.html}{ISO 8601}, sendo representado como \texttt{ano-mês-dia\ horas:minutos:segundos\ zonadetempo} (YYYY-MM-DD HH:mm:SS TMZ). Veja o exemplo a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating a POSIXct object}
\NormalTok{my\_timedate }\OtherTok{\textless{}{-}} \FunctionTok{as.POSIXct}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 16:00:00\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_timedate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-01-01 16:00:00 -03"
\end{verbatim}

O pacote \texttt{lubridate} também oferece funções inteligentes para a criação de objetos do tipo data-tempo. Essas seguem a mesma linha de raciocínio que as funções de criar datas. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# creating a POSIXlt object}
\NormalTok{my\_timedate }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 16:00:00\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_timedate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-01-01 16:00:00 UTC"
\end{verbatim}

Destaca-se que essa classe adiciona automaticamente o fuso horário. Caso seja necessário representar um fuso diferente, é possível fazê-lo com o argumento \texttt{tz}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# creating a POSIXlt object with custom timezone}
\NormalTok{my\_timedate\_tz }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 16:00:00\textquotesingle{}}\NormalTok{,}
                          \AttributeTok{tz =} \StringTok{\textquotesingle{}GMT\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_timedate\_tz)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-01-01 16:00:00 GMT"
\end{verbatim}

É importante ressaltar que, para o caso de objetos do tipo \texttt{POSIXlt} e \texttt{POSIXct}, \textbf{as operações de soma e diminuição referem-se a segundos} e não dias, como no caso do objeto da classe \texttt{Date}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Adding values (seconds) to a POSIXlt object and printing it}
\FunctionTok{print}\NormalTok{(my\_timedate\_tz }\SpecialCharTok{+} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-01-01 16:00:30 GMT"
\end{verbatim}

Assim como para a classe \texttt{Date}, existem símbolos específicos para lidar com componentes de um objeto do tipo data/tempo. Isso permite a formatação customizada de datas. A seguir, apresentamos um quadro com os principais símbolos e os seus respectivos significados.

\begin{longtable}[]{@{}ccc@{}}
\toprule()
Código & Valor & Exemplo \\
\midrule()
\endhead
\%H & Hora (decimal, 24 horas) & 23 \\
\%I & Hora (decimal, 12 horas) & 11 \\
\%M & Minuto (decimal, 0-59) & 12 \\
\%p & Indicador AM/PM & AM \\
\%S & Segundos (decimal, 0-59) & 50 \\
\bottomrule()
\end{longtable}

A seguir veremos como utilizar essa tabela para customizar datas.

\hypertarget{personalizando-o-formato-de-datas}{%
\subsection{Personalizando o Formato de Datas}\label{personalizando-o-formato-de-datas}}

A notação básica para representar datas e data/tempo no R pode não ser a ideal em algumas situações. No Brasil, por exemplo, indicar datas no formato \texttt{YYYY-MM-DD} pode gerar bastante confusão em um relatório formal. É recomendado, portanto, modificar a representação das datas para o formato esperado, isto é, \texttt{DD/MM/YYYY}.

Para formatar uma data, utilizamos a função \texttt{format}. Seu uso baseia-se nos símbolos de data e de horário apresentados anteriormente. A partir desses, pode-se criar qualquer customização. Veja o exemplo a seguir, onde apresenta-se a modificação de um vetor de datas para o formato brasileiro:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create vector of dates}
\NormalTok{my\_dates }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}\NormalTok{),}
                \AttributeTok{to =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}15\textquotesingle{}}\NormalTok{),}
                \AttributeTok{by =} \StringTok{\textquotesingle{}1 day\textquotesingle{}}\NormalTok{)}

\CommentTok{\# change format}
\NormalTok{my\_dates\_br }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(my\_dates, }\StringTok{\textquotesingle{}\%d/\%m/\%Y\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_dates\_br)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "01/01/2021" "02/01/2021" "03/01/2021" "04/01/2021"
R>  [5] "05/01/2021" "06/01/2021" "07/01/2021" "08/01/2021"
R>  [9] "09/01/2021" "10/01/2021" "11/01/2021" "12/01/2021"
R> [13] "13/01/2021" "14/01/2021" "15/01/2021"
\end{verbatim}

O mesmo procedimento pode ser realizado para objetos do tipo data/tempo (\texttt{POSIXct}):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create vector of date{-}time}
\NormalTok{my\_datetime }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 12:00:00\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{560}\NormalTok{,}\DecValTok{60}\NormalTok{)}

\CommentTok{\# change to Brazilian format}
\NormalTok{my\_dates\_br }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(my\_datetime, }\StringTok{\textquotesingle{}\%d/\%m/\%Y \%H:\%M:\%S\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_dates\_br)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "01/01/2021 12:00:00" "01/01/2021 12:01:00"
R>  [3] "01/01/2021 12:02:00" "01/01/2021 12:03:00"
R>  [5] "01/01/2021 12:04:00" "01/01/2021 12:05:00"
R>  [7] "01/01/2021 12:06:00" "01/01/2021 12:07:00"
R>  [9] "01/01/2021 12:08:00" "01/01/2021 12:09:00"
\end{verbatim}

Pode-se também customizar para formatos bem específicos. Veja a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set custom format}
\NormalTok{my\_dates\_custom }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(my\_dates,}
                          \StringTok{\textquotesingle{}Year=\%Y | Month=\%m | Day=\%d\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_dates\_custom)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Year=2021 | Month=01 | Day=01"
R>  [2] "Year=2021 | Month=01 | Day=02"
R>  [3] "Year=2021 | Month=01 | Day=03"
R>  [4] "Year=2021 | Month=01 | Day=04"
R>  [5] "Year=2021 | Month=01 | Day=05"
R>  [6] "Year=2021 | Month=01 | Day=06"
R>  [7] "Year=2021 | Month=01 | Day=07"
R>  [8] "Year=2021 | Month=01 | Day=08"
R>  [9] "Year=2021 | Month=01 | Day=09"
R> [10] "Year=2021 | Month=01 | Day=10"
R> [11] "Year=2021 | Month=01 | Day=11"
R> [12] "Year=2021 | Month=01 | Day=12"
R> [13] "Year=2021 | Month=01 | Day=13"
R> [14] "Year=2021 | Month=01 | Day=14"
R> [15] "Year=2021 | Month=01 | Day=15"
\end{verbatim}

\hypertarget{extraindo-elementos-de-uma-data}{%
\subsection{Extraindo Elementos de uma Data}\label{extraindo-elementos-de-uma-data}}

Para extrair elementos de datas tal como o ano, mês, dia, hora, minuto e segundo, uma alternativa é utilizar função \texttt{format}. Observe o próximo exemplo, onde recuperamos apenas as horas de um objeto \texttt{POSIXct}: \index{base!format}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# create vector of date{-}time}
\NormalTok{my\_datetime }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 12:00:00\textquotesingle{}}\NormalTok{),}
                   \AttributeTok{to =} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 18:00:00\textquotesingle{}}\NormalTok{),}
                   \AttributeTok{by =} \StringTok{\textquotesingle{}1 hour\textquotesingle{}}\NormalTok{)}

\CommentTok{\# get hours from POSIXlt}
\NormalTok{my\_hours }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{format}\NormalTok{(my\_datetime, }\StringTok{\textquotesingle{}\%H\textquotesingle{}}\NormalTok{))}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_hours)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 12 13 14 15 16 17 18
\end{verbatim}

Da mesma forma, poderíamos utilizar os símbolos \texttt{\%M} e \texttt{\%S} para recuperar facilmente minutos e segundos de um vetor de objetos \texttt{POSIXct}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create vector of date{-}time}
\NormalTok{my\_datetime }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 12:00:00\textquotesingle{}}\NormalTok{),}
                   \AttributeTok{to =} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 18:00:00\textquotesingle{}}\NormalTok{),}
                   \AttributeTok{by =} \StringTok{\textquotesingle{}15 min\textquotesingle{}}\NormalTok{)}

\CommentTok{\# get minutes from POSIXlt}
\NormalTok{my\_minutes }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{format}\NormalTok{(my\_datetime, }\StringTok{\textquotesingle{}\%M\textquotesingle{}}\NormalTok{))}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_minutes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0 15 30 45  0 15 30 45  0 15 30 45  0 15 30 45  0 15
R> [19] 30 45  0 15 30 45  0
\end{verbatim}

Outra forma é utilizar as funções do \texttt{lubridate}, tal como \texttt{hour} e \texttt{minute}: \index{lubridate!hour}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get hours with lubridate}
\FunctionTok{print}\NormalTok{(}\FunctionTok{hour}\NormalTok{(my\_datetime))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 12 12 12 12 13 13 13 13 14 14 14 14 15 15 15 15 16 16
R> [19] 16 16 17 17 17 17 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get minutes with lubridate}
\FunctionTok{print}\NormalTok{(}\FunctionTok{minute}\NormalTok{(my\_datetime))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0 15 30 45  0 15 30 45  0 15 30 45  0 15 30 45  0 15
R> [19] 30 45  0 15 30 45  0
\end{verbatim}

Outras funções também estão disponíveis para os demais elementos de um objeto data-hora.

\hypertarget{conhecendo-o-horuxe1rio-e-a-data-atual}{%
\subsection{Conhecendo o Horário e a Data Atual}\label{conhecendo-o-horuxe1rio-e-a-data-atual}}

O R inclui várias funções que permitem o usuário utilizar no seu código o horário e data atual do sistema. Isso é bastante útil quando se está criando registros e é importante que a data e horário de execução do código seja conhecida futuramente.

Para conhecer o dia atual, basta utilizarmos a função \texttt{base::Sys.Date} ou \texttt{lubridate::today}: \index{base!Sys.Date} \index{lubridate!today}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lubridate)}

\CommentTok{\# get today}
\FunctionTok{print}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2022-11-23"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(}\FunctionTok{today}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2022-11-23"
\end{verbatim}

Para descobrir a data e horário, utilizamos a função \texttt{base::Sys.time} ou \texttt{lubridate::now}: \index{base!Sys.time} \index{lubridate!now}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get time!}
\FunctionTok{print}\NormalTok{(}\FunctionTok{Sys.time}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2022-11-23 10:57:03 -03"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get time!}
\FunctionTok{print}\NormalTok{(}\FunctionTok{now}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2022-11-23 10:57:03 -03"
\end{verbatim}

Com base nessas, podemos escrever:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\CommentTok{\# example of log message}
\NormalTok{my\_str }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(}\StringTok{\textquotesingle{}This code was executed in \textquotesingle{}}\NormalTok{, }\FunctionTok{now}\NormalTok{())}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_str)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "This code was executed in 2022-11-23 10:57:03"
\end{verbatim}

\hypertarget{outras-funuxe7uxf5es-uxfateis-5}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-5}}

\textbf{weekdays} - Retorna o dia da semana de uma ou várias datas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set date vector}
\NormalTok{my\_dates }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}\NormalTok{),}
                \AttributeTok{to =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}5\textquotesingle{}}\NormalTok{),}
                \AttributeTok{by =} \StringTok{\textquotesingle{}1 day\textquotesingle{}}\NormalTok{)}

\CommentTok{\# find corresponding weekdays}
\NormalTok{my\_weekdays }\OtherTok{\textless{}{-}} \FunctionTok{weekdays}\NormalTok{(my\_dates)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_weekdays)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Friday"   "Saturday" "Sunday"   "Monday"   "Tuesday"
\end{verbatim}

\textbf{months} - Retorna o mês de uma ou várias datas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create date vector}
\NormalTok{my\_dates }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}\NormalTok{),}
                \AttributeTok{to =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}12{-}31\textquotesingle{}}\NormalTok{),}
                \AttributeTok{by =} \StringTok{\textquotesingle{}1 month\textquotesingle{}}\NormalTok{)}

\CommentTok{\# find months}
\NormalTok{my\_months }\OtherTok{\textless{}{-}} \FunctionTok{months}\NormalTok{(my\_dates)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_months)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "January"   "February"  "March"     "April"    
R>  [5] "May"       "June"      "July"      "August"   
R>  [9] "September" "October"   "November"  "December"
\end{verbatim}

\textbf{quarters} - Retorna a localização de uma ou mais datas dentro dos quartis do ano.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get quartiles of the year}
\NormalTok{my\_quarters }\OtherTok{\textless{}{-}} \FunctionTok{quarters}\NormalTok{(my\_dates)}
\FunctionTok{print}\NormalTok{(my\_quarters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Q1" "Q1" "Q1" "Q2" "Q2" "Q2" "Q3" "Q3" "Q3" "Q4" "Q4"
R> [12] "Q4"
\end{verbatim}

\textbf{OlsonNames} - Retorna um vetor com as zonas de tempo disponíveis no R. No total, são mais de 500 itens. Aqui, apresentamos apenas os primeiros cinco elementos.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get possible timezones}
\NormalTok{possible\_tz }\OtherTok{\textless{}{-}} \FunctionTok{OlsonNames}\NormalTok{()}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(possible\_tz[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Africa/Abidjan"     "Africa/Accra"      
R> [3] "Africa/Addis_Ababa" "Africa/Algiers"    
R> [5] "Africa/Asmara"
\end{verbatim}

\textbf{Sys.timezone} - Retorna a zona de tempo do sistema.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get current timezone}
\FunctionTok{print}\NormalTok{(}\FunctionTok{Sys.timezone}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "America/Sao_Paulo"
\end{verbatim}

\textbf{cut} - Retorna um fator a partir da categorização de uma classe de data e tempo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set example date vector}
\NormalTok{my\_dates }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01\textquotesingle{}}\NormalTok{),}
                \AttributeTok{to =} \FunctionTok{ymd}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}03{-}01\textquotesingle{}}\NormalTok{),}
                \AttributeTok{by =} \StringTok{\textquotesingle{}5 days\textquotesingle{}}\NormalTok{)}

\CommentTok{\# group vector based on monthly breaks}
\NormalTok{my\_month\_cut }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_dates,}
                    \AttributeTok{breaks =} \StringTok{\textquotesingle{}month\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_month\_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 2021-01-01 2021-01-01 2021-01-01 2021-01-01 2021-01-01
R>  [6] 2021-01-01 2021-01-01 2021-02-01 2021-02-01 2021-02-01
R> [11] 2021-02-01 2021-02-01
R> Levels: 2021-01-01 2021-02-01
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set example datetime vector}
\NormalTok{my\_datetime }\OtherTok{\textless{}{-}} \FunctionTok{as.POSIXlt}\NormalTok{(}\StringTok{\textquotesingle{}2021{-}01{-}01 12:00:00\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{250}\NormalTok{,}\DecValTok{15}\NormalTok{)}

\CommentTok{\# set groups for each 30 seconds}
\NormalTok{my\_cut }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_datetime, }\AttributeTok{breaks =} \StringTok{\textquotesingle{}30 secs\textquotesingle{}}\NormalTok{)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 2021-01-01 12:00:00 2021-01-01 12:00:00
R>  [3] 2021-01-01 12:00:30 2021-01-01 12:00:30
R>  [5] 2021-01-01 12:01:00 2021-01-01 12:01:00
R>  [7] 2021-01-01 12:01:30 2021-01-01 12:01:30
R>  [9] 2021-01-01 12:02:00 2021-01-01 12:02:00
R> [11] 2021-01-01 12:02:30 2021-01-01 12:02:30
R> [13] 2021-01-01 12:03:00 2021-01-01 12:03:00
R> [15] 2021-01-01 12:03:30 2021-01-01 12:03:30
R> [17] 2021-01-01 12:04:00
R> 9 Levels: 2021-01-01 12:00:00 ... 2021-01-01 12:04:00
\end{verbatim}

\hypertarget{dados-omissos---na-not-available}{%
\section{\texorpdfstring{Dados Omissos - \texttt{NA} (\emph{Not available})}{Dados Omissos - NA (Not available)}}\label{dados-omissos---na-not-available}}

Uma das principais inovações do R em relação a outras linguagens de programação é a representação de dados omissos através de objetos da classe \texttt{NA} (\emph{Not Available}). A falta de dados pode ter inúmeros motivos, tal como a falha na coleta de informações ou simplesmente a não existência dos mesmos. Esses casos são tratados por meio da remoção ou da substituição dos dados omissos antes realizar uma análise mais profunda. A identificação desses casos, portanto, é de extrema importância.

\hypertarget{definindo-valores-na}{%
\subsection{\texorpdfstring{Definindo Valores \texttt{NA}}{Definindo Valores NA}}\label{definindo-valores-na}}

Para definirmos os casos omissos nos dados, basta utilizar o símbolo \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# a vector with NA}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  1  2 NA  4  5
\end{verbatim}

Vale destacar que a operação de qualquer valor \texttt{NA} com outro sempre resultará em \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# example of NA interacting with other objects}
\FunctionTok{print}\NormalTok{(my\_x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2  3 NA  5  6
\end{verbatim}

Isso exige cuidado quando se está utilizando alguma função com cálculo recursivo, tal como \texttt{cumsum} e \texttt{cumprod}. Nesses casos, todo valor consecutivo ao \texttt{NA} será transformado em \texttt{NA}. Veja os exemplos a seguir com as duas funções:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector with NA}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{5}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{\# print cumsum (NA after sixth element)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{cumsum}\NormalTok{(my\_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  1  3  6 10 15 NA NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# print cumprod (NA after sixth element)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{cumprod}\NormalTok{(my\_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]   1   2   6  24 120  NA  NA  NA  NA  NA  NA  NA
\end{verbatim}

\begin{rmdcaution}
Toda vez que utilizar as funções \texttt{cumsum} e \texttt{cumprod},
certifique-se de que não existe algum valor \texttt{NA} no vetor de
entrada. Lembre-se de que todo \texttt{NA} é contagiante e o cálculo
recursivo irá resultar em um vetor repleto de dados faltantes.
\end{rmdcaution}

\hypertarget{encontrando-e-substituindo-valores-na}{%
\subsection{\texorpdfstring{Encontrando e Substituindo Valores \texttt{NA}}{Encontrando e Substituindo Valores NA}}\label{encontrando-e-substituindo-valores-na}}

Para encontrar os valores \texttt{NA} em um vetor, basta utilizar a função \texttt{is.na}: \index{base!is.na}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector with NA}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{4}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{\# find location of NA}
\NormalTok{idx\_na }\OtherTok{\textless{}{-}} \FunctionTok{is.na}\NormalTok{(my\_x)}
\FunctionTok{print}\NormalTok{(idx\_na)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
R> [10] FALSE
\end{verbatim}

Para substituí-los, use indexação com a saída de \texttt{is.na}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{my\_x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{3}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\ConstantTok{NA}\NormalTok{)}

\CommentTok{\# replace NA for 2}
\NormalTok{my\_x[}\FunctionTok{is.na}\NormalTok{(my\_x)] }\OtherTok{\textless{}{-}} \DecValTok{2}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 4 2
\end{verbatim}

Outra maneira de limpar o objeto é utilizar a função \texttt{na.omit}, que retorna o mesmo objeto mas sem os valores \texttt{NA}. Note, porém, que o tamanho do vetor irá mudar e o objeto será da classe \texttt{omit}, o que indica que o vetor resultante não inclui os \texttt{NA} e apresenta, também, a posição dos elementos \texttt{NA} encontrados. \index{base!na.omit}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# set vector}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(letters[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], }\ConstantTok{NA}\NormalTok{, letters[}\DecValTok{5}\SpecialCharTok{:}\DecValTok{8}\NormalTok{])}

\CommentTok{\# print it}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c" NA  "e" "f" "g" "h"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# use na.omit to remove NA}
\NormalTok{my\_char }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(my\_char)}

\CommentTok{\# print result}
\FunctionTok{print}\NormalTok{(my\_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c" "e" "f" "g" "h"
R> attr(,"na.action")
R> [1] 4
R> attr(,"class")
R> [1] "omit"
\end{verbatim}

Apesar de o tipo de objeto ter sido trocado, devido ao uso de \texttt{na.omit}, as propriedades básicas do vetor inicial se mantêm. Por exemplo: o uso de \texttt{nchar} no objeto resultante é possível.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# trying nchar on a na.omit object}
\FunctionTok{print}\NormalTok{(}\FunctionTok{nchar}\NormalTok{(my\_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 1 1 1 1 1 1
\end{verbatim}

Para outros objetos, porém, recomenda-se cautela quando no uso da função \texttt{na.omit}.

\hypertarget{outras-funuxe7uxf5es-uxfateis-6}{%
\subsection{Outras Funções Úteis}\label{outras-funuxe7uxf5es-uxfateis-6}}

\textbf{complete.cases} - Retorna um vetor lógico que indica se as linhas do objeto possuem apenas valores não omissos. Essa função é usada exclusivamente para \texttt{dataframes} e matrizes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create matrix}
\NormalTok{my\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{5}\NormalTok{)}

\CommentTok{\# set an NA value}
\NormalTok{my\_mat[}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\CommentTok{\# print index with rows without NA}
\FunctionTok{print}\NormalTok{(}\FunctionTok{complete.cases}\NormalTok{(my\_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  TRUE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\hypertarget{exerc-classes-basicas}{%
\section{Exercícios}\label{exerc-classes-basicas}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Considere os seguintes os vetores x e y:

\begin{verbatim}
set.seed(7)
x <- sample (1:3, size = 5, replace = T)
y <- sample (1:3, size = 5, replace = T)
\end{verbatim}

Qual é a soma dos elementos de um novo vetor resultante da multiplicação entre os elementos de \texttt{x} e \texttt{y}?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  41
\item
  34
\item
  55
\item
  48
\item
  31
\end{enumerate}

02 -
Caso realizássemos uma soma cumulativa de uma sequência entre 1 e 100, em qual elemento esta soma iria passar de 50?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  5
\item
  3
\item
  1
\item
  7
\item
  10
\end{enumerate}

03 -
Utilizando o R, crie uma sequência em objeto chamado \texttt{seq\_1} entre -15 e 10, onde o intervalo entre valores é sempre igual a 2. Qual o valor da soma dos elementos de \texttt{seq\_1}?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  -15
\item
  -6
\item
  -39
\item
  -31
\item
  -23
\end{enumerate}

04 -
Defina outro objeto chamado \texttt{seq\_2} contendo uma sequência de tamanho 1000, com valores entre 0 e 100. Qual é o desvio padrão (função \texttt{sd}) dessa sequência?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  28.91
\item
  19.58
\item
  12.45
\item
  38.46
\item
  67.37
\end{enumerate}

05 -
Calcule a soma entre vetores \texttt{seq\_1} e \texttt{seq\_2} (veja exercício anterior). Esta operação funcionou apesar do tamanho diferente dos vetores? Explique sua resposta. Caso funcionar, qual o maior valor do vetor resultante?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  148.2
\item
  169.3
\item
  127.1
\item
  109.0
\item
  190.4
\end{enumerate}

06 -
Vamos supor que, em certa data, você comprou 100 ações de uma empresa, a \texttt{price\_purchase} reais por ação. Depois de algum tempo, você vendeu 30 ações por 18 reais cada e as 70 ações restantes foram vendidas por 22 reais em um dia posterior. Usando um \emph{script} em R, estruture este problema financeiro criando objetos numéricos. Qual é o lucro bruto desta transação no mercado de ações?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  R\$922
\item
  R\$1.037
\item
  R\$692
\item
  R\$807
\item
  R\$580
\end{enumerate}

07 -
Crie um vetor x de acordo com a fórmula a seguir, onde \(i=1...100\). Qual é o valor da soma dos elementos de x?

\[
x_i=\frac{-1^{i+1}}{2i-1}
\]

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0.7829
\item
  2.2385
\item
  0.3014
\item
  0.5253
\item
  1.4556
\end{enumerate}

08 -
Crie um vetor \(z_i\) de acordo com a fórmula a seguir onde \(x_i=1...50\) e \(y_i=50...1\). Qual é o valor da soma dos elementos de \(z_i\)? Dica: veja o funcionamento da função \texttt{dplyr::lag}.

\[
z_i=\frac{y_i - x_{i-1}}{y_{i-2}}
\]

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  -27.78
\item
  -65.96
\item
  -82.23
\item
  -44.80
\item
  -148.19
\end{enumerate}

09 -
Usando uma semente de valor 11 em \texttt{set.seed()}, crie um objeto chamado \texttt{x} com valores aleatórios da distribuição Normal com média igual a 10 e desvio padrão igual a 10. Usando função \texttt{cut}, crie outro objeto que defina dois grupos com base em valores de \texttt{x} maiores que 15 e menores que 15. Qual a quantidade de observações no primeiro grupo?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  504
\item
  92
\item
  688
\item
  229
\item
  367
\end{enumerate}

10 -
Crie o seguinte objeto com o código a seguir:

\begin{verbatim}
set.seed(15)
my_char <- paste(sample(letters, 5000, replace = T), 
                 collapse = '')
\end{verbatim}

Qual a quantidade de vezes que a letra \texttt{\textquotesingle{}x\textquotesingle{}} é encontrada no objeto de texto resultante?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  297
\item
  264
\item
  198
\item
  174
\item
  231
\end{enumerate}

11 -
Baseado no objeto \texttt{my\_char} criado anteriormente, caso dividíssemos o mesmo em diversos pedaços menores utilizando a letra \texttt{"b"}, qual é o número de caracteres no \textbf{maior} pedaço encontrado?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  188
\item
  125
\item
  167
\item
  146
\item
  110
\end{enumerate}

12 -
No endereço \url{https://www.gutenberg.org/files/1342/1342-0.txt} é possível acessar um arquivo .txt contendo o texto integral do livro \emph{Pride and Prejudice} de Jane Austen. Utilize funções \texttt{download.file} e \texttt{readr::read\_lines} para importar o livro inteiro como um vetor de caracteres chamado \texttt{my\_book} no R. Quantas linhas o objeto resultante possui?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  5029
\item
  3675
\item
  8704
\item
  2537
\item
  1698
\end{enumerate}

13 -
Junte o vetor de caracteres em \texttt{my\_book} para um único valor (texto) em outro objeto chamado \texttt{full\_text} usando função \texttt{paste0(my\_book,\ collapse\ =\ \textquotesingle{}\textbackslash{}n\textquotesingle{})}. Utilizando este último e pacote \texttt{stringr}, quantas vezes a palavra \texttt{\textquotesingle{}King\textquotesingle{}} é repetida na totalidade do texto?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  55
\item
  93
\item
  70
\item
  30
\item
  163
\end{enumerate}

14 -
Para o objeto \texttt{full\_text} criado anteriormente, utilize função \texttt{stringr::str\_split} para \emph{quebrar} o texto inteiro em função de espaços em branco. Com base nesse, crie uma tabela de frequência. Qual a palavra mais utilizada no texto? Dica: Remova todos os casos de caracteres vazios (\texttt{\textquotesingle{}\textquotesingle{}}).

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  and
\item
  to
\item
  you
\item
  my
\item
  the
\end{enumerate}

15 -
Assumindo que uma pessoa nascida em 2000-05-12 irás viver for 100 anos, qual é o número de dias de aniversário que cairão em um final de semana (sábado ou domingo)? Dica: use operador \texttt{\%in\%} para checar uma condição múltipla nos dados.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0
\item
  0
\item
  0
\item
  0
\item
  0
\end{enumerate}

16 -
Qual data e horário é localizado \ensuremath{10^{4}} \textbf{segundos} após 2021-02-02 11:50:02?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2021-02-02 12:44:52
\item
  2021-02-02 10:23:31
\item
  2021-02-02 10:29:10
\item
  2021-02-02 14:36:42
\item
  2021-02-02 10:48:06
\end{enumerate}

\hypertarget{programacao}{%
\chapter{Programando com o R}\label{programacao}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-funuxe7uxf5es}{%
\section{Criando Funções}\label{criando-funuxe7uxf5es}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{loops}{%
\section{\texorpdfstring{Utilizando Loops (comando \emph{for})}{Utilizando Loops (comando for)}}\label{loops}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{execuuxe7uxf5es-condicionais-if-else-switch}{%
\section{\texorpdfstring{Execuções Condicionais (\texttt{if}, \texttt{else}, \texttt{switch})}{Execuções Condicionais (if, else, switch)}}\label{execuuxe7uxf5es-condicionais-if-else-switch}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{utilizando-as-funuxe7uxf5es-da-famuxedlia-apply}{%
\section{\texorpdfstring{Utilizando as Funções da Família \texttt{apply}}{Utilizando as Funções da Família apply}}\label{utilizando-as-funuxe7uxf5es-da-famuxedlia-apply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-lapply}{%
\subsection{\texorpdfstring{Função \texttt{lapply}}{Função lapply}}\label{funuxe7uxe3o-lapply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-sapply}{%
\subsection{\texorpdfstring{Função \texttt{sapply}}{Função sapply}}\label{funuxe7uxe3o-sapply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-tapply}{%
\subsection{\texorpdfstring{Função \texttt{tapply}}{Função tapply}}\label{funuxe7uxe3o-tapply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-mapply}{%
\subsection{\texorpdfstring{Função \texttt{mapply}}{Função mapply}}\label{funuxe7uxe3o-mapply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-apply}{%
\subsection{\texorpdfstring{Função \texttt{apply}}{Função apply}}\label{funuxe7uxe3o-apply}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{utilizando-pacote-purrr}{%
\section{\texorpdfstring{Utilizando Pacote \texttt{purrr}}{Utilizando Pacote purrr}}\label{utilizando-pacote-purrr}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-purrrmap}{%
\subsection{\texorpdfstring{Função \texttt{purrr::map}}{Função purrr::map}}\label{funuxe7uxe3o-purrrmap}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-purrrsafely}{%
\subsection{\texorpdfstring{Função \texttt{purrr::safely}}{Função purrr::safely}}\label{funuxe7uxe3o-purrrsafely}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{funuxe7uxe3o-purrrpmap}{%
\subsection{\texorpdfstring{Função \texttt{purrr::pmap}}{Função purrr::pmap}}\label{funuxe7uxe3o-purrrpmap}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{manipulauxe7uxe3o-de-dados-com-dplyr}{%
\section{\texorpdfstring{Manipulação de Dados com \texttt{dplyr}}{Manipulação de Dados com dplyr}}\label{manipulauxe7uxe3o-de-dados-com-dplyr}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{operauxe7uxf5es-de-grupo-com-dplyr}{%
\subsection{\texorpdfstring{Operações de Grupo com \texttt{dplyr}}{Operações de Grupo com dplyr}}\label{operauxe7uxf5es-de-grupo-com-dplyr}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{operauxe7uxf5es-de-grupo-complexas-com-dplyr}{%
\subsection{\texorpdfstring{Operações de Grupo Complexas com \texttt{dplyr}}{Operações de Grupo Complexas com dplyr}}\label{operauxe7uxf5es-de-grupo-complexas-com-dplyr}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exerc-programacao}{%
\section{Exercícios}\label{exerc-programacao}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Crie uma função chamada \texttt{say\_my\_name} que tome como entrada um nome de pessoa e mostre na tela o texto \emph{Your name is \ldots{}}. Dentro do escopo da função, utilize comentários para descrever o propósito da função, suas entradas e saídas.

02 -
Implemente um teste para os objetos de entrada, de forma que, quando o nome de entrada não for da classe \texttt{character}, um erro é retornado ao usuário. Teste sua nova função e verifique se a mesma está funcionando conforme esperado.

03 -
Crie um vetor com cinco nomes quaisquer, chamado \texttt{my\_names}. Utilizando um \emph{loop}, aplique função \texttt{say\_my\_name} para cada elemento de \texttt{my\_names}.

04 -
No banco de dados do \href{https://data.brasil.io/dataset/genero-nomes/grupos.csv.gz}{Brasil.IO}\footnote{\url{https://data.brasil.io/dataset/genero-nomes/grupos.csv.gz}} encontrarás uma tabela com nomes e gêneros derivados de uma das pesquisas do IBGE. Importe os dados do arquivo para R e, usando um \emph{loop}, aplique a função \texttt{say\_my\_name} a 15 nomes aleatórios do banco de dados. Dica: neste caso, você pode baixar os dados direto do link usando \texttt{readr::read\_csv(LINK)}.

05 -
Refaça o exercício anterior utilizando comandos \texttt{sapply} ou \texttt{purrr::map}.

06 -
Use o pacote \texttt{BatchGetSymbols} para baixar dados do índice SP500 (\texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}), Ibovespa (\texttt{\textquotesingle{}\^{}BVSP\textquotesingle{}}), FTSE (\texttt{\textquotesingle{}\^{}FSTE\textquotesingle{}}) e Nikkei 225 (\texttt{\textquotesingle{}\^{}N225\textquotesingle{}}) de \texttt{\textquotesingle{}2010-01-01\textquotesingle{}} até a data atual. Com os dados importados, use um \emph{loop} para calcular o retorno médio, máximo e mínimo de cada índice durante o período analisado. Salve todos os resultados em uma tabela única e a mostre no \emph{prompt} do R.

07 -
Refaça o exercício anterior utilizando as funções \texttt{group\_by} e \texttt{summarise}, ambas do pacote \texttt{dplyr}.

08 -
No site do \href{http://cran-logs.rstudio.com/}{Rstudio CRAN logs}\footnote{\url{http://cran-logs.rstudio.com/}} você encontrará dados sobre as estatísticas de download para a distribuição de base de R na seção \emph{Daily R downloads}. Usando suas habilidades de programação, importe todos os dados disponíveis entre 2020-01-01 e 2020-01-15 e agregue-os em uma única tabela. Qual país apresenta a maior contagem de downloads do R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  HU
\item
  JM
\item
  MD
\item
  CR
\item
  US
\end{enumerate}

\hypertarget{limpando-estruturando}{%
\chapter{Estruturando e Limpando Dados}\label{limpando-estruturando}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{o-formato-do-dataframe}{%
\section{\texorpdfstring{O Formato do \texttt{dataframe}}{O Formato do dataframe}}\label{o-formato-do-dataframe}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{conversuxe3o-entre-long-e-wide}{%
\subsection{\texorpdfstring{Conversão entre \emph{long} e \emph{wide}}{Conversão entre long e wide}}\label{conversuxe3o-entre-long-e-wide}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{convertendo-listas-em-dataframes}{%
\section{\texorpdfstring{Convertendo Listas em \texttt{dataframes}}{Convertendo Listas em dataframes}}\label{convertendo-listas-em-dataframes}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{fct-replace}{%
\section{Eliminando Outliers}\label{fct-replace}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{desinflacionando-dados-de-preuxe7os}{%
\section{Desinflacionando Dados de Preços}\label{desinflacionando-dados-de-preuxe7os}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modificando-a-frequuxeancia-temporal-dos-dados}{%
\section{Modificando a Frequência Temporal dos Dados}\label{modificando-a-frequuxeancia-temporal-dos-dados}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exerc-limpando-estruturando}{%
\section{Exercícios}\label{exerc-limpando-estruturando}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Considere o \texttt{dataframe} criado com o código a seguir:

\begin{verbatim}
library(tidyverse)

my_N <- 100

df <- bind_rows(tibble(ticker = rep('STOCK 1', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))),
                tibble(ticker = rep('STOCK 2', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))) )

print(df)
\end{verbatim}

O formato do \texttt{dataframe} é longo ou largo? Explique sua resposta.

02 -
Modifique o formato do \texttt{dataframe} anterior, de longo para largo ou vice-versa.

\begin{verbatim}
library(tidyverse)

my_N <- 100

df <- bind_rows(tibble(ticker = rep('STOCK 1', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))),
                tibble(ticker = rep('STOCK 2', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))) )

print(df)
\end{verbatim}

03 -
Considere a seguinte lista:

\begin{verbatim}
library(tidyverse)

my_l <- list(df1 = tibble(x = 1:100, y = runif(100)),
             df2 = tibble(x = 1:100, y = runif(100), v = runif(100)),
             df3 = tibble(x = 1:100, y = runif(100), z = runif(100)) )
\end{verbatim}

Agrege todos \texttt{dataframes} em \texttt{my\_l} para um objeto único usando funções \texttt{do.call} ou \texttt{dplyr::bind\_rows}. O que aconteceu com os dados de \texttt{df1} onde colunas \texttt{v} e \texttt{z} não existem?

04 -
Utilize pacote \texttt{BatchGetSymbols} para baixar os dados do índice SP500 (\texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}) desde 1950-01-01 até 2021-01-01. Quais é a soma dos 5 maiores retornos positivos do índice?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0.5834
\item
  0.7691
\item
  0.5014
\item
  0.6763
\item
  0.8620
\end{enumerate}

05 -
Use função \texttt{replace\_outliers} (veja seção \ref{fct-replace}), criada neste capítulo, para remover \emph{outliers} de todas as colunas numéricas dos dados do SP500 importados anteriormente com \texttt{my\_prob\ =\ 0.025}. Quantas linhas foram perdidas neste processo de limpeza?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  5574
\item
  4101
\item
  7281
\item
  2627
\item
  1154
\end{enumerate}

06 -
Use a função \texttt{BatchGetSymbols::BatchGetSymbols} para baixar os preços do índice FTSE (\texttt{\textquotesingle{}\^{}FTSE\textquotesingle{}}) de 2010-01-01 até 2021-01-01. Em seguida, reconstrua os dados na frequência anual, definindo cada valor do ano como sendo a última observação do período. Dica: veja a função \texttt{dplyr::summary\_all} para uma forma funcional de agregar todas as colunas de um \texttt{dataframe}.

07 -
Use os mesmos dados diários do FTSE e reconstrua os dados na frequência mensal, novamente utilizando a última observação do período.

08 -
Para os mesmos dados diários do FTSE, verifique as datas e preços das 20 maiores quedas de preços. Se, para cada um desses casos, um investidor comprasse o índice no preço das maiores quedas e o mantivesse por 30 dias, qual seria seu retorno nominal médio por transação?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2,53\%
\item
  3,85\%
\item
  2,82\%
\item
  3,34\%
\item
  4,37\%
\end{enumerate}

\hypertarget{figuras}{%
\chapter{Visualizando Dados}\label{figuras}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-janelas-de-gruxe1ficos-com-x11}{%
\section{\texorpdfstring{Criando Janelas de Gráficos com \texttt{x11}}{Criando Janelas de Gráficos com x11}}\label{criando-janelas-de-gruxe1ficos-com-x11}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-figuras-com-qplot}{%
\section{\texorpdfstring{Criando Figuras com \texttt{qplot}}{Criando Figuras com qplot}}\label{criando-figuras-com-qplot}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-figuras-com-ggplot}{%
\section{\texorpdfstring{Criando Figuras com \texttt{ggplot}}{Criando Figuras com ggplot}}\label{criando-figuras-com-ggplot}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{a-curva-de-juros-brasileira}{%
\subsection{A Curva de Juros Brasileira}\label{a-curva-de-juros-brasileira}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{usando-temas}{%
\subsection{Usando Temas}\label{usando-temas}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{facets}{%
\subsection{\texorpdfstring{Criando Painéis com \texttt{facet\_wrap}}{Criando Painéis com facet\_wrap}}\label{facets}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{uso-do-operador-pipeline}{%
\section{\texorpdfstring{Uso do Operador \emph{pipeline}}{Uso do Operador pipeline}}\label{uso-do-operador-pipeline}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-figuras-estatuxedsticas}{%
\section{Criando Figuras Estatísticas}\label{criando-figuras-estatuxedsticas}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-histogramas}{%
\subsection{Criando Histogramas}\label{criando-histogramas}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-figuras-boxplot}{%
\subsection{\texorpdfstring{Criando Figuras \emph{Boxplot}}{Criando Figuras Boxplot}}\label{criando-figuras-boxplot}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-figuras-qq}{%
\subsection{\texorpdfstring{Criando Figuras \emph{QQ}}{Criando Figuras QQ}}\label{criando-figuras-qq}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{salvando-figuras-para-arquivos}{%
\section{Salvando Figuras para Arquivos}\label{salvando-figuras-para-arquivos}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exerc-figuras}{%
\section{Exercícios}\label{exerc-figuras}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Baixe dados da ação CIEL3 com o pacote \texttt{BatchGetSymbols} para os últimos 500 dias. Apresente o gŕafico de linha do preço ajustado ao longo do tempo utilizando função \texttt{ggplot2::ggplot}. Tenha certeza que:

\begin{itemize}
\tightlist
\item
  Eixos x e y estão corretamente nomeados
\item
  O gráfico tem um título (``Preços para CIEL3''), subtítulo (``Dados de YYYY-MM-DD até YYYY-MM-DD'') e um \emph{caption} (``Solução para exercício 01, cap 10 - adfeR'').
\end{itemize}

02 -
Baixe dados das ações PETR3 (PETR3.SA), VALE3 (VALE3.SA), GGBR4 (GGBR4.SA) com \texttt{BatchGetSymbols} para os últimos 1500 dias. Apresente, no mesmo gráfico, os preços das ações com diferentes cores de linhas. Mantenha todos demais aspectos do gráfico anterior.

03 -
Para o gráfico anterior, adicione pontos nas linhas.

04 -
Para o mesmo gráfico, separe os preços das ações em painéis diferentes com a função \texttt{ggplot::facet\_wrap}. Use argumento \texttt{scales\ =\ \textquotesingle{}free\textquotesingle{}} para ``soltar'' os eixos de cada figura.

05 -
Modifique o tema do gráfico anterior para uma escala em preto e branco, tanto para a área do gráfico quanto para as cores das linhas.

06 -
Para os dados anteriores, apresente o histograma dos retornos das diferentes ações em painéis diferentes e salve o resultado em um arquivo chamado \texttt{\textquotesingle{}histograms.png\textquotesingle{}}.

07 -
Use a função \texttt{BatchGetSymbols::GetIbovStocks} para descobrir todos os tickers pertencentes ao índice Ibovespa atualmente. Usando \texttt{BatchGetSymbols}, baixe os dados de retorno anual para todas as ações do índice de 2015 até o dia atual. Depois disso, crie o mapa de média/variância plotando o retorno anual médio em relação ao seu desvio padrão. Dica: Use a opção paralela em \texttt{BatchGetSymbols} para acelerar a execução. Você encontrará muitos retornos discrepantes nos dados brutos. Certifique-se de que o gráfico esteja visível limitando os eixos x e y (consulte as funções \texttt{ggplot2::xlim} e\texttt{ggplot2::ylim}).

\hypertarget{modelos}{%
\chapter{Econometria Financeira com o R}\label{modelos}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modelos-lineares-ols}{%
\section{Modelos Lineares (OLS)}\label{modelos-lineares-ols}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-um-modelo-linear}{%
\subsection{Simulando um Modelo Linear}\label{simulando-um-modelo-linear}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estimating-ols}{%
\subsection{Estimando um Modelo Linear}\label{estimating-ols}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{testing-ols}{%
\subsection{Inferência Estatística em Modelos Lineares}\label{testing-ols}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modelos-lineares-generalizados-glm}{%
\section{Modelos Lineares Generalizados (GLM)}\label{modelos-lineares-generalizados-glm}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-um-modelo-glm}{%
\subsection{Simulando um Modelo GLM}\label{simulando-um-modelo-glm}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estimando-um-modelo-glm}{%
\subsection{Estimando um Modelo GLM}\label{estimando-um-modelo-glm}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modelos-para-dados-em-painel}{%
\section{Modelos para Dados em Painel}\label{modelos-para-dados-em-painel}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-dados-em-painel}{%
\subsection{Simulando Dados em Painel}\label{simulando-dados-em-painel}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estimando-modelos-de-dados-em-painel}{%
\subsection{Estimando Modelos de Dados em Painel}\label{estimando-modelos-de-dados-em-painel}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modelos-arima}{%
\section{Modelos ARIMA}\label{modelos-arima}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-modelos-arima}{%
\subsection{Simulando Modelos ARIMA}\label{simulando-modelos-arima}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{arima-estimating}{%
\subsection{Estimando Modelos ARIMA}\label{arima-estimating}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{prevendo-modelos-arima}{%
\subsection{Prevendo Modelos ARIMA}\label{prevendo-modelos-arima}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{modelos-garch}{%
\section{Modelos GARCH}\label{modelos-garch}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-modelos-garch}{%
\subsection{Simulando Modelos GARCH}\label{simulando-modelos-garch}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estimating-garch}{%
\subsection{Estimando Modelos GARCH}\label{estimating-garch}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{prevendo-modelos-garch}{%
\subsection{Prevendo Modelos GARCH}\label{prevendo-modelos-garch}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{mudanca-regime}{%
\section{Modelos de Mudança de Regime}\label{mudanca-regime}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{simulando-modelos-de-mudanuxe7a-de-regime}{%
\subsection{Simulando Modelos de Mudança de Regime}\label{simulando-modelos-de-mudanuxe7a-de-regime}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estimando-modelos-de-mudanuxe7a-de-regime}{%
\subsection{Estimando Modelos de Mudança de Regime}\label{estimando-modelos-de-mudanuxe7a-de-regime}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{prevendo-modelos-de-mudanuxe7a-de-regime}{%
\subsection{Prevendo Modelos de Mudança de Regime}\label{prevendo-modelos-de-mudanuxe7a-de-regime}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{trabalhando-com-diversos-modelos}{%
\section{Trabalhando com Diversos Modelos}\label{trabalhando-com-diversos-modelos}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exerc-modelos}{%
\section{Exercícios}\label{exerc-modelos}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Simule o seguinte processo linear no R:

\begin{verbatim}
set.seed(5)

# number of obs
n_row <- 100

# set x as Normal (0, 1)
x <- rnorm(n_row)

# set coefficients
my_alpha <- 1.5
my_beta <- 0.5

# build y
y <- my_alpha + my_beta*x + rnorm(n_row)
\end{verbatim}

A partir de \texttt{x} e \texttt{y}, estime um modelo linear onde \texttt{x} é a variável explicativa e \texttt{y} é a variável explicada. Use função \texttt{summary} no objeto de retorno da estimação para obter mais detalhes sobre o modelo. Qual é o valor do beta estimado dos dados simulados?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0.4003
\item
  1.5038
\item
  0.8707
\item
  0.2910
\item
  0.6331
\end{enumerate}

02 -
Utilizando pacote \texttt{car}, teste a hipótese conjunta de que o valor de alpha é igual a 1.5 e beta igual a 0.5. Qual o valor do teste F resultante?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  10.727
\item
  16.967
\item
  7.799
\item
  40.301
\item
  23.335
\end{enumerate}

03 -
Utilize pacote \texttt{gvlma} para testar as premissas do OLS para o modelo estimado anteriormente. O modelo passa em todos os testes? Em caso negativo, aumente o valor de \texttt{n\_row} para 1000 e tente novamente. O aumento do número de observações do modelo impactou no teste das premissas? De que forma?

04 -
Utilize função \texttt{BatchGetSymbols::GetSP500Stocks} para baixar dados de todas ações pertencentes ao atual índice SP500 para os últimos três anos. Usando o SP500 como o índice de mercado, calcule o beta para cada uma das ações. Apresente o histograma dos \emph{betas} estimados. Note que os retornos do SP500 (\texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}) não estão disponíveis na base de dados original e devem ser baixados e agregados a base de dados original.

05 -
Para os dados importados anteriormente, estime uma versão em dados de painel para o modelo de mercado (beta). Nesta versão, cada ação possui um intercepto diferente, porém compartilham o mesmo beta. O beta estimado é significativo a 5\%?

06 -
Utilizando as funções do tidyverse, \texttt{dplyr::group\_by} e \texttt{dplyr::do}, estime um modelo ARIMA para os retornos de cada ação dos dados importados no exercício do SP500. No mesmo \texttt{dataframe} de saída, crie uma nova coluna com a previsão em \emph{t+1} de cada modelo. Qual ação possui maior expectativa de retorno para \emph{t+1}?

07 -
No mesmo código utilizado na questão anterior, adicione uma nova coluna-lista com a estimação de um modelo ARMA(1,0)-GARCH(1,1) para os retornos de cada ação. Adicione outra coluna com a previsão de volatilidade (desvio padrão) em \emph{t+1}. Ao dividir o retorno esperado calculado no item anterior pelo risco previsto, temos um índice de direção do mercado, onde aquelas ações com maior valor de índice apresentam maior retorno esperado por menor risco. Qual ação é mais atrativa e possui maior valor deste índice?

08 -
Para a mesma base de dados do SP500, selecione 4 ações aleatoriamente e estime um modelo de mudança de regime markoviano equivalente ao apresentado no item \ref{mudanca-regime} para cada ação. Utilize função \texttt{plot} para apresentar o gráfico das probabilidades suavizadas e salve cada figura em uma pasta chamada \texttt{\textquotesingle{}fig\textquotesingle{}}.

\hypertarget{reportando-resultados}{%
\chapter{Reportando Resultados e Criando Relatórios}\label{reportando-resultados}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{reportando-tabelas}{%
\section{Reportando Tabelas}\label{reportando-tabelas}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{reporting-models}{%
\section{Reportando Modelos}\label{reporting-models}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{criando-relatuxf3rios-com-o-rmarkdown}{%
\section{\texorpdfstring{Criando Relatórios com o \emph{RMarkdown}}{Criando Relatórios com o RMarkdown}}\label{criando-relatuxf3rios-com-o-rmarkdown}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exerc-reportando-resultados}{%
\section{Exercícios}\label{exerc-reportando-resultados}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Observe os dados disponíveis no arquivo \texttt{grunfeld.csv}. Importe os dados no R e monte uma tabela descritiva das variáveis. Essa tabela deve oferecer informações suficientes para o leitor entender os dados. Utilize pacote \texttt{xtable} para reportar a mesma no formato \emph{LaTeX} ou Word/Writer.

02 -
Utilizando função \texttt{BatchGetSymbols::GetSP500Stocks}, selecione 4 ações aleatoriamente e baixe os dados de preços ajustados para os últimos três anos. Estime um modelo ARIMA(1, 0, 1) para cada ação e reporte o resultado na tela do R com função \texttt{texreg::screenreg}.

03 -
Crie um novo relatório em \emph{Rmarkdown} contemplando os dois exercícios anteriores. Compile o relatório em html e abra o mesmo no seu \emph{browser}.

\hypertarget{otimizacao}{%
\chapter{Otimização de Código}\label{otimizacao}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{otimizando-cuxf3digo-em-r}{%
\section{Otimizando Código em R}\label{otimizando-cuxf3digo-em-r}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{otimizando-a-velocidade-de-execuuxe7uxe3o}{%
\section{Otimizando a Velocidade de Execução}\label{otimizando-a-velocidade-de-execuuxe7uxe3o}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{perfil-do-cuxf3digo-r-profiling}{%
\subsection{\texorpdfstring{Perfil do Código R (\emph{profiling})}{Perfil do Código R (profiling)}}\label{perfil-do-cuxf3digo-r-profiling}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{estratuxe9gias-para-melhorar-a-velocidade-de-execuuxe7uxe3o}{%
\subsection{Estratégias para Melhorar a Velocidade de Execução}\label{estratuxe9gias-para-melhorar-a-velocidade-de-execuuxe7uxe3o}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{use-operauxe7uxf5es-vetoriais}{%
\subsubsection{Use Operações Vetoriais}\label{use-operauxe7uxf5es-vetoriais}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{junuxe7uxe3o-repetitiva-de-dataframes}{%
\subsubsection{\texorpdfstring{Junção Repetitiva de \texttt{dataframes}}{Junção Repetitiva de dataframes}}\label{junuxe7uxe3o-repetitiva-de-dataframes}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{usando-cuxf3digo-c-pacote-rcpp}{%
\subsection{\texorpdfstring{Usando Código C ++ (pacote \texttt{Rcpp})}{Usando Código C ++ (pacote Rcpp)}}\label{usando-cuxf3digo-c-pacote-rcpp}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{usando-cacheamento-local-pacote-memoise}{%
\subsection{\texorpdfstring{Usando Cacheamento Local (pacote \texttt{memoise})}{Usando Cacheamento Local (pacote memoise)}}\label{usando-cacheamento-local-pacote-memoise}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{usando-processamento-paralelo-pacote-furrr}{%
\subsubsection{\texorpdfstring{Usando Processamento Paralelo (pacote \texttt{furrr})}{Usando Processamento Paralelo (pacote furrr)}}\label{usando-processamento-paralelo-pacote-furrr}}

\begin{pleasebuyit}
Você chegou ao fim da versão online do livro \textbf{Análise de Dados
Financeiros e Econômicos com o R}, terceira edição. O conteúdo integral
da obra pode ser adquirido na loja da Amazon como
\href{https://www.amazon.com.br/dp/B08WNC27ZY}{ebook} ou
\href{https://www.amazon.com/dp/B08WP8CCDB}{livro impresso}. A compra do
livro é uma ótima maneira de suportar este e outros projetos do autor.
\end{pleasebuyit}

\hypertarget{exercuxedcios-1}{%
\section{Exercícios}\label{exercuxedcios-1}}

Todas soluções de exercícios estão disponíveis em \url{https://www.msperlin.com/adfeR}.

01 -
Considere o seguinte código:

\begin{verbatim}
library(tidyverse)
library(forecast)
library(BatchGetSymbols)

ticker <- '^GSPC'
df_prices <- BatchGetSymbols(tickers = ticker, 
                             first.date = '2010-01-01')[[2]]

my_arima <- auto.arima(df_prices$ret.adjusted.prices)
summary(my_arima)
\end{verbatim}

Use funcões \texttt{Rprof} e \texttt{profvis} para identificar o gargalo do código. Qual número da linha que está tomando maior tempo de execução?

02 -
Use o pacote \texttt{Rcpp} para escrever e usar uma função em linguagem C++ que irá adicionar elementos dos vetores \texttt{x} e \texttt{y}, elemento por elemento. A saída deve ser outro vetor de mesmo tamanho e com elementos iguais a operação \texttt{x\ +\ y}. Use a função \texttt{identical} para testar se todos os elementos de ambos os vetores são iguais.

03 -
Use o pacote \texttt{tictoc} para comparar o desempenho da função anterior com o operador nativo \texttt{+}, e uma versão baseada em loops com pré-alocação. Qual alternativa apresenta menor tempo de execução e por quê? A versão \texttt{Rcpp} vence a versão em loop?

04 -
Use o pacote \texttt{memoise} para criar uma versão memorizada de \texttt{Quandl::Quandl}. Use a nova função para importar dados para o Índice de Preços ao Consumidor dos Estados Unidos (código \texttt{\textquotesingle{}FRED/DDOE01USA086NWDB\textquotesingle{}}). Quanto de ganho de velocidade em porcentagem você obtém da segunda chamada para a versão memorizada?

  \bibliography{00-text-resources/bib-files/book.bib,00-text-resources/bib-files/packages.bib,00-text-resources/bib-files/problematic.bib}

%\backmatter
\printindex

\end{document}
