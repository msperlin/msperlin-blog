% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  12pt,
]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Analyzing Financial and Economic Data with R - Online Edition},
  pdfauthor={Marcelo S. Perlin (marcelo.perlin@ufrgs.br)},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in, paperwidth=7in, paperheight=10in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.61,0.61,0.61}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.14,0.14,0.14}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.43,0.43,0.43}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{imakeidx}
\makeindex

\usepackage[Lenny]{fncychap}

% fix for fonts in verbatim
%\usepackage[warn]{textcomp}
%\usepackage{textcomp}

% for pdf latex
\usepackage[english]{babel}
%\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}


% Bera font
\usepackage{lmodern}

%\usepackage{bera}
%\renewcommand{\textasciigrave}{`}

%\usepackage{beraserif}

%\usepackage[pdfpagelabels,draft,implicit=false]{hyperref}

%\frontmatter
%\usepackage{fontspec}
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}
%\hypersetup{hidelinks=true}

%\frontmatter

\usepackage{awesomebox}


\newenvironment{rmdcaution}
{\begin{cautionblock}
		
	} {\end{cautionblock}}


\newenvironment{rmdimportant}
{\begin{importantblock}
		
	} {\end{importantblock}}


\newenvironment{pleasebuyit}
{\begin{noteblock}
		
	} {\end{noteblock}}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Analyzing Financial and Economic Data with R - Online Edition}
\author{Marcelo S. Perlin (\href{mailto:marcelo.perlin@ufrgs.br}{\nolinkurl{marcelo.perlin@ufrgs.br}})}
\date{2021-03-30}

\begin{document}
\maketitle

\thispagestyle{empty}

\begin{tabular}{@{}l }
  \textbf{Analyzing Financial and Economic Data with R}   \\
	{} \\
	by \textbf{Marcelo Scherer Perlin}
\end{tabular}

\vspace{0.75cm}

\begin{tabular}{@{}l }
  {\textcopyright} 2020 Marcelo S. Perlin. All rights reserved.
\end{tabular}

\begin{tabular}{@{}l }
    Independent publication. Printed on demand by Amazon.com. \\
    Online edition with first six chapters available at: \\
    \textit{https://www.msperlin.com/afedR/}
\end{tabular}


\vspace{0.75cm}

\begin{tabular}{@{} ll}
	\textbf{Cover:              }& Rubens Lima - https://capista.com.br \\
%	\textbf{ }       & https://capista.com.br \\
	\textbf{Proofreader:} & Various \\
	\textbf{ISBN (paperback):} & 9781710627312  \\
	\textbf{ISBN (hardcover):} & 9798714799266  \\	
	\textbf{ISBN (ebook):} & -
\end{tabular}

\vspace{0.5cm}

\textbf{History of editions:}

\begin{tabular}{@{} ll}
	  2017-05-01 & First edition \\
	  2020-02-15 & Second edition \\
	  2021-03-15 & Second edition revised\\
\end{tabular}

\vspace{0.5cm}

\small{While the author has used good faith efforts to ensure that the instructions and code contained in this work are accurate, the author disclaims all responsibility for errors or omissions, including without limitation responsibility for damages resulting from the use of or reliance on this work and its resulting code. The use of the information contained in this work is at your own risk. If any code in this book is subject to open source licenses or the intellectual property rights of others, complying with such rights and licenses is your responsibility as a user.}

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\hypertarget{about-new-edition}{%
\chapter*{About New Edition}\label{about-new-edition}}
\addcontentsline{toc}{chapter}{About New Edition}

Since the first edition of this book in 2017, many things have changed. The second edition of the book complements and extends the previous material, considering new ways to use Rstudio, new R packages written by me and others, as well as the feedback from the first edition.

However, the format of the book has changed significantly. The order of chapters is now aligned with the steps of data-based research, from importing tables, cleaning it, testing hypotheses and presenting results. Thus, the reader can follow through the chapters according to his own work. Another important change is the alignment with the \texttt{tidyverse} tools -- a set of packages that greatly facilitate the use of R --, especially for data importation and manipulation. Some native R functions are presented when necessary, but only when a \texttt{tidyverse} counterpart does not exist.

Three new chapters were added to this book, including a dedicated piece to the process of reporting research output and the use of the \emph{RMarkdown} technology. The final chapter now discusses code optimization by presenting the best code practices and simple strategies to improve work efficiency.

For all R teachers in the world, this and all future editions of the book will include class material such as end-of-chapter exercises with solutions. All teaching material is publicly available in the \href{https://www.msperlin.com/blog/publication/2020_book-afedr-en/}{internet}\footnote{\url{https://www.msperlin.com/blog/publication/2020_book-afedr-en/}} and released with a generous \href{https://opensource.org/licenses/MIT}{MIT license}\footnote{\url{https://opensource.org/licenses/MIT}}. So, if you are an R tutor in finance or economics, feel free to use and modify the teaching material to your liking. However, if you do so, please make sure that you cite the original source.

I hope you enjoy reading this book and, based on its content, you can find ways to improve your data analysis. Your feedback is always important and you can reach me at \emph{\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}}. This book is a special and lifelong project and I will keep improving it as much as I can over the years.

\hypertarget{revision-2021}{%
\section*{Revision 2021}\label{revision-2021}}
\addcontentsline{toc}{section}{Revision 2021}

The book was revised in march 2021, with the following changes:

\begin{itemize}
\tightlist
\item
  Improved and consistent css template for html and ebook.
\item
  Over 100 end of chapter exercises. The exercises within the book are in the \texttt{exams} \citep{R-exams} format and can be compiled to pdf or html. Check out this \href{https://www.msperlin.com/blog/post/2021-02-28-dynamic-exercises-afedr/}{blog post} for details.
\item
  To help the reader with topics that don't quite fit with the main text, new text boxes with important and cautionary messages were implemented in all formats.
\item
  New hardcover format is available at Amazon.
\end{itemize}

All changes are fully reflected in Amazon.com. Those who previously purchase the second edition in ebook will have a new copy delivered to their kindle account.

\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

Since you are reading this book, you are likely a data analyst looking for alternative and more efficient ways to add value to your organization, an undergraduate or graduate student in your first steps learning data science, or an experienced researcher, looking for new tools to use in your work. Be assured that you are in the right place. \textbf{This book will teach you to use R and RStudio for data analysis in finance and economics}.

The material in this book started out as class slides from my work as a university teacher and researcher in the south of Brazil. By observing students learning and using R in the classroom, I frequently see the positive impact that it has on their careers. They can autonomously do complex data tasks with their computers, providing a better and more comprehensive analysis to help the decision-making process in their organizations. They spend less time doing repetitive and soul-crushing spreadsheet data chores and more time thinking about their analysis and learning new tools. This book attempts to go beyond the classroom and reach an international and more diversified audience.

Another motivation for writing this book is my personal experience using code from other researchers. Usually, the code is not well-organized, lacks clarity, and, possibly, only works in the computer of its author! After being constantly frustrated, I realized the work required to figure out the code of other researchers would take more time than writing the procedure myself. These cases hurt the development of science, as one of its basic principles is the \textbf{reproducibility of experiments}. In the case of a computer-intensive field, such as empirical finance and economics, the underlying research code should run without effort in other people's computers. As researchers are expected to be good writers, it should also be expected that their code is in a proper format and readable by other people. With this book, I will tackle this problem by presenting a code structure focused on scientific reproducibility, organization, and usability.

In this book, we will not work on the advanced uses of R. The content will be limited to simple and practical examples. One challenge of writing this book was defining the boundary between introductory and advanced material. Wherever possible, I gradually dosed the level of complexity. For readers interested in learning advanced features of the program and its inner workings, I suggest the work of \citet{venables2004introduction}, \citet{teetor2011r} and \citet{wickham2019advanced}.

This is what you'll learn from this book:

\begin{description}
\tightlist
\item[Using R and RStudio]
In chapter 01 we will discuss the use of R as a programming platform designed to solve data-related problems in finance and economics. In chapter 02 we will explore basic commands and many functionalities of R and RStudio that will increase your productivity.
\item[Importing financial and economic data]
In chapters 04 and 05 we will learn to import data from local files, such as an Excel spreadsheet, or the internet, using specialized packages that can download financial and economic data such as stock prices, economic indices, the US yield curve, corporate financial statements, and many others.
\item[Cleaning, structuring and analyzing the data with R]
In chapters 06 and 07 we will concentrate our study on the ecosystem of basic and advanced classes of objects within R. We will learn to manipulate objects such as numeric vectors, dates and whole tables. In chapters 08 and 09 we'll study to use the programming tools to solve data-related problems such as cleaning and structuring messy data. In chapter 11 we will learn applications of the most common econometric models used in finance and economics including linear regression, generalized linear model, Arima model and others.
\item[Creating a visual analysis of data]
In chapter 10 we'll learn to use functions from package \texttt{ggplot2} to create clever visualizations of our datasets, including the most popular applications in finance and economics, time series and statistical plots.
\item[Reporting your results]
In chapter 12 we will see how to report our data analysis using specialized packages and the \emph{RMarkdown} technology. It includes the topic of presenting and exporting tables, figures and models to a written report.
\item[Writing better and faster code]
In the last chapter of the book we discuss best programming practices with R. We will look at how to profile code and search for bottlenecks and improving execution time with caching strategies using package \texttt{memoize}, C++ code with \texttt{Rcpp} and parallel computing with \texttt{furrr}.
\end{description}

\hypertarget{supplement-material}{%
\section*{Supplement Material}\label{supplement-material}}
\addcontentsline{toc}{section}{Supplement Material}

All the material used in the book, including code examples separated by chapters, is publicly available on the Internet and distributed with an R package called \texttt{afedR}. It includes data files and several functions that can make it easier to run the examples of the book. If you plan to write some code as you read the book, this package will greatly help your journey.

In order to install the book package in your computer, you need to execute a couple of lines of code in R. For that, copy and paste the following commands into RStudio prompt (bottom left of screen, with a ``\textgreater{}'' sign) and press enter for each command. Be aware you'll need R and RStudio installed in your computer (see section \ref{installing} for details).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install devtools dependency}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{'devtools'}\NormalTok{)}

\CommentTok{# install book package}
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{'msperlin/afedR'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

What this code will do is to install package \texttt{devtools}, a required dependency for installing a package from Github, which is where the book bundle is hosted. After that, a call to \texttt{devtools::install\_github(\textquotesingle{}msperlin/afedR\textquotesingle{})} will install the package in your computer. You can safely ignore any warning messages during instalation.

After installing the book package \texttt{afedR}, you can, but its not necessary, to copy all book files to a local folder by simply executing the following command in R:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{afedR}\OperatorTok{::}\KeywordTok{copy_book_files}\NormalTok{(}\DataTypeTok{path_to_copy =} \StringTok{'~'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The previous code will unzip the book file into your ``Documents/afedR-files'' folder, as the tilda (\texttt{\textasciitilde{}}) is a shortcut to your ``Documents'' directory. The package also includes several other functions that will be used throughout the book. If you prefer the old-fashioned way of using an internet page, you can find and download the zip file in the \href{https://www.msperlin.com/blog/files/afedr-files/afedR-code-and-data.zip}{book site}\footnote{\url{https://www.msperlin.com/blog/files/afedr-files/afedR-code-and-data.zip}}.

A suggestion, before you read the rest of the book: go to the \href{https://www.msperlin.com/blog/publication/2020_book-afedr-en/}{book website} and search for the related links page at the bottom. There you will find all internet addresses highlighted in the text, including the links for the installation of R and RStudio.

\hypertarget{content-for-instructors}{%
\section*{Content for Instructors}\label{content-for-instructors}}
\addcontentsline{toc}{section}{Content for Instructors}

If you are an R instructor, you'll find plenty of material you can use with your classes. I made sure you get everything you need:

\begin{description}
\tightlist
\item[Over 100 exercises]
Every chapter in this book includes exercises that your students can practice, with solutions available in the \href{https://www.msperlin.com/afedR}{web version} of the book. Also, all exercises are available in the \texttt{exams} format (see \href{http://www.r-exams.org/}{this} webpage for details), meaning that you can compile the same exercises in pdf or html. Moreover, you can export the exercises to \emph{e-learning} platforms such as Moodle and Blackboard. See this \href{https://www.msperlin.com/blog/post/2021-02-28-dynamic-exercises-afedr/}{blog post}\footnote{\url{https://www.msperlin.com/blog/post/2021-02-28-dynamic-exercises-afedr/}} for instructions on how to use it with your students.
\item[Web version]
The first seven chapters of the book is freely available at link \url{https://www.msperlin.com/afedR}, which is more than enough material for an introductory class on R and data analysis.
\end{description}

All of this content is released with the \href{https://opensource.org/licenses/MIT}{MIT license}, so feel free to use and abuse it, as long as you give the credits to the original author. You can find the content within the book package \texttt{afedR} (see previous instructions on installation) or directly at the \href{https://www.msperlin.com/blog/publication/2020_book-afedr-en/}{book site}\footnote{\url{https://www.msperlin.com/blog/publication/2020_book-afedr-en/}}.

I hope you enjoy this book and find it useful for your work.

Good reading!

Marcelo S. Perlin

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\textbf{In the digital era, information is abundant and accessible}. From the ever-changing price of financial contracts to the unstructured data of social media websites, the high volume of information creates a strong need for data analysis in the workplace. A company or organization benefit immensely when it can create a bridge between raw information from its environment and making strategic decisions. Undoubtedly, this is a prolific time for professionals skilled in using the right tools for acquiring, storing, and analyzing data.

In particular, datasets related to Economics and Finance are widely available to the public. International and local institutions, such as central banks, government research agencies, financial exchanges, and many others, provide their data publicly, either by legal obligation or to foment research. Whether you are looking into statistics for a particular country or a company, most information is just two clicks away. By analyzing this information efficiently and effortlessly, you'll be able to offer valuable insights to your team.

Not surprisingly, fields with abundant access to data and practical applications, such as economics and finance, it is expected that a graduate student or a data analyst has learned at least one programming language that allows him/her to do his work efficiently. \textbf{Learning how to program is becoming a requisite for the job market}. In this setup, the role and contribution of R shine. In these sections, I will explain what R is and why you should use it.

\hypertarget{what-is-r}{%
\section{What is R}\label{what-is-r}}

R is a programming language specially designed to resolve statistical problems and display graphical representations of data. R is a modern version of S, a programming language originally created in Bell Laboratories (formerly AT\&T, now Lucent Technologies). The base code of R was developed by two academics, \textbf{Ross Ihaka} and \textbf{Robert Gentleman}, resulting in the programming platform we have today. For anyone curious about the name, the letter R was chosen due to the common first letter of the name of their creators. \index{R language} \index{S language}

Today, R is almost synonymous with data analysis, with a large user base and consolidated modules. It is likely that researchers from various fields, from economics to biology, find in R significant preexisting code that facilitates their analysis.

On the business side, large and established companies, such as \emph{Google} and \emph{Microsoft}, already adopted R as the internal language for data analysis. R is maintained by the \href{https://www.r-project.org/foundation/}{\textbf{R Foundation}}\footnote{\url{https://www.r-project.org/foundation/}} and the \href{https://www.r-consortium.org/}{\textbf{R Consortium}}\footnote{\url{https://www.r-consortium.org/}}, a collective effort to fund projects for extending the programming language. \index{R foundation} \index{R consortium}

\hypertarget{why-choose-r}{%
\section{Why Choose R}\label{why-choose-r}}

Learning a new programming language requires a lot of time and effort. Perhaps you're wondering why you should choose R and invest time in learning it. Here are the main arguments.

First, \textbf{R is a mature and stable platform, continuously supported and intensively used in the industry}. When choosing R, you will have the computational background not only for an academic career in scientific research but also to work as a data analyst in private organizations. Due to its open license, you can use R anywhere. Also, the strong support from the community means it is very unlikely the R platform will ever fade away or be substituted. Depending on your career choices, R might be the only programming language you ever need to learn.

\textbf{Learning R is easy}. My experience in teaching R allows me to confidently state that students, even those with no programming experience, have no problem learning the language and using it to create their own code. The language is intuitive and certain rules and functions can be extended to different cases. For example, the function \texttt{print} is used to show the contents of an object on the screen. You can use it for any kind of object. So, by learning the main concept, you'll be able to apply it in different scenarios. Once you understand how the software expects you to think, it is easy to discover new features starting from a previous logic. This generic notation facilitates the learning process.

\textbf{The engine of R and the interface of RStudio creates a highly productive environment}. The graphical interface provided by RStudio facilitates the use of R and increases productivity by introducing new features to the platform. By combining both, the user has at his disposal many tools that facilitate the development of research scripts and other projects. \index{RStudio}

\textbf{CRAN Packages allow the user to do many different things with R}. We will soon learn that we can import external code directly into R as individual modules (packages) and use it for different purposes. These packages extend the basic language of R and enable the most diverse functionalities. You can, for example, use R to write and publish a book, build and publish a blog, create exams with dynamic content, write random jokes and poems (seriously!), send emails, access and collect data from the internet, and many other features. It is truly impressive what you can do with just a couple of lines of code in R.

\textbf{R is compatible with different operating systems and it can interface with different programming languages}. If you need to execute code from another programming language, such as \emph{C++}, \emph{Python}, \emph{Julia}, it is easy to integrate it with R. Therefore, the user is not restricted to a single programming language and can easily use features and functions from others. For example, the C++ code is well known for its superior speed in numerical tasks. From an R script, you can use package \texttt{Rcpp} \citep{R-Rcpp} to write a C++ function and effortlessly use it within your R code. \index{C++} \index{Python} \index{Julia}

\textbf{R is free!} The main software and all its packages are free. A generous license motivates the adoption of the R language in a business environment, where obtaining individual and collective licenses of commercial software can be costly. This means you can take R anywhere you go.

\hypertarget{what-can-you-do-with-r-and-rstudio}{%
\section{What Can You Do With R and RStudio?}\label{what-can-you-do-with-r-and-rstudio}}

R is a fairly complete programming language and any computational problem can be solved based on it. Given the adoption of R for different areas of knowledge, the list is extensive. With finance and economics, I can highlight the following possibilities:

\begin{itemize}
\item
  Substitute and improve data-intensive tasks from spreadsheet-like software;
\item
  Develop routines for managing investment portfolios and executing financial orders;
\item
  Creating tools for calculating and reporting economic indices such as inflation and unemployment;
\item
  Performing empirical data research using statistical techniques, such as econometric models and hypothesis testing;
\item
  Create dynamic \emph{websites} with the \texttt{shiny} \citep{R-shiny} package, allowing anyone in the world to use a computational tool created by you; \index{shiny}
\item
  Automate the process of writing technical reports with the \textbf{RMarkdown} technology; \index{RMarkdown}
\end{itemize}

Moreover, public access to packages developed by users further expands these capabilities. The \href{https://cran.r-project.org/web/views}{CRAN views website}\footnote{\url{https://cran.r-project.org/web/views}} offers a \emph{Task Views} panel for the topic of \href{https://cran.r-project.org/web/views/Finance.html}{Finance}\footnote{\url{https://cran.r-project.org/web/views/Finance.html}} and \href{https://cran.r-project.org/web/views/Econometrics.html}{Econometrics}\footnote{\url{https://cran.r-project.org/web/views/Econometrics.html}}. There you can find the main packages to perform specific operations such as importing financial data from the internet, estimating econometric models, calculation of different risk estimates, among many other possibilities. Reading this page and the knowledge of these packages is essential for those who intend to work in Finance and Economics. It is worth noting, however, that the complete list of packages is much larger.

\begin{rmdimportant}
Be aware that R has a consistent release schedule. Every four months a
new version of R is released, fixing \emph{bugs} and implementing new
solutions. There are two main types of releases, \emph{major} and
\emph{minor}. For example, today, 2021-02-24, the latest version of R is
4.0.4. The first digit (``4'') indicates the \emph{major} release while
all others are of the \emph{minor} type. Generally, the \emph{minor}
changes are very specific and, possibly, will have little impact on your
work.

However, unlike \emph{minor} releases, \textbf{\emph{major} releases are
fully reflected in the R package ecosystem}. Every time you install a
new \emph{major} version of R, you will have to reinstall all packages.
Particularly, the problem here is that it is not uncommon that a new
major release comes with package incompatibility issues. My advice is:
every time a new \emph{major} release of R comes out, \textbf{wait a few
months} before installing it on your machine. Thus, the authors of the
packages will have more time to update their codes, minimizing the
possibility of compatibility problems.
\end{rmdimportant}

\hypertarget{installing}{%
\section{Installing R}\label{installing}}

Before going any further, let's install the required software on your computer. The most direct and practical way to install R is to direct your browser to \href{http://www.r-project.org/}{R website}\footnote{\url{http://www.r-project.org/}} and click the \emph{Download} link in the left side of the page, as shown in Figure \ref{fig:website-cran-1}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/website_cran_1} 

}

\caption{Initial page for downloading R}\label{fig:website-cran-1}
\end{figure}

The next screen gives you a choice of the mirror to download the installation files. The CRAN repository (\emph{R Comprehensive Archive network}) is mirrored in various parts of the world. You can choose one of the links from the nearest location to you. If undecided, just select the mirror \emph{0-Cloud} (see Figure \ref{fig:website-cran-2}), which will automatically take you to the nearest location.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/website_cran_2} 

}

\caption{Choosing the CRAN mirror}\label{fig:website-cran-2}
\end{figure}

The next step involves selecting your operating system, likely to be \emph{Windows}. From now on, due to the greater popularity of this platform, we will focus on installing R in Windows. The instructions for installing R in other operating systems can be easily found \href{https://www.google.com.br/webhp?sourceid=chrome-instant\&ion=1\&espv=2\&ie=UTF-8\#q=installing+r\&*}{online}. Regardless of the underlying platform, using R is about the same. There are a few exceptions, especially when R interacts with the file system. In the content of the book, special care was taken to choose functions that work the same way in different operating systems. A few exceptions are highlighted throughout the book. So, even if you are using a Mac or a flavor of Linux, you can take full advantage of the material presented here.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/website_cran_3} 

}

\caption{Choosing the operating system}\label{fig:website-cran-3}
\end{figure}

After clicking the link \emph{Download R for Windows}, as in Figure \ref{fig:website-cran-3}, the next screen will show the following download options: \emph{base}, \emph{contrib}, \emph{old.contrib} and \emph{RTools}. The first (\emph{base}), should be selected. It contains the download link to the executable installation file of R in \emph{Windows}.

If the user is interested in creating and distributing their own R packages, \emph{RTools} should also be installed. For most users, however, this should not be the case. If you don't intend to write packages, you can safely ignore \emph{Rtools} for now. The links to \emph{contrib} and \emph{old.contrib} relate to files for the current and old releases of R packages and can also be ignored. We will discuss the use of packages in the next chapter.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/website_cran_4} 

}

\caption{Installation options}\label{fig:website-cran-4}
\end{figure}

After clicking the link \emph{base}, the next screen will show the link to the \emph{download} of the R installation file (Figure \ref{fig:website-cran-5}). After downloading the file, open it and follow the steps in the installation screen. At this time, no special configuration is required. I suggest keeping all the default choices and simply hit \emph{accept} in the displayed dialogue screens. After the installation of R, it is strongly recommended to install RStudio, which will be addressed next.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/website_cran_5} 

}

\caption{Downloading R}\label{fig:website-cran-5}
\end{figure}

\hypertarget{installing-rstudio}{%
\section{Installing RStudio}\label{installing-rstudio}}

The base installation of R includes its own \emph{GUI} (graphical user interface), where we can write and execute code. However, this native interface has several limitations. RStudio substitutes the original GUI and makes access to R more practical and efficient. One way to understand this relationship is with an analogy with cars. While R is the engine of the programming language, RStudio is the body and instrument panel, which significantly improves the user experience. Besides presenting a more attractive look, RStudio also adds several features that make the life of a programmer easier, allowing the creation of projects and packages, creation of dynamic documents, among others. \index{RStudio}

The installation of RStudio is simpler than that of R. The files are available in \href{https://www.rstudio.com/}{RStudio website}\footnote{\url{https://www.rstudio.com/}}. After accessing the page, click \emph{Download RStudio} and then \emph{Download RStudio Desktop}. After that, just select the installation file relative to the operating system on which you will work. This option is probably \emph{WINDOWS Vista 7/8/10}. Note that, as well as R, RStudio is also available for alternative platforms.

I emphasize that using RStudio is not essential to develop programs in R. Other interfaces are available and can be used. However, in my experience, RStudio is the interface that offers a vast range of features for the language and is widely used, which justifies its choice.

\hypertarget{resources-in-the-web}{%
\section{Resources in the Web}\label{resources-in-the-web}}

\textbf{The R community is vivid and engaging}. There are many authors, such as \href{https://www.msperlin.com/blog}{myself}\footnote{\url{https://www.msperlin.com/blog}}, that constantly release material about R in their blogs. It includes the announcement of new packages, posts about data analysis in real life, curiosities, rants, and tutorials. \href{https://www.r-bloggers.com/}{R-Bloggers}\footnote{\url{https://www.r-bloggers.com/}} is a website that aggregates these blogs, making it easier for anyone to access and participate. I strongly recommend to sign up for the R-Bloggers feed in \href{https://feeds.feedburner.com/RBloggers}{RSS}\footnote{\url{https://feeds.feedburner.com/RBloggers}}, \href{https://www.facebook.com/rbloggers/?fref=ts}{Facebook}\footnote{\url{https://www.facebook.com/rbloggers/?fref=ts}} or \href{https://twitter.com/Rbloggers}{Twitter}\footnote{\url{https://twitter.com/Rbloggers}}. Not only you'll be informed of what is happening in the R community, but also learn a lot by reading other people's code and articles. \index{RBloggers}

Learning and using R can be a social experience. Several conferences and user-groups are available in many countries. You can find the complete list in this \href{https://jumpingrivers.github.io/meetingsR/index.html}{link}\footnote{\url{https://jumpingrivers.github.io/meetingsR/index.html}}. I also suggest looking in social platforms for local R groups in your region.

\hypertarget{structure-and-organization}{%
\section{Structure and Organization}\label{structure-and-organization}}

This book presents a practical approach to using R in finance and economics. To get the most out of this book, I suggest you first seek to understand the code shown, and only then, try using it on your own computer. Whenever you find a piece of code that you do not understand, go on and study it. At first, it might seem like a daunting task but, with time, be confident that the learning process will get a lot easier as the code blocks start to make sense.

Learning to program in a new platform is like learning a foreign spoken language: the use in day-to-day problems is imperative to create fluency. All the code and data used in this book is available with the installation of package \texttt{afedR} (see the preface for instructions on how to install it). I suggest you test the code on your computer and \emph{play} with it, modifying the examples and checking the effect of changes in the outputs. Whenever you have a computational problem, try using R to solve it. You'll stumble and make mistakes at first. But I guarantee that, soon enough, you'll be able to write complex data tasks effortlessly.

Throughout the book, every demonstration of code will have two parts: the R code and its output. The output is nothing more than the result of the commands on the screen. All inputs and outputs code will be marked in the text with a special format. See the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a list}
\NormalTok{L <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\StringTok{'abc'}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\StringTok{'dec'}\NormalTok{)}

\CommentTok{# print list}
\KeywordTok{print}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "abc"
R> 
R> [[2]]
R> [1] 1 2 3 4 5
R> 
R> [[3]]
R> [1] "dec"
\end{verbatim}

For the previous chunk of code, lines \texttt{L\ \textless{}-\ list(\textquotesingle{}abc\textquotesingle{},\ 1:5,\ \textquotesingle{}dec\textquotesingle{})} and \texttt{print(L)} are actual commands given to R. The output of this simple piece of code is the on-screen presentation of the contents of object \texttt{L}. The symbol \texttt{R\textgreater{}} is used for any code output. Notice also that inline comments are set with the symbol \texttt{\#}. Anything on the right side of \texttt{\#} is not evaluated by R. These comments serve as written notes about the code.

The code can also be spatially organized using newlines. This is a common strategy around arguments of functions. The next chunk of code is equivalent to the previous and will run the exact same way. Notice how we used a new line to vertically align the arguments of function \texttt{list}. You'll soon see that, throughout the book, this type of vertical alignment is constantly used.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a list}
\NormalTok{L <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\StringTok{'abc'}\NormalTok{, }
          \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }
          \StringTok{'dec'}\NormalTok{)}

\CommentTok{# print list}
\KeywordTok{print}\NormalTok{(L)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "abc"
R> 
R> [[2]]
R> [1] 1 2 3 4 5
R> 
R> [[3]]
R> [1] "dec"
\end{verbatim}

The code also follows a well-defined structure. One decision in writing computer code is how to name objects and how to structure it. It is recommended to follow a clear pattern, so it is easy to maintain over time and be used and understood by others. For this book, a mixture of the author's personal choices with the coding style suggested by \href{https://google.github.io/styleguide/Rguide.xml}{Google}\footnote{\url{https://google.github.io/styleguide/Rguide.xml}} was used. The reader, however, may choose the structure he finds more efficient and aesthetically pleasing. Like many things in life, this is a choice. We will get back at discussing code structure in chapter \ref{optimizing}.

\hypertarget{exercises}{%
\section{Exercises}\label{exercises}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
The R language was developed based on what other programming language?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  C++
\item
  S
\item
  Julia
\item
  Javascript
\item
  Python
\end{enumerate}

02 -
What are the names of the two authors of R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Guido van Rossum and Bjarne Stroustrup
\item
  Linus Torvalds and Richard Stallman
\item
  John Chambers and Robert Engle
\item
  Ross Ihaka and Robert Gentleman
\item
  Roger Federer and Rafael Nadal
\end{enumerate}

03 -
Why is R special when comparing to other programming languages, such as Python, C++, javascript and others?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Makes it easy to write mobile apps
\item
  Quick code execution
\item
  Easy to use
\item
  Works on any plataform such as Windows, Unix, MacOS
\item
  It was designed for analyzing data and producing statistical output
\end{enumerate}

04 -
What was the reason the programming language was named R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  It was the only available letter, not yet used as a programming language.
\item
  The mother of one of the authors is called Renata.
\item
  Letter R is shared in the first names of its authors.
\item
  Letter R is cool!
\item
  R = Reausable code.
\end{enumerate}

05 -
Consider the following alternatives about R and RStudio:

I - R was developed in 2018 and is an innovative and unstable project;

II - RStudio is an alternative programming language to R;

III - R has compatibility with different programming languages;

Which alternatives are correct?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  FALSE, TRUE, TRUE
\item
  FALSE, FALSE, FALSE
\item
  FALSE, FALSE, TRUE
\item
  TRUE, TRUE, FALSE
\item
  TRUE, FALSE, TRUE
\end{enumerate}

06 -
Once you have R and RStudio installed, head over to the \href{https://cloud.r-project.org/web/packages/available_packages_by_date.html}{CRAN package website}\footnote{https: //cloud.r- project.org/web/packages/available\_packages\_by\_date.html} and look for technologies you use in your work. For example, if you use \href{https://www.google.com/sheets/about/}{Google Sheets}\footnote{\url{https://www.google.com/sheets/about/}} ostensibly in your work, you will soon discover that there is a package in CRAN that interacts with spreadsheets in the cloud.

07 -
On the \href{https://cloud.r-project.org/bin/windows/}{CRAN site} you can also install the Rtools application. What is it for?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Compile R packages locally
\item
  Build web pages.
\item
  Compile graphics.
\item
  Compile technical reports.
\item
  Make coffee (?).
\end{enumerate}

08 -
Use \href{https://www.google.com/search?q=R+groups+in+my+city}{Google} to search for R groups in your region. Check if the meetings are frequent and, if you don't have a major impediment, go to one of these meetings and make new friends.

09 -
Go to the \href{https://www.r-bloggers.com/}{RBloggers website}\footnote{\url{https://www.r-bloggers.com/}} and look for a topic of interest to you, such as football (\emph{soccer}) or investments (\emph{investments}). Read at least three of the found blog posts.

10 -
If you work in an institution with data infrastructure, talk to the person in charge of the IT department and verify what technologies are used. Check if, through R, it is possible to access all tables in the databases. For now there is no need to write code, yet. Just check if this possibility exists.

\hypertarget{basicoperations}{%
\chapter{Basic Operations in R}\label{basicoperations}}

Basic operation are the fundamental tasks that you will be repeating many times over your workday. As such, it is important to understand how to work with R and RStudio efficiently before you develop your data analysis. This includes understanding the RStudio interface, basic R commands, file extensions, available shortcuts and the autocomplete feature of RStudio.

In this section, we will go through the initial steps from the viewpoint of someone who has never worked with R and possibly never had contact with other programming languages. Those already familiar with the software may not find novel information here and, therefore, I suggest skipping to the next section. However, it is recommended, that you at least check the discussed topics so you can confirm your knowledge about the features of the software and how to use them for working smarter and not harder. This is especially true for RStudio, which offers several tools to increase your productivity.

\hypertarget{working-with-r}{%
\section{Working With R}\label{working-with-r}}

The greatest difficulty new user experiences when developing routines in R is the format of work -- the so-called development cycle. Our interaction with computers has been simplified over the years and we are currently comfortable with the \emph{point\&click} format. That is, if you want to perform an operation on the computer, just point the \emph{mouse} to the specific location on the screen and click a button. Visual cues in a series of steps allow the execution of complex tasks. But, you need to be aware that this form of interaction is just one layer above what actually happens. Behind all these \emph{clicks}, there is a command being executed on your computer. Any common task such as opening a \emph{pdf} file, a spreadsheet document, directing a \emph{browser} to a web page has an underlying call to a code.

The ``point\&click'' format of visual and motor interaction has its benefits in facilitating and popularizing the use of computers. However, it is not flexible and effective when working with computational procedures such as data analysis. By knowing the commands available to the user and how to execute them, it is possible to create a file containing several instructions in sequence and, in the future, simply request that the computer \textbf{execute} this file using the recorded procedures. There is no need to do a ``scripted'' point\&click operation. You spend some time writing the program but, in the future, it will always execute the recorded procedure in the same way.

In the medium and long term, there is a significant gain in productivity between the use of a \emph{script} (sequence of commands) and a \emph{point\&click} type of interface. Going further, the risk of human error in executing the procedure is almost nil because the commands and their required sequence of execution are recorded in the text file and will always be executed in the same way. This is one of the main reasons programming languages are popular in science. All steps of data-based research, including results, can be replicated.

In using R, the ideal format of work is to merge the mouse movement with commands. R and RStudio have some functionality with the \emph{mouse}, but their capacity is optimized when we perform operations using code. When a group of commands is performed in a smart way, we have an R script that should preferably produce something important to us at the end of its execution. In finance and economics, this can be the current price of a stock, the value of an economic index such as inflation, the result of academic research, among many other possibilities.

Like other software, R allows us to import data and export files. We can use code to import a dataset stored in a local file -- or the web--, analyze it and paste the results into a technical report. We can use RStudio and the \emph{RMarkdown} technology to write a dynamic report, where code and content are integrated. For example, the book you're reading was written using the \texttt{bookdown} package \citep{R-bookdown}. The content of the book is compiled with the execution of the R codes and their outputs are recorded in the scope of the text. All figures and data tasks in the book can be updated with the execution of a simple command. Needless to say that by using the capabilities of R and RStudio, you will work smarter and faster. \index{bookdown} \index{Rmarkdown}

The final product of working with R and RStudio will be an R script that produces elements for a data report. A good example of a simple and polished R script can be found at this \href{https://github.com/msperlin/afedR/raw/master/inst/extdata/others/S_Example_Script.R}{link}\footnote{\url{https://github.com/msperlin/afedR/raw/master/inst/extdata/others/S_Example_Script.R}}. Open it and you'll see the content of a file with extension \emph{.R} that will download stock prices of two companies and create a plot and a table. By the end of the book, you can understand what is going on in the code and how it gets the job done. Even better, you'll be able to improve it. Soon, you'll learn to execute the code on your own computer. If impatient, simply copy the text content of the link to a new RStudio R script, save it, and press \texttt{control\ +\ shift\ +\ enter}.

\hypertarget{objects-in-r}{%
\section{Objects in R}\label{objects-in-r}}

\textbf{In R, everything is an object, and each type of object has its properties}. For example, the daily closing prices of the IBM stock can be represented as a numerical vector, where each element is a price recorded at the end of a trading day. Dates related to these prices can be represented as text (\emph{string}) or as a unique \texttt{Date} class. Finally, we can represent the price data and the dates together by storing them in a single object of type \texttt{dataframe}, which is nothing more than a table with rows and columns. These objects are part of the R ecosystem, and through their manipulation, we take full advantage of the software.

While we represent data as objects in R, a special type is a \texttt{function}. It stores a pre-established manipulation of other objects available to the user. R has an extremely large number of functions, which enable the user to perform a wide range of operations. For example, the basic commands of R, available in the package \texttt{base}, adds up to a total of 1243 functions.

Each function has its own name and a programmer can write their own functions. For example, the \texttt{sort} function is a procedure that sorts elements within a vector. If we wanted to sort the elements of \texttt{2,\ 1,\ 4,\ 3,\ 1}, simply insert the following command in the \emph{prompt} (left bottom side of RStudio's screen) and press \emph{enter}: \index{base!mean} \index{functions}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_vec <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{sorted_vec <-}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_vec, }\DataTypeTok{decreasing =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{print}\NormalTok{(sorted_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 3 2 1 1
\end{verbatim}

The \texttt{sort} function is used with start and end parentheses. These parentheses serve to highlight the entries (\emph{inputs}), that is, the information sent to the function to produce something that will be saved in object \texttt{sorted\_vec}. Note that each entry is separated by a comma, as in \texttt{my\_fct(input1,\ input2,\ input3,\ ...)}. We also set option \texttt{decreasing\ =\ TRUE}. This is a specific directive for the \texttt{sort} function to order the value from highest to lowest. \textbf{Functions are at the heart of R} and we will dedicate a large part of this book to them. You can use the available functions or write your own. You can also publish functions as a package and let other people use your code.

\hypertarget{international-and-local-formats}{%
\section{International and Local Formats}\label{international-and-local-formats}}

Before explaining the use of R and RStudio, it is important to highlight some rules of formatting numbers, Latin characters and dates.

\textbf{decimal:} Following an international notation, the decimal point in R is defined by the period symbol (.), as in \texttt{2.5} and not a comma, as in \texttt{2,5}. If this is not standard in your country, you'll have issues when importing local data from text files. Sometimes, such as with storing data in Microsoft Excel files, the conversion happens automatically in the importing process. This, however, is generally an exception. As a general rule of using R, only use commas to separate the inputs of a function. Under no circumstances should the comma symbol be used as the decimal point separator. Always give priority to the international format because it will be compatible with the vast majority of data. \index{decimal}

\textbf{Latin characters:} Due to its international standard, R has problems understanding Latin characters, such as the cedilla and accents. If you can, avoid it, and do not use Latin characters in the names of your variables or files. In the content of character objects (text), you can use them without problems as long as the encoding of the script is correctly specified (e.g.~UTF-8, Latin1). I strongly recommend the use of the English language for writing code and defining object names. This automatically eliminates the use of Latin characters and facilitates the usability of the code by people outside of your country. \index{latin characters} \index{UTF-8} \index{Latin1}

\textbf{date format:} Dates in R are structured according to the \href{https://www.iso.org/iso-8601-date-and-time-format.html}{ISO 8601}\footnote{\url{https://www.iso.org/iso-8601-date-and-time-format.html}} format. It follows the \texttt{YYYY-MM-DD} pattern, where \texttt{YYYY} is the year in four numbers, \texttt{MM} is the month and \texttt{DD} is the day. An example is 2021-03-30. This, however, may not be the case in your country. When importing local data sets, make sure the dates are in this format. If necessary, you can convert any date to the ISO format. Again, while you can work with your local format of dates in R, it is best advised to use the international notation. The conversion between one format and another is quite easy and will be presented in chapter \ref{basic-classes}. \index{dates}

If you want to learn more about your local format in R, use the following command by typing it in the prompt and pressing enter:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{Sys.localeconv}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>     decimal_point     thousands_sep          grouping 
R>               "."                ""                "" 
R>   int_curr_symbol   currency_symbol mon_decimal_point 
R>            "USD "               "$"               "." 
R> mon_thousands_sep      mon_grouping     positive_sign 
R>               ","        "\003\003"                "" 
R>     negative_sign   int_frac_digits       frac_digits 
R>               "-"               "2"               "2" 
R>     p_cs_precedes    p_sep_by_space     n_cs_precedes 
R>               "1"               "0"               "1" 
R>    n_sep_by_space       p_sign_posn       n_sign_posn 
R>               "0"               "1"               "1"
\end{verbatim}

The output of \texttt{Sys.localeconv()} shows how R interprets decimal points and the thousands separator, among other things. As you can see from the previous output, this book was compiled using the Brazilian notation for the currency but uses the dot point for decimals.

\begin{rmdcaution}
Be careful when modifying the format that R interprets the different
symbols and notations. As a rule of thumb, if you need to use a specific
format, do it separately within the context of the code. Avoid permanent
changes as you never know where such formats are being used. That way,
you can avoid unpleasant surprises in the future.
\end{rmdcaution}

\hypertarget{types-of-files-in-r}{%
\section{Types of Files in R}\label{types-of-files-in-r}}

Like any other programming platform, R has a file ecosystem and each type of file has a different purpose. In the vast majority of cases, however, the work will focus mostly on a couple of types. Next, I describe various file extensions. The items in the list are ordered by importance. Note that we omit graphic files such as \emph{.png}, \emph{.jpg}, \emph{.gif} and data storage/spreadsheet files (\emph{.csv}, \emph{.xlsx}, ..) among others, as they are not exclusive to R. \index{file types!.R} \index{file types!.RData} \index{file types!.rds} \index{file types!.Rmd}

\textbf{Files with extension \emph{.R}}: text files containing R code. Besides, these are the files we will spend most of our time. They contain the sequence of commands that configures the main script and subroutines of the data research. Examples: \emph{Script-stock-research.R}, \emph{R-fcts.R}.

\textbf{Files with extension \emph{.RData} or \emph{.rds}}: files that store data in the native format. These files are used to save/write objects created in different sessions into your hard drive. For example, you can use a \emph{.rds} file to save a table after processing and cleaning up the raw database. By \emph{freezing} the data in a local file, we can later load it for subsequent analysis. Examples: \emph{cleaned-inflation-data.rds}, \emph{model-results.RData}.

\textbf{Files with extension \emph{.Rmd} and \emph{.md}}: files used for editing dynamic documents in the \emph{RMarkdown} and \emph{markdown} formats. Using these files allows the creation of documents where text and code output are integrated into the same document. In chapter \ref{reporting} we have a dedicated section for RMarkdown, which will explore this functionality in detail. Example: \emph{investment-report.Rmd}. \index{Rmarkdown} \index{markdown}

\textbf{Files with extension \emph{.Rproj}}: contain files for editing projects in RStudio, such as a new R package, a \emph{shiny} application or a book. While you can use the functionalities of RStudio projects to write R scripts, it is not a necessity. For those interested in learning more about this functionality, I suggest the \href{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}{RStudio manual}\footnote{\url{https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects}}. Example: \emph{project-retirement.Rproj}. \index{RStudio projects}

\hypertarget{explaining-the-rstudio-screen}{%
\section{Explaining the RStudio Screen}\label{explaining-the-rstudio-screen}}

After installing the two programs, R and RStudio, open RStudio by double-clicking its icon. Be aware that R also has its own interface and this often causes confusion. You should find the correct shortcut for RStudio by going through your software folders. In Windows, you can search for RStudio using the \emph{Start} button and typing \emph{Rstudio}. \index{RStudio}

After opening RStudio, the resulting window should look like Figure \ref{fig:RStudio1}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/RStudio1} 

}

\caption{The RStudio screen}\label{fig:RStudio1}
\end{figure}

Note that RStudio automatically detected the installation of R and initialized your screen on the left side.

As a first exercise, click \emph{file}, \emph{New File}, and \emph{R Script}. A text editor should appear on the left side of the screen. It is there that we will spend most of our time developing code. Commands are executed sequentially, from top to bottom. A side note, all \emph{.R} files created in RStudio are just text files and can be edited anywhere. It is not uncommon for experienced programmers to use specific software to write code and another to run it.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/RStudio2} 

}

\caption{Explaining the RStudio screen}\label{fig:RStudio2}
\end{figure}

\begin{rmdimportant}
An important suggestion here is to change the color scheme of RStudio to
a \textbf{dark mode} setting. It is not just an aesthetic issue, but
also a strategy for preventing health problems. Since you will be
spending a lot of time in front of the computer, it is smart to change
the colors of the interface to relieve your eyes of the constant
brightness of the screen. That way, you'll be able to work longer,
without straining your vision. You can configure the color scheme of
RStudio by going to the option \emph{Tools}, \emph{Global Options} and
then \emph{Appearance}. A dark color scheme that I personally like and
suggest is \emph{Ambience}.
\end{rmdimportant}

After the previous steps in RStudio, the resulting screen should look like the image in Figure \ref{fig:RStudio2}. The main items/panels of the RStudio screen in are:

\textbf{Script Editor:} located on the left side and above the screen. This panel is used to write scripts and functions, mostly on files with the \emph{.R} extension; \index{script editor}

\textbf{R prompt:} on the left side and below the script editor. It displays the \emph{prompt}, which can also be used to give commands to R. The main purpose of the prompt is to test code and display the results of the commands entered in the script editor; \index{prompt}

\textbf{Environment:} located on the top-right of the screen. Shows all objects, including variables and functions currently available to the user. Also note a \emph{History} panel, which shows the history of commands previously executed by the user; \index{environment}

\textbf{Panel Packages:} shows the packages installed and loaded by R. Here you have four tabs: \emph{Files}, to load and view system files; \emph{Plots}, to view statistical figures created in R; \emph{Help} to access the help system and \emph{Viewer} to display dynamic and interactive results, such as a web page. \index{RStudio panels}

As an introductory exercise, let's initialize two objects in R. Inside the prompt (lower left side), insert these commands and press \emph{enter} at the end of each. The \texttt{\textless{}-} symbol is nothing more than the result of joining \texttt{\textless{}} (less than) with the \texttt{-} (minus sign). The \texttt{\textquotesingle{}} symbol represents a single quotation mark and, in the computer keyboard, it is found under the escape (\emph{esc}) key.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}

\CommentTok{# set y}
\NormalTok{y <-}\StringTok{ 'My humble text'}
\end{Highlighting}
\end{Shaded}

If done correctly, notice that two objects appeared in the \emph{environment} panel, one called \texttt{x} with a value of 1, and another called \texttt{y} with the text content \texttt{"My\ humble\ text"}. Also noticed how we used specific symbols to define objects \texttt{x} and \texttt{y}. The use of double quotes (\texttt{"\ "}) or single quotes (\texttt{\textquotesingle{}\ \textquotesingle{}}) defines objects of the class \texttt{character}. Numbers are defined by the value itself. As will be discussed later, understanding R object classes are important as each has a different behavior within the R code. After executing the previous commands, the \emph{history tab} has been updated.

Now, let's show the values of \texttt{x} on the screen. To do this, type the following command:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print contents of x}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

The \texttt{print} function is one of the main functions for displaying values in the \emph{prompt} of R. The text displayed as \texttt{{[}1{]}} indicates the index of the first line number. To verify this, enter the following command, which will show a lengthy sequence of numbers on the screen: \index{base!print}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print a sequence}
\KeywordTok{print}\NormalTok{(}\DecValTok{50}\OperatorTok{:}\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  50  51  52  53  54  55  56  57  58  59  60  61  62  63
R> [15]  64  65  66  67  68  69  70  71  72  73  74  75  76  77
R> [29]  78  79  80  81  82  83  84  85  86  87  88  89  90  91
R> [43]  92  93  94  95  96  97  98  99 100
\end{verbatim}

Here, we use the colon symbol in \texttt{50:100} to create a sequence starting at 50 and ending at 100. Note that, on the left side of each line, we have the values {[}1{]}, {[}13{]}, and {[}25{]}. These represent the index of the first element presented in the line. For example, the fifteenth element of \texttt{50:100} is 64.

\hypertarget{r-packages}{%
\section{R Packages}\label{r-packages}}

One of the greatest benefits of using R is its package collection. A package is nothing more than a group of procedures aimed at solving a particular computational problem. R has at its core a collaborative philosophy. Users provide their codes for others to use. And, most importantly, \textbf{all packages are free}. For example, consider a case where the user is interested in accessing data about historical inflation in the USA. He can install and use an R module that is specifically designed for importing data from central banks and research agencies.

Every function in R belongs to a package. When R initializes, packages \texttt{stats}, \texttt{graphics}, \texttt{grDevices}, \texttt{utils}, \texttt{datasets}, \texttt{methods} and \texttt{base} are loaded by default. Almost every function we have used so far belongs to the package \texttt{base}. R packages can be accessed and installed from different sources. The main being \textbf{CRAN} (\emph{The Comprehensive R Archive network}), and \textbf{Github}. It's worth knowing that the quantity and diversity of R packages increase every day.

\textbf{CRAN is the official repository of R and it is built by the community}. Anyone can send a package. However, there is an evaluation process to ensure that certain strict rules about code format and safety are respected. For those interested in creating and distributing packages, a clear roadmap on how to create and send packages to CRAN is presented on the site \href{http://r-pkgs.had.co.nz/intro.html}{R packages}\footnote{\url{http://r-pkgs.had.co.nz/intro.html}}. Complete rules are available on the \href{https://cran.r-project.org/web/packages/policies.html}{CRAN website}\footnote{\url{https://cran.r-project.org/web/packages/policies.html}}.

The suitability of the code to CRAN standards is the developer's responsibility. My personal experience, sending and publishing a package on CRAN demands a significant amount of work, especially in the first submission. After that, it becomes a lot easier. Don't be angry if your package is rejected. My own packages were rejected several times before entering CRAN. Listen to what the maintainers tell you and try fixing all problems before resubmitting. If you're having issues that you cannot solve or find a solution on the Internet, look for help in the \href{https://www.r-project.org/mail.html}{R-packages mailing list}\footnote{\url{https://www.r-project.org/mail.html}}. You'll be surprised at how accessible and helpful the R community can be.

The complete list of packages available on CRAN, along with a brief description, can be accessed at the \href{https://cran.r-project.org/web/packages/available_packages_by_date.html}{packages section of the R site}\footnote{\url{https://cran.r-project.org/web/packages/available_packages_by_date.html}}. A practical way to check if there is a package that does a specific procedure is to load the previous page and search in your \emph{browser} for a keyword of interest (e.g.~``SEC data''). If there is a package that does what you want, it is very likely that the keyword is used in the description field.

Another important source for finding packages is the \href{https://cran.r-project.org/web/views/}{CRAN Task Views}\footnote{\url{https://cran.r-project.org/web/views/}}. There you can find the collection of noteworthy packages for a given area of expertise. See the \emph{Task Views} screen in Figure \ref{fig:TaskViews}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/TaskViews} 

}

\caption{Task View screen}\label{fig:TaskViews}
\end{figure}

A popular alternative to CRAN is \href{https://github.com/}{Github}\footnote{\url{https://github.com/}}. Unlike the former, Github imposes no restrictions on the submitted code and, because of this and its version control system, it is a popular choice by developers. In practice, it is very common for developers to maintain a development version on Github and the official version in CRAN. When the development version reaches a certain stage of maturity, it is then sent to CRAN.

The most interesting part of this is that the Github packages can be accessed and installed directly from the prompt using the internet. To find out the current amount of packages on CRAN, type and execute the following commands in the prompt:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get a matrix with available packages}
\NormalTok{df_cran_pkgs <-}\StringTok{ }\KeywordTok{available.packages}\NormalTok{()}

\CommentTok{# find the number of packages}
\NormalTok{n_cran_packages <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df_cran_pkgs)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(n_cran_packages)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 17337
\end{verbatim}

Currently, 2021-03-30 11:22:27, there are 17337 packages available on the CRAN servers, a very impressive mark for the community of developers as a whole.

You can also check the amount of \textbf{locally installed packages} in R with the \texttt{installed.packages} command: \index{base!installed.packages}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find number of packages currently installed}
\NormalTok{n_local_packages <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(}\KeywordTok{installed.packages}\NormalTok{())}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(n_local_packages)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 346
\end{verbatim}

In this case, the computer in which the book was written has 346 packages currently installed. Notice that, even as an experienced researcher and R programmer, I'm only using a small fraction of all packages available in CRAN! The number of installed packages is probably different from yours. Give it a try with the command \texttt{installed.packages()}!

\hypertarget{installing-packages-from-cran}{%
\subsection{Installing Packages from CRAN}\label{installing-packages-from-cran}}

To install a package, simply use the command \texttt{install.packages}. You only need to do it once for each new package. As an example, we will install a package called \texttt{readr} that will be used in future chapters. Note that we defined the package name in the installation as if it were text with the use of quotation marks (\texttt{"\ "}). \index{base!install.packages}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install package readr}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{"readr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

That's it! After executing this simple command, package \texttt{readr} and all of its dependencies will be installed and the functions related to the package will be ready for use once the package is loaded in a script. If the installed package is dependent on another package, R detects this dependency and automatically installs the missing packages. Thus, all the requirements for using the installed package will already be satisfied and everything will work perfectly. It is possible, however, that a package has an external dependency. As an example, package \texttt{RndTexExams} depends on the existence of a LaTeX installation. These cases are usually announced in the description of the package and an error informs that a requirement is missing. External dependencies for R packages are not common, but they do happen.

\hypertarget{installing-packages-from-github}{%
\subsection{Installing Packages from Github}\label{installing-packages-from-github}}

To install a package hosted in Github, you must first install the \emph{devtools} package, available on CRAN: \index{devtools}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install devtools}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{'devtools'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After that, use the function \texttt{devtools::install\_github} to install a package directly from Github. In the following example, we will install the development version of package \texttt{dplyr}: \index{devtools!install\_github}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install ggplot2 from github}
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"hadley/dplyr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that the username of the developer is included in the input string. In this case, the \emph{hadley} name belongs to the developer of \texttt{dplyr}, Hadley Wickham. Throughout the book, you will notice that this name appears several times. Hadley is a prolific and competent developer of several popular R packages and currently works for RStudio.

\begin{rmdcaution}
Be aware that \textbf{github packages are not moderated}. Anyone can
send code there and the content is not independently checked. Never
install github packages without some confidence of the author's work.
Although unlikely - it never happened to me for example - it is possible
that they have malicious code.
\end{rmdcaution}

\hypertarget{loading-packages}{%
\subsection{Loading Packages}\label{loading-packages}}

Within a script, use the function \texttt{library} to load a package, as in the following example. \index{base!library}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load package readr}
\KeywordTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

After running this command, all functions of the package will be available in the \textbf{current} R session. Whenever you close RStudio or start a new session, you'll lose all loaded packages. This is the reason why packages are usually loaded in the top of the script: starting from a clean memory, required packages are sequentially loaded before the actual R code is executed.

If the package you want to use is not available, R will throw an error message. See an example next, where we try to load a non-existing package called \texttt{unicorn}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(unicorn)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error: There is no library called "unicorn"
\end{verbatim}

Remember this error message. It will appear every time a package is not found. If you got the same message when running code from this book, you need to check what are the required packages of the example and install them using \texttt{install.packages}, as in \texttt{install.packages(\textquotesingle{}unicorn\textquotesingle{})}.

Alternatively, if you use a specific package function and do not want to load all functions from the same package, you can do it with the use of double colons (\texttt{::}), as in the following example. \index{base!::}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of using a function without loading package}
\NormalTok{fortunes}\OperatorTok{::}\KeywordTok{fortune}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Overall, SAS is about 11 years behind R and S-Plus in
R> statistical capabilities (last year it was about 10 years
R> behind) in my estimation.
R>    -- Frank Harrell (SAS User, 1969-1991)
R>       R-help (September 2003)
\end{verbatim}

Here, we use function \texttt{fortune} from the package \texttt{fortunes} \citep{R-fortunes}, which shows on screen a potentially funny phrase chosen from the R mailing list. For our example, we selected message number 10. One interesting use of the package \texttt{fortune} is to display a random joke every time R starts and, perhaps, lighten up your day. As mentioned before, R is fully customizable. You can find many tutorials on how to achieve this effect by searching on the web for ``customizing R startup''.

Another way of loading a package is by using the \texttt{require} function. A call to \texttt{require} has a different behavior than a call to \texttt{library}. Whenever you try to load an uninstalled package with the \texttt{library} function, it returns an error. This means that the script stops and no further code are evaluated. As for \texttt{require}, if a package is not found, it returns an object with value \texttt{FALSE} and the rest of the code is evaluated. So, in order to avoid code being executed without its explicit dependencies, it is best advised to always use \texttt{library} for loading packages in R scripts. \index{base!required}

The use of \texttt{require} is left for loading up packages inside of functions. If you create a custom function that requires procedures from a particular package, you must load the package within the scope of the function. For example, see the following code, where we create a new function called \texttt{fct\_example} that depends on the package \texttt{quantmod}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fct_example <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)\{}

  \KeywordTok{require}\NormalTok{(quantmod)}

\NormalTok{    df <-}\StringTok{ }\KeywordTok{getSymbols}\NormalTok{(x, }\DataTypeTok{auto.assign =}\NormalTok{ F)}
    \KeywordTok{return}\NormalTok{(df)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In this case, the first time that \texttt{fct\_example} is called, it loads up the package \texttt{quantmod} and all of its functions. Using \texttt{require} inside a function is a good programming policy because the function becomes self-contained, making it easier to use it in the future. This was the first time where the complete definition of a user-created function in R is presented. Do not worry about it for now. We will explain it further in chapter \ref{programming}.

\begin{rmdcaution}
Be aware that loading a package can cause a \textbf{conflict of
functions}. For example, there is a function called \texttt{filter} in
the \texttt{dplyr} package and also in the \texttt{stats} package. If we
load both packages and call the \texttt{filter} function within the
scope of the code, which one will R use? Well, the \textbf{preference is
always for the last loaded package}. This is a type of problem that can
be very confusing. Fortunately, note that R itself tests for conflicts
when loading a package. Try it out: start a new R session and load the
\texttt{dplyr} package. You will see that a message indicates that there
are two conflicts with the \texttt{stats} package -- functions
\texttt{filter} and \texttt{lag} -- and four with the \texttt{base}
package.

A simple strategy to avoid bugs due to conflict of function is to call a
function using the actual package name. For example, if I'm calling
\texttt{lag} from \texttt{dplyr}, I can write the call as
\texttt{dplyr::lag}. As you can see, the package name is explicit,
avoiding any possible conflict.
\end{rmdcaution}

\hypertarget{upgrading-packages}{%
\subsection{Upgrading Packages}\label{upgrading-packages}}

Over time, it is natural that packages available on CRAN are upgraded to accommodate new features, correct bugs and adapt to changes. Thus, it is recommended that users update their installed packages to a new version over the internet. In R, this procedure is quite easy. A direct way of upgrading packages is to click the button \emph{Update} located in the package panel, lower right corner of RStudio, as shown in Figure \ref{fig:RStudio-update}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/RStudio_update} 

}

\caption{Updating R packages}\label{fig:RStudio-update}
\end{figure}

The user can also update packages through the prompt. Simply type command \texttt{update.packages()} and hit \emph{enter}, as shown below. \index{base!update.packages}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# update all installed packages}
\KeywordTok{update.packages}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

The command \texttt{update.packages} compares the version of the installed packages with the versions available in CRAN. If it finds any difference, the new versions are downloaded and installed. After running the command, all packages will be synchronized with the versions available in CRAN.

\begin{rmdimportant}
Package versioning is an extremely important topic for keeping your code
reproducible. Although it is uncommon to happen, a package update might
modify, for the same data, results obtained previously. I have a
particularly memorable experience when a scientific article returned
from a journal review and, due to the update of one of the R packages, I
was unable to reproduce the results presented in the article. In the end
everything went well, but the trauma remains.

One solution to this problem is to freeze the package versions for each
project using RStudio's \texttt{packrat} tool. In summary,
\texttt{packrat} makes local copies of the packages used in the project,
which have preference over system packages. Thus, if a package is
updated in the system, but not in the project, the R code will continue
to use the older version and the R code will always run under the same
conditions.
\end{rmdimportant}

\hypertarget{running-scripts-from-rstudio}{%
\section{Running Scripts from RStudio}\label{running-scripts-from-rstudio}}

Now, let's combine all the previously typed codes into a single file by copying and pasting all commands into the editor's screen (upper left side). The result looks like Figure \ref{fig:example-script}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/RStudio_example_script} 

}

\caption{Example of an R script}\label{fig:example-script}
\end{figure}

After pasting all the commands in the editor, save the \emph{.R} file to a personal folder where you have read and write permissions. In Windows, one possibility is to save it in the \texttt{Documents} folder with a name like \texttt{\textquotesingle{}my\_first\_script.R\textquotesingle{}}. This saved file, which at the moment does nothing special, records the steps of a simple algorithm that creates several objects and shows their content.

\hypertarget{rstudio-shortcuts}{%
\subsection{RStudio shortcuts}\label{rstudio-shortcuts}}

In RStudio, there are some predefined and time-saving shortcuts for running code from the editor. To execute an entire script, simply press \textbf{control + shift + s}. This is the \emph{source} command. With RStudio open, I suggest testing this key combination and checking how the code saved in a \emph{.R} file is executed. The output of the script is shown in the prompt of R. The result in RStudio should look like Figure \ref{fig:example-script-source}. \index{source}

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/RStudio_example_script_source} 

}

\caption{Example of a R script after execution}\label{fig:example-script-source}
\end{figure}

Another way of executing code is with the shortcut \textbf{control + enter}, which will only execute the line where the cursor is located. This shortcut is very useful in developing scripts because it allows each line of the code to be tested. As an example of usage, point the cursor to the \texttt{print(x)} line and press \emph{control + enter}. As you will notice, only the line \texttt{print(x)} was executed and the cursor moves to the next line. Therefore, before running the whole script, you can test it line by line and check for possible errors.

Next, I highlight these and other RStudio shortcuts, which are also very useful.

\begin{description}
\tightlist
\item[control + shift + s]
executes (source) the current RStudio file;
\item[control + shift + enter]
executes the current file with echo, showing the commands on the prompt;
\item[control + enter]
executes the selected line, showing on-screen commands;
\item[control + shift + b]
executes the codes from the beginning of the file to the cursor's location;
\item[control + shift + e]
executes the codes of the lines where the cursor is until the end of the file.
\end{description}

I suggest using these shortcuts from day one, creating a healthy habit. Those who like to use the \emph{mouse}, an alternate way to execute code is to click the \emph{source} button in the upper-right corner of the code editor.

If you want to run code in a \emph{.R} file within another \emph{.R} file, you can use the \texttt{source} command. For example, imagine that you have the main script with your data analysis and another two scripts that performs some support operation such as importing data to R. These operations have been dismembered as a way of organizing the code. \index{base!source}

To run the support \emph{scripts}, just call it with function \texttt{source} in the main script, as in the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# execute import script}
\KeywordTok{source}\NormalTok{(}\StringTok{'01-import-data.R'}\NormalTok{)}

\CommentTok{# execute analysis}
\KeywordTok{source}\NormalTok{(}\StringTok{'02-build-tables'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Here, all code in \texttt{01-import-data.R} and \texttt{02-build-tables.R} will be executed sequentially. This equals manually opening each file and hitting \emph{control + shift + s}.

\hypertarget{testing-and-debugging-code}{%
\section{Testing and Debugging Code}\label{testing-and-debugging-code}}

Developing code follows a cycle. At first, you will write a command line on a script, try it using \emph{control + enter} and check the output on the prompt or the content of objects. A new line of code is written once the previous line worked as expected. A moving cycle is clear, writing code is followed by line execution, followed by result checking, modify and repeat if necessary. This is a normal and expected process. You need to make sure that every line of code is correctly specified before moving to the next one.

When trying to find an error in a preexisting script, R offers debugging tools for controlling and assessing its execution. This is especially useful when you have a long and complicated script. The simplest and easiest tool that R and RStudio offer is code breakpoint. In RStudio, you can click on the left side of the script editor and a red circle will appear, as in Figure \ref{fig:example-debug}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/RStudio_example_debug} 

}

\caption{Example of breakpoint in an R script}\label{fig:example-debug}
\end{figure}

This red circle indicates a flag that will force the code to stop at that line. You can use it to test existing code and check its objects at a certain part of the execution. Pausing the code at a certain point might seem strange for a starting programmer but, for large scripts, with many functions and complex code, it is a necessity. When the execution hits the breakpoint, the prompt will change to \texttt{Browse{[}1{]}\textgreater{}} and you'll be able to try new code and verify the content of all current objects. From the Console, you have the option to continue the execution to the next breakpoint or stop it by pressing \emph{shift+f8}. The same result can be achieved using a function called \texttt{browser}. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}

\CommentTok{# set y}
\NormalTok{y <-}\StringTok{ 'My humble text'}

\KeywordTok{browser}\NormalTok{()}

\CommentTok{# print contents of x}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

The practical result is the same as using RStudio's red circle, but it gives you more control for the case of several commands in the same line.

\hypertarget{creating-simple-objects}{%
\section{Creating Simple Objects}\label{creating-simple-objects}}

One of the most basic and most used commands in R is the creation of objects. As shown in previous sections, you can define an object using the \texttt{\textless{}-} command, which is verbally translated to \emph{assign}. For example, consider the following code: \index{assign}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{x <-}\StringTok{ }\DecValTok{123}

\CommentTok{# set my_x, my_y and my_z in one line}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\NormalTok{; my_y <-}\StringTok{ }\DecValTok{2}\NormalTok{; my_z <-}\StringTok{ }\DecValTok{3}
\end{Highlighting}
\end{Shaded}

We can read this code as \emph{the value 123 is assigned to x}. The direction of the arrow defines where the value is stored. For example, using \texttt{123\ -\textgreater{}\ x} also works, although this is not recommended as the code becomes less readable. Moreover, notice that you can create objects within the same line by separating the commands using a semi-colon.

\begin{rmdimportant}
Using an arrow symbol \texttt{\textless{}-} for object definition is
specific to R. The reason for this choice was that, at the time of
conception of the \emph{S} language, keyboards had a specific key that
directly defined the arrow symbol. This means that the programmer only
had to hit one key in the keyboard to set the \emph{assign} symbol.
Modern keyboards, however, are different. If you find it troublesome to
type this symbol, you can use a shortcut as well. In \emph{Windows}, the
shortcut for the symbol \texttt{\textless{}-} is \emph{alt} plus -.
\end{rmdimportant}

Most programming languages uses a equality symbol (\texttt{=}) to define objects and, often, this creates confusion. When using R, you can also define objects with \texttt{=}, as in \texttt{x\ =\ 123}, however, no one should ever recommend it. The equality symbol has a special use within an R code as it defines function arguments, as in \texttt{my\_l\ \textless{}-\ fct(arg1\ =\ 1,\ arg2\ =\ 3)}. For now, just remember to use \texttt{\textless{}-} for defining objects. We will learn more about functions and using the equality symbol in a future chapter.

The name of the object is important in R. With the exception of very specific cases, you can name objects as you please. This freedom, however, can work against you. It is desirable to set short object names that make sense to the content of the script and which are simple to understand. This facilitates the understanding of the code by other users and is part of the suggested set of rules for structuring code. Note that all objects created in this book have nomenclature in English and specific format, where the white space between nouns are replaced by an underscore, as in \texttt{my\_x\ \textless{}-\ 1} and \texttt{name\_of\_file\ \textless{}-\ \textquotesingle{}my\_data\_file.csv\textquotesingle{}}. We will get back at code structure in chapter \ref{optimizing}.

R executes the code looking for objects available in the environment, including functions. You also need to be aware that R is case sensitive. Likewise, object \texttt{m} differs from \texttt{M}. If we try to access an object that does not exist, R will return an error message and halt the execution of the rest of the code. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error in print(z): object 'z' not found
\end{verbatim}

The error occurred because the object \texttt{z} does not exist in the current environment. If we create a variable \texttt{z} as \texttt{z\ \textless{}-\ 321} and repeat the command \texttt{print(z)}, we will not have the same error message.

\hypertarget{creating-vectors}{%
\section{Creating Vectors}\label{creating-vectors}}

In the previous examples, we created simple objects such as \texttt{x\ \textless{}-\ 1} and \texttt{x\ \textless{}-\ \textquotesingle{}ABC\textquotesingle{}}. While this is sufficient to demonstrate the basic commands in R, in practice, such commands are very limited. A real problem of data analysis will certainly have a greater volume of information.

When we gather many elements of the same class, such as \texttt{numeric}, into a single object, the result is an atomic vector. An example would be the representation of a series of daily stock prices as an atomic vector of the class \texttt{numeric}. Once you have a vector, you can manipulate it any way you want.

Atomic vectors are created in R using the \texttt{c} command, which comes from the verb \emph{combine}. For example, if we want to combine the values 1, 2 and 3 in a single object, we can do it with the following command: \index{base!c}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create numeric atomic vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

The \texttt{c} command works the same way for any other class of object, such as \emph{character}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create character atomic vector}
\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'text 1'}\NormalTok{, }\StringTok{'text 2'}\NormalTok{, }\StringTok{'text 3'}\NormalTok{, }\StringTok{'text 4'}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "text 1" "text 2" "text 3" "text 4"
\end{verbatim}

The only restriction on the use of the \texttt{c} command is that all elements must have the same class. If we insert data from different classes in a call to \texttt{c()}, R will try to mutate all elements into the same class following its own logic. If the conversion of all elements to a single class is not possible, an error message is returned. Note the following example, where numeric values are set in the first and second element of \texttt{x} and a character in the last element.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# a mixed vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{'3'}\NormalTok{)}

\CommentTok{# print result of forced conversion}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "1" "2" "3"
\end{verbatim}

The values of \texttt{x} are all of type \texttt{character}. The use of \texttt{class} command confirms this result:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print class of x}
\KeywordTok{class}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\hypertarget{knowing-your-environment-and-objects}{%
\section{Knowing Your Environment and Objects}\label{knowing-your-environment-and-objects}}

After using various commands, further development of an R script requires you to understand what objects are available and if their content is as expected. You can find this information simply by looking at the \emph{environment} tab in the upper right corner of RStudio. However, there is a command that shows the same information in the prompt. In order to know what objects are currently available in R's memory, you can use the command \texttt{ls}. Note the following example: \index{base!ls}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set some objects}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}
\NormalTok{y <-}\StringTok{ }\DecValTok{2}
\NormalTok{z <-}\StringTok{ }\DecValTok{3}

\CommentTok{# print all objects in the environment}
\KeywordTok{print}\NormalTok{(}\KeywordTok{ls}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "x" "y" "z"
\end{verbatim}

Objects \texttt{x}, \texttt{y} and \texttt{z} were created and are available in the current working environment. If we had other objects, they would also appear in the output to \texttt{ls}.

To display the content of each object, just enter the names of objects and press \texttt{enter} in the \emph{prompt}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print objects by their name}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3
\end{verbatim}

Typing the object name on the screen has the same effect as using the \texttt{print} command. In fact, when executing the sole name of a variable in the prompt or script, R internally passes the object to the \texttt{print} function.

In R, all objects belong to a class. As previously mentioned, to find the class of an object, simply use the \texttt{class} function. In the following example, \texttt{x} is an object of the class \texttt{numeric}, \texttt{y} is a text (\texttt{character}) object and \texttt{fct\_example} is a function object. \index{base!class}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set objects}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}
\NormalTok{y <-}\StringTok{ 'a'}
\NormalTok{fct_example <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{()\{\}}

\CommentTok{# print their classes}
\KeywordTok{print}\NormalTok{(}\KeywordTok{class}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{class}\NormalTok{(y))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{class}\NormalTok{(fct_example))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "function"
\end{verbatim}

Another way to learn more about an object is to check its textual representation. Every object in R has this property and we can find it with function \texttt{str}: \index{base!str}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vec}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\CommentTok{# print the textual representation of a vector}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  int [1:10] 1 2 3 4 5 6 7 8 9 10
R> NULL
\end{verbatim}

We find that object \texttt{x} is a vector of class \texttt{int} (integer). Function \texttt{str} is particularly useful when trying to understand the details of a more complex object, such as a \texttt{dataframe} or a \texttt{list}.

\hypertarget{displaying-and-formatting-output}{%
\section{Displaying and Formatting Output}\label{displaying-and-formatting-output}}

You can show the value of an R object on the screen in two ways. You can either enter its name in the prompt or use the \texttt{print} function. Explaining it further, the \texttt{print} function focuses on the presentation of objects and can be customized for any type. For example, if we had an object of a class called \texttt{My\_Table} to represent a specific type of table, we could create a function called \texttt{print.My\_Table} that would show a table on the screen with a special format for the rows and column names. Function \texttt{print}, therefore, is oriented towards presenting objects and the user can customize it for different classes. The \texttt{base} package, which is automatically initialized with R, contains several \texttt{print} functions for various kinds of objects, such as \texttt{numeric} and \texttt{character}.

However, there are other specific functions to display text in the prompt. The main one is \texttt{message}. This function takes a text as input, processes it for specific symbols and displays the result on the screen. Function \texttt{message} is far more powerful and customizable than \texttt{print}. \index{base!cat}

For example, if we wanted to show the text, \texttt{The\ value\ of\ x\ is\ equal\ to\ 2} on-screen using a numerical object, we could do it as follows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{x <-}\StringTok{ }\DecValTok{2}

\CommentTok{# print customized message}
\KeywordTok{message}\NormalTok{(}\StringTok{'The value of x is'}\NormalTok{, x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The value of x is2
\end{verbatim}

You can also customize the screen output using specific commands. For example, if we wanted to break a line in the screen output, we could do it through the use of the reserved character \texttt{\textbackslash{}n}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set text with break line}
\NormalTok{my_text <-}\StringTok{ ' First Line,}\CharTok{\textbackslash{}n}\StringTok{ Second line'}

\CommentTok{# print it}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  First Line,
R>  Second line
\end{verbatim}

Note that the use of \texttt{print} would not result in the same effect as this command displays the text as it is, without processing it for specific symbols:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] " First Line,\n Second line"
\end{verbatim}

Another example in the use of specific commands for text is to add a \emph{tab} space with the symbol \texttt{\textbackslash{}t}. See an example next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char with \textbackslash{}t}
\NormalTok{my_text_}\DecValTok{1}\NormalTok{ <-}\StringTok{ 'A and B'}
\NormalTok{my_text_}\DecValTok{2}\NormalTok{ <-}\StringTok{ '}\CharTok{\textbackslash{}t}\StringTok{A and B'}
\NormalTok{my_text_}\DecValTok{3}\NormalTok{ <-}\StringTok{ '}\CharTok{\textbackslash{}t\textbackslash{}t}\StringTok{A and B'}

\CommentTok{# print with message()}
\KeywordTok{message}\NormalTok{(my_text_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> A and B
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{message}\NormalTok{(my_text_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  A and B
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{message}\NormalTok{(my_text_}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      A and B
\end{verbatim}

We've only scratched the surface of the possible ways to manipulate text output. More details are found in the \href{https://cran.r-project.org/doc/manuals/R-lang.html\#Literal-constants}{official R manual}\footnote{\url{https://cran.r-project.org/doc/manuals/R-lang.html\#Literal-constants}}.

\hypertarget{customizing-the-output}{%
\subsection{Customizing the Output}\label{customizing-the-output}}

Another way to customize text output is by using specific functions to manipulate objects of class \texttt{character}. For that, there are two very useful functions: \texttt{paste} and \texttt{format}. \index{base!paste} \index{base!format}

Function \texttt{paste} \emph{glues} a series of character objects. It is a very useful function and will be used intensively for the rest of the examples in this book. Consider the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set some text objects}
\NormalTok{my_text_}\DecValTok{1}\NormalTok{ <-}\StringTok{ 'I am a text'}
\NormalTok{my_text_}\DecValTok{2}\NormalTok{ <-}\StringTok{ 'very beautiful'}
\NormalTok{my_text_}\DecValTok{3}\NormalTok{ <-}\StringTok{ 'and informative.'}

\CommentTok{# paste all objects together and print}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(my_text_}\DecValTok{1}\NormalTok{, my_text_}\DecValTok{2}\NormalTok{, my_text_}\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a text very beautiful and informative.
\end{verbatim}

The previous result is not far from what we did in the example with the \texttt{print} function. Note, however, that the \texttt{paste} function adds a space between each text. If we did not want this space, we could use the function \texttt{paste0} as in:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of paste0}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(my_text_}\DecValTok{1}\NormalTok{, my_text_}\DecValTok{2}\NormalTok{, my_text_}\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a textvery beautifuland informative.
\end{verbatim}

\begin{rmdimportant}
An alternative to the \texttt{message} function is \texttt{cat}
(\emph{concatenate and print}). It is not uncommon to find code where
messages to the user are transmitted with \texttt{cat} and not
\texttt{message}. As a rule of thumb, give preference to
\texttt{message} which provides a output that is easier to control. For
example, if the user wants to silence a function, omitting all outputs
from the screen, he/she could just use the command
\texttt{suppressMessages}.
\end{rmdimportant}

Another very useful possibility with the \texttt{paste} function is to insert a text or symbol between the junction of texts. For example, if we wanted to add a comma (\texttt{,}) between each item to be pasted, we could do this by using the input option \texttt{sep} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example using the argument sep}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(my_text_}\DecValTok{1}\NormalTok{, my_text_}\DecValTok{2}\NormalTok{, my_text_}\DecValTok{3}\NormalTok{, }\DataTypeTok{sep =} \StringTok{', '}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a text, very beautiful, and informative.
\end{verbatim}

If we had an atomic vector with all elements to be glued in a single object, we could achieve the same result using the \texttt{collapse} argument. See an example next.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set character object}
\NormalTok{my_text <-}\KeywordTok{c}\NormalTok{(}\StringTok{'I am a text'}\NormalTok{, }\StringTok{'very beautiful'}\NormalTok{, }\StringTok{'and informative.'}\NormalTok{)}

\CommentTok{# example of using the collapse argument in paste}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(my_text, }\DataTypeTok{collapse =} \StringTok{', '}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> I am a text, very beautiful, and informative.
\end{verbatim}

Another key feature of the \texttt{paste} command is that also works for vectors. For example, let's say I needed to create a series of text objects containing the phrase \texttt{"My\ value\ is\ equal\ to\ X"}, where \texttt{"X"} goes from 1 to 10. We can do the following:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set size and vector}
\NormalTok{my_size <-}\StringTok{ }\DecValTok{10}
\NormalTok{my_vec <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\NormalTok{my_size}

\CommentTok{# define string vector}
\NormalTok{my_str <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'My value is equal to '}\NormalTok{, my_vec)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_str)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "My value is equal to 1"  "My value is equal to 2" 
R>  [3] "My value is equal to 3"  "My value is equal to 4" 
R>  [5] "My value is equal to 5"  "My value is equal to 6" 
R>  [7] "My value is equal to 7"  "My value is equal to 8" 
R>  [9] "My value is equal to 9"  "My value is equal to 10"
\end{verbatim}

Going forward, command \texttt{format} is used to format numbers and dates. It is especially useful when we want to represent numbers in a more visually appealing way. By definition, R presents a set number of digits after the decimal point: \index{base!format}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of decimal points in R}
\KeywordTok{message}\NormalTok{(}\DecValTok{1}\OperatorTok{/}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 0.333333333333333
\end{verbatim}

If we wanted only two digits on the screen, we could use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of using the format on numerical objects}
\KeywordTok{message}\NormalTok{(}\KeywordTok{format}\NormalTok{(}\DecValTok{1}\OperatorTok{/}\DecValTok{3}\NormalTok{, }\DataTypeTok{digits=}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 0.33
\end{verbatim}

Likewise, if we wanted to use a scientific format in the display, we could do the following:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of using a scientific format}
\KeywordTok{message}\NormalTok{(}\KeywordTok{format}\NormalTok{(}\DecValTok{1}\OperatorTok{/}\DecValTok{3}\NormalTok{, }\DataTypeTok{scientific=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 3.333333e-01
\end{verbatim}

Function \texttt{format} has many more options. If you need your numbers to come out in a specific way, have a look at the help manual for this function. It is also a generic function and can be used for many types of objects.

\hypertarget{finding-the-size-of-objects}{%
\section{Finding the Size of Objects}\label{finding-the-size-of-objects}}

In R, an object size can mean different things but most likely it is defined as the number of individual elements that constitute the object. This information serves not only to assist the programmer in checking possible code errors but also to know the length of iteration procedures such as \emph{loops}, which will be treated in a later chapter of this book.

In R, the size of an object can be checked with the use of four main functions: \texttt{length}, \texttt{nrow}, \texttt{ncol} and \texttt{dim}. \index{base!length} \index{base!nrow} \index{base!ncol} \index{base!dim}

Function \texttt{length} is intended for objects with a single dimension, such as atomic vectors:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create atomic vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{)}

\CommentTok{# get length of x}
\NormalTok{n <-}\StringTok{ }\KeywordTok{length}\NormalTok{(x)}

\CommentTok{# display message}
\KeywordTok{message}\NormalTok{(}\StringTok{'The length of x is '}\NormalTok{, n)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The length of x is 6
\end{verbatim}

For objects with more than one dimension, such as a matrix, use functions \texttt{nrow}, \texttt{ncol} and \texttt{dim} (dimension) to find the number of rows (first dimension) and the number of columns (second dimension). See the difference in usage below.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a matrix}
\NormalTok{M <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{4}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{5}\NormalTok{)}

\CommentTok{# print matrix}
\KeywordTok{print}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    5    9   13   17
R> [2,]    2    6   10   14   18
R> [3,]    3    7   11   15   19
R> [4,]    4    8   12   16   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate size in different ways}
\NormalTok{my_nrow <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(M)}
\NormalTok{my_ncol <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(M)}
\NormalTok{my_n_elements <-}\StringTok{ }\KeywordTok{length}\NormalTok{(M)}

\CommentTok{# display messages}
\KeywordTok{message}\NormalTok{(}\StringTok{'The number of lines in M is '}\NormalTok{, my_nrow)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The number of lines in M is 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{message}\NormalTok{(}\StringTok{'The number of columns in M is '}\NormalTok{, my_ncol)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The number of columns in M is 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{message}\NormalTok{(}\StringTok{'The number of elements in M is '}\NormalTok{, my_n_elements)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The number of elements in M is 20
\end{verbatim}

The \texttt{dim} function shows the dimension of the object, resulting in a numeric vector as output. This function should be used when the object has more than two dimensions. In practice, however, such cases are rare as most data-related problems can be solved with a bi-dimensional representation. An example is given next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get dimension of M}
\NormalTok{my_dim <-}\StringTok{ }\KeywordTok{dim}\NormalTok{(M)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_dim)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 5
\end{verbatim}

In the case of objects with more than two dimensions, we can use the \texttt{array} function to create the object and \texttt{dim} to find its size. Have a look at the next example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create an array with three dimensions}
\NormalTok{my_array <-}\StringTok{ }\KeywordTok{array}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DataTypeTok{dim =} \KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{))}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_array)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> , , 1
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
R> 
R> , , 2
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
R> 
R> , , 3
R> 
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# display its dimensions}
\KeywordTok{print}\NormalTok{(}\KeywordTok{dim}\NormalTok{(my_array))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3 3 3
\end{verbatim}

An important note here is that \textbf{the use of functions \texttt{length}, \texttt{nrow}, \texttt{dim} and \texttt{ncol} are not intended to discover the number of letters in a text}. This is a common mistake and you should be aware of it. For example, if we had a \texttt{character} type of object and we use the \texttt{length} function, the result would be the following:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set text object}
\NormalTok{my_char <-}\StringTok{ 'abcde'}

\CommentTok{# print result of length}
\KeywordTok{print}\NormalTok{(}\KeywordTok{length}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1
\end{verbatim}

This occurred because the \texttt{length} function returns the number of elements in an object. In this case, \texttt{my\_char} has only one element. To find out the number of characters in the object, we use the \texttt{nchar} function as follows: \index{base!nchar}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find the number of characters in an character object}
\KeywordTok{print}\NormalTok{(}\KeywordTok{nchar}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5
\end{verbatim}

\hypertarget{selecting-elements-from-an-atomic-vector}{%
\section{Selecting Elements from an Atomic Vector}\label{selecting-elements-from-an-atomic-vector}}

After creating an atomic vector of a class, it is possible that the user is interested in only one or more elements of it. For example, if we were updating the value of an investment portfolio, our interest is only for the latest price of the stocks. All values from other dates are not relevant to our analysis and therefore could be safely ignored.

The selection of \emph{pieces} of an atomic vector is called indexing and it is accomplished with the use of square brackets (\texttt{{[}\ {]}}). Consider the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{7}\NormalTok{, }\FloatTok{3.5}\NormalTok{, }\FloatTok{4.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If we wanted only the third element of \texttt{my\_x}, we use the bracket operator as follows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get the third element of x}
\NormalTok{elem_x <-}\StringTok{ }\NormalTok{my_x[}\DecValTok{3}\NormalTok{]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(elem_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4
\end{verbatim}

Indexing also works using vectors containing the desired locations. If we are only interested in the last and penultimate values of \texttt{my\_x}, we use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector with indices}
\NormalTok{my_idx <-}\StringTok{  }\NormalTok{(}\KeywordTok{length}\NormalTok{(my_x)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{length}\NormalTok{(my_x) }

\CommentTok{# get last and penultimate value of my_x}
\NormalTok{piece_x_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{my_x[my_idx]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(piece_x_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3.5 4.3
\end{verbatim}

A cautionary note: \textbf{a unique property of the R language is that if a non-existing element of an object is accessed, the program returns the value \texttt{NA} (\emph{not available})}. See the next example code, where we attempt to obtain the fourth value of a vector with only three components.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set object}
\NormalTok{my_vec <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{# print non-existing fourth element}
\KeywordTok{print}\NormalTok{(my_vec[}\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] NA
\end{verbatim}

This is important because \texttt{NA} elements are contagious. That is, anything that interacts with \texttt{NA} will also become \texttt{NA}.The lack of treatment of these errors can lead to problems that are difficult to identify. In other programming languages, attempting to access non-existing elements generally returns an error and cancels the execution of the rest of the code.

\begin{rmdimportant}
Generally, the occurrence of \texttt{NA} (\emph{Not Available}) values
suggests a code problem. Always remember that \texttt{NA} indicates lack
of data and are contagious: anything that interacts with an \texttt{NA}
value will turn into another \texttt{NA}. \textbf{You should become
suspicious about your code every time that \texttt{NA} values are found
unexpectedly}. A manual inspection in the length and indexation of
vectors may be required.
\end{rmdimportant}

The use of indices is very useful when you are looking for items of a vector that satisfy some condition. For example, if we wanted to find out all values in \texttt{my\_x} that are greater than 3, we could use the following command:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find all values in my_x that is greater than 3}
\NormalTok{piece_x_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{my_x[my_x}\OperatorTok{>}\DecValTok{3}\NormalTok{]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(piece_x_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5.0 4.0 7.0 3.5 4.3
\end{verbatim}

It is also possible to index elements by more than one condition using the logical operators \texttt{\&} and \texttt{\textbar{}} (\emph{or}). For example, if we wanted the values of \texttt{my\_x} greater than 2 \textbf{and} lower than 4, we could use the following command: \index{logical operators}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find all values of my_x that are greater than 2 and lower then 4}
\NormalTok{piece_x_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\NormalTok{my_x[ (my_x }\OperatorTok{>}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(my_x }\OperatorTok{<}\StringTok{ }\DecValTok{4}\NormalTok{) ]}
\KeywordTok{print}\NormalTok{(piece_x_}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3.0 3.5
\end{verbatim}

Likewise, if we wanted all items that are lower than 3 \textbf{or} greater than 6, we use:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find all values of my_x that are lower than 3 or higher than 6}
\NormalTok{piece_x_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\NormalTok{my_x[ (my_x }\OperatorTok{<}\StringTok{ }\DecValTok{3}\NormalTok{) }\OperatorTok{|}\StringTok{ }\NormalTok{(my_x }\OperatorTok{>}\StringTok{ }\DecValTok{6}\NormalTok{) ]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(piece_x_}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 7
\end{verbatim}

Moreover, logic indexing also works with the interaction of different objects. That is, we can use a logical condition in one object to select items from another:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set my_x and my.y}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{12}\NormalTok{)}
\NormalTok{my_y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{, }\DecValTok{-3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{)}

\CommentTok{# find all elements of my_x where my.y is higher than 0}
\NormalTok{my_piece_x <-}\StringTok{ }\NormalTok{my_x[my_y }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{ ]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_piece_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  6  8 12
\end{verbatim}

Looking more closely at the indexing process, it is worth noting that, when we use a data indexing condition, we are in fact creating a variable of the \texttt{logical} type. This object takes only two values: \texttt{TRUE} and \texttt{FALSE}. Have a look in the code presented next, where we create a \texttt{logical} object, print it and present its class.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a logical object}
\NormalTok{my_logical <-}\StringTok{ }\NormalTok{my_y }\OperatorTok{>}\StringTok{ }\DecValTok{0}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_logical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find its class}
\KeywordTok{class}\NormalTok{(my_logical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "logical"
\end{verbatim}

Logical objects are very useful whenever we are testing a particular condition on a data set. We will learn more about this and other basic classes in chapter \ref{basic-classes}.

\hypertarget{removing-objects-from-the-memory}{%
\section{Removing Objects from the Memory}\label{removing-objects-from-the-memory}}

After creating several variables, the R environment can become full of used and disposable content. In this case, it is desirable to clear the memory to erase objects that are no longer needed. Generally, this is accomplished at the beginning of a script, so that every time the script runs, the memory will be cleared before any calculation. In addition to cleaning the computer's memory, it also helps to avoid possible errors in the code. In most cases, cleaning the working environment should be performed only once at the beginning of the script.

For example, given an object \texttt{x}, we can delete it from memory with the command \texttt{rm}, as shown next: \index{base!rm}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}

\CommentTok{# remove x}
\KeywordTok{rm}\NormalTok{(}\StringTok{'x'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After executing the command \texttt{rm(\textquotesingle{}x\textquotesingle{})}, the value of \texttt{x} is no longer available in the R session. In practical situations, however, it is desirable to clean up all the memory used by all objects created in R. We can achieve this goal with the following code:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(}\DataTypeTok{list =} \KeywordTok{ls}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

The term \texttt{list} in \texttt{rm(list\ =\ ls())} is a function argument of \texttt{rm} that defines which objects will be deleted. The \texttt{ls()} command shows all the currently available objects. Therefore, by chaining together both commands, we erase all current objects available in the environment. As mentioned before, it is a good programming policy to clear the memory before running the script. However, you should only wipe out all of R's memory if you have already saved the results of interest or if you can replicate them.

\begin{rmdcaution}
Clearing memory in \emph{scripts} is a controversial topic. Some authors
argue that it is better not to clear the memory as this can erase
important results. In my opinion, I think it is important to clear the
memory at the top of the script, as long as all results are
reproducible. When you start a code in a clean state -- no variables or
functions -- it becomes easier to understand and solve possible
\emph{bugs}.
\end{rmdcaution}

\hypertarget{displaying-and-setting-the-working-directory}{%
\section{Displaying and Setting the Working Directory}\label{displaying-and-setting-the-working-directory}}

Like other programming platforms, \textbf{R always works in a directory}. If no directory is set, a default value is used when R starts up. It is based on the working directory that R searches for files to load data or other R scripts. It is in this directory that R saves any output if we do not explicitly define a path on the computer. This output can be a graphic file, text or a spreadsheet. \textbf{It is a good programming policy is to change the working directory to the same place where the \emph{script} is located}.

The simplest way of checking the current working directory is looking at RStudio's prompt panel. At the top, in a small font and just below the word ``Console'', you'll see the working path. Using code, we can check the current working directory with function \texttt{getwd}: \index{base!getwd}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get current dir}
\NormalTok{my_dir <-}\StringTok{ }\KeywordTok{getwd}\NormalTok{()}

\CommentTok{# display it}
\KeywordTok{print}\NormalTok{(my_dir)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> C:/Dropbox/06-My Books/afedR-ed2/Book Content
\end{verbatim}

The result of the previous code shows the folder in which this book was written and compiled. As you can see, the book files are saved in a sub-folder of my Dropbox directory.

The change of the working directory is performed with the \texttt{setwd} command. For example, if we wanted to change our working directory to \emph{C:/My Research/}, simply type in the \emph{prompt}: \index{base!setwd}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set where to change directory}
\NormalTok{my_d <-}\StringTok{ 'C:/My Research/'}

\CommentTok{# change it}
\KeywordTok{setwd}\NormalTok{(my_d)}
\end{Highlighting}
\end{Shaded}

After changing the directory, importing and saving files in the \emph{C:/My Research/} folder will be a lot easier.

As for simple cases such as the above, remembering the directory name is not difficult. In practical cases, however, the working directory can be in a deeper directory of the file system. A simple and very efficient way of setting the working directory is using the \emph{autocomplete} feature of RStudio. Explained briefly, we can use the \emph{tab} key in the keyboard to navigate the computer's folders within RStudio. Give it a try with the following steps:

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  Write command \texttt{setwd(\textquotesingle{}\textquotesingle{})} in a script as it is, with an empty content for the inner character;
\item
  Place your cursor between the \texttt{\textquotesingle{}} symbols;
\item
  Press the \emph{tab} key.
\end{enumerate}

Now you'll be able to see your folders in a small window and use the arrows and \emph{enter} key to navigate. The autocomplete feature of RStudio goes much deeper than that. We will learn more about it in a future section of this chapter.

Another, more modern, way of setting the directory is to use the RStudio API package, which contains a set of functions that only work inside RStudio and provides information about current file, project and many more. To find out the path of the current R script being edited in RStudio and set the working directory to there, you can write:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_path <-}\StringTok{ }\KeywordTok{dirname}\NormalTok{(rstudioapi}\OperatorTok{::}\KeywordTok{getActiveDocumentContext}\NormalTok{()}\OperatorTok{$}\NormalTok{path)}
\KeywordTok{setwd}\NormalTok{(my_path)}
\end{Highlighting}
\end{Shaded}

This way, the script will change the directory to its own location, no matter where you copy it. Be aware, however, that this trick only works in RStudio's script editor and within a saved file. It will not work from the prompt.

Once you are working on the same path as the script, using relative paths is preferable. For example, if you are working in a folder that contains a subdirectory called \texttt{data}, you can enter this sub-folder with the code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# change to subfolder}
\KeywordTok{setwd}\NormalTok{(}\StringTok{'data'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Another possibility is to go to a previous level of the directory using \texttt{..}, as in:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# change to the previous level}
\KeywordTok{setwd}\NormalTok{(}\StringTok{'..'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

So, if you are working in directory \texttt{C:/My\ Research/} and execute the command \texttt{setwd(\textquotesingle{}..\textquotesingle{})}, the current folder becomes \texttt{C:/}, which is one level below \texttt{C:/My\ Research/}.

\hypertarget{canceling-code-execution}{%
\section{Canceling Code Execution}\label{canceling-code-execution}}

Whenever R is running some code, a visual cue in the shape of a small red circle in the right corner of the \emph{prompt} will appear. If you read it, the text shows the \emph{stop} word. This button is not only an indicator of running code but also a shortcut for canceling its execution. Another way to cancel an execution is to point the mouse to the \emph{prompt} and press the \emph{escape} (\emph{esc}) button from the keyboard.

To try it out, run the next chunk of code in RStudio and cancel its execution using \emph{esc}.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{100}\NormalTok{) \{}
  \KeywordTok{message}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Running code (please make it stop by hitting esc!)'}\NormalTok{)}
  \KeywordTok{Sys.sleep}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In the previous code, we used a \texttt{for} loop and function \texttt{Sys.sleep} to display the message \texttt{\textquotesingle{}\textbackslash{}nRunning\ code\ (please\ make\ it\ stop\ by\ hitting\ ESC!)\textquotesingle{}} one hundred times, every second. For now, do not worry about the code and functions used in the example. We will discuss the use of loops in chapter \ref{programming}.

\begin{rmdimportant}
Another very useful trick for defining working directories in R is to
use the \texttt{\textasciitilde{}} symbol. The tilda defines the
``Documents'' folder in \emph{Windows}, which is unique for each user.
Therefore, by running
\texttt{setwd(\textquotesingle{}\textasciitilde{}\textquotesingle{})},
you will direct R to a folder that is easily accessible.
\end{rmdimportant}

\hypertarget{code-comments}{%
\section{Code Comments}\label{code-comments}}

In R, comments are set using the hashtag symbol \texttt{\#}. Anything after this symbol will not be processed by R. This gives you the freedom to write whatever you want within the script. An example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# this is a comment (R will not parse it)}
\CommentTok{# this is another comment (R will again not parse it)}

\NormalTok{x <-}\StringTok{ 'abc'} \CommentTok{# this is an inline comment}
\end{Highlighting}
\end{Shaded}

Comments are an effective way to communicate any important information that cannot be directly inferred from the code. In general, you should avoid using comments that are too obvious or too generic:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# read CSV file}
\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{'data/data_file.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

As you can see, it is quite obvious from the line \texttt{df\ \textless{}-\ read.csv(\textquotesingle{}..\textquotesingle{})} that the code is reading a .csv file. The name of the function already states that. So, the comment was not a good one as it did not add any new information to the user. A better approach at commenting would be to set the author, description of the script and better explain the origin and last update of the data file. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Script for reproducing the results of JOHN (2019)}
\CommentTok{# Author: Mr data analyst (dontspamme@emailprovider.com)}
\CommentTok{# Last script update: 2020-01-10}
\CommentTok{#}
\CommentTok{# File downloaded from www.site.com/data-files/data_file.csv}
\CommentTok{# The description of the data goes here}
\CommentTok{# Last file update: 2020-01-10}

\NormalTok{df <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{'data/data_file.csv'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

So, by reading the comments, the user will know the purpose of the script, who wrote it and the date of the last edit. It also includes the origin of the data file and the date of the latest update. If the user wants to update the data, all he has to do is go to the referred website and download the new file.

Another productive use of comments is to set sections in the code, such as in:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Script for reproducing the results of JOHN (2019)}
\CommentTok{# Author: Mr data analyst (dontspamme@emailprovider.com)}
\CommentTok{# Last script update: 2020-01-10}
\CommentTok{#}
\CommentTok{# File downloaded from www.site.com/data-files/data_file.csv}
\CommentTok{# The description of the data goes here}
\CommentTok{# Last file update: 2020-01-10}

\CommentTok{# Clean data -------------------------}
\CommentTok{# - remove outliers}
\CommentTok{# - remove unnecessary columns}

\CommentTok{# Create descriptive tables ----------}


\CommentTok{# Estimate models --------------------}


\CommentTok{# Report results ---------------------}
\end{Highlighting}
\end{Shaded}

The use of a long line of dashes (-) at each section of the code is intentional. It causes RStudio to identify and bookmark the sections, with a link to them at the bottom of the script editor. Test it yourself, copy and paste the above code into a new R script, save it, and you'll see that the sections appear on a button between the editor and the prompt. Such a shortcut can save plenty of time in lengthy scripts.

\begin{rmdcaution}
When you start to share code with other people, you'll soon realize that
comments are essential and expected. They help transmit information that
is not available from the code. This is one way of a discerning novice
from experienced programmers. The later is always very communicative in
its comments (sometimes too much!). A note here, throughout the book
you'll see that the code comments are, most of the time, a bit obvious.
This was intentional as clear and direct messages are important for new
users, which is part of the audience of this book.
\end{rmdcaution}

\hypertarget{looking-for-help}{%
\section{Looking for Help}\label{looking-for-help}}

A common task in the use of R is to seek help. Even advanced users often seek instructions on specific tasks, whether it is to better understand the details of some functions or simply to study a new procedure. The use of the R help system is part of the everyday routine with the software and you should master it as soon as possible.

You can get help by using the \emph{help} panel in RStudio or directly from the \emph{prompt}. Simply enter the question mark next to the object on which you want help, as in \texttt{?mean}. In this case, object \texttt{means} is a function and the use of the \texttt{help} command will open a panel on the right side of RStudio. \index{base!help}

In R, the help screen of a function is the same as shown in Figure \ref{fig:example-help}. It presents a general description of the function, explains its input arguments and the format of the output. The help screen follows with references and suggestions for other related functions. More importantly, examples of usage are given last and can be copied to the prompt or script in order to accelerate the learning process.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/ExemploAjuda} 

}

\caption{Help screen for function mean}\label{fig:example-help}
\end{figure}

If we are looking for help for a given text and not a function name, we can use double question marks as in \texttt{??"standard\ deviation"}. This operation will search for the occurrence of the term in all packages of R and it is very useful to learn how to perform a particular task. In this case, we looked for the available functions to calculate the standard deviation of a vector.

As a suggestion, the easiest and most direct way to learn a new function is by trying out the examples in the manual. This way, you can see which type of input objects the function expects and what type of output it gives. Once you have it working, read the help screen to understand if it does exactly what you expected and what are the options for its use. If the function performs the desired procedure, you can copy and paste the example for your own \emph{script}, adjusting where necessary.

Another very important source of help is the Internet itself. Sites like \href{http://stackoverflow.com/}{stackoverflow} and specific \emph{mailing lists} and blogs, whose content is also on the Internet, are a valuable source of information. If you find a problem that could not be solved by reading the standard help files, the next logical step is to seek a solution using your error message or the description of the problem in search engines. In many cases, your problem, \textbf{no matter how specific it is, has already occurred and has been solved by other users}. In fact, it is more surprising \textbf{not} to find the solution for a programming problem on the internet, than the other way around.

\begin{rmdcaution}
Whenever you ask for help on the internet, always try to 1) describe
your problem clearly and 2) add a reproducible code of your problem.
Thus, the reader can easily verify what is happening by running the
example on his computer. I have no doubt that if you respect both rules,
a charitable person will soon help you with your problem.
\end{rmdcaution}

\hypertarget{autocomplete}{%
\section{\texorpdfstring{Using Code Completion with \emph{tab}}{Using Code Completion with tab}}\label{autocomplete}}

A very useful feature of RStudio is \emph{code completion}, an editing tool that facilitates the search of object names, packages, function arguments, and files. Its usage is very simple. After you type any first letter in the keyboard, just press \emph{tab} (left side of the keyboard, above \emph{capslock}) and a number of options will appear. See Figure \ref{fig:autocomplete-objects} where, after entering the \emph{f} letter and pressing \emph{tab}, a small window appears with a list of object names that begin with that letter. \index{code completion}

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/autocomplete_objects} 

}

\caption{Usage of autocomplete for object name}\label{fig:autocomplete-objects}
\end{figure}

The autocomplete feature is self-aware and will work differently depending on where it is called. As such, it works perfectly for searching for packages. For that, type \texttt{library()} in the prompt or editor, place the cursor in between the parentheses and press \emph{tab}. The result should look something like Figure \ref{fig:autocomplete-packages}, shown next.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/autocomplete_packages} 

}

\caption{Usage of autocomplete for packages}\label{fig:autocomplete-packages}
\end{figure}

Note that a description of the package or object is also offered by the code completion tool. This greatly facilitates the day to day work as the memorization of package names and R objects is not an easy task. The use of the \emph{tab} decreases the time to look up names, also avoiding possible coding errors.

The use of this tool becomes even more beneficial when objects and functions are named with some sort of pattern. In the rest of the book, you will notice that objects tend to be named with the prefix \emph{my}, as \texttt{my\_x}, \texttt{my\_num}, \texttt{my\_df}. Using this naming rule (or any other) facilitates the lookup for the names of objects created by the user. You can just type \texttt{my\_}, press \emph{tab}, and a list of objects will appear.

As mentioned in the previous section, you can also find files and folders on your computer using \emph{tab}. To try it, write the command \texttt{my\_file\ \textless{}-\ ""} in the prompt or a script, point the cursor to the middle of the quotes and press the \emph{tab} key. A screen with the files and folders from the current working directory should appear, as shown in Figure \ref{fig:autocomplete-files}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/autocomplete_files} 

}

\caption{Usage of autocomplete for files and folders}\label{fig:autocomplete-files}
\end{figure}

The use of autocomplete is also possible for finding the name and description of function arguments. To try it out, write \texttt{message()} and place the mouse cursor inside the parentheses. After that, press \emph{tab}. The result should be similar to Figure \ref{fig:autocomplete-args}. By using \emph{tab} inside of a function, we have the names of all arguments and their description -- a mirror of the information found in the help files.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/autocomplete_args} 

}

\caption{Usage of autocomplete for function arguments}\label{fig:autocomplete-args}
\end{figure}

Likewise, you can also search for a function within a package with \emph{tab}. For that, simply type the name of the package followed by two commas, as in \texttt{readr::}, and press \emph{tab}. The result should be similar to Figure \ref{fig:autocomplete-pkg-fct}

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/autocomplete_pkg_fcts} 

}

\caption{Usage of autocomplete for finding functions within a package}\label{fig:autocomplete-pkg-fct}
\end{figure}

Summing up, using code completion will make you more productive. You'll find names of files, objects, arguments, and packages much faster. Use it as much as you can and form a habit out of it.

\begin{rmdimportant}
\emph{Autocomplete} is one of the most important tools of RStudio,
helping users to find object names, locations on the hard disk, packages
and functions. Get used to using the \emph{tab} key and, soon enough,
you'll see how much the \emph{autocomplete} tool can help you write code
quickly, and without typos.
\end{rmdimportant}

\hypertarget{interacting-with-files-and-the-operating-system}{%
\section{Interacting with Files and the Operating System}\label{interacting-with-files-and-the-operating-system}}

As you are learning R, soon enough you'll find a data-related problem with a demand for interacting with files on the computer, either by creating new folders, decompressing and compressing files, listing and removing files from the hard drive of the computer or any other type of operation. R has full support for such type of operations. You can automate any type of computer task within an R script, if so needed.

\hypertarget{listing-files-and-folders}{%
\subsection{Listing Files and Folders}\label{listing-files-and-folders}}

To list files from your computer, use function \texttt{list.files}, where the \texttt{path} argument sets the directory to list the files from. For the compilation of the book, I've created a directory called \emph{data}. This folder contains all the data needed to recreate the book's examples. You can check the files in the sub-folder \texttt{data} with the following code: \index{base!list.files}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list files in data folder}
\NormalTok{my_files <-}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path =} \StringTok{"data"}\NormalTok{, }\DataTypeTok{full.names =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_files)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "data/batchgetsymbols_parallel_example.rds"       
R>  [2] "data/BGS_Cache"                                  
R>  [3] "data/FileWithLatinChar_ISO-8859-9.txt"           
R>  [4] "data/FileWithLatinChar_UTF-8.txt"                
R>  [5] "data/Financial Sample.xlsx"                      
R>  [6] "data/grunfeld.csv"                               
R>  [7] "data/MySQLiteDatabase.SQLITE"                    
R>  [8] "data/pride_and_prejudice.txt"                    
R>  [9] "data/SP500_Excel.xlsx"                           
R> [10] "data/SP500_long_yearly_2010-01-01_2019-11-04.rds"
R> [11] "data/SP500-Stocks_long.csv"                      
R> [12] "data/SP500-Stocks_wide.csv"                      
R> [13] "data/SP500-Stocks-WithRet.rds"                   
R> [14] "data/SP500.csv"                                  
R> [15] "data/SQLite_db.SQLITE"                           
R> [16] "data/temp_file.xlsx"                             
R> [17] "data/temp_fst.fst"                               
R> [18] "data/temp_rds.rds"                               
R> [19] "data/temp_writexl.xlsx"                          
R> [20] "data/temp_xlsx.xlsx"                             
R> [21] "data/temp.csv"                                   
R> [22] "data/temp.fst"                                   
R> [23] "data/temp.RData"                                 
R> [24] "data/temp.rds"                                   
R> [25] "data/temp.txt"                                   
R> [26] "data/temp.xlsx"                                  
R> [27] "data/top25babynames-by-sex-2005-2017.csv"        
R> [28] "data/UCI_Credit_Card.csv"
\end{verbatim}

There are several files with different extensions in this directory. These files contain data that will be used in future chapters. When using \texttt{list.files}, it is recommended to set input \texttt{full.names} as \texttt{TRUE}. This option makes sure that the names returned by the function contain the full path. It facilitates further manipulation, such as reading and importing information from data files. It is worth noting that you can also list the files recursively, that is, list all files from all sub-folders contained in the original address. To check it, try using the following code in your computer:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list all files for all subfolders (IT MAY TAKE SOME TIME...)}
\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path =} \KeywordTok{getwd}\NormalTok{(), }\DataTypeTok{recursive =}\NormalTok{ T, }\DataTypeTok{full.names =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The previous command will list all files in the current folder and sub-folders. Depending on the current working directory, it may take some time to run it all. If you executed it, be patient or just cancel it pressing \emph{esc} in your keyboard.

To list folders (directories) on your computer, use the command \texttt{list.dirs}. See below. \index{base!list.dirs}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# store names of directories}
\NormalTok{my_dirs <-}\StringTok{ }\KeywordTok{list.dirs}\NormalTok{(}\DataTypeTok{recursive =}\NormalTok{ F)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_dirs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "./_book"             "./_bookdown_files"  
R>  [3] "./.Rproj.user"       "./.vscode"          
R>  [5] "./afedR_ed_02_cache" "./afedR_ed_02_files"
R>  [7] "./bib-files"         "./blocks"           
R>  [9] "./css"               "./data"             
R> [11] "./ebook files"       "./eqs"              
R> [13] "./fig_ggplot"        "./figs"             
R> [15] "./ftp files"         "./html code"        
R> [17] "./images"            "./js"               
R> [19] "./latex"             "./many_datafiles"   
R> [21] "./many_datafiles_2"  "./mem_cache"        
R> [23] "./Other chapters"    "./quandl_cache"     
R> [25] "./Scripts"           "./tabs"
\end{verbatim}

The command \texttt{list.dirs(recursive\ =\ F)} listed all directories of the current path without recursion. The output shows the directories used to write the book. It includes the output directory of the book ( \texttt{./\_book}), the directory with the data (\texttt{./data}), among others. In this same directory, you can find the chapters of the book, organized by files and based on the \emph{RMarkdown} language (\texttt{.Rmd} file extension). To list only files with the extension \texttt{.Rmd}, we can use the \texttt{pattern} input in function \texttt{list.files} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list all files with the extension .Rmd}
\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{pattern =} \StringTok{"*.Rmd"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "_Welcome.Rmd"                    
R>  [2] "00a-About-new-edition.Rmd"       
R>  [3] "00b-Preface.Rmd"                 
R>  [4] "01-Introduction.Rmd"             
R>  [5] "02-Basic-operations.Rmd"         
R>  [6] "03-Research-scripts.Rmd"         
R>  [7] "04-Importing-exporting-local.Rmd"
R>  [8] "05-Importing-internet.Rmd"       
R>  [9] "06-Data-structure-objects.Rmd"   
R> [10] "07-Basic-objects.Rmd"            
R> [11] "08-Programming--ONLINE.Rmd"      
R> [12] "09-Cleaning-data--ONLINE.Rmd"    
R> [13] "10-Figures--ONLINE.Rmd"          
R> [14] "11-Models--ONLINE.Rmd"           
R> [15] "12-Reporting-results--ONLINE.Rmd"
R> [16] "13-Optimizing-code--ONLINE.Rmd"  
R> [17] "14-References.Rmd"               
R> [18] "afedR_ed02-ONLINE.Rmd"           
R> [19] "index.Rmd"
\end{verbatim}

The files presented above contain all the contents of this book, including this specific paragraph, located in file \texttt{02-Basic-operations.Rmd}!

\hypertarget{deleting-files-and-directories}{%
\subsection{Deleting Files and Directories}\label{deleting-files-and-directories}}

You can also use an R session to delete files and directories from your computer. This might come in handy when dealing with disposable data files. Use these commands with responsibility. If not careful, you can easily break the operating system of your computer.

You can delete files with command \texttt{file.remove}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create temporary file}
\NormalTok{my_file <-}\StringTok{ 'data/tempfile.csv'}
\KeywordTok{write.csv}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{),}
          \DataTypeTok{file =}\NormalTok{ my_file)}

\CommentTok{# delete it}
\KeywordTok{file.remove}\NormalTok{(my_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

Remember that you must have permission from your operating system to manipulate the hard drive and delete a file. In the previous chunk of code, the returned value \texttt{TRUE} tells us that the operation was successful.

To delete directories and all their elements, we use \texttt{unlink}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create temp dir}
\KeywordTok{dir.create}\NormalTok{(}\StringTok{'temp'}\NormalTok{)}

\CommentTok{# create a file inside of temp}
\NormalTok{my_file <-}\StringTok{ 'temp/tempfile.csv'}
\KeywordTok{write.csv}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{),}
          \DataTypeTok{file =}\NormalTok{ my_file)}

\KeywordTok{unlink}\NormalTok{(}\DataTypeTok{x =} \StringTok{'temp'}\NormalTok{, }\DataTypeTok{recursive =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Notice that, unlike \texttt{file.remove}, function \texttt{unlink} returns nothing. If needed, we can check if the deletion of a directory was successful with command \texttt{dir.exists}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dir.exists}\NormalTok{(}\StringTok{'temp'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] FALSE
\end{verbatim}

As expected, the directory was not found.

\hypertarget{downloading-files-from-the-internet}{%
\subsection{Downloading Files from the Internet}\label{downloading-files-from-the-internet}}

We can also use R to download files from the Internet with function \texttt{download.file}. See the following example, where we download an Excel spreadsheet from Microsoft's website:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set link}
\NormalTok{link_dl <-}\StringTok{ 'go.microsoft.com/fwlink/?LinkID=521962'}
\NormalTok{local_file <-}\StringTok{ 'data/temp_file.xlsx'} \CommentTok{# name of local file}

\KeywordTok{download.file}\NormalTok{(}\DataTypeTok{url =}\NormalTok{ link_dl,}
              \DataTypeTok{destfile =}\NormalTok{ local_file)}
\end{Highlighting}
\end{Shaded}

Using \texttt{download.file} is quite handy when you are working with Internet data that is constantly updated. Just re-download the file with data at the beginning of the \emph{script}. After that, we could continue the code by reading the downloaded file and performing our analysis.

One trick worth knowing is that you can also download files from cloud services such as \href{https://www.dropbox.com/}{Dropbox}\footnote{\url{https://www.dropbox.com/}} and \href{https://drive.google.com/}{Google Drive}\footnote{\url{https://drive.google.com/}}. So, if you need to send a data file to a large group of people and update it frequently, just pass the file link from the cloud service. This way, any local change in the data file in your computer will be reflected for all users with the file link.

\begin{rmdcaution}
Needless to say, \textbf{be very careful} with commands
\texttt{file.remove} and \texttt{unlink}, especially when using
recursion (\texttt{recursive\ =\ TRUE}). One simple mistake and
important parts of your hard drive can be erased, leaving your computer
inoperable. Be aware that R \textbf{permanently deletes} files and do
move them to the trash folder. Therefore, when deleting directories with
\texttt{unlink}, you will be unable to recover the files easily.
\end{rmdcaution}

\hypertarget{using-temporary-files-and-directories}{%
\subsection{Using Temporary Files and Directories}\label{using-temporary-files-and-directories}}

An interesting aspect of R is that every new session is linked to a temporary folder within the computer. This folder is used to store any disposable files and folders generated by R. The location of this directory is available with \texttt{tempdir}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{windows_tempdir <-}\StringTok{ }\KeywordTok{tempdir}\NormalTok{()}
\KeywordTok{print}\NormalTok{(windows_tempdir)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> C:\Users\NAME\AppData\Local\Temp\Rtmp8E
\end{verbatim}

The name of the temporary directory, in this case `\texttt{Rtmp8E\textquotesingle{}}, is randomly defined at the start of every new R session. When the computer is rebooted, all temporary directories are deleted.

The same dynamic is found for file names. If you want to use a temporary random name for some reason, use \texttt{tempfile}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{windows_tempfile <-}\StringTok{ }\KeywordTok{tempfile}\NormalTok{(}\DataTypeTok{pattern =} \StringTok{'temp_'}\NormalTok{,}
                             \DataTypeTok{fileext =} \StringTok{'.xlsx'}\NormalTok{)}
\KeywordTok{message}\NormalTok{(windows_tempfile)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> C:\Users\NAME\AppData\Local\Temp\Rtmp8E\temp_4365730565.xlsx
\end{verbatim}

You can also set its extension and name:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{windows_tempfile <-}\StringTok{ }\KeywordTok{tempfile}\NormalTok{(}\DataTypeTok{pattern =} \StringTok{'temp_'}\NormalTok{, }
                             \DataTypeTok{fileext =} \StringTok{'.csv'}\NormalTok{)}
\KeywordTok{message}\NormalTok{(windows_tempfile)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> C:\Users\NAME\AppData\Local\Temp\Rtmp8E\temp_43664e87729.csv
\end{verbatim}

As a practical case of using temporary files and folders, let's \emph{download} the Excel worksheet from Microsoft into a temporary folder and read its content for the first five rows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set link}
\NormalTok{link_dl <-}\StringTok{ 'go.microsoft.com/fwlink/?LinkID=521962'}
\NormalTok{local_file <-}\StringTok{ }\KeywordTok{tempfile}\NormalTok{(}\DataTypeTok{fileext =} \StringTok{'.xlsx'}\NormalTok{, }\DataTypeTok{tmpdir =} \KeywordTok{tempdir}\NormalTok{())}

\KeywordTok{download.file}\NormalTok{(}\DataTypeTok{url =}\NormalTok{ link_dl,}
              \DataTypeTok{destfile =}\NormalTok{ local_file)}

\NormalTok{df_msft <-}\StringTok{ }\NormalTok{readxl}\OperatorTok{::}\KeywordTok{read_excel}\NormalTok{(local_file)}

\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(df_msft))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 16
R>   Segment    Country Product   `Discount Band` `Units Sold`
R>   <chr>      <chr>   <chr>     <chr>                  <dbl>
R> 1 Government Canada  Carretera None                   1618.
R> 2 Government Germany Carretera None                   1321 
R> 3 Midmarket  France  Carretera None                   2178 
R> 4 Midmarket  Germany Carretera None                    888 
R> 5 Midmarket  Mexico  Carretera None                   2470 
R> 6 Government Germany Carretera None                   1513 
R> # ... with 11 more variables: Manufacturing Price <dbl>,
R> #   Sale Price <dbl>, Gross Sales <dbl>, Discounts <dbl>,
R> #   Sales <dbl>, COGS <dbl>, Profit <dbl>, Date <dttm>,
R> #   Month Number <dbl>, Month Name <chr>, Year <chr>
\end{verbatim}

The example Excel file contains the sales report of a company. Do notice that the imported file becomes a \texttt{dataframe} in our R session, a table like an object with rows and columns.

By using \texttt{tempfile}, we do not need to delete (or worry) about the downloaded file because it will be removed from the computer's hard disk when the system is rebooted.

\hypertarget{exercises-basic-exercises}{%
\section{Exercises}\label{exercises-basic-exercises}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
In RStudio, create a new \emph{script} and save it in a personal folder. Now, write R commands in the script that define two objects: one holding a sequence between 1 and 100 and the other with the text of your name (ex. `Richard'). Execute the whole script with the keyboard shortcuts.

02 -
In the previously created \emph{script}, use function \texttt{message} to display the following phrase in R's \emph{prompt}:\texttt{"My\ name\ is\ ...."}.

03 -
Within the same script, show the current working directory (see function \texttt{getwd}, as in \texttt{print(getwd())}). Now, change your working directory to \emph{Desktop} (\emph{Desktop}) and show the following message on the \emph{prompt} screen: \texttt{\textquotesingle{}My\ desktop\ address\ is\ ....\textquotesingle{}}. Tip: use and abuse of RStudio's \emph{autocomplete} tool to quickly find the \emph{desktop} folder.

04 -
Use R to download the compressed zip file with the book material, available at this \href{https://www.msperlin.com/blog/files/afedr-files/afedR-code-and-data.zip}{link}\footnote{\url{https://www.msperlin.com/blog/files/afedr-files/afedR-code-and-data.zip}}. Save it as a file in the temporary session folder (see function \texttt{tempfile}).

05 -
Use the \texttt{unzip} function to unzip the downloaded file from previous question to a directory called\texttt{\textquotesingle{}afedR-files\textquotesingle{}} inside the ``Desktop'' folder. How many files are available in the resulting folder? Tip: use the \texttt{recursive\ =\ TRUE} argument with \texttt{list.files} to also search for all available subdirectories.

06 -
Every time the user installs an R package, all package files are stored locally in a specific directory of the hard disk. Using command \texttt{Sys.getenv(\textquotesingle{}R\_LIBS\_USER\textquotesingle{})} and \texttt{list.dirs}, list all the directories in this folder. How many packages are available in this folder on your computer?

07 -
In the same topic as previous exercise, list all files in all subfolders in the directory containing the files for the different packages (see command \texttt{Sys.getenv(\textquotesingle{}R\_LIBS\_USER\textquotesingle{})}). On average, how many files are needed for each package?

08 -
Use the \texttt{install.packages} function to install the \texttt{BatchGetSymbols} package on your computer. After installation, use function \texttt{BatchGetSymbols} to download price data for the IBM stock in the last 15 days. Tips: 1) use function \texttt{Sys.Date()} to find out the current date and \texttt{Sys.Date()-\ 15} to calculate the date located 15 days in the past; 2) note that the output of \texttt{BatchGetSymbols} is a list -- a special type of object -- and that the price data is located in the second element of that list.

09 -
The \texttt{cranlogs} package allows access to downloads statistics of CRAN packages. After installing \texttt{cranlogs} on your computer, use the \texttt{cranlogs::cran\_top\_downloads} function to check which are the 10 most installed packages by the global community in the last month. Which package comes first? Tip: Set the \texttt{cran\_top\_downloads} function input to \texttt{when\ =\ \textquotesingle{}last-month\textquotesingle{}}. Also, be aware that the answer here may not be the same as you got because it depends on the day the R code was executed.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  dplyr
\item
  sf
\item
  rlang
\item
  vctrs
\item
  jsonlite
\end{enumerate}

10 -
Using the \texttt{devtools} package, install the development version of the \texttt{ggplot2} package, available in the \href{https://github.com/hadley}{Hadley Hickman repository}. Load the package using \texttt{library} and create a simple figure with the code \texttt{qplot(y\ =\ rnorm(10),\ x\ =\ 1:10)}.

11 -
Using your programming ability check on your computer which folder, from the ``Documents'' directory (shortcut = \texttt{\textasciitilde{}}), has the largest number of files. Display the five folders with the largest number of files on R's prompt.

\hypertarget{research-scripts}{%
\chapter{Writing Research Scripts}\label{research-scripts}}

So far we learned how to use R for basic tasks such as interacting with the computer, creating simple vectors and downloading files from the internet. Although, before we import large volume tables into R and analyze them, we need to discuss the structure of a research script and, more specifically, how to organize our work efficiently. \index{Research scripts}

An organized code facilitates sharing and future use. As a research code becomes larger and complex, organization is a necessity. In this chapter, I will suggest a way to organize files and folders. So, I recommend that you follow these guidelines -- or at least your own version of them -- in every project you work on.

\hypertarget{stages-of-research}{%
\section{Stages of Research}\label{stages-of-research}}

Unlike other software designs, every research script has clear consecutive steps to achieve its goal.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{Importation of data}: Raw (original) data is imported from a local file or the internet. At this stage, no manual data manipulation, such as renaming columns names at a .csv file, should happen. The raw data should be imported ``as it is''. Save any required and reproducible manipulation for the next stage.
\item
  \textbf{Cleaning and structuring the data}: The raw data imported in the previous step is further cleaned and structured according to the need of the research. Abnormal records and errors in observations can be removed or treated. The structure of the data can also be manipulated, binding different datasets and adding other variables of interest. Preferably, at the end of this stage, there should be a couple of final datasets that will be used in the next stage.
\item
  \textbf{Visual analysis and hypothesis testing}: After cleansing and structuring the data, the work continues with implementing the visual analysis and hypothesis testing. Here, you can create graphical representations of the data for your audience and use statistical tools, such as econometric models, to test a particular hypothesis. This is the \emph{heart} of the research and the stage most likely to take more development time.
\item
  \textbf{Reporting the results}: The final stage of a research script is reporting the results. Likely, we will be exporting selected tables and figures from R to a text processing software such as Latex, Writer (LibreOffice) or Word (Microsoft).
\end{enumerate}

Each of the mentioned steps can be structured in a single \emph{.R} script or in several separate files. Using multiple files is preferable when the first steps of the research demand significant processing time. For example, in importing and organizing a large volume database, it is worth the trouble to separate the code in different files. It will be easier to find bugs and maintain the code. Each script will do one job, and do it well.

A practical example would be the analysis of a large dataset of financial transactions. Importing and cleansing the data takes plenty of computer time. A smart organization is to insert these primary data procedures in a \emph{.R} file and save the final objects of this stage in an external file. This local archive serves as a bridge to the next step, hypothesis testing, where the previously created file with clean data is imported. Every time a change is made to the hypothesis testing script, it is unnecessary to rebuild the whole dataset. This simple organization of files saves a lot of time. The underlying logic is simple, isolate the parts of the script that demand more computational time -- and less development --, and connect them to the rest of the code using external data files.

If you are working with multiple files, one suggestion is to create a naming structure that informs the steps of the research in an intuitive way. An example would be to name the data importing code as \texttt{01-Import-and-clean-data.R}, the modeling code as \texttt{02-build-report-models.R} and so on. The practical effect is that using a number in the first letter of the filenames clarifies the order of execution. We can also create a \emph{master} script called \texttt{0-run-it-all.R} or \texttt{0-main.R} that runs (\texttt{source}) all other scripts. So, every time we make an update to the original data, we can simply run \texttt{0-run-it-all.R} and will have the new results, without the need to run each script individually.

\hypertarget{directories}{%
\section{Folder Structure}\label{directories}}

A proper folder structure also benefits the reproducibility and organization of research. In simple scripts, with a small database and a low number of procedures, it is unnecessary to spend much time thinking about the organization of files, just place all files in the same directory. This is certainly the case for most of the code in this book. More complex programs, with several stages of data cleansing, hypothesis testing, and several sources of data, organizing the file structure is essential. \index{Folder structure}

A suggestion for an effective folder structure is to create a single directory and, within it, create subdirectories for each input and output element. For example, you can create a subdirectory called \texttt{data}, where all the original data will be stored, a directory \texttt{fig} and \texttt{tables}, where figures and tables with final results will be exported. If you are using many custom-written functions in the scripts, you can also create a directory called \texttt{R-Fcts} and save all files with function definitions at this location. As for the root of the directory, you should only find the main research scripts there. An example of a file structure that summarizes this idea is: \index{folder structure}

\begin{verbatim}
/Capital Markets and Inflation/
    /data/
        stock_indices.csv
        inflation_data.csv
    /figs/
        SP500_and_inflation.png
    /tables/
        Table1_descriptive_table.tex
        Table2_model_results.tex
    /R-Fcts/
        fct_models.R
        fct_clean_data.R
    0-run-it-all.R
    1-import-and-clean-data.R
    2-run-research.R
\end{verbatim}

The research code should also be self-contained, with all files available within a sub-folder of the root directory. If you are using many different R packages, it is advisable to add a comment in the first lines of \texttt{0-run-it-all.R} that indicates which packages are necessary to run the code. The most friendly way to inform it is by adding a commented line that installs all required packages, as in \texttt{\#install.packages(\textquotesingle{}pkg1\textquotesingle{},\ \textquotesingle{}pkg2\textquotesingle{},\ ...)}. So, when someone receives the code for the first time, all he (or she) needs to do is uncomment the line and execute it. External dependencies and steps for their installation should also be informed.

The benefits of this directory format are as follows. If you need to share the code with other researchers, simply compress the directory to a single file and send it to the recipient. After decompressing the file, the structure of the folder immediately informs the user were to change the original data, the order of execution of the scripts in the root folder, and where the outputs are saved. The same benefit goes when you reuse your code in the future, say three years from now. By working smarter, you will be more productive, spending less time with repetitive and unnecessary steps.

An example for the content of file \texttt{0-run-it-all.R} would be:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# clean up workspace}
\KeywordTok{rm}\NormalTok{(}\DataTypeTok{list=}\KeywordTok{ls}\NormalTok{())}

\CommentTok{# close all figure windows created with x11()}
\KeywordTok{graphics.off}\NormalTok{()}

\CommentTok{# load packages}
\KeywordTok{library}\NormalTok{(pkg1)}
\KeywordTok{library}\NormalTok{(pkg2)}
\KeywordTok{library}\NormalTok{(pkg3)}

\CommentTok{# change directory}
\NormalTok{my_dir <-}\StringTok{ }\KeywordTok{dirname}\NormalTok{(rstudioapi}\OperatorTok{::}\KeywordTok{getActiveDocumentContext}\NormalTok{()}\OperatorTok{$}\NormalTok{path)}
\KeywordTok{setwd}\NormalTok{(my_dir)}

\CommentTok{# list  functions in 'R-Fcts'}
\NormalTok{my_R_files <-}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path=}\StringTok{'R-Fcts'}\NormalTok{,}
                         \DataTypeTok{pattern =} \StringTok{'*.R'}\NormalTok{,}
                         \DataTypeTok{full.names=}\OtherTok{TRUE}\NormalTok{)}

\CommentTok{# Load all functions in R}
\KeywordTok{sapply}\NormalTok{(my_R_files, source)}

\CommentTok{# Import data script}
\KeywordTok{source}\NormalTok{(}\StringTok{'01-import-and-clean-data.R'}\NormalTok{)}

\CommentTok{# run models and report results}
\KeywordTok{source}\NormalTok{(}\StringTok{'02-run-research.R'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This is the first time we use functions \texttt{graphics.off} and \texttt{sapply}. The first one simply closes all windows used to display a figure. In a research script, sometimes you may have many graphical windows opened and it is wise to close them all. Command \texttt{sapply} will apply a function, in this case \texttt{source}, to a series of elements. Here, the practical effect is that all files located at folder \texttt{R-Fcts} and with extension \emph{.R} will be executed. In chapter \ref{programming} we will learn more about \texttt{sapply} and its variants.

Notice that, assuming all packages are installed, no extra step is needed to run the above code successfully on another computer. We could also automate the copy of the figure and table files used in the report with \texttt{file.copy}. From there, you can create a link in the text for each figure file. As an example, in LaTeX, you can include a figure file with the command \texttt{\textbackslash{}includegraphics\{file\_name\_here\}}. You can also create a direct link for the figure file in the research folder, although this method is not recommended since it creates an external dependency on the written report. Either way, whenever the main code is executed, all research figures will be automatically updated in the text. If needed, you can also produce table files in different formats using packages \texttt{xtable} \citep{R-xtable} and \texttt{texreg} \citep{R-texreg}. We will go deeper into this subject in chapter \ref{reporting}.

Another way of setting up directories in a research script is by using an RStudio project. For that, open RStudio and go to \emph{File}, \emph{New Project}, \emph{New Directory}, and choose a folder and project name. RStudio will create a file with the \emph{.RProj} extension in the chosen directory. Every time you want to work on the project, just open the project file in RStudio.

The benefit of this approach is that it is unnecessary to change the directory in the code. The project automatically changes it to the location of the \emph{.RProj} file. Various information is saved, including the history of files being edited, a history of project commands, among other things. Besides that, custom options for the project can also be made. It's worth noting that \emph{.RProj} file is pure text and editable. You can open it in any text editor of your operating system and see how it stores many startup options for R.

\hypertarget{important-aspects-of-a-research-script}{%
\section{Important Aspects of a Research Script}\label{important-aspects-of-a-research-script}}

In this section I'll be making some suggestions for how you can conduct research with R. Making it clear, these are personal positions from my experience as a researcher and teacher. Many points raised here are specific to the academic environment but can be easily extended to the practice of research outside universities. In short, these are suggestions I wish I knew when I first started my career.

Firstly, \textbf{know your data!}. I can't stress enough how this is important! The first instinct of every passionate data analyst when encountering a new set of tables is to immediately import it into R and perform an analysis. However, a certain level of caution is needed. Every time you come across a new set of data, ask yourself how much you \textbf{really} know about this data:

\begin{itemize}
\tightlist
\item
  How was the data collected? To what purpose?
\item
  How do the available data compare with data used in other studies?
\item
  Is there any possibility of bias within the data collection?
\end{itemize}

Furthermore, you need to remember that the ultimate goal of any research is communication. Thus, it is very likely that you will report your results to people who will have an informed opinion about the subject, including the sources and individualities of different datasets. The worst case scenario is when a research effort of three to six months in between coding and writing is nullified by a simple lapse in data checking. Unfortunately, this is not uncommon.

As an example, consider the case of analyzing the long term performance of companies in the retail business. For that, you gather a recent list of available companies and download financial records about their revenue, profit and adjusted stock price for the past twenty years. Well, the problem here is in the selection of the companies. By taking those that are available today, you missed all companies that went bankrupt during the 20 year period. By looking only at companies that stayed active during the whole period, you indirectly selected those that are profitable and presented good performance. This is a well-known effect called \textbf{survival bias}. The right way of doing this research is gathering a list of companies in the retail business twenty years ago and keep track of those that went bankrupt and those that stayed alive.

The message is clear. \textbf{Be very cautious about the data you are using}. Your raw tables stand at the base of the research. A small detail that goes unnoticed can invalidate your whole work. If you are lucky and the database is accompanied by a written manual, break it down to the last detail. If the information is not clear, do not be shy about sending questions to the responsible party. Likewise, if there is an inevitable operational bias in your dataset, be open and transparent about it.

The second point here is the code. After you finish reading this book, you will have the knowledge to conduct research with R. The computer will be a powerful ally in making your research ideas come true, no matter how gigantic they may be. However, \textbf{a great power comes with great responsibility}. Likewise, you need to be aware that a single misplace line in a code can easily bias and invalidate your research.

Remember that analyzing data is your profession and \textbf{your reputation is your most valuable asset}. If you have no confidence in the produced code, do not publish or communicate your results. The code is entirely your responsibility and no one else's. Check it as many times as necessary. Always be skeptical about your own work:

\begin{itemize}
\tightlist
\item
  Do the descriptive statistics of the variables faithfully report the database?
\item
  Is there any relationship between the variables that can be verified in the descriptive table?
\item
  Do the main findings of the research make sense to the current literature of the subject? If not, how to explain them?
\item
  Is it possible that a \emph{bug} in the code has produced the results?
\end{itemize}

I'm constantly surprised by how many studies submitted to respected periodicals can be denied publication based on a simple analysis of the descriptive table. Basic errors in variable calculations can be easily spotted with a trained eye. The process of continuous evaluation of your research will not only make you stronger as a researcher but will also serve as practice for peer evaluation, much used in academic research. If you do not have enough confidence to report results, test your code extensively. If you have already done so and are still not confident, identify the lines of code you have doubts and seek help with a colleague or your advisor, if there is one. The latter is a strong ally who can help you in dealing with problems he/she already had.

All of the research work is, to some extent, based on existing work. Today it is extremely difficult to carry out ground-breaking research. Knowledge is built in the form of blocks, one over the other. There is always a collection of literature that needs to be consulted. Particularly in the case of data research. Therefore, you should always compare your results with the results already presented in the subject, especially when it is replicated. If the main results are not similar to those found in the literature, one should ask himself: could a code error have created this result?

I clarify that it is possible that the results of research differ from those of the literature, but the opposite is more likely. Knowledge of this demands care with your code. \emph{Bugs} and code errors are quite common, especially in early versions of scripts. As a data analyst, it is important to recognize this risk and manage it.

\hypertarget{exercises-1}{%
\section{Exercises}\label{exercises-1}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Imagine a survey involving analyzing your household budget over time. Data are available in electronic spreadsheets separated by month, for 10 years. The objective of the research is to understand if it is possible to purchase a real state property in the next five years. Within this setup, detail in text the elements in each stage of the study, from importing the data to the construction of the report.

02 -
Based on the study proposed earlier, create a directory structure on your computer to accommodate the study. Create mock files for each subdirectory (see directory structure at section \ref{directories}). Be aware you can create mock files and direction all in R (see functions \texttt{cat} and \texttt{dir.create}).

\hypertarget{importing}{%
\chapter{Importing Data from Local Files}\label{importing}}

Surely, the very first step of script is getting your data into R. In this chapter, we will learn to import and export data available as local files in the computer. Although the task is not particularly difficult, a good data analyst should understand the different characteristics of file formats and how to take the best advantage of them in every situation. While some are best suited for sharing and collaboration, others can offer a significant boost in reading and writing speeds.

Here we will draw a comprehensive list of file formats for importing and exporting data, including:

\begin{itemize}
\tightlist
\item
  Text data with comma-separated values (\emph{csv});
\item
  Microsoft Excel (\emph{xls}, \emph{xlsx});
\item
  R native files (\emph{RData}, \emph{rds});
\item
  \texttt{fst} format;
\item
  SQLite;
\item
  Unstructured text data.
\end{itemize}

The first lesson in importing data from local files is that the location of the file must be explicitly stated in the code. The path of the file is then passed to a function that will read the file. The best way to work with paths is to use the \emph{autocomplete} feature of RStudio (see section \ref{autocomplete}). An example of full path is:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_file <-}\StringTok{ 'C:/My Research/data/SP500_Data.csv'}
\end{Highlighting}
\end{Shaded}

Note the use of forwarding slashes (\texttt{/}) to designate the file directory. Relative references also work, as in:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_file <-}\StringTok{ 'data/SP500_Data.csv'}
\end{Highlighting}
\end{Shaded}

Here, it is assumed that in the current working folder there is a directory called \texttt{data} and, inside of it, exists a file called \texttt{SP500\_Data.csv}. If the file path is simply its name, such as in \texttt{my\_file\ \textless{}-\ \textquotesingle{}SP500\_Data.csv\textquotesingle{}}, it is implicitly assumed that the file is located in the root of the working directory. From the previous chapter, recall you can use \texttt{setwd} to change the working folder to where the work is being done and simply use the relative path of the data file. An example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setwd}\NormalTok{(}\StringTok{'C:/My Research'}\NormalTok{)}
\NormalTok{my_file <-}\StringTok{ 'data/SP500_Data.csv'}
\end{Highlighting}
\end{Shaded}

\begin{rmdimportant}
Here, again, I reinforce the use of \emph{tab} and the
\emph{autocomplete} tool of RStudio. It is much more \textbf{easier and
practical} to find files on your computer's hard disk using \emph{tab}
navigation than to copy and paste the address from your file explorer.
To use it, open double or quotes in RStudio, place the \emph{mouse}
cursor in between the quotes and press \emph{tab}.
\end{rmdimportant}

Another very important point here is that \textbf{the data will be imported and exported in R as an object of type \texttt{dataframe}}. That is, a table contained in an Excel or \emph{.csv} file will become a \texttt{dataframe} object in R. When we export data, the most common format is this same type of object. Conveniently, \texttt{dataframes} are nothing more than tables, with rows and columns.

Each column in the \texttt{dataframe} will have its own class, the most common being numeric (\emph{numeric}), text (\emph{character}), factor (\emph{factor}) and date (\emph{Date}). When importing the data, \textbf{it is imperative that each column is represented in the correct class}. A vast amount of errors can be avoided by simply checking the column classes in the \texttt{dataframe} resulting from the import process. For now, we only need to understand this basic property of \texttt{dataframes}. We will study the details of this object in chapter \ref{data-structure-objects}.

\hypertarget{csv-files}{%
\section{\texorpdfstring{\emph{csv} files}{csv files}}\label{csv-files}}

Consider a data file called SP500.csv, available in the book package. It contains daily closing prices of the SP500 index from 2010-01-04 until 2020-12-30. We will now use package \texttt{afedR} for finding the file and copying it to your local folder. If you followed the instructions in the book preface chapter, you should have package \texttt{afedR} already installed. If not, execute the following code: \index{file types!.csv}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# install devtools dependency}
\KeywordTok{install.packages}\NormalTok{(}\StringTok{'devtools'}\NormalTok{)}

\CommentTok{# install book package}
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{'msperlin/afedR'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once you installed package \texttt{afedR}, file SP500.csv and all other data files used in the book were downloaded from Github. The package also includes functions for facilitating the reproduction of code examples. Command \texttt{afedR::get\_data\_file} will return the local path of a book data file by its name.

Let's copy SP500.csv to your ``My Documents'' folder with the following code using the tilde (\texttt{\textasciitilde{}}) shortcut:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'SP500.csv'}\NormalTok{)}
\KeywordTok{file.copy}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ my_f, }\DataTypeTok{to =} \StringTok{'~'}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

Now, if it is your first time working with \emph{.csv} files, use a file browser (Explorer in Windows) and open SP500.csv in the ``My Documents'' folder with any text editor software such as Notepad (see figure \ref{fig:notepad}). The first lines of SP500.csv, also called header lines, show the column names. Following international standards, rows are set using line breaks, and all columns are separated by commas (\texttt{,}).

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/example_csv_notepad} 

}

\caption{Ibov.csv in Notepad}\label{fig:notepad}
\end{figure}

The content of SP500.csv is standard and we should have no problem importing the data in R. However, you should be aware this is not always the case. So, if you want to avoid the common issues, I suggest that you use a set of steps that can avoid most problems in importing data from \emph{.csv} files:

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  Check the existence of text before the actual data. A standard \emph{.csv} file will only have the contents of a table but, sometimes, you will find a header text with some details about the data. In R, you can control how many lines you skip in the \emph{csv} reading function;
\item
  Verify the existence of names for all columns and if those names are readable;
\item
  Check the symbol for column separation. Normally it is a comma, but you never know for sure;
\item
  For the numerical data, verify the decimal symbol. R will expect it to be a dot. If necessary, you can adjust this information in the CSV reading function.
\item
  Check the encoding of the text file. Normally it is one of UTF-8, Latin1 (ISO-8859) or Windows 1252. These are broad encoding formats and should suffice for most languages. Whenever you find strange symbols in the text columns of the resulting \texttt{dataframe}, the problem is due to a difference in encoding. While the file is encoded in a specific format, R is reading it with a different encoding structure. Windows users can check the encoding of a text file by opening it in \href{https://notepad-plus-plus.org/}{Notepad++}\footnote{\url{https://notepad-plus-plus.org/}}. The information about the encoding will be available in the bottom right corner of the Notepad++ editor. Linux and Mac users can find the same information in any advanced text editor software such as \href{https://kate-editor.org/}{Kate}\footnote{\url{https://kate-editor.org/}}.
\end{enumerate}

\begin{rmdimportant}
Whenever you find an unexpected text structure in a \emph{.csv} file,
use the arguments of the \emph{csv} reading function to import the
information correctly. As a rule of thumb, \textbf{never modify raw .csv
data manually}. Its far more efficient to use the R code to deal with
different structures of \emph{.csv} files. It takes a bit of work, but
such a policy will save you a lot of time in the future as, in a couple
of months, you are unlikely to remember how you manually cleaned that
\emph{.csv} file for your R script.
\end{rmdimportant}

\hypertarget{importing-data}{%
\subsection{Importing Data}\label{importing-data}}

The \texttt{base} package of R includes a native function called \texttt{read.csv} for importing data from \emph{.csv} files. However, we will prefer the \texttt{tidyverse} alternative, \texttt{readr::read\_csv} \citep{R-readr}, as it is more efficient and easier to work with. In short, the benefit is that it reads the data very quickly, and it uses clever rules for defining the classes of imported columns.

This is the first package from the \texttt{tidyverse} that we will use. Before doing so, it is necessary to install it in your R session. A simple way of installing all \texttt{tidyverse} packages as a bundle is as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\StringTok{'tidyverse'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After running the previous code, all \texttt{tidyverse} packages will be installed on your computer. Once it finishes, let's load the \texttt{tidyverse} set of packages.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load library}
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

Back to importing data from \emph{.csv} files, to load the contents of file SP500.csv in R, use the \texttt{readr::read\_csv} function. \index{readr!read\_csv}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file to read}
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'SP500.csv'}\NormalTok{)}

\CommentTok{# read file}
\NormalTok{my_df_sp500 <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> -- Column specification ------------------------------------
R> cols(
R>   ref.date = col_date(format = ""),
R>   price.close = col_double()
R> )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df_sp500))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 2
R>   ref.date   price.close
R>   <date>           <dbl>
R> 1 2010-01-04       70045
R> 2 2010-01-05       70240
R> 3 2010-01-06       70729
R> 4 2010-01-07       70451
R> 5 2010-01-08       70263
R> 6 2010-01-11       70433
\end{verbatim}

The contents of the imported file becomes a \texttt{dataframe} object in R. As mentioned in the previous chapter, each column of a \texttt{dataframe} has a class. We can check the classes of \texttt{my\_df\_sp500} using function \texttt{glimpse} from package \texttt{dplyr}, which is also part of the \texttt{tidyverse}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check the content of dataframe}
\KeywordTok{glimpse}\NormalTok{(my_df_sp500)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,718
R> Columns: 2
R> $ ref.date    <date> 2010-01-04, 2010-01-05, 2010-01-06, 2~
R> $ price.close <dbl> 70045, 70240, 70729, 70451, 70263, 704~
\end{verbatim}

Note that the column of dates -- \texttt{ref.date} -- was imported as a \texttt{Date} vector and the closing prices -- \texttt{price.close} -- as numeric (\texttt{dbl}, double accuracy). This is exactly what we expected. Internally, function \texttt{read\_csv} identifies columns classes according to their content.

Notice how the previous code presented a message entitled \texttt{Parsed\ with\ column\ specification:\ ...}. This message shows how the function sets the attributes of the columns by reading the first 1000 lines of the file. Column \texttt{ref.date} was imported as \texttt{date} and column \texttt{price.close} was imported as \texttt{double} (numeric). We can use this information in our own code by copying the text and assigning it to a variable. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set cols from import message}
\NormalTok{my_cols <-}\StringTok{ }\KeywordTok{cols}\NormalTok{(}\DataTypeTok{ref.date =} \KeywordTok{col_date}\NormalTok{(),}
                \DataTypeTok{price.close =} \KeywordTok{col_character}\NormalTok{() ) }

\CommentTok{# read file with readr::read_csv}
\NormalTok{my_df_sp500 <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_f, }\DataTypeTok{col_types =}\NormalTok{ my_cols)}
\end{Highlighting}
\end{Shaded}

As an exercise, Let's import the same data, but use a \texttt{character} class for column \texttt{date}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set cols from import message}
\NormalTok{my_cols <-}\StringTok{ }\KeywordTok{cols}\NormalTok{(}\DataTypeTok{ref.date =} \KeywordTok{col_character}\NormalTok{(),}
                \DataTypeTok{price.close =} \KeywordTok{col_character}\NormalTok{() ) }

\CommentTok{# read file with readr::read_csv}
\NormalTok{my_df_sp500 <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_f, }\DataTypeTok{col_types =}\NormalTok{ my_cols)}

\CommentTok{# glimpse the dataframe}
\KeywordTok{glimpse}\NormalTok{(my_df_sp500)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,718
R> Columns: 2
R> $ ref.date    <chr> "2010-01-04", "2010-01-05", "2010-01-0~
R> $ price.close <chr> "70045", "70240", "70729", "70451", "7~
\end{verbatim}

As expected, both columns are of class \texttt{character}. So, a possible set of steps using \texttt{readr::read\_csv} is, first, to read the file without arguments in \texttt{read\_csv}, copy the default column classes from the output message, add it as argument \texttt{col\_types}, and re-execute the script. This is handy when the imported file has several columns and manually defining each column class requires lots of typing.

There is also a simpler way of using the classes defined by \texttt{read\_csv}, just set \texttt{col\_types\ =\ cols()}. This way you don't need to manually copy and paste the message from \texttt{read\_csv}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# read file with readr::read_csv}
\NormalTok{my_df_sp500 <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_f, }
                        \DataTypeTok{col_types =} \KeywordTok{cols}\NormalTok{())}

\CommentTok{# glimpse the dataframe}
\KeywordTok{glimpse}\NormalTok{(my_df_sp500)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,718
R> Columns: 2
R> $ ref.date    <date> 2010-01-04, 2010-01-05, 2010-01-06, 2~
R> $ price.close <dbl> 70045, 70240, 70729, 70451, 70263, 704~
\end{verbatim}

Going further, \texttt{read\_csv} has several other input options such as:

\begin{itemize}
\tightlist
\item
  change the format of the import data, including symbols for decimal places and encoding (\texttt{locale} option);
\item
  change column names (argument \texttt{col\_names});
\item
  skip \emph{n} lines before importation (\texttt{skip} option);
\item
  custom definition for NA values (\texttt{na} option)
\end{itemize}

Now, let's study a more abnormal case of \emph{.csv} file. In the book package we have a file called \texttt{funky\_csv\_file.csv} where:

\begin{itemize}
\tightlist
\item
  the header has textual information;
\item
  the file will use the comma as a decimal;
\item
  the file text will contain Latin characters.
\end{itemize}

The first 5 lines of the files contain the following content:

\begin{verbatim}
R> Example of csv file with alternative format:
R> - columns separated by ";"
R> - decimal as ","
R> 
R> Data compiled in 2021-02-26
\end{verbatim}

He ave a header text up to line number 7 and the columns being separated by a semicolon (``;''). When importing the data with standard (and wrong) options, we will have the following result:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'funky_csv_file.csv'}\NormalTok{)}

\NormalTok{df_funky <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_f, }
                     \DataTypeTok{col_types =} \KeywordTok{cols}\NormalTok{())}

\KeywordTok{glimpse}\NormalTok{(df_funky)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2
R> Columns: 1
R> $ `Example of csv file with alternative format:` <chr> "- ~
\end{verbatim}

Clearly something went wrong, with the issue of several \emph{warning} messages. To solve it, we use the following code, making sure the particularities of the file are handled:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df_not_funky <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(}
        \DataTypeTok{file =}\NormalTok{ my_f, }
        \DataTypeTok{skip =} \DecValTok{7}\NormalTok{, }\CommentTok{# how many lines do skip}
        \DataTypeTok{delim =} \StringTok{';'}\NormalTok{, }\CommentTok{# column separator}
        \DataTypeTok{col_types =} \KeywordTok{cols}\NormalTok{(), }\CommentTok{# column types}
        \DataTypeTok{locale =} \KeywordTok{locale}\NormalTok{(}\DataTypeTok{decimal_mark =} \StringTok{','}\NormalTok{)}\CommentTok{# locale}
\NormalTok{)}

\KeywordTok{glimpse}\NormalTok{(df_not_funky)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 100
R> Columns: 6
R> $ COD.UF     <dbl> 35, 21, 35, 35, 41, 31, 31, 21, 29, 26,~
R> $ COD        <dbl> 3546306, 2103109, 3514700, 3538105, 411~
R> $ NOME       <chr> "Santa Cruz das Palmeiras", "Cedral", "~
R> $ state      <chr> "So Paulo", "Maranho", "So Paulo", "~
R> $ SIGLA      <chr> " SP", " MA", " SP", " SP", " PR", " MG~
R> $ number_col <dbl> 1.902087, 69.808750, 81.509312, 56.8400~
\end{verbatim}

Note that the data has now been correctly imported, with the correct column classes. For that, we use the alternative function \texttt{readr::read\_delim} with custom inputs. Package \texttt{readr} also provides several other functions for specific import situations. If the \texttt{read\_csv} function does not solve your problem in reading some structured text file, surely another function of this package will.

\hypertarget{exporting-data}{%
\subsection{Exporting Data}\label{exporting-data}}

To write a \emph{.csv} file, use the \texttt{readr::write\_csv} function. First, we create a new dataframe with some random data: \index{file types!.csv} \index{base!write.csv}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set the number of rows}
\NormalTok{N <-}\StringTok{ }\DecValTok{100}

\CommentTok{# set dataframe}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{runif}\NormalTok{(N), }
                    \DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{,N))}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>            y z
R> 1 0.63588576 a
R> 2 0.88288939 a
R> 3 0.29775107 a
R> 4 0.03925958 a
R> 5 0.91619037 a
R> 6 0.37189320 a
\end{verbatim}

And now we use \texttt{write\_csv} to save it in a new \emph{.csv} file:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file out}
\NormalTok{f_out <-}\StringTok{ 'data/temp.csv'}

\CommentTok{# write to files}
\KeywordTok{write_csv}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df,  }
          \DataTypeTok{file =}\NormalTok{ f_out)}
\end{Highlighting}
\end{Shaded}

In the previous example, we save the object \texttt{my\_df} into a file with path \texttt{data/temp.csv}. We can read it back and check its contents using \texttt{read\_csv} once again:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# read it}
\NormalTok{my_df_imported <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(f_out)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> -- Column specification ------------------------------------
R> cols(
R>   y = col_double(),
R>   z = col_character()
R> )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print first five rows}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df_imported))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 2
R>        y z    
R>    <dbl> <chr>
R> 1 0.636  a    
R> 2 0.883  a    
R> 3 0.298  a    
R> 4 0.0393 a    
R> 5 0.916  a    
R> 6 0.372  a
\end{verbatim}

As we can see, the data imported from the file is identical to the one created in the previous code chunk.

\hypertarget{excel-files-xls-and-xlsx}{%
\section{\texorpdfstring{\emph{Excel} Files (\emph{xls} and \emph{xlsx})}{Excel Files (xls and xlsx)}}\label{excel-files-xls-and-xlsx}}

Although it is not an efficient or portable data storage format, Excel is a very popular software due to its spreadsheet-like capacities. It is not uncommon for data to be stored and distributed in this format, especially in the finance industry.

The downside of using Excel files for storing data is its low portability and the longer time required to read and write it. This may not be a problem for small tables, but when handling a large volume of data, using Excel files can be very frustrating. If you can, avoid the use of Excel files in your work cycle.

\hypertarget{importing-data-1}{%
\subsection{Importing Data}\label{importing-data-1}}

R does not have a native function for importing Excel files; therefore, we must install and use packages to perform this operation. There are several good options including \texttt{XLConnect} \citep{R-XLConnect}, \texttt{xlsx} \citep{R-xlsx}, \texttt{readxl} \citep{R-readxl} and \texttt{tidyxl} \citep{R-tidyxl}. \index{XLConnet} \index{xlsx} \index{readxl}

Despite their similar goals, each package has its peculiarities. If reading Excel files is important to your work, I strongly advise the study of each package. For example, package \texttt{tidyxl} was specially designed to read unstructured Excel files, where the desired information is not contained in a tabular format. Package \texttt{XLConnect} allows the user to open a live connection and, from R, control an Excel file, making it possible to export and send data, format cells, and so on.

In this section, we will give priority to package \texttt{readxl}, one of the most straightforward packages to use. It also does not require the installation of external software such as \emph{Java}. Let's start with an example. Consider a file called \texttt{SP500-Excel.xlsx} that contains the same SP500 data. We can import the information from the file using function \texttt{read\_excel} from \texttt{readxl}: \index{readxl!read\_excel}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readxl)}

\CommentTok{# set excel file}
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'SP500_Excel.xlsx'}\NormalTok{)}

\CommentTok{# read excel file }
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{read_excel}\NormalTok{(my_f, }\DataTypeTok{sheet =} \StringTok{'Sheet1'}\NormalTok{)}

\CommentTok{# print classes}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(my_df, class))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $ref.date
R> [1] "POSIXct" "POSIXt" 
R> 
R> $price.close
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print with head (first five rows)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 2
R>   ref.date            price.close
R>   <dttm>                    <dbl>
R> 1 2010-01-04 00:00:00       1133.
R> 2 2010-01-05 00:00:00       1137.
R> 3 2010-01-06 00:00:00       1137.
R> 4 2010-01-07 00:00:00       1142.
R> 5 2010-01-08 00:00:00       1145.
R> 6 2010-01-11 00:00:00       1147.
\end{verbatim}

As we can see, one benefit of using Excel files is that the column's classes are directly inherited. If the classes are correct in the Excel file, then they will automatically be correct in R. In our case, the date column of file SP500\_Excel.xlsx was correctly set as a \texttt{dttm} object, a special type of \texttt{DateTime} class. Likewise, even if the Excel file used commas for decimals, the import process would still succeed as the conversion is handled internally.

\hypertarget{exporting-data-1}{%
\subsection{Exporting Data}\label{exporting-data-1}}

Exporting a \texttt{dataframe} to an Excel file is also easy. Again, no native function in R performs this procedure. We can, however, use packages \texttt{xlsx} and \texttt{writexl}. A requisite for using \texttt{xlsx} is the installation of Java JDK in the operating system. For Windows users, visit the \href{https://www.java.com/pt_BR/}{Java site}\footnote{\url{https://www.java.com/pt_BR/}} and install it with option \emph{Windows Off-line (64 bits)}. After that, install \texttt{xlsx} with command \texttt{install.packages(\textquotesingle{}xlsx\textquotesingle{})} and try loading it with \texttt{library(xlsx)}. If you got an error message about \emph{Java} , try rebooting your system.

An example of \texttt{xlsx} usage is given next: \index{xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(xlsx)}

\CommentTok{# create dataframe}
\NormalTok{N <-}\StringTok{ }\DecValTok{50}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N), }\DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{,N))}

\CommentTok{# set excel file}
\NormalTok{f_out <-}\StringTok{ 'data/temp.xlsx'}

\CommentTok{# write to excel}
\KeywordTok{write.xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df, }\DataTypeTok{file =}\NormalTok{ f_out, }\DataTypeTok{sheetName =} \StringTok{"my df"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to save several \texttt{dataframes} into several worksheets of the same Excel file, you must use the input option \texttt{append=TRUE} in the call to \texttt{write.xlsx}. Otherwise, the function will create a new file on each call and erase all previous content. See the following example, where we export two \texttt{dataframes} for two different sheets in the same Excel file: \index{xlsx!write.xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create two dataframes}
\NormalTok{N <-}\StringTok{ }\DecValTok{25}
\NormalTok{my_df_A <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, N), }
                      \DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, N))}

\NormalTok{my_df_B <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'b'}\NormalTok{, N))}

\CommentTok{# set file out}
\NormalTok{f_out <-}\StringTok{ 'data/temp.xlsx'}

\CommentTok{# write in different sheets}
\KeywordTok{write.xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df_A, }
           \DataTypeTok{file =}\NormalTok{ f_out, }
           \DataTypeTok{sheetName =} \StringTok{"my df A"}\NormalTok{)}

\KeywordTok{write.xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df_B, }
           \DataTypeTok{file =}\NormalTok{ f_out, }
           \DataTypeTok{sheetName =} \StringTok{"my df B"}\NormalTok{, }
           \DataTypeTok{append =} \OtherTok{TRUE}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

After executing the code, we can open the excel files and check their contents to see that they mirror the artificial data.

As for package \texttt{writexl}, its innovation is that a Java installation is not needed. Writing speed is also significantly increased. See an example next. \index{writexl!write\_xlsx}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(writexl)}
\CommentTok{# set number of rows}
\NormalTok{N <-}\StringTok{ }\DecValTok{25}

\CommentTok{# create random dfs}
\NormalTok{my_df_A <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, N),}
                      \DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, N))}

\KeywordTok{write_xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df_A,}
           \DataTypeTok{path =}\NormalTok{ f_out)}
\end{Highlighting}
\end{Shaded}

In order to compare writing performance, let's calculate the difference of time from \texttt{xlsx} to \texttt{writexl}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(writexl)}
\KeywordTok{library}\NormalTok{(readxl)}
\KeywordTok{library}\NormalTok{(xlsx)}

\CommentTok{# set number of rows}
\NormalTok{N <-}\StringTok{ }\DecValTok{2500}

\CommentTok{# create random dfs}
\NormalTok{my_df_A <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                      \DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{,N))}

\CommentTok{# set files}
\NormalTok{my_file_}\DecValTok{1}\NormalTok{ <-}\StringTok{ 'data/temp_writexl.xlsx'}
\NormalTok{my_file_}\DecValTok{2}\NormalTok{ <-}\StringTok{ 'data/temp_xlsx.xlsx'}

\CommentTok{# test export}
\NormalTok{time_write_writexl <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{write_xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df_A,}
                                             \DataTypeTok{path =}\NormalTok{ my_file_}\DecValTok{1}\NormalTok{))}

\NormalTok{time_write_xlsx <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{write.xlsx}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df_A,}
                                          \DataTypeTok{file =}\NormalTok{ my_file_}\DecValTok{2}\NormalTok{))}

\CommentTok{# test read}
\NormalTok{time_read_readxl <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{read_xlsx}\NormalTok{(}\DataTypeTok{path =}\NormalTok{ my_file_}\DecValTok{1}\NormalTok{ ))}
\NormalTok{time_read_xlsx <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{read.xlsx}\NormalTok{(}\DataTypeTok{file =}\NormalTok{ my_file_}\DecValTok{2}\NormalTok{,}
                                        \DataTypeTok{sheetIndex =} \DecValTok{1}\NormalTok{ ))}
\end{Highlighting}
\end{Shaded}

And now we show the results:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# results}
\NormalTok{my_formats <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'xlsx'}\NormalTok{, }\StringTok{'readxl'}\NormalTok{)}
\NormalTok{results_read <-}\StringTok{ }\KeywordTok{c}\NormalTok{(time_read_xlsx[}\DecValTok{3}\NormalTok{], time_read_readxl[}\DecValTok{3}\NormalTok{])}
\NormalTok{results_write<-}\StringTok{ }\KeywordTok{c}\NormalTok{(time_write_xlsx[}\DecValTok{3}\NormalTok{], time_write_writexl[}\DecValTok{3}\NormalTok{])}

\CommentTok{# print text}
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Time to WRITE dataframe with '}\NormalTok{,}
\NormalTok{                  my_formats, }\StringTok{': '}\NormalTok{,}
                  \KeywordTok{format}\NormalTok{(results_write, }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{),}
                  \StringTok{' seconds'}\NormalTok{, }\DataTypeTok{collapse =} \StringTok{''}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to WRITE dataframe with xlsx: 2.462 seconds
R> Time to WRITE dataframe with readxl: 0.013 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Time to READ dataframe with '}\NormalTok{,}
\NormalTok{                  my_formats, }\StringTok{': '}\NormalTok{,}
                  \KeywordTok{format}\NormalTok{(results_read, }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{),}
                  \StringTok{' seconds'}\NormalTok{, }\DataTypeTok{collapse =} \StringTok{''}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to READ dataframe with xlsx: 3.181 seconds
R> Time to READ dataframe with readxl: 0.018 seconds
\end{verbatim}

As we can see, even for low-volume data, a dataframe with 2500 rows and 2 columns, the run-time difference is significant. If you are working with large spreadsheets, the use of packages \texttt{readxl} and \texttt{writexl} for reading and writing Excel files is strongly recommended.

\hypertarget{rdata-and-rds-files}{%
\section{\texorpdfstring{\emph{RData} and \emph{rds} Files}{RData and rds Files}}\label{rdata-and-rds-files}}

R offers native formats to write objects to a local file. The great benefit of using both native formats, \emph{RData}, and \emph{rds}, is that the saved file is compact and its access is very fast. The downside is the low portability, i.e., it's difficult to use the files in other software. \index{file types!.RData} \index{file types!.rds}

The difference between \emph{RData} and \emph{rds} is that the first can save many R objects in a single file, while the latter only one. This, however, is not a hard restriction for the \emph{rds} format as we can incorporate several objects into a single one using a \texttt{list}, a special type of object. In practice, a \emph{rds} file can store as many objects as needed.

\hypertarget{importing-data-2}{%
\subsection{Importing Data}\label{importing-data-2}}

To create a new \emph{.RData} file, use the \texttt{save} function. See the following example, where we create a \emph{.RData} file with some content, clear R's memory, and then load the previously created file: \index{base!save} \index{base!load}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set a object}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{100}

\CommentTok{# set name of RData file}
\NormalTok{my_file <-}\StringTok{ 'data/temp.RData'}

\CommentTok{# save it}
\KeywordTok{save}\NormalTok{(}\DataTypeTok{list =} \KeywordTok{c}\NormalTok{(}\StringTok{'my_x'}\NormalTok{), }\DataTypeTok{file =}\NormalTok{ my_file)}
\end{Highlighting}
\end{Shaded}

We can verify the existence of the file with the \texttt{file.exists} function: \index{base!list.files}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# check if file exists}
\KeywordTok{file.exists}\NormalTok{(my_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

As expected, file temp.RData is available.

Importing data from \texttt{.rds} files is very similar. For that we use function \texttt{readr::read\_rds}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file path}
\NormalTok{my_file <-}\StringTok{ 'data/temp.rds'}

\CommentTok{# load content into workspace}
\NormalTok{my_y <-}\StringTok{ }\KeywordTok{read_rds}\NormalTok{(}\DataTypeTok{file =}\NormalTok{ my_file)}
\end{Highlighting}
\end{Shaded}

Comparing the code between using \texttt{.RData} and \texttt{.rds} files, note that the \texttt{.rds} format allows the explicit definition of the output object. The contents of \texttt{my\_file} in \texttt{read\_rds} is saved in \texttt{my\_y}. When we use the \texttt{load} function for \emph{RData} files, we cannot name the output directly. This is particularly inconvenient when you need to modify the name of the imported object.

\begin{rmdimportant}
As a suggestion, give preference to the \emph{.rds} format, which is
more practical, resulting in cleaner code. The difference in speed
between one and the other is minimal. The benefit of importing multiple
objects into the same \texttt{RData} format file becomes irrelevant when
using \texttt{list} objects, which can incorporate other objects into
its content.
\end{rmdimportant}

\hypertarget{exporting-data-2}{%
\subsection{Exporting Data}\label{exporting-data-2}}

We can create a new \emph{RData} file with command \texttt{save}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vars}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{100}
\NormalTok{my_y <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{100}

\CommentTok{# write to RData}
\NormalTok{my_file <-}\StringTok{ 'data/temp.RData'}
\KeywordTok{save}\NormalTok{(}\DataTypeTok{list =} \KeywordTok{c}\NormalTok{(}\StringTok{'my_x'}\NormalTok{, }\StringTok{'my_y'}\NormalTok{),}
     \DataTypeTok{file =}\NormalTok{ my_file)}
\end{Highlighting}
\end{Shaded}

We can check if the file exists with function \texttt{file.exists}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{file.exists}\NormalTok{(my_file)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

The result is \texttt{TRUE} as expected.

As for \emph{.rds} files, we save it with function \texttt{readr::write\_rds}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set data and file}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{100}
\NormalTok{my_file <-}\StringTok{ 'data/temp.rds'}

\CommentTok{# save as .rds}
\KeywordTok{write_rds}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_x,}
          \DataTypeTok{file =}\NormalTok{ my_file)}

\CommentTok{# read it}
\NormalTok{my_x2 <-}\StringTok{ }\KeywordTok{read_rds}\NormalTok{(}\DataTypeTok{file =}\NormalTok{ my_file)}

\CommentTok{# test equality}
\KeywordTok{print}\NormalTok{(}\KeywordTok{identical}\NormalTok{(my_x, my_x2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] TRUE
\end{verbatim}

Command \texttt{identical} tests if both objects are equal. Again, as expected, we find the result to be \texttt{TRUE}.

\hypertarget{fst-files}{%
\section{\texorpdfstring{\emph{fst} files}{fst files}}\label{fst-files}}

The \href{http://www.fstpackage.org/}{\emph{fst} format}\footnote{\url{http://www.fstpackage.org/}} is specially designed to enable quick writing and reading time from tabular data, with minimal disk space. Using this format is particularly beneficial when working with large databases in powerful computers. The trick here is the use of all computer cores to import and export data, while all other formats only use one. If you have a computer with several cores, the gain in speed is impressive, as we will soon learn. \index{fst}

\hypertarget{importing-data-3}{%
\subsection{Importing Data}\label{importing-data-3}}

Using \emph{fst} file format is similar to the previous cases. We use function \texttt{read\_fst} from package \texttt{fst} \citep{R-fst} to read files:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fst)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> fst package v0.9.4
\end{verbatim}

\begin{verbatim}
R> (OpenMP detected, using 4 threads)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file location}
\NormalTok{my_file <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'temp.fst'}\NormalTok{)}

\CommentTok{# read fst file}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{read_fst}\NormalTok{(my_file)}

\CommentTok{# check contents}
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,000
R> Columns: 1
R> $ x <dbl> 0.70968891, 0.83903044, 0.70026554, 0.78120026, ~
\end{verbatim}

As with the other cases, the data from file temp.fst is available in the workspace. \index{fst!read\_fst}

\hypertarget{exporting-data-3}{%
\subsection{Exporting Data}\label{exporting-data-3}}

We use function \texttt{fst::write\_fst} to save dataframes in the \emph{fst} format: \index{fst!write\_fst}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fst)}

\CommentTok{# create dataframe}
\NormalTok{N <-}\StringTok{ }\DecValTok{1000}
\NormalTok{my_file <-}\StringTok{ 'data/temp.fst'}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{runif}\NormalTok{(N))}

\CommentTok{# write to fst}
\KeywordTok{write_fst}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_df, }\DataTypeTok{path =}\NormalTok{ my_file)}
\end{Highlighting}
\end{Shaded}

\hypertarget{timing-the-fst-format}{%
\subsection{\texorpdfstring{Timing the \emph{fst} format}{Timing the fst format}}\label{timing-the-fst-format}}

As a test of the potential of the \texttt{fst} format, we will now time the read and write time between \texttt{fst} and \texttt{rds} for a large table: 5.000.000 rows and 2 columns. We will also report the size of the resulting file.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(fst)}

\CommentTok{# set number of rows}
\NormalTok{N <-}\StringTok{ }\DecValTok{5000000}

\CommentTok{# create random dfs}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,N),}
                    \DataTypeTok{z =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{,N))}

\CommentTok{# set files}
\NormalTok{my_file_}\DecValTok{1}\NormalTok{ <-}\StringTok{ 'data/temp_rds.rds'}
\NormalTok{my_file_}\DecValTok{2}\NormalTok{ <-}\StringTok{ 'data/temp_fst.fst'}

\CommentTok{# test write}
\NormalTok{time_write_rds <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{write_rds}\NormalTok{(my_df, my_file_}\DecValTok{1}\NormalTok{ ))}
\NormalTok{time_write_fst <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{write_fst}\NormalTok{(my_df, my_file_}\DecValTok{2}\NormalTok{ ))}

\CommentTok{# test read}
\NormalTok{time_read_rds <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{readRDS}\NormalTok{(my_file_}\DecValTok{1}\NormalTok{))}
\NormalTok{time_read_fst <-}\StringTok{ }\KeywordTok{system.time}\NormalTok{(}\KeywordTok{read_fst}\NormalTok{(my_file_}\DecValTok{2}\NormalTok{))}

\CommentTok{# test file size (MB)}
\NormalTok{file_size_rds <-}\StringTok{ }\KeywordTok{file.size}\NormalTok{(my_file_}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{1000000}
\NormalTok{file_size_fst <-}\StringTok{ }\KeywordTok{file.size}\NormalTok{(my_file_}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\DecValTok{1000000}
\end{Highlighting}
\end{Shaded}

And now we check the results:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# results}
\NormalTok{my_formats <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'.rds'}\NormalTok{, }\StringTok{'.fst'}\NormalTok{)}
\NormalTok{results_read <-}\StringTok{ }\KeywordTok{c}\NormalTok{(time_read_rds[}\DecValTok{3}\NormalTok{], time_read_fst[}\DecValTok{3}\NormalTok{])}
\NormalTok{results_write<-}\StringTok{ }\KeywordTok{c}\NormalTok{(time_write_rds[}\DecValTok{3}\NormalTok{], time_write_fst[}\DecValTok{3}\NormalTok{])}
\NormalTok{results_file_size <-}\StringTok{ }\KeywordTok{c}\NormalTok{(file_size_rds , file_size_fst)}

\CommentTok{# print text}
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Time to WRITE dataframe with '}\NormalTok{,}
\NormalTok{                  my_formats, }\StringTok{': '}\NormalTok{,}
\NormalTok{                  results_write, }\StringTok{' seconds'}\NormalTok{, }\DataTypeTok{collapse =} \StringTok{''}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to WRITE dataframe with .rds: 2.124 seconds
R> Time to WRITE dataframe with .fst: 0.297000000000011 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Time to READ dataframe with '}\NormalTok{,}
\NormalTok{                  my_formats, }\StringTok{': '}\NormalTok{,}
\NormalTok{                  results_read, }\StringTok{' seconds'}\NormalTok{, }\DataTypeTok{collapse =} \StringTok{''}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Time to READ dataframe with .rds: 1.35000000000001 seconds
R> Time to READ dataframe with .fst: 0.177999999999997 seconds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{Resulting FILE SIZE for '}\NormalTok{,}
\NormalTok{                  my_formats, }\StringTok{': '}\NormalTok{,}
\NormalTok{                  results_file_size, }\StringTok{' MBs'}\NormalTok{, }\DataTypeTok{collapse =} \StringTok{''}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Resulting FILE SIZE for .rds: 65.01011 MBs
R> Resulting FILE SIZE for .fst: 14.791938 MBs
\end{verbatim}

The difference is very impressive! The \texttt{fst} not only reads and writes faster but also results in smaller file sizes. Be aware, however, this result is found in a 16 core computer in which the book was compiled. You may not be able to replicate the same result in a more modest machine.

\begin{rmdimportant}
Due to the use of all the computer's cores, the \emph{fst} format is
highly recommended when working with large data on a powerful computer.
Not only will the resulting files be smaller, but the writing and
reading process will be considerably faster.
\end{rmdimportant}

\hypertarget{sqlite-files}{%
\section{SQLite Files}\label{sqlite-files}}

The use of \emph{.csv} or \emph{.rds} files for storing objects has its limits as the size of the files increases. If you are waiting a long time to read a \texttt{dataframe} from a file or if you are only interested in a small portion of a large table, you should look for alternatives. Likewise, if you are working in a network of computers from your institution and many people are using the same tables, it makes sense to keep and distribute the information from a central server. This way, every user can access the same information, concurrently.

This brings us to the topic of \textbf{database software}. These specific programs usually work with a query language, called \emph{SQL} (\emph{Structured Query Language}). It allows the user to read portions of the data and even manipulate it efficiently. Many options of database software integrate nicely with R. The list includes \textbf{MySQL}, \textbf{SQLite} and \textbf{MariaDB}. Here, we will provide a quick tutorial on this topic using SQLite, which is the easiest one to work. \index{mySQL} \index{SQLite} \index{MariaDB}

Before moving to the examples, we need to understand how to use database software. First, R will connect to the database and return a connection object. Based on this connection, we will send queries for importing data using the \emph{SQL} language. The main advantage is we can have a large database of, let's say, 10 GB and only load a small portion of it in R. This operation is also very quick, allowing efficient access to the available tables.

\hypertarget{importing-data-4}{%
\subsection{Importing Data}\label{importing-data-4}}

Assuming the existence of an SQLite file in the computer, we can import its tables with package \texttt{RSQLite} \citep{R-RSQLite}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(RSQLite)}

\CommentTok{# set name of SQLITE file}
\NormalTok{f_sqlite <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'SQLite_db.SQLITE'}\NormalTok{)}

\CommentTok{# open connection}
\NormalTok{my_con <-}\StringTok{ }\KeywordTok{dbConnect}\NormalTok{(}\DataTypeTok{drv =} \KeywordTok{SQLite}\NormalTok{(), f_sqlite)}

\CommentTok{# read table}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{dbReadTable}\NormalTok{(}\DataTypeTok{conn =}\NormalTok{ my_con,}
                     \DataTypeTok{name =} \StringTok{'MyTable1'}\NormalTok{) }\CommentTok{# name of table in sqlite}

\CommentTok{# print with str}
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,000,000
R> Columns: 2
R> $ x <dbl> 0.007504194, 0.439465174, 0.178387480, 0.9857759~
R> $ G <chr> "B", "B", "B", "B", "A", "B", "A", "B", "B", "B"~
\end{verbatim}

It worked. The \texttt{dataframe} from table \texttt{MyTable1} is exactly as expected. \index{RSQLite!dbReadTable}

Another example of using SQLite is with the actual SQL statements. Notice, in the previous code, we used function \texttt{dbReadTable} to get the contents of all rows in table \texttt{MyTable1}. Now, let's use an SQL command to get from \texttt{MyTable2} only the rows where the \texttt{G} column is equal to \texttt{A}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set sql statement}
\NormalTok{my_SQL_statement <-}\StringTok{ "select * from myTable2 where G='A'"}

\CommentTok{# get query}
\NormalTok{my_df_A <-}\StringTok{ }\KeywordTok{dbGetQuery}\NormalTok{(}\DataTypeTok{conn =}\NormalTok{ my_con, }
                      \DataTypeTok{statement =}\NormalTok{ my_SQL_statement)}

\CommentTok{# disconnect from db}
\KeywordTok{dbDisconnect}\NormalTok{(my_con)}

\CommentTok{# print with str}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str}\NormalTok{(my_df_A))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 'data.frame':    499522 obs. of  2 variables:
R>  $ x: num  0.0637 0.1982 0.2894 0.7389 0.0669 ...
R>  $ G: chr  "A" "A" "A" "A" ...
R> NULL
\end{verbatim}

It also worked, as expected.

In this simple example, we can see how easy it is to create a connection to a database, retrieve tables, and disconnect. If you have to work with large tables, which, in my opinion, is any database that occupies more than 4 GB of your computer memory, it is worth moving it to proper database software. You'll be able to retrieve data faster, without the need of loading the whole database in the computer's memory. If you have a server available in your workplace, I strongly advise learning how to connect to it and use the SQL language to your advantage.

\hypertarget{exporting-data-4}{%
\subsection{Exporting Data}\label{exporting-data-4}}

As an example of exporting data to an SQLite file, let's first create an SQLite database. For that, we will set two large \texttt{dataframes} with random data and save both in an SQLite file using the package \texttt{RSQLite}. \index{RSQLite}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(RSQLite)}

\CommentTok{# set number of rows in df}
\NormalTok{N =}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{6} 

\CommentTok{# create simulated dataframe}
\NormalTok{my_large_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{runif}\NormalTok{(N), }
                            \DataTypeTok{G=} \KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{,}\StringTok{'B'}\NormalTok{),}
                                      \DataTypeTok{size =}\NormalTok{ N,}
                                      \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{))}

\NormalTok{my_large_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{runif}\NormalTok{(N), }
                            \DataTypeTok{G =} \KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{,}\StringTok{'B'}\NormalTok{),}
                                       \DataTypeTok{size =}\NormalTok{ N,}
                                       \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{))}

\CommentTok{# set name of SQLITE file}
\NormalTok{f_sqlite <-}\StringTok{ 'data/SQLite_db.SQLITE'}

\CommentTok{# open connection}
\NormalTok{my_con <-}\StringTok{ }\KeywordTok{dbConnect}\NormalTok{(}\DataTypeTok{drv =} \KeywordTok{SQLite}\NormalTok{(), f_sqlite)}

\CommentTok{# write df to sqlite}
\KeywordTok{dbWriteTable}\NormalTok{(}\DataTypeTok{conn =}\NormalTok{ my_con, }\DataTypeTok{name =} \StringTok{'MyTable1'}\NormalTok{, }
             \DataTypeTok{value =}\NormalTok{ my_large_df_}\DecValTok{1}\NormalTok{)}
\KeywordTok{dbWriteTable}\NormalTok{(}\DataTypeTok{conn =}\NormalTok{ my_con, }\DataTypeTok{name =} \StringTok{'MyTable2'}\NormalTok{, }
             \DataTypeTok{value =}\NormalTok{ my_large_df_}\DecValTok{2}\NormalTok{)}

\CommentTok{# disconnect}
\KeywordTok{dbDisconnect}\NormalTok{(my_con)}
\end{Highlighting}
\end{Shaded}

The \texttt{TRUE} output of \texttt{dbWriteTable} indicates everything went well. A connection was opened using function \texttt{dbConnect}, and the \texttt{dataframes} were written to an SQLite file, called SQLite\_db.SQLITE. Unlike other database software, SQLite stores data and configurations from a single file, without the need of a formal server. Also, notice how we disconnected from the database using the function \texttt{dbDisconnect}. \index{RSQLite!dbWriteTable} \index{RSQLite!dbConnect} \index{RSQLite!dbDisconnect}

\hypertarget{unstructured-data-and-other-formats}{%
\section{Unstructured Data and Other Formats}\label{unstructured-data-and-other-formats}}

The previous packages and functions are sufficient for getting most of the work done. Nevertheless, it is worth mentioning that R can also import data from other formats such as SPSS, Stata, Matlab, among many others. If that is your case, I suggest a thorough study of the \texttt{foreign} package \citep{R-foreign}.

Another example is the case of importing data from unstructured text files. Reading raw text files is the last resort for data importation. If none of the previous packages can read the data, then it must be parsed line by line. Let's explore this problem.

\hypertarget{importing-data-5}{%
\subsection{Importing Data}\label{importing-data-5}}

You can read the contents of a text file with function \texttt{readr::read\_lines}: \index{readr!read\_lines}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file to read}
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'pride_and_prejudice.txt'}\NormalTok{)}

\CommentTok{# read file line by line}
\NormalTok{my_txt <-}\StringTok{ }\KeywordTok{read_lines}\NormalTok{(my_f)}

\CommentTok{# print 50 characters of first fifteen lines}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str_sub}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ my_txt[}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{], }
              \DataTypeTok{start =} \DecValTok{1}\NormalTok{, }
              \DataTypeTok{end =} \DecValTok{50}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "The Project Gutenberg EBook of Pride and Prejudice"
R>  [2] ""                                                  
R>  [3] "This eBook is for the use of anyone anywhere at no"
R>  [4] "almost no restrictions whatsoever.  You may copy i"
R>  [5] "re-use it under the terms of the Project Gutenberg"
R>  [6] "with this eBook or online at www.gutenberg.org"    
R>  [7] ""                                                  
R>  [8] ""                                                  
R>  [9] "Title: Pride and Prejudice"                        
R> [10] ""                                                  
R> [11] "Author: Jane Austen"                               
R> [12] ""                                                  
R> [13] "Posting Date: August 26, 2008 [EBook #1342]"       
R> [14] "Release Date: June, 1998"                          
R> [15] "Last Updated: March 10, 2018"
\end{verbatim}

In this example, file pride\_and\_prejudice.txt contains the whole content of the book \emph{Pride and Prejudice} by Jane Austen, freely available in the \href{http://www.gutenberg.org/}{Gutenberg}\footnote{\url{http://www.gutenberg.org/}} project. We imported the entire content of the file as a \texttt{character} vector named \texttt{my\_txt}. Each element of \texttt{my\_txt} is a line from the raw text file. Based on it, we can calculate many things such as the number of lines in the book and the number of times that the name \texttt{\textquotesingle{}Bennet\textquotesingle{}}, one of the protagonists, appears in the text:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# count number of lines}
\NormalTok{n_lines <-}\StringTok{ }\KeywordTok{length}\NormalTok{(my_txt)}

\CommentTok{# set target text}
\NormalTok{name_to_search <-}\StringTok{ 'Bennet'}
  
\CommentTok{# set function for counting words}
\NormalTok{fct_count_bennet <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(str_in, target_text) \{}
  
  \KeywordTok{require}\NormalTok{(stringr)}
  

\NormalTok{  n_words <-}\StringTok{ }\KeywordTok{length}\NormalTok{(}\KeywordTok{str_locate_all}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ str_in, }
                                   \DataTypeTok{pattern =}\NormalTok{ target_text)[[}\DecValTok{1}\NormalTok{]])}
  
  \KeywordTok{return}\NormalTok{(n_words)}
\NormalTok{\}}

\CommentTok{# use fct for all lines of Pride and Prejudice}
\NormalTok{n_times <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(}\DataTypeTok{X =}\NormalTok{ my_txt, }
                      \DataTypeTok{FUN =}\NormalTok{ fct_count_bennet, }
                      \DataTypeTok{target_text =}\NormalTok{ name_to_search))}

\CommentTok{# print results}
\NormalTok{my_msg <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'The number of lines found in the file is '}\NormalTok{, }
\NormalTok{                 n_lines, }\StringTok{'.}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{,}
                 \StringTok{'The word "'}\NormalTok{, name_to_search, }\StringTok{'" appears '}\NormalTok{, }
\NormalTok{                 n_times, }\StringTok{' in the book.'}\NormalTok{)}
\KeywordTok{message}\NormalTok{(my_msg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The number of lines found in the file is 13427.
R> The word "Bennet" appears 664 in the book.
\end{verbatim}

In the example, we once again used \texttt{sapply}. In this case, it allowed us to use a function for each element of \texttt{my\_txt}. We searched and counted the number of times the word ``Bennet'' was found. Notice we could simply change \texttt{name\_to\_search} for any other name if we wanted to.

\hypertarget{exporting-data-5}{%
\subsection{Exporting Data}\label{exporting-data-5}}

A typical case of exporting unstructured text is saving the log record of a procedure. This is quite simple. Using function \texttt{readr::write\_lines}, use the input \texttt{file} to set the name of the local file and \texttt{x} for the actual textual content. \index{readr!write\_lines}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set file}
\NormalTok{my_f <-}\StringTok{ 'data/temp.txt'}

\CommentTok{# set some string}
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'Today is '}\NormalTok{, }\KeywordTok{Sys.Date}\NormalTok{(), }\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{, }
                  \StringTok{'Tomorrow is '}\NormalTok{, }\KeywordTok{Sys.Date}\NormalTok{()}\OperatorTok{+}\DecValTok{1}\NormalTok{)}

\CommentTok{# save string to file}
\KeywordTok{write_lines}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_text, }\DataTypeTok{file =}\NormalTok{ my_f, }\DataTypeTok{append =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In the previous example, we created a simple text object and saved it in data/temp.txt. We can check the result with the \texttt{readr::read\_lines} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{read_lines}\NormalTok{(my_f))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Today is 2021-03-30"    "Tomorrow is 2021-03-31"
\end{verbatim}

As we can see, it worked as expected.

\hypertarget{how-to-select-a-format}{%
\section{How to Select a Format}\label{how-to-select-a-format}}

The choice of file format is an important topic and might actually be a time-saver at your work. In that decision, we must consider three points:

\begin{itemize}
\tightlist
\item
  speed of reading and writing operations;
\item
  size of the resulting file;
\item
  compatibility with other software and operating systems.
\end{itemize}

Usually, the use of \emph{csv} files easily satisfies these requirements. A \emph{csv} file is nothing more than a text file that can be opened, viewed, and imported into any other statistical software. This makes it easy to share it with other people. Also, the size of \emph{csv} files is usually not restrictive and, if needed, it can be compressed using the \emph{zip} function. For these reasons, the use of \emph{csv} files for importing and exporting data is preferable in the vast majority of situations. \index{utils!zip}

However, there are cases where the execution speed of import and export operations matter. If you don't mind giving up portability, the \emph{rds} format is a great choice for most projects. If you have good hardware and execution speed with \emph{rds} is still not great, then the best alternative is the \emph{fst} format, which uses all cores to import and export data. Finally, if you can, my most important suggestion is to \textbf{avoid the Excel format at all costs}.

\hypertarget{exerc-importacao-exportacao}{%
\section{Exercises}\label{exerc-importacao-exportacao}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Create a \texttt{dataframe} with the following code:

\begin{verbatim}
library(dplyr)

my_N <- 10000
my_df <- tibble(x = 1:my_N,
                y = runif(my_N))
\end{verbatim}

Export the resulting \texttt{dataframe} to each of the five formats: csv, rds, xlsx, fst. Which of the formats took up the most space in the computer's memory? Tip: \texttt{file.size} calculates the size of files within R.

02 -
Improve the previous code by measuring the execution time for saving the data in different formats. Which file format resulted in the fastest execution for exporting data? Tip: use the \texttt{system.time} function or the\texttt{tictoc} package to calculate the execution times.

03 -
For the previous code, reset the value of \texttt{my\_N} to \texttt{1000000}. Does it change the answers to the last two questions?

04 -
Use \texttt{afedR::get\_data\_file} function to access the \texttt{SP500.csv} file in the book's data repository. Import the contents of the file into R with the function \texttt{readr::read\_csv}. How many lines are there in the resulting \texttt{dataframe}?

05 -
Within link \href{https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv}{https://eeecon.uibk.ac.at/\textasciitilde zeileis/grunfeld/Grunfeld.csv/} you will find a \emph{.csv} file for the \emph{Grunfeld} data. This is a particularly famous table due to its use as reference data in econometric models. Using \texttt{readr::read\_csv} function, read this file using the direct link as input \texttt{read\_csv}. How many columns do you find in the resulting \texttt{dataframe}?

06 -
Use function \texttt{afedR::get\_data\_file} function to access the \texttt{example\_tsv.csv} file in the book's data repository. Note that the columns of the data are separated by the tab symbol (\texttt{\textquotesingle{}\textbackslash{}t\textquotesingle{}}), and not the usual comma. After reading the \texttt{readr::read\_delim} manual, import the information from this file to your R session. How many rows does the resulting \texttt{dataframe} contain?

07 -
In the book package there is a data file called \texttt{\textquotesingle{}funky\_csv2.csv\textquotesingle{}}. This has a particularly bizarre format for the data. Open it in a text editor and try to understand how the columns are separated and what is symbol for decimals. After that, study the inputs of function \texttt{read.table} and import the table into your R session. If we add the number of rows to the number of columns in the imported table, what is the result?

\hypertarget{importing-internet}{%
\chapter{Importing Data from the Internet}\label{importing-internet}}

One of the great advantages of R is a large amount of data that can be imported using the internet and specialized packages. This means that you can avoid all the tedious and soul-crushing work of manual data collection. It also becomes easy to share reproducible code, as anyone can feasibly download the same tables with a single line of code.

In this chapter, I will describe and give examples of the most important and reliable packages for data importation in the fields of finance and economics. It is a small, but comprehensive list of packages that cover a large range of research topics. The list includes:

\begin{description}
\tightlist
\item[\texttt{GetQuandlData} \citep{R-GetQuandlData}]
Imports economical and financial data from the Quandl platform.
\item[\texttt{BatchGetSymbols} \citep{R-BatchGetSymbols}]
Imports adjusted and unadjusted stock price data from Yahoo Finance.
\item[\texttt{simfinR} \citep{R-simfinR}]
Imports financial statements and adjusted stock prices from the \href{https://simfin.com/}{SimFin project}\footnote{\url{https://simfin.com/}}.
\item[\texttt{tidyquant} \citep{R-tidyquant}]
Imports several financial information about stock prices and fundamental data.
\item[\texttt{Rbitcoin} \citep{R-Rbitcoin}]
Imports data for cryptocurrencies.
\end{description}

\hypertarget{quandl}{%
\section{\texorpdfstring{Package \texttt{GetQuandlData}}{Package GetQuandlData}}\label{quandl}}

\emph{Quandl} is an established and comprehensive platform that provides access to a series of free and paid data. Several central banks and research institutions provide free economic and financial information on this platform. I strongly recommend browsing the available tables from the \href{https://www.quandl.com/}{Quandl website}\footnote{\url{https://www.quandl.com/}}. It is likely that you'll find datasets that you're familiar with. \index{Quandl}

In R, package \texttt{Quandl} \citep{R-Quandl} is the official extension offered by the company and available in CRAN. However, the package has some issues (see \href{https://www.msperlin.com/blog/post/2019-10-01-new-package-getquandldata/}{blog post here}\footnote{\url{https://www.msperlin.com/blog/post/2019-10-01-new-package-getquandldata/}}) and it is uncomfortable to work with the \texttt{tidyverse} collection of packages. The alternative package \texttt{GetQuandlData} \citep{R-GetQuandlData} is, in my humble and biased opinion as an author, a better alternative.

The \textbf{first and mandatory} step in using \texttt{GetQuandlData} is to register a user at the \href{https://www.quandl.com/}{Quandl website}. Soon after, go to \emph{account settings} and click \emph{API KEY}. This page should show a code, such as \texttt{Asv8Ac7zuZzJSCGxynfG}. Copy it to the clipboard (\emph{control + c}) and, in R, define a character object containing the copied content as follows:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set FAKE api key to quandl}
\NormalTok{my_api_key <-}\StringTok{ 'Asv8Ac7zuZzJSCGxynfG'}
\end{Highlighting}
\end{Shaded}

This API key is unique to each user, and the one presented here will not work on your computer. You'll need to get your own API key to run the examples of the book. After finding and setting your key, go to \href{https://www.quandl.com/search?query=}{Quandl's website} and use the search box to look for the symbol of the time series of interest. As an example, we will use data for gold prices in the London Market, with a Quandl code equivalent to \texttt{\textquotesingle{}LBMA/GOLD\textquotesingle{}}. Do notice that the structure of a Quandl code is always the same, with the name of the main database at first, and the name of table second, separated by a forward slash (/).

Now, with the API key and the Quandl symbol, we use function \texttt{get\_Quandl\_series} to download the data from 1980-01-01 to 2019-01-01: \index{Quandl!Quandl.api\_key} \index{Quandl!Quandl}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(GetQuandlData)}
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{# set symbol and dates}
\NormalTok{my_symbol <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'GOLD'}\NormalTok{ =}\StringTok{ 'LBMA/GOLD'}\NormalTok{)}
\NormalTok{first_date <-}\StringTok{ '1980-01-01'}
\NormalTok{last_date <-}\StringTok{ '2021-01-01'}

\CommentTok{# get data!}
\NormalTok{df_quandl <-}\StringTok{ }\KeywordTok{get_Quandl_series}\NormalTok{(}\DataTypeTok{id_in =}\NormalTok{ my_symbol,}
                               \DataTypeTok{api_key =}\NormalTok{ my_api_key, }
                               \DataTypeTok{first_date =}\NormalTok{ first_date,}
                               \DataTypeTok{last_date =}\NormalTok{ last_date, }
                               \DataTypeTok{do_cache =} \OtherTok{FALSE}\NormalTok{)}

\CommentTok{# check it}
\KeywordTok{glimpse}\NormalTok{(df_quandl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 10,424
R> Columns: 9
R> $ `USD (AM)`  <chr> "1723.95", "1727.85", "1729.2", "1734.~
R> $ `USD (PM)`  <chr> "1705.95", "1731.8", "1737.3", "1730.5~
R> $ `GBP (AM)`  <chr> "1247.62", "1253.56", "1260.07", "1264~
R> $ `GBP (PM)`  <chr> "1235.79", "1254.86", "1266.67", "1261~
R> $ `EURO (AM)` <chr> "1464.15", "1465.91", "1463.94", "1466~
R> $ `EURO (PM)` <chr> "1448.52", "1469.09", "1472.71", "1462~
R> $ series_name <chr> "GOLD", "GOLD", "GOLD", "GOLD", "GOLD"~
R> $ ref_date    <date> 2021-03-29, 2021-03-26, 2021-03-25, 2~
R> $ id_quandl   <chr> "LBMA/GOLD", "LBMA/GOLD", "LBMA/GOLD",~
\end{verbatim}

Notice how we set the name of the time series inline \texttt{id\_in\ =\ c(\textquotesingle{}GOLD\textquotesingle{}\ =\ \textquotesingle{}LBMA/GOLD\textquotesingle{})}. The name of the element becomes the value of column \texttt{series\_name} in \texttt{df\_quandl}. If we had more time series, they would be stacked in the same table, but with different \texttt{series\_name} value.

Worth knowing that other \texttt{Quandl} API options are available with inputs \texttt{order}, \texttt{collapse} and \texttt{transform}. If using \texttt{Quandl} is important to your work, I strongly recommend reading the \href{https://docs.quandl.com/docs/parameters-2}{available parameters for querying data}\footnote{\url{https://docs.quandl.com/docs/parameters-2}}. Several choices for data transformations can be passed to function \texttt{get\_Quandl\_series}.

As an inspection check, let's plot the prices of Gold in USD over time.

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-168-1} \end{center}

Overall, gold prices were fairly stable between 1980 and 2000, reaching a spike after 2010. One possible explanation is the higher demand for safer assets, such as gold, after the 2009 financial crisis. However, gold was never an efficient long term investment. To show that, let's calculate its compound annual return from 1980-01-02 to 2021-03-29:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sort the rows}
\NormalTok{df_quandl <-}\StringTok{ }\NormalTok{df_quandl }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{USD =} \KeywordTok{as.numeric}\NormalTok{(}\StringTok{`}\DataTypeTok{USD (AM)}\StringTok{`}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(ref_date)}

\NormalTok{total_ret <-}\StringTok{ }\KeywordTok{last}\NormalTok{(df_quandl}\OperatorTok{$}\NormalTok{USD)}\OperatorTok{/}\KeywordTok{first}\NormalTok{(df_quandl}\OperatorTok{$}\NormalTok{USD) }\OperatorTok{-}\StringTok{ }\DecValTok{1}
\NormalTok{total_years <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{max}\NormalTok{(df_quandl}\OperatorTok{$}\NormalTok{ref_date) }\OperatorTok{-}\StringTok{ }
\StringTok{                            }\KeywordTok{min}\NormalTok{(df_quandl}\OperatorTok{$}\NormalTok{ref_date) )}\OperatorTok{/}\DecValTok{365}

\NormalTok{comp_ret_per_year <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{total_ret)}\OperatorTok{^}\NormalTok{(}\DecValTok{1}\OperatorTok{/}\NormalTok{total_years) }\OperatorTok{-}\StringTok{ }\DecValTok{1}

\KeywordTok{print}\NormalTok{(comp_ret_per_year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.02766781
\end{verbatim}

We find the result that Gold prices in USD compounded in a rate equal to 2.77\% per year. This is not an impressive investment result by any means. As a comparison, the annual inflation for the US in the same period is 3.12\%. This means that by buying gold in 1980, the investor received less than the inflation as a nominal return.

\hypertarget{fetching-many-time-series}{%
\subsubsection{Fetching many time series}\label{fetching-many-time-series}}

When asking for multiple time series from Quandl, package \texttt{GetQuandlData} stacks all the data in a single \texttt{dataframe}, making it easier to work with the \texttt{tidyverse} tools. As an example, let's look at \texttt{Quandl} database \texttt{RATEINF}, which contains a time series of inflation rates around the world. First, we need to see what are the available datasets:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(GetQuandlData)}
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{# databse to get info}
\NormalTok{db_id <-}\StringTok{ 'RATEINF'}

\CommentTok{# get info }
\NormalTok{df_db <-}\StringTok{ }\KeywordTok{get_database_info}\NormalTok{(db_id, my_api_key)}

\KeywordTok{glimpse}\NormalTok{(df_db)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 26
R> Columns: 8
R> $ code         <chr> "CPI_ARG", "CPI_AUS", "CPI_CAN", "CPI~
R> $ name         <chr> "Consumer Price Index - Argentina", "~
R> $ description  <chr> "Please visit <a href=http://www.rate~
R> $ refreshed_at <dttm> 2020-10-10 02:03:32, 2021-03-27 02:0~
R> $ from_date    <date> 1988-01-31, 1948-09-30, 1989-01-31, ~
R> $ to_date      <date> 2013-12-31, 2020-12-31, 2021-02-28, ~
R> $ quandl_code  <chr> "RATEINF/CPI_ARG", "RATEINF/CPI_AUS",~
R> $ quandl_db    <chr> "RATEINF", "RATEINF", "RATEINF", "RAT~
\end{verbatim}

Column \texttt{name} contains the description of tables. If we dig deeper, we'll find the following names:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{unique}\NormalTok{(df_db}\OperatorTok{$}\NormalTok{name))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Consumer Price Index - Argentina"  
R>  [2] "Consumer Price Index - Australia"  
R>  [3] "Consumer Price Index - Canada"     
R>  [4] "Consumer Price Index - Switzerland"
R>  [5] "Consumer Price Index - Germany"    
R>  [6] "Consumer Price Index - Euro Area"  
R>  [7] "Consumer Price Index - France"     
R>  [8] "Consumer Price Index - UK"         
R>  [9] "Consumer Price Index - Italy"      
R> [10] "Consumer Price Index - Japan"      
R> [11] "Consumer Price Index - New Zealand"
R> [12] "Consumer Price Index - Russia"     
R> [13] "Consumer Price Index - USA"        
R> [14] "Inflation YOY - Argentina"         
R> [15] "Inflation YOY - Australia"         
R> [16] "Inflation YOY - Canada"            
R> [17] "Inflation YOY - Switzerland"       
R> [18] "Inflation YOY - Germany"           
R> [19] "Inflation YOY - Euro Area"         
R> [20] "Inflation YOY - France"            
R> [21] "Inflation YOY - UK"                
R> [22] "Inflation YOY - Italy"             
R> [23] "Inflation YOY - Japan"             
R> [24] "Inflation YOY - New Zealand"       
R> [25] "Inflation YOY - Russia"            
R> [26] "Inflation YOY - USA"
\end{verbatim}

What we want is the \texttt{\textquotesingle{}Inflation\ YOY\ -\ *\textquotesingle{}} datasets, which contain the year-on-year inflation rates for different countries. Let's filter the \texttt{dataframe} to keep the series with the yearly inflation, and select four countries:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{selected_series <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Inflation YOY - USA'}\NormalTok{,}
                     \StringTok{'Inflation YOY - Canada'}\NormalTok{,}
                     \StringTok{'Inflation YOY - Euro Area'}\NormalTok{,}
                     \StringTok{'Inflation YOY - Australia'}\NormalTok{)}

\CommentTok{# filter selected countries}
\NormalTok{idx <-}\StringTok{ }\NormalTok{df_db}\OperatorTok{$}\NormalTok{name }\OperatorTok{%in%}\StringTok{ }\NormalTok{selected_series}
\NormalTok{df_db <-}\StringTok{ }\NormalTok{df_db[idx, ]}
\end{Highlighting}
\end{Shaded}

Now we grab the data using \texttt{get\_Quandl\_series}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_id <-}\StringTok{ }\NormalTok{df_db}\OperatorTok{$}\NormalTok{quandl_code}
\KeywordTok{names}\NormalTok{(my_id) <-}\StringTok{ }\NormalTok{df_db}\OperatorTok{$}\NormalTok{name}
\NormalTok{first_date <-}\StringTok{ '2010-01-01'}
\NormalTok{last_date <-}\StringTok{ }\KeywordTok{Sys.Date}\NormalTok{()}

\NormalTok{df_inflation <-}\StringTok{ }\KeywordTok{get_Quandl_series}\NormalTok{(}\DataTypeTok{id_in =}\NormalTok{ my_id, }
                                  \DataTypeTok{api_key =}\NormalTok{ my_api_key,}
                                  \DataTypeTok{first_date =}\NormalTok{ first_date,}
                                  \DataTypeTok{last_date =}\NormalTok{ last_date)}

\KeywordTok{glimpse}\NormalTok{(df_inflation)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 446
R> Columns: 4
R> $ series_name <chr> "Inflation YOY - Australia", "Inflatio~
R> $ ref_date    <date> 2020-12-31, 2020-09-30, 2020-06-30, 2~
R> $ value       <dbl> 0.9, 0.7, -0.3, 2.2, 1.8, 1.7, 1.6, 1.~
R> $ id_quandl   <chr> "RATEINF/INFLATION_AUS", "RATEINF/INFL~
\end{verbatim}

And, finally, we create an elegant plot to see the behavior of the inflation rates in the selected countries:

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-175-1} \end{center}

As you can see, the \texttt{GetQuandlData} output is formatted to work well with the \texttt{tidyverse} tools. The resulting data shows some correlation between the inflation rates, specially between the Euro Area and USA.

\hypertarget{package-batchgetsymbols}{%
\section{\texorpdfstring{Package \texttt{BatchGetSymbols}}{Package BatchGetSymbols}}\label{package-batchgetsymbols}}

Package \texttt{BatchGetSymbols} \citep{R-BatchGetSymbols} is all about downloading stock price data from Yahoo Finance. Unlike other packages, \texttt{BatchGetSymbols} focuses on large batch downloads of structured and clean/tidy data. Its main features are: \index{BatchGetSymbols}

\textbf{Cleanliness and organization}: All financial data from different \emph{tickers} is kept in the same \texttt{dataframe} in a format that facilitates further analysis using packages from \texttt{tidyverse}.

\textbf{Control of import errors}: All download errors are registered in the output. If a particular stock does not have available data in Yahoo finance, it will be skipped and all other stock data are still downloaded and returned to the user;

\textbf{Comparison of dates to a benchmark}: Individual asset data is compared to data available for a benchmark, usually a market index. If the number of missing dates exceeds a certain limit set by the user, the stock is removed from the final dataframe. Moreover, you can set the minimal accepted volume of data for each stock, removing all stock cases with a low number of rows.

\textbf{Caching system}: By default, all imported data is locally saved using a clever caching system. Whenever the user repeats a data query, the cache system is used. If the desired data is not available in the cache, the function will only download the missing data. This significantly increases data access speed while minimizing the use of an Internet connection;

\begin{rmdimportant}
Since version 2.6 (2020-11-22) of \texttt{BatchGetSymbols}, the default
cache folder is located in the temporary directory of the R session.
Thus, the cache is persistent only for the current user session. This
change was motivated by structural breaks in the \emph{Yahoo Finance}
data, where the past data recorded in cache was no longer correct due to
corporate events such as splits and dividends. The user, however, can
change the cache folder using the \texttt{cache.folder} entry.
\end{rmdimportant}

\textbf{Access to \emph{tickers} in market indices}: The package includes functions to download composition of stock indexes. This makes it easy to import data for a large number of stocks. You can, for example, download prices for all stocks constituents of the SP500 index.

\textbf{Use of multiple cores}: If the user is downloading a large batch of stock data, an option for parallel execution is available. The practical effect is, depending on the number of cores in the computer, a significant decrease in total download time.

\textbf{Flexible output format}: The package also offers functions to modify the format of the data. If you need the wide format dataframe, such as a price matrix where tickers are columns and prices are rows, all you need to do is call function \texttt{BatchGetSymbols::reshape.wide}. Likewise, changing the frequency of the data is also possible. You can, for example, download weekly or monthly prices.

As an example of usage, let's download the prices of four stocks in the previous five years using function \texttt{BatchGetSymbols}. We choose these companies: Microsoft (MSFT), Google (GOOGL), JP Morgan (JPM) and General Electric (GE). \index{BatchGetSymbols!BatchGetSymbols} \index{base!Sys.Date}

In the call to function \texttt{BatchGetSymbols}, we set arguments \texttt{thresh.bad.data\ =\ 0.95} and \texttt{bench\_ticker\ =\ \textquotesingle{}\^{}GSPC\textquotesingle{}}. These choices make sure that all returned data have at least 95\% of valid prices when compared to data from the SP500 index (ticker \texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(BatchGetSymbols)}

\CommentTok{# set tickers}
\NormalTok{tickers <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'MSFT'}\NormalTok{,}\StringTok{'GOOGL'}\NormalTok{,}\StringTok{'JPM'}\NormalTok{,}\StringTok{'GE'}\NormalTok{)}

\CommentTok{# set dates}
\NormalTok{first_date <-}\StringTok{ }\KeywordTok{Sys.Date}\NormalTok{()}\OperatorTok{-}\DecValTok{5}\OperatorTok{*}\DecValTok{365}
\NormalTok{last_date <-}\StringTok{ }\KeywordTok{Sys.Date}\NormalTok{()}
\NormalTok{thresh_bad_data <-}\StringTok{ }\FloatTok{0.95}   \CommentTok{# sets percent threshold for bad data}
\NormalTok{bench_ticker <-}\StringTok{ '^GSPC'}   \CommentTok{# set benchmark as ibovespa}

\NormalTok{l_out <-}\StringTok{ }\KeywordTok{BatchGetSymbols}\NormalTok{(}\DataTypeTok{tickers =}\NormalTok{ tickers,}
                         \DataTypeTok{first.date =}\NormalTok{ first_date,}
                         \DataTypeTok{last.date =}\NormalTok{ last_date,}
                         \DataTypeTok{bench.ticker =}\NormalTok{ bench_ticker,}
                         \DataTypeTok{thresh.bad.data =}\NormalTok{ thresh_bad_data)}
\end{Highlighting}
\end{Shaded}

The output of \texttt{BatchGetSymbols} is an object of type \texttt{list}, which was not yet presented in this book. For now, all you need to know is that a \texttt{list} is a container for other objects. We will further study this class in chapter \ref{data-structure-objects}.

\begin{rmdcaution}
Note that the entries of the \texttt{BatchGetSymbols::BatchGetSymbols}
function use ``.'' in their names, such as \texttt{thresh.bad.data}, and
\texttt{bench.ticker}, while the book is written using the underscore
(\texttt{\_}), such as\texttt{thresh\_bad\_data}, and
\texttt{bench\_ticker}. This difference can result in problems if, in
the absence of attention, the user substitutes one for the other. As a
rule of thumb, prioritize the use of underscores in object names.
Unfortunately some functions written in the past still have an old code
structure and, in order not to harm old users, the names of the inputs
were kept.
\end{rmdcaution}

Back to our example, object \texttt{l\_out} has two elements, a table called \texttt{df.control} and another table called \texttt{df.tickers}. We can access each element using operator \texttt{\$}, such as in \texttt{l\_out\$df.control}. The first table, \texttt{df.control}, contains the result of the download process. As previously mentioned, the package not only downloads the data but also keeps track of possible errors and missing values. Let's check the content of this table.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print result of download process}
\KeywordTok{print}\NormalTok{(l_out}\OperatorTok{$}\NormalTok{df.control)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 4 x 6
R>   ticker src   download.status total.obs perc.benchmark.dat~
R>   <chr>  <chr> <chr>               <int>               <dbl>
R> 1 MSFT   yahoo OK                   1258                   1
R> 2 GOOGL  yahoo OK                   1258                   1
R> 3 JPM    yahoo OK                   1258                   1
R> 4 GE     yahoo OK                   1258                   1
R> # ... with 1 more variable: threshold.decision <chr>
\end{verbatim}

Column \texttt{threshold.decision} from \texttt{df.control} shows that all tickers were valid, and we got 1258 valid observations (rows) for each company.

As for the actual financial data, it is contained in element \texttt{df.tickers} of \texttt{l\_out}. Let's have a look:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print df.tickers}
\KeywordTok{glimpse}\NormalTok{(l_out}\OperatorTok{$}\NormalTok{df.tickers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 5,032
R> Columns: 10
R> $ price.open          <dbl> 54.95, 55.05, 55.43, 55.19, 54~
R> $ price.high          <dbl> 55.59, 55.61, 55.66, 55.30, 55~
R> $ price.low           <dbl> 54.86, 54.57, 55.00, 54.46, 54~
R> $ price.close         <dbl> 55.23, 55.57, 55.43, 54.56, 55~
R> $ volume              <dbl> 26360500, 24399200, 18928800, ~
R> $ price.adjusted      <dbl> 50.64435, 50.95612, 50.82775, ~
R> $ ref.date            <date> 2016-03-31, 2016-04-01, 2016-~
R> $ ticker              <chr> "MSFT", "MSFT", "MSFT", "MSFT"~
R> $ ret.adjusted.prices <dbl> NA, 0.0061560863, -0.002519265~
R> $ ret.closing.prices  <dbl> NA, 0.0061560746, -0.002519345~
\end{verbatim}

As expected, we find information about stock prices and traded volume. Notice it also includes column \texttt{ticker}, which contains the symbols of the stocks. In the tidy format, each stock has a chunk of data that is pilled in top of each other. Later, in chapter \ref{programming}, we will use this column to split the data and build summary tables. To inspect the data, let's look at its prices with \texttt{ggplot2}.

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-181-1} \end{center}

We see that General Eletric (GE) stock was not kind to its investors. Someone that bought the stock at its peak in mid-2016 has found its current value at less than half. Now, when it comes to the GOOGL, JPM and MSFT, we see an upward increase in stock prices. These are profitable and competitive companies in their sectors and not surprisingly, the stock prices surged over time.

Now, let's look at an example of a large batch download of stock prices. For that, we had to find the group of tickers of stocks that currently belong to the SP500 index with function \texttt{BatchGetSymbols::GetSP500Stocks}. After that, we simply pass the vector of tickers to \texttt{BatchGetSymbols}. We will also use parallel computing to speed up the importation:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(BatchGetSymbols)}

\CommentTok{# set tickers}
\NormalTok{df_SP500 <-}\StringTok{ }\KeywordTok{GetSP500Stocks}\NormalTok{()}
\NormalTok{sp500_tickers <-}\StringTok{ }\NormalTok{df_SP500}\OperatorTok{$}\NormalTok{Tickers}

\CommentTok{# set dates}
\NormalTok{first_date <-}\StringTok{ '2010-01-01'}
\NormalTok{last_date <-}\StringTok{ '2021-01-01'}
\NormalTok{thresh_bad_data <-}\StringTok{ }\FloatTok{0.95}   \CommentTok{# sets percent threshold for bad data}
\NormalTok{bench_ticker <-}\StringTok{ '^GSPC'}   \CommentTok{# set benchmark as ibovespa}

\CommentTok{# set number of cores (half of available cores)}
\NormalTok{future}\OperatorTok{::}\KeywordTok{plan}\NormalTok{(future}\OperatorTok{::}\NormalTok{multisession, }
             \DataTypeTok{workers =} \KeywordTok{floor}\NormalTok{(parallel}\OperatorTok{::}\KeywordTok{detectCores}\NormalTok{()}\OperatorTok{/}\DecValTok{2}\NormalTok{))}

\NormalTok{l_out <-}\StringTok{ }\KeywordTok{BatchGetSymbols}\NormalTok{(}\DataTypeTok{tickers =}\NormalTok{ sp500_tickers,}
                         \DataTypeTok{first.date =}\NormalTok{ first_date,}
                         \DataTypeTok{last.date =}\NormalTok{ last_date,}
                         \DataTypeTok{bench.ticker =}\NormalTok{ bench_ticker,}
                         \DataTypeTok{thresh.bad.data =}\NormalTok{ thresh_bad_data,}
                         \DataTypeTok{do.parallel =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

And now we check the resulting data:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(l_out}\OperatorTok{$}\NormalTok{df.tickers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,027,664
R> Columns: 10
R> $ price.open          <dbl> 83.09, 82.80, 83.88, 83.32, 83~
R> $ price.high          <dbl> 83.45, 83.23, 84.60, 83.76, 84~
R> $ price.low           <dbl> 82.67, 81.70, 83.51, 82.12, 83~
R> $ price.close         <dbl> 83.02, 82.50, 83.67, 83.73, 84~
R> $ volume              <dbl> 3043700, 2847000, 5268500, 447~
R> $ price.adjusted      <dbl> 64.09430, 63.69284, 64.59611, ~
R> $ ref.date            <date> 2010-01-04, 2010-01-05, 2010-~
R> $ ticker              <chr> "MMM", "MMM", "MMM", "MMM", "M~
R> $ ret.adjusted.prices <dbl> NA, -0.0062636148, 0.014181783~
R> $ ret.closing.prices  <dbl> NA, -0.0062635150, 0.014181793~
\end{verbatim}

We get a table with 1027664 rows in \texttt{l\_out\$df.tickers}. Looking deeper into \texttt{l\_out\$df.control} we find that, out of 505 tickers, only 454 passed the consistency check. This is a fairly sized table. Notice how easy it was to get that large volume of data from Yahoo Finance into an R session.

\begin{rmdcaution}
Please be aware that Yahoo Finance (YF) data for \textbf{adjusted prices
of single stocks} is not trustworthy and, if you compare to other data
vendors, you'll easily find large differences. The issue is that Yahoo
Finance does not adjust for dividends, only for stock splits. This means
that, when looking at price series over a long period of time, there is
a downward bias in overall return. As a rule of thumb, in a formal
research, \textbf{never use individual stock data from Yahoo Finance},
specially if the stock return is important to the research. The
exception is for financial indexes, such as the SP500, where Yahoo
Finance data is quite reliable since indexes do not undergo the same
adjustments as individual stocks.
\end{rmdcaution}

\hypertarget{package-simfinr}{%
\section{\texorpdfstring{Package \texttt{simfinR}}{Package simfinR}}\label{package-simfinr}}

\href{https://simfin.com/}{SimFin}\footnote{\url{https://simfin.com/}} is a special project for making financial data as accessible as possible. It works by gathering data from different stock exchanges and financial reports, cleaning and verifying it against official records, and distributing the tables from an API (\emph{access point interface}.). From its own website:

\begin{quote}
Our core goal is to make financial data as freely available as possible because we believe that having the right tools for investing/research shouldn't be the privilege of those that can afford to spend thousands of dollars per year on data.
\end{quote}

The platform is free, with a daily limit of 2000 api calls. This is not bad and should suffice for most users. If you need more calls, the \href{https://simfin.com/simfin-plus}{premium version}\footnote{\url{https://simfin.com/simfin-plus}} is just 10 euros a month, a fraction of what other data vendors usually request.

Package \texttt{simfinR} facilitates importing data from the SimFin API. First, it makes sure the requested data exists and only then calls the api. As usual, all api queries are saved locally using package \texttt{memoise}. This means that the second time you ask for a particular data about a company/year, the function will load a local copy, and will not call the web api, helping you stay below the API limits.

\hypertarget{example-01---apple-inc-annual-profit}{%
\subsection{Example 01 - Apple Inc Annual Profit}\label{example-01---apple-inc-annual-profit}}

The first step in using \texttt{simfinR} is registering at the \href{https://simfin.com/}{SimFin website}. Once done, click on \href{https://simfin.com/data/access/api}{Data Access}\footnote{\url{https://simfin.com/data/access/api}}. It should now show an API key such as \texttt{\textquotesingle{}rluwSlN304NpyJeBjlxZPspfBBhfJR4o\textquotesingle{}}. Save it in an R object for later use.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_api_key <-}\StringTok{ 'rluwSlN304NpyJeBjlxZPspfBBhfJR4o'}
\end{Highlighting}
\end{Shaded}

You need to be aware that the \textbf{API key in \texttt{my\_api\_key} is fake and will not work for you}. You need to get your own to execute the examples.

With the API key in hand, the second step is to find the numerical id of the company of interest. For that, we can find all available companies and their respective ids and ticker with \texttt{simfinR\_get\_available\_companies}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(simfinR)}
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{# get info}
\NormalTok{df_info_companies <-}\StringTok{ }\KeywordTok{simfinR_get_available_companies}\NormalTok{(my_api_key)}

\CommentTok{# check it}
\KeywordTok{glimpse}\NormalTok{(df_info_companies)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,974
R> Columns: 3
R> $ simId  <int> 171401, 901704, 994625, 45730, 378251, 8964~
R> $ ticker <chr> "ZYXI", "ZYNE", "ZUO", "ZUMZ", "ZTS", "ZS",~
R> $ name   <chr> "ZYNEX INC", "Zynerba Pharmaceuticals, Inc.~
\end{verbatim}

Digging deeper into the \texttt{dataframe}, we find that the numerical id of Apple is 111052. Let's use it to download the annual financial information since 2009.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id_companies <-}\StringTok{ }\DecValTok{111052} \CommentTok{# id of APPLE INC}
\NormalTok{type_statements <-}\StringTok{ 'pl'} \CommentTok{# profit/loss}
\NormalTok{periods =}\StringTok{ 'FY'} \CommentTok{# final year}
\NormalTok{years =}\StringTok{ }\DecValTok{2009}\OperatorTok{:}\DecValTok{2018}

\NormalTok{df_fin_FY <-}\StringTok{ }\KeywordTok{simfinR_get_fin_statements}\NormalTok{(}
\NormalTok{  id_companies,}
  \DataTypeTok{type_statements =}\NormalTok{ type_statements,}
  \DataTypeTok{periods =}\NormalTok{ periods,}
  \DataTypeTok{years =}\NormalTok{ years,}
  \DataTypeTok{api_key =}\NormalTok{ my_api_key)}

\KeywordTok{glimpse}\NormalTok{(df_fin_FY)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 580
R> Columns: 13
R> $ company_name   <chr> "APPLE INC", "APPLE INC", "APPLE IN~
R> $ company_sector <chr> "Computer Hardware", "Computer Hard~
R> $ type_statement <fct> pl, pl, pl, pl, pl, pl, pl, pl, pl,~
R> $ period         <fct> FY, FY, FY, FY, FY, FY, FY, FY, FY,~
R> $ year           <int> 2009, 2009, 2009, 2009, 2009, 2009,~
R> $ ref_date       <date> 2009-12-31, 2009-12-31, 2009-12-31~
R> $ acc_name       <chr> "Revenue", "Sales & Services Revenu~
R> $ acc_value      <dbl> 4.2905e+10, NA, NA, NA, -2.5683e+10~
R> $ tid            <chr> "1", "3", "5", "6", "2", "7", "8", ~
R> $ uid            <chr> "1", "0", "0", "0", "2", "0", "0", ~
R> $ parent_tid     <chr> "4", "1", "1", "1", "4", "2", "2", ~
R> $ display_level  <chr> "0", "1", "1", "1", "0", "1", "1", ~
R> $ check_possible <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, ~
\end{verbatim}

And now we plot the results of the Net Income (profit/loss) for all years:

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-190-1} \end{center}

Not bad! Apple has been doing very well over the years. We can also grab data for all quarters and get more detailed information:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{type_statements <-}\StringTok{ 'pl'} \CommentTok{# profit/loss}
\NormalTok{periods =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Q1'}\NormalTok{, }\StringTok{'Q2'}\NormalTok{, }\StringTok{'Q3'}\NormalTok{, }\StringTok{'Q4'}\NormalTok{) }\CommentTok{# final year}
\NormalTok{years =}\StringTok{ }\DecValTok{2009}\OperatorTok{:}\DecValTok{2018}

\NormalTok{df_fin_quarters <-}\StringTok{ }\KeywordTok{simfinR_get_fin_statements}\NormalTok{(}
\NormalTok{  id_companies,}
  \DataTypeTok{type_statements =}\NormalTok{ type_statements,}
  \DataTypeTok{periods =}\NormalTok{ periods,}
  \DataTypeTok{years =}\NormalTok{ years,}
  \DataTypeTok{api_key =}\NormalTok{ my_api_key)}

\KeywordTok{glimpse}\NormalTok{(df_fin_quarters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 2,320
R> Columns: 13
R> $ company_name   <chr> "APPLE INC", "APPLE INC", "APPLE IN~
R> $ company_sector <chr> "Computer Hardware", "Computer Hard~
R> $ type_statement <fct> pl, pl, pl, pl, pl, pl, pl, pl, pl,~
R> $ period         <fct> Q1, Q1, Q1, Q1, Q1, Q1, Q1, Q1, Q1,~
R> $ year           <int> 2009, 2009, 2009, 2009, 2009, 2009,~
R> $ ref_date       <date> 2009-03-31, 2009-03-31, 2009-03-31~
R> $ acc_name       <chr> "Revenue", "Sales & Services Revenu~
R> $ acc_value      <dbl> 1.188e+10, NA, NA, NA, -7.373e+09, ~
R> $ tid            <chr> "1", "3", "5", "6", "2", "7", "8", ~
R> $ uid            <chr> "1", "0", "0", "0", "2", "0", "0", ~
R> $ parent_tid     <chr> "4", "1", "1", "1", "4", "2", "2", ~
R> $ display_level  <chr> "0", "1", "1", "1", "0", "1", "1", ~
R> $ check_possible <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, ~
\end{verbatim}

And plot the results:

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-192-1} \end{center}

Nice and impressive profit record. The first quarter (Q1) seems to present the best performance, probably due to the effect of Christmas in the retail business. Apple sells quality products at a premium price. Not surprinsingly, many people want the new iphone for Christmas and that translates into more sells in the months of december, which are registered at the first quarter of the year.

\hypertarget{example-02---quarterly-net-profit-of-many-companies}{%
\subsection{Example 02 - Quarterly Net Profit of Many Companies}\label{example-02---quarterly-net-profit-of-many-companies}}

Package \texttt{simfinR} can also fetch information for many companies in a single call. Let's run another example by selecting four random companies and creating the same previous graph:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{my_ids <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(df_info_companies}\OperatorTok{$}\NormalTok{simId, }\DecValTok{4}\NormalTok{)}
\NormalTok{type_statements <-}\StringTok{ 'pl'} \CommentTok{# profit/loss}
\NormalTok{periods =}\StringTok{ 'FY'} \CommentTok{# final year}
\NormalTok{years =}\StringTok{ }\DecValTok{2010}\OperatorTok{:}\DecValTok{2018}

\NormalTok{df_fin <-}\StringTok{ }\KeywordTok{simfinR_get_fin_statements}\NormalTok{(}
  \DataTypeTok{id_companies =}\NormalTok{ my_ids,}
  \DataTypeTok{type_statements =}\NormalTok{ type_statements,}
  \DataTypeTok{periods =}\NormalTok{ periods,}
  \DataTypeTok{years =}\NormalTok{ years,}
  \DataTypeTok{api_key =}\NormalTok{ my_api_key)}

\NormalTok{net_income <-}\StringTok{ }\NormalTok{df_fin }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{filter}\NormalTok{(acc_name }\OperatorTok{==}\StringTok{ 'Net Income'}\NormalTok{)}

\KeywordTok{glimpse}\NormalTok{(net_income)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 18
R> Columns: 13
R> $ company_name   <chr> "SOUTHERN NATURAL GAS COMPANY, L.L.~
R> $ company_sector <chr> NA, NA, NA, NA, NA, NA, NA, "Chemic~
R> $ type_statement <fct> pl, pl, pl, pl, pl, pl, pl, pl, pl,~
R> $ period         <fct> FY, FY, FY, FY, FY, FY, FY, FY, FY,~
R> $ year           <int> 2010, 2011, 2014, 2015, 2016, 2017,~
R> $ ref_date       <date> 2010-12-31, 2011-12-31, 2014-12-31~
R> $ acc_name       <chr> "Net Income", "Net Income", "Net In~
R> $ acc_value      <dbl> 267000000, 260000000, -344224, -262~
R> $ tid            <chr> "55", "55", "55", "55", "55", "55",~
R> $ uid            <chr> "55", "55", "55", "55", "55", "55",~
R> $ parent_tid     <chr> "58", "58", "58", "58", "58", "58",~
R> $ display_level  <chr> "0", "0", "0", "0", "0", "0", "0", ~
R> $ check_possible <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, ~
\end{verbatim}

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-194-1} \end{center}

As you can see, it is fairly straighforward to download financial data for multiple companies using \texttt{simfinR}.

\hypertarget{example-03-fetching-price-data}{%
\subsection{Example 03: Fetching price data}\label{example-03-fetching-price-data}}

The simfin project also provides prices of stocks, adjusted for dividends, splits and other corporate events. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{15}\NormalTok{)}
\NormalTok{my_ids <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(df_info_companies}\OperatorTok{$}\NormalTok{simId, }\DecValTok{4}\NormalTok{)}


\NormalTok{df_price <-}\StringTok{ }\KeywordTok{simfinR_get_price_data}\NormalTok{(}\DataTypeTok{id_companies =}\NormalTok{ my_ids,}
                                   \DataTypeTok{api_key =}\NormalTok{ my_api_key)}

\KeywordTok{glimpse}\NormalTok{(df_price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 11,778
R> Columns: 8
R> $ ref_date         <date> 2021-03-29, 2021-03-26, 2021-03-~
R> $ close_adj        <dbl> 69.22, 69.49, 66.73, 65.26, 65.62~
R> $ split_coef       <chr> NA, NA, NA, NA, NA, NA, NA, NA, N~
R> $ share_class_id   <int> 928013, 928013, 928013, 928013, 9~
R> $ share_class_name <chr> "Common Shares", "Common Shares",~
R> $ share_class_type <chr> "common", "common", "common", "co~
R> $ currency         <chr> "USD", "USD", "USD", "USD", "USD"~
R> $ company_name     <chr> "Smith A O Corp", "Smith A O Corp~
\end{verbatim}

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-196-1} \end{center}

As you can see, the data is comprehensive and should suffice for many different corporate finance research topics.

\hypertarget{package-tidyquant}{%
\section{\texorpdfstring{Package \texttt{tidyquant}}{Package tidyquant}}\label{package-tidyquant}}

Package \texttt{tidyquant} \citep{R-tidyquant} provides functions related to financial data acquisition and analysis. It is an ambitious project that offers many solutions in the field of finance. As you might suspect, \texttt{tidyquant} is designed to interact well with the \emph{tidyverse} format, also known as the \emph{long} format, discussed in chapter \ref{data-structure-objects}. The package includes functions for obtaining financial data from the web, manipulation of such data, and the calculation of performance measures of portfolios. \index{tidyquant}

In its current version, \texttt{tidyquant} has 159 functions. Let's look at its main functionalities. First, we will obtain price data for Apple stocks (AAPL) using function \texttt{tq\_get}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyquant)}

\CommentTok{# set stock and dates}
\NormalTok{ticker <-}\StringTok{ 'AAPL'}
\NormalTok{first_date <-}\StringTok{ '2019-01-01'}
\NormalTok{last_date <-}\StringTok{  }\KeywordTok{Sys.Date}\NormalTok{()}

\CommentTok{# get data with tq_get}
\NormalTok{df_prices <-}\StringTok{ }\KeywordTok{tq_get}\NormalTok{(ticker,}
                    \DataTypeTok{get =} \StringTok{"stock.prices"}\NormalTok{, }
                    \DataTypeTok{from =}\NormalTok{ first_date, }
                    \DataTypeTok{to =}\NormalTok{ last_date)}

\KeywordTok{glimpse}\NormalTok{(df_prices)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 564
R> Columns: 8
R> $ symbol   <chr> "AAPL", "AAPL", "AAPL", "AAPL", "AAPL", "~
R> $ date     <date> 2019-01-02, 2019-01-03, 2019-01-04, 2019~
R> $ open     <dbl> 38.7225, 35.9950, 36.1325, 37.1750, 37.39~
R> $ high     <dbl> 39.7125, 36.4300, 37.1375, 37.2075, 37.95~
R> $ low      <dbl> 38.5575, 35.5000, 35.9500, 36.4750, 37.13~
R> $ close    <dbl> 39.4800, 35.5475, 37.0650, 36.9825, 37.68~
R> $ volume   <dbl> 148158800, 365248800, 234428400, 21911120~
R> $ adjusted <dbl> 38.50502, 34.66964, 36.14966, 36.06920, 3~
\end{verbatim}

As we can see, except for column names, the price data has a similar format to the one we got with \texttt{BatchGetSymbols}. This is not surprising as both share the same origin, Yahoo Finance.

We can also get information about components of an index using function \texttt{tq\_index}. The available market indices are: \index{tidyquant!tq\_index\_options} \index{tidyquant!tq\_index}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print available indices}
\KeywordTok{print}\NormalTok{(}\KeywordTok{tq_index_options}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "DOW"       "DOWGLOBAL" "SP400"     "SP500"    
R> [5] "SP600"
\end{verbatim}

Let's get information for \texttt{"DOWGLOBAL"}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get components of "DOWJONES"}
\KeywordTok{print}\NormalTok{(}\KeywordTok{tq_index}\NormalTok{(}\StringTok{"DOWGLOBAL"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Getting holdings for DOWGLOBAL
\end{verbatim}

\begin{verbatim}
R> # A tibble: 155 x 8
R>    symbol  company        identifier sedol  weight sector   
R>    <chr>   <chr>          <chr>      <chr>   <dbl> <chr>    
R>  1 MT-NL   ArcelorMittal~ BYPBS6     BYPB~ 0.0117  Materials
R>  2 GE      General Elect~ 36960410   2380~ 0.0117  Industri~
R>  3 SPG     Simon Propert~ 82880610   2812~ 0.00951 Real Est~
R>  4 HWM     Howmet Aerosp~ 44320110   BKLJ~ 0.00950 Industri~
R>  5 BBVA-ES Banco Bilbao ~ 550190     5501~ 0.00948 Financia~
R>  6 DE      Deere & Compa~ 24419910   2261~ 0.00913 Industri~
R>  7 MTN-ZA  MTN Group Lim~ 656320     6563~ 0.00912 Communic~
R>  8 GLE-FR  Societe Gener~ 596651     5966~ 0.00893 Financia~
R>  9 AIG     American Inte~ 02687478   2027~ 0.00872 Financia~
R> 10 GS      Goldman Sachs~ 38141G10   2407~ 0.00869 Financia~
R> # ... with 145 more rows, and 2 more variables:
R> #   shares_held <dbl>, local_currency <chr>
\end{verbatim}

We only looked into a few functions from the package \texttt{tidyquant}. It also offers solutions for the usual manipulations, such as calculating returns and functions for portfolio analytics. You can find more details about this package in its \href{https://business-science.github.io/tidyquant/}{website}\footnote{\url{https://business-science.github.io/tidyquant/}}.

\hypertarget{package-rbitcoin}{%
\section{\texorpdfstring{Package \texttt{Rbitcoin}}{Package Rbitcoin}}\label{package-rbitcoin}}

Given the popularity of crypto-currencies, another package worth mentioning is \texttt{RBitcoin}. It allows access to trade data from several Bitcoin exchanges. Here, let's show a simple example of importing trade data from the \texttt{\textquotesingle{}Kraken\textquotesingle{}} exchange, using Euro as the currency.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(Rbitcoin)}

\CommentTok{# set mkt, currency pair and type of action}
\NormalTok{mkt <-}\StringTok{ "kraken"}
\NormalTok{currency <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"BTC"}\NormalTok{,}\StringTok{"EUR"}\NormalTok{)}
\NormalTok{action <-}\StringTok{ 'trades'}

\CommentTok{# import data}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{market.api.process}\NormalTok{(}\DataTypeTok{market =}\NormalTok{ mkt,}
                           \DataTypeTok{currency_pair =}\NormalTok{ currency,}
                           \DataTypeTok{action =}\NormalTok{ action)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $market
R> [1] "kraken"
R> 
R> $base
R> [1] "BTC"
R> 
R> $quote
R> [1] "EUR"
R> 
R> $timestamp
R> [1] "2021-03-30 11:31:52 -03"
R> 
R> $market_timestamp
R> [1] NA
R> 
R> $trades
R>                      date   price     amount
R>    1: 2021-03-30 14:11:47 50000.0 0.00869530
R>    2: 2021-03-30 14:11:47 50000.0 0.00001300
R>    3: 2021-03-30 14:11:47 50000.1 0.01213864
R>    4: 2021-03-30 14:11:47 50000.1 0.00001939
R>    5: 2021-03-30 14:11:47 50000.1 0.00000003
R>   ---                                       
R>  996: 2021-03-30 14:31:40 50165.8 0.00484159
R>  997: 2021-03-30 14:31:41 50165.8 0.00200000
R>  998: 2021-03-30 14:31:41 50165.8 0.00429305
R>  999: 2021-03-30 14:31:42 50166.3 0.00434051
R> 1000: 2021-03-30 14:31:50 50176.5 0.00020000
R>                       tid type
R>    1:                <NA>  bid
R>    2:                <NA>  bid
R>    3:                <NA>  bid
R>    4:                <NA>  bid
R>    5:                <NA>  bid
R>   ---                         
R>  996:                <NA>  bid
R>  997:                <NA>  bid
R>  998:                <NA>  bid
R>  999:                <NA>  bid
R> 1000: 1617114710282894649  bid
\end{verbatim}

The output of \texttt{market.api.process} is a \texttt{list} object with information about Bitcoin in the \texttt{\textquotesingle{}Kraken\textquotesingle{}} market. The actual trades are available in the \texttt{trade} slot of \texttt{my\_l}. Let's have a look at its content:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(my_l}\OperatorTok{$}\NormalTok{trades)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 1,000
R> Columns: 5
R> $ date   <dttm> 2021-03-30 14:11:47, 2021-03-30 14:11:47, ~
R> $ price  <dbl> 50000.0, 50000.0, 50000.1, 50000.1, 50000.1~
R> $ amount <dbl> 0.00869530, 0.00001300, 0.01213864, 0.00001~
R> $ tid    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,~
R> $ type   <chr> "bid", "bid", "bid", "bid", "bid", "bid", "~
\end{verbatim}

It includes price and time information for the past 1000 trades. The package also includes functions for looking into the order book of each market and managing Bitcoin wallets. One can find more details about the functionalities of the package in its \href{https://github.com/jangorecki/Rbitcoin}{website}\footnote{\url{https://github.com/jangorecki/Rbitcoin}}.

\hypertarget{other-packages}{%
\section{Other Packages}\label{other-packages}}

In CRAN, you'll find many more packages for importing financial datasets in R. In this section, we focused on packages, which are free and easy to use. Interface with commercial data sources is also possible. Several companies provide APIs for serving data to their clients. Packages such as \texttt{Rblpapi} (Bloomberg), \texttt{IBrokers} (Interactive Brokers), \texttt{TFX} (TrueFX), \texttt{rdatastream} (Thomson Dataworks) can make R communicate with these commercial platforms. If the company you use is not presented here, check the \href{https://cran.r-project.org/}{list of packages in CRAN}\footnote{\url{https://cran.r-project.org/}}. It is very likely you'll find what you need.

\hypertarget{accessing-data-from-web-pages-webscraping}{%
\section{\texorpdfstring{Accessing Data from Web Pages (\emph{webscraping})}{Accessing Data from Web Pages (webscraping)}}\label{accessing-data-from-web-pages-webscraping}}

Packages from the previous section make it easy to import data directly from the web with a single line of code. However, in many cases, the information of interest is not available through a package, but on a web page. Fortunately, we can use R to read the HTML data and import the desired information into an R session. The main advantage is that every time we execute the R code, we get the same content as the target website.

The process of extracting information from web pages is called \emph{webscraping}. Depending on the structure and technology used on the internet page, importing its content can be as trivial as a single line in R or a complex process, taking hundreds of lines of code. Let's look at two simple examples; first, we will retrieve tabular information about the SP500 index from Wikipedia and, second, we will extract current inflation and interest rate from the Reserve Bank of Australia (RBA) website. \index{webscraping}

\hypertarget{scraping-the-components-of-the-sp500-index-from-wikipedia}{%
\subsection{Scraping the Components of the SP500 Index from Wikipedia}\label{scraping-the-components-of-the-sp500-index-from-wikipedia}}

In its website, Wikipedia offers a \href{https://en.wikipedia.org/wiki/List_of_S\%26P_500_companies}{section}\footnote{\url{https://en.wikipedia.org/wiki/List_of_S\%26P_500_companies}} about the components of the SP500 index. This information is presented in a tabular format, Figure \ref{fig:SP500-wikipedia}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/SP500-Wikipedia} 

}

\caption{Mirror of Wikipedia page on SP500 components}\label{fig:SP500-wikipedia}
\end{figure}

The information on this web page is constantly updated, and we can use it to import information about the stocks belonging to the SP500 index. Before delving into the R code, we need to understand how a webpage works. Briefly, a webpage is nothing more than a lengthy HTML code interpreted by your browser. A numerical value or text presented on the website can usually be found within the code. This code has a particular tree-like structure with branches and classes. Moreover, every element of a webpage has an address, called \emph{xpath}. In chrome and firefox browsers, you can see the actual code of a webpage by using the mouse to right-click any part of the webpage and selecting \emph{View page source}.

The first step in webscraping is finding out the location of the information you need. In Chrome, you can do that by right-clicking in the specific location of the number/text on the website and selecting \emph{inspect}. This will open an extra window in the browser. Once you do that, right-click in the selection and chose \emph{copy} and \emph{copy xpath}. In Figure \ref{fig:SP500-Wikipedia-webscraping}, we see a mirror of what you should be seeing in your browser.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/SP500-Wikipedia_webscraping} 

}

\caption{Finding xpath from website}\label{fig:SP500-Wikipedia-webscraping}
\end{figure}

Here, the copied \emph{xpath} is:

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{'//*[@id="mw-content-text"]/table[1]/thead/tr/th[2]'}
\end{Highlighting}
\end{Shaded}

This is the address of the header of the table. For the whole content of the table, including header, rows, and columns, we need to set an upper level of the HTML tree. This is equivalent to address \texttt{//*{[}@id="MW-content-text"{]}/table{[}1{]}}.

Now that we have the location of what we want, let's load package \texttt{rvest} \citep{R-rvest} and use functions \texttt{read\_html}, \texttt{html\_nodes} and \texttt{html\_table} to import the desired table into R: \index{rvest} \index{rvest!read\_html} \index{rvest!html\_nodes} \index{rvest!html\_table}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rvest)}

\CommentTok{# set url and xpath}
\NormalTok{my_url <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'https://en.wikipedia.org/wiki/'}\NormalTok{,}
                 \StringTok{'List_of_S%26P_500_companies'}\NormalTok{)}
\NormalTok{my_xpath <-}\StringTok{ '//*[@id="mw-content-text"]/div/table[1]'}

\CommentTok{# get nodes from html}
\NormalTok{out_nodes <-}\StringTok{ }\KeywordTok{html_nodes}\NormalTok{(}\KeywordTok{read_html}\NormalTok{(my_url),}
                        \DataTypeTok{xpath =}\NormalTok{ my_xpath)}

\CommentTok{# get table from nodes (each element in }
\CommentTok{# list is a table)}
\NormalTok{df_SP500_comp <-}\StringTok{ }\KeywordTok{html_table}\NormalTok{(out_nodes)}

\CommentTok{# isolate it }
\NormalTok{df_SP500_comp <-}\StringTok{ }\NormalTok{df_SP500_comp[[}\DecValTok{1}\NormalTok{]]}

\CommentTok{# change column names (remove space)}
\KeywordTok{names}\NormalTok{(df_SP500_comp) <-}\StringTok{ }\KeywordTok{make.names}\NormalTok{(}\KeywordTok{names}\NormalTok{(df_SP500_comp))}

\CommentTok{# print it}
\KeywordTok{glimpse}\NormalTok{(df_SP500_comp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 505
R> Columns: 9
R> $ Symbol                <chr> "MMM", "ABT", "ABBV", "ABMD"~
R> $ Security              <chr> "3M Company", "Abbott Labora~
R> $ SEC.filings           <chr> "reports", "reports", "repor~
R> $ GICS.Sector           <chr> "Industrials", "Health Care"~
R> $ GICS.Sub.Industry     <chr> "Industrial Conglomerates", ~
R> $ Headquarters.Location <chr> "St. Paul, Minnesota", "Nort~
R> $ Date.first.added      <chr> "1976-08-09", "1964-03-31", ~
R> $ CIK                   <int> 66740, 1800, 1551152, 815094~
R> $ Founded               <chr> "1902", "1888", "2013 (1888)~
\end{verbatim}

Object \texttt{df\_SP500\_comp} contains a mirror of the data from the Wikipedia website. The names of the columns require some work, but the raw data is intact and could be further used in a script. Notice how the output is the exact same data as the previous use of function \texttt{BatchGetSymbols::GetSP500Stocks}. By executing command \texttt{edit(BatchGetSymbols::GetSP500Stocks)} you'll see that the source of data is the same and the code is similar to the one we just executed.

\hypertarget{scraping-the-website-of-the-reserve-bank-of-australia}{%
\subsection{Scraping the Website of the Reserve Bank of Australia}\label{scraping-the-website-of-the-reserve-bank-of-australia}}

As another example of webscraping with R, let's import information from the Reserve Bank of Australia. When accessed in 2021-02-26, its \href{http://www.rba.gov.au/}{home page}\footnote{\url{http://www.rba.gov.au/}} mirrors Figure \ref{fig:RBA-website}.

\begin{figure}[!htbp]

{\centering \includegraphics[width=0.75\linewidth]{figs/website_RBA-webscrapping} 

}

\caption{Website for the Reserve Bank of Australia}\label{fig:RBA-website}
\end{figure}

The website presents several information such as current news and interest rates. Let's assume we are interested in the information about the current cash/bank rate and inflation, right upper corner of the webpage.

The first step of \emph{webscrapping} is finding out the \emph{xpath} of the information we want. Using the procedure described in the previous example, we find out the address of both values, market rate and current inflation:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xpath_inflation <-}\StringTok{ '//*[@id="content"]/section[1]/div/div[3]/p'}
\NormalTok{xpath_int_rate <-}\StringTok{ '//*[@id="content"]/section[1]/div/div[1]/p'}
\end{Highlighting}
\end{Shaded}

A difference from the previous example is we are not importing a table, but a simple text from the website. For that, we use function \texttt{html\_text} and not \texttt{html\_table}. The full code and its output are presented next.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(rvest)}

\CommentTok{# set address of RBA}
\NormalTok{my_url <-}\StringTok{ 'https://www.rba.gov.au/'}

\CommentTok{# read html}
\NormalTok{html_code <-}\StringTok{ }\KeywordTok{read_html}\NormalTok{(my_url)}

\CommentTok{# set xpaths}
\NormalTok{xpath_inflation <-}\StringTok{ '//*[@id="content"]/section[1]/div/div[3]/p'}
\NormalTok{xpath_int_rate <-}\StringTok{ '//*[@id="content"]/section[1]/div/div[1]/p'}

\CommentTok{# get inflation from html}
\NormalTok{my_inflation <-}\StringTok{ }\KeywordTok{html_text}\NormalTok{(}\KeywordTok{html_nodes}\NormalTok{(html_code,}
                                     \DataTypeTok{xpath =}\NormalTok{ xpath_inflation ))}

\CommentTok{# get interest rate from html}
\NormalTok{my_int_rate <-}\StringTok{ }\KeywordTok{html_text}\NormalTok{(}\KeywordTok{html_nodes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ html_code,}
                                    \DataTypeTok{xpath =}\NormalTok{ xpath_int_rate ))}
\end{Highlighting}
\end{Shaded}

And now we print the result:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print result}
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Current inflation in AUS:"}\NormalTok{, my_inflation)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Current inflation in AUS: 0.9%
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Current interest rate AUS:"}\NormalTok{, my_int_rate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R> Current interest rate AUS: 0.1%
\end{verbatim}

Using \emph{webscraping} techniques can become a strong ally of the researcher. It can give you access to an immense amount of information available on the web. However, each scenario of \emph{webscraping} is particular. It is not always the case you can import data directly and easily as in previous examples.

Another problem is that the webscrapping code depends on the structure of the website. Any simple change in the \emph{html} structure and your code will fail. You should be aware that maintaining a \emph{webscraping} code can demand significant time and effort from the developer. If possible, you should always check for alternative sources of the same information.

Readers interested in learning more about this topic should study the functionalities of packages \texttt{XML} \citep{R-XML}, \texttt{RSelenium} \citep{R-RSelenium} and \texttt{splashr} \citep{R-splashr}. Each one of these is best suited to sove a particular webscraping problem. \index{rvest} \index{XML} \index{RSelenium} \index{splashr}

\hypertarget{exercises-2}{%
\section{Exercises}\label{exercises-2}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Using the \texttt{BatchGetSymbols} package, download daily data of the Facebook stock (FB) from \emph{Yahoo Finance} for the period between 2019 and 2020. What is the lowest \textbf{unadjusted closing price (column \texttt{price.close})} in the analyzed period?

02 -
If you have not already done so, create a profile on the \href{https://www.quandl.com/}{Quandl website}\footnote{\url{https://www.quandl.com/}} and download the arabica coffee price data in the CEPEA database (Center for Advanced Studies in Applied Economics) ) between 2010-01-01 and 2020-12-31. What is the value of the most recent price?

03 -
Use function \texttt{simfinR::simfinR\_get\_available\_companies} to import data about all available companies in \href{https://simfin.com}{Simfin}. How many companies do you find? Be aware that the number of rows is not necessarily equal to the number of companies. You need to check the number of unique values in column \texttt{name} (see function \texttt{dplyr::n\_distinct}.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2973
\item
  3520
\item
  4631
\item
  5187
\item
  4076
\end{enumerate}

04 -
With package \texttt{simfinR}, download the PL (profit/loss) statement for FY (final year) data of company TESLA INC (id = \ensuremath{5.6317\times 10^{4}}) for years 2018, 2019, 2020. What is the latest Net Income of the company?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  \$469,622,295
\item
  \$270,115,209
\item
  \$721,000,000
\item
  \$1,869,794,924
\item
  \$1,148,794,924
\end{enumerate}

05 -
Using function \texttt{tidyquant::tq\_index}, download current composition of index SP400. What is the company with the highest percentage in the composition of the index?

Be aware that the answer is time-dependent and the reported result might be different from what you actually got in your R session.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  SEI Investments Company
\item
  Bio-Techne Corporation
\item
  First Industrial Realty Trust Inc.
\item
  Fair Isaac Corporation
\item
  TripAdvisor Inc.
\end{enumerate}

06 -
Using again the \texttt{BatchGetSymbols} package, download data between 2019-01-01 and 2020-01-01 for the following tickers:

\begin{itemize}
\tightlist
\item
  AAPL: Apple Inc
\item
  BAC: Bank of America Corporation
\item
  GE: General Electric Company
\item
  TSLA: Tesla, Inc.
\item
  SNAP: Snap Inc.
\end{itemize}

Using the \textbf{adjusted closing price} column, what company provided higher return to the stock holder during the analyzed period?

Tip: this is an advanced exercise that will require some coding. To solve it, check out function \texttt{split} to split the dataframe of price data and \texttt{lapply} to map a function to each dataframe.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  TSLA
\item
  SNAP
\item
  GE
\item
  AAPL
\item
  BAC
\end{enumerate}

\hypertarget{data-structure-objects}{%
\chapter{Dataframes and other objects}\label{data-structure-objects}}

\textbf{In R, everything is an object with its own properties}. A \texttt{numeric} vector can interact with other \texttt{numeric} objects in operations such as multiplication, division, and addition. The same is not for objects of the \texttt{character} class, where mathematical properties are not valid or intuitive -- it does not make sense to add a numeric value to a text or to divide a text for other text. But, the \texttt{character} class has other properties, such as allowing the user to look for a specific chunk of characters, splitting parts of a text, and replacing specific characters, among many other possibilities. \textbf{One of the most important aspects of working with R is learning the functionalities of the object classes}.

The basic object classes in R include numeric values, characters (text), factors, dates, among many other cases. However, base classes are stored in more complex data structures, such as \texttt{dataframes} (tables) and lists. Such an organization makes the job of manipulating data a lot easier. Imagine, for example, conducting a study using price and volume data for five hundred stocks. If we used one numeric object -- a vector -- for each stock's volume and price, we would have one thousand objects to handle in our \emph{environment}. Although it is possible to work this way, the resulting code would be disorganized, difficult to understand, and prone to errors -- the so-called \href{https://en.wikipedia.org/wiki/Spaghetti_code}{spaguetti code}\footnote{\url{https://en.wikipedia.org/wiki/Spaghetti_code}}. So twisted and tangled that it becomes difficult to use and maintain.

To avoid that, a simpler way to organize our data is to create an object named \texttt{my\_data} and allocate prices and volumes there. All the information needed to perform the study would be in this object, facilitating the import and export of data. Our code would also be simpler and more structured as would only need to manipulate one object -- a table, expanding it with new variables or relating it to other tables. Said that, let's have a closer look at objects for structuring datasets, including \texttt{dataframes}, \texttt{lists} and \texttt{matrices}.

\hypertarget{dataframes}{%
\section{\texorpdfstring{\texttt{Dataframes}}{Dataframes}}\label{dataframes}}

Without a doubt, the \texttt{dataframe} class is the most used and most important object to understand while learning R. You will spend most of your time manipulating one or many \texttt{dataframes} to get the result you need. A \texttt{dataframe} is simply a table with rows and columns. It allows for each column to have a different class. We can organize text data into a dataframe along with numbers, for example. This flexibility makes the \texttt{dataframe} an efficient object to represent heterogeneous datasets. Internally, a dataframe is a special type of a \texttt{list}, where each column is an atomic vector. \index{dataframes}

\textbf{A \texttt{dataframe} can organize our work significantly}. The tabular structure of a \texttt{dataframe} forces the data to be \emph{paired}, where each row is a different data point with several pieces of information (columns). This simple data structure can accommodate an infinite variety of information. As new data points arrive, the number of rows increases. When a new variable is inserted in the analysis, we simply add a new column to the existing table.

Another positive aspect of using the \texttt{dataframe} class in R is that several functions expect a \texttt{dataframe} as input. For example, the data manipulation package \texttt{dplyr} \citep{R-dplyr} and the graphical package \texttt{ggplot2} \citep{R-ggplot2} work from a \texttt{dataframe} only. Operations of importing and exporting information are mostly \texttt{dataframe} oriented. Without a doubt, \texttt{dataframes} are at the centre of functionalities in R, and you \textbf{must} master the manipulation of this object.

\hypertarget{creating-dataframes}{%
\subsection{\texorpdfstring{Creating \texttt{dataframes}}{Creating dataframes}}\label{creating-dataframes}}

The \texttt{dataframe} object is one of R's native classes and is implemented in the \texttt{base} package. We can, for example, create a \texttt{dataframe} with function \texttt{base::data.frame}. However, the \texttt{tidyverse} universe offers its own version of a dataframe, called \texttt{tibble}. Converting a dataframe to \texttt{tibble} is internal and automatic. A \texttt{tibble} object is more flexible than native \texttt{dataframes}, making it significantly easier to use. Following our preference for the \texttt{tidyverse} functions, from now on we will use \texttt{tibbles} as our version of \texttt{dataframes}. \index{base!data.frame}

We call function \texttt{tibble::tibble} to create a \texttt{dataframe}. Notice that function \texttt{tibble:data\_frame} does the same job, but has been deprecated. This means that developers of the \texttt{tibble} package will give preference to the \texttt{tibble} function in the future and, as users, we should follow the recommendation. We will now use this function for creating a \texttt{dataframe} with financial data of different stocks. \index{tibble} \index{tibble!tibble} \index{tibble!data\_frame}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{# set tickers}
\NormalTok{tickers <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\StringTok{'AAP'}\NormalTok{,}\DecValTok{5}\NormalTok{), }
             \KeywordTok{rep}\NormalTok{(}\StringTok{'COG'}\NormalTok{, }\DecValTok{5}\NormalTok{), }
             \KeywordTok{rep}\NormalTok{(}\StringTok{'BLK'}\NormalTok{, }\DecValTok{5}\NormalTok{), }
             \KeywordTok{rep}\NormalTok{(}\StringTok{'CAM'}\NormalTok{,}\DecValTok{5}\NormalTok{) )}

\CommentTok{# set a date vector}
\NormalTok{dates <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"2010-01-04"}\NormalTok{, }\StringTok{"2010-01-05"}\NormalTok{, }\StringTok{"2010-01-06"}\NormalTok{, }
                       \StringTok{"2010-01-07"}\NormalTok{, }\StringTok{"2010-01-08"}\NormalTok{), }\DecValTok{4}\NormalTok{) )}

\CommentTok{# set prices                      }
\NormalTok{prices <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{40.38}\NormalTok{,  }\FloatTok{40.14}\NormalTok{,  }\FloatTok{40.49}\NormalTok{,  }\FloatTok{40.48}\NormalTok{,  }\FloatTok{40.64}\NormalTok{,}
            \FloatTok{46.23}\NormalTok{,  }\FloatTok{46.17}\NormalTok{,  }\FloatTok{45.97}\NormalTok{,  }\FloatTok{45.56}\NormalTok{,  }\FloatTok{45.46}\NormalTok{,}
            \FloatTok{238.58}\NormalTok{, }\FloatTok{239.61}\NormalTok{, }\FloatTok{234.67}\NormalTok{, }\FloatTok{237.25}\NormalTok{, }\FloatTok{238.92}\NormalTok{,}
            \FloatTok{43.43}\NormalTok{,  }\FloatTok{43.96}\NormalTok{,  }\FloatTok{44.26}\NormalTok{,  }\FloatTok{44.5}\NormalTok{,   }\FloatTok{44.86}\NormalTok{)}

\CommentTok{# create tibble/dataframe}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(tickers, dates, prices)}

\CommentTok{# print its first 5 rows}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 3
R>   tickers dates      prices
R>   <chr>   <date>      <dbl>
R> 1 AAP     2010-01-04   40.4
R> 2 AAP     2010-01-05   40.1
R> 3 AAP     2010-01-06   40.5
R> 4 AAP     2010-01-07   40.5
R> 5 AAP     2010-01-08   40.6
R> 6 COG     2010-01-04   46.2
\end{verbatim}

We used the function \texttt{rep} to replicate and facilitate the creation of the raw data for the \texttt{dataframe} object. Notice how all our data is now stored in a single object, facilitating access and organization of the resulting code. The content of \texttt{my\_df} can also be viewed in the RStudio interface. To do so, click on the object name in the \emph{environment} tab, top right of the screen. After that, a viewer will appear on the main screen of the program, as in \ref{fig:example-view}. \index{base!rep}

\begin{figure}[!htbp]

{\centering \includegraphics[width=1\linewidth]{figs/Command_view} 

}

\caption{Example of viewing a dataframe in RStudio}\label{fig:example-view}
\end{figure}

The advantage of using the viewer is that you can explore the data and easily sort the columns by clicking on their names. For those who like to use the prompt, you can open the viewer with function \texttt{View}, as in \texttt{View(my\_df)}. \index{utils!View}

\hypertarget{inspecting-a-dataframe}{%
\subsection{Inspecting a Dataframe}\label{inspecting-a-dataframe}}

Once you have a dataframe in your R session, a \textbf{mandatory} step is to check its contents. With time, this should become a healthy habit in your work. You need to be aware of:

\begin{itemize}
\tightlist
\item
  Properly defined column's names and classes;
\item
  Correct number of rows and columns;
\item
  The existence (or not) of missing data (\texttt{NA}).
\end{itemize}

We often have no control over how we get our data and errors in column names are very common. With that in mind, having meaningful column names that are intuitive, easy to access and without special characters is essential. Therefore, the first step in checking a \texttt{dataframe} is to analyze the names of columns and, if necessary, adjust the code. As a rule, \textbf{never touch the content of raw tables}, always use code to further manipulate the data.

It is also very important to make sure that the classes of columns from the imported \texttt{dataframe} are correctly specified. Otherwise, future column operations may cause an error. For example, if a column of numeric values is imported with the text class (\texttt{character}), any mathematical operation with that column will cause an error. \textbf{Checking column's classes right after importing the data is very important} and will save you a lot of time in the future.

You should also check for the number of \texttt{NA} values in the different columns. Whenever you find a large proportion of \texttt{NA} values in the imported table, you should find out what is going on and if the information is being correctly imported. As mentioned in the previous chapter, \texttt{NA} values are contagious and will turn anything it touches into another \texttt{NA}.

Back to the code, one of the most recommended functions for familiarizing yourself with a \texttt{dataframe} is \texttt{dplyr::glimpse}. It shows the name and class of the columns and the number of rows/columns. We used and abused this function in previous chapters. Here's a simple example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# check content of my_df}
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 3
R> $ tickers <chr> "AAP", "AAP", "AAP", "AAP", "AAP", "COG", ~
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-~
R> $ prices  <dbl> 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, ~
\end{verbatim}

Usually, the use of \texttt{glimpse} is sufficient to check if the data import process has succeeded. However, a deeper analysis can also help to understand how each column varies in the imported data and if that makes sense to our problem. Here comes the role of the \texttt{base::summary} function:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# check variation my_df}
\KeywordTok{summary}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>    tickers              dates                prices      
R>  Length:20          Min.   :2010-01-04   Min.   : 40.14  
R>  Class :character   1st Qu.:2010-01-05   1st Qu.: 42.73  
R>  Mode  :character   Median :2010-01-06   Median : 45.16  
R>                     Mean   :2010-01-06   Mean   : 92.08  
R>                     3rd Qu.:2010-01-07   3rd Qu.: 93.34  
R>                     Max.   :2010-01-08   Max.   :239.61
\end{verbatim}

The objective of \texttt{summary} is to provide a grasp of the content for each column of the \texttt{dataframe}. Notice that \texttt{summary} interprets each column differently. For the first case, column \texttt{ticker}, a \emph{character} vector, it shows only its length. But, for column \texttt{prices}, a \texttt{numeric} vector, it presents its maximum, minimum, median and quartiles. We can use a simple call to \texttt{base::summary} for inspecting the contents of all columns. For example, an extreme observation (\emph{outlier}) could easily be identified by analyzing the output of \texttt{summary}.

\begin{rmdimportant}
Whenever you start to work on a new \texttt{dataframe}, check its
contents with functions \texttt{dplyr::glimpse} and
\texttt{base::summary} and verify possible problems with the importing
process or the content of the file itself. With experience you will
notice that many future errors in code can be remedied by a simple
inspection of the imported tables.
\end{rmdimportant}

\hypertarget{the-pipeline-operator}{%
\subsection{\texorpdfstring{The \emph{pipeline} Operator (\texttt{\%\textgreater{}\%})}{The pipeline Operator (\%\textgreater\%)}}\label{the-pipeline-operator}}

An important feature of the \texttt{tidyverse} universe is the extensive use of the \emph{pipeline} operator, first proposed in package \texttt{magrittr} \citep{R-magrittr} and defined by symbol \texttt{\%\textgreater{}\%}. The \emph{pipeline} operator allows data operations to be performed sequentially and in a modular fashion, increasing readability and maintainability of the resulting code.

Imagine a situation where we have three functions to be applied to a \texttt{dataframe}. Each function depends on the output of another function. This requires chaining your calls, so one output feeds an object to the next call. Using the \emph{pipeline} operator, we can write the \texttt{dataframe} manipulation procedure with the following code: \index{dplyr!\%>\%}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_tab <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fct1}\NormalTok{(arg1) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fct2}\NormalTok{(arg2) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fct3}\NormalTok{(arg3)}
\end{Highlighting}
\end{Shaded}

We use symbol \texttt{\%\textgreater{}\%} at the end of each line to ``glue'' the operations. The \texttt{fct*} functions are operations performed at each step. The \texttt{arg*} objects are just arguments (options) for each function call. The result of each code line is passed to the next function sequentially. Thus, there is no need to create intermediate objects. To compare, here are two ways to perform the same operation \textbf{without} the \emph{pipeline} operator:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# version 1}
\NormalTok{my_tab <-}\StringTok{ }\KeywordTok{fct3}\NormalTok{(}\KeywordTok{fct2}\NormalTok{(}\KeywordTok{fct1}\NormalTok{(my_df,}
\NormalTok{                         arg1),}
\NormalTok{                    arg2),}
\NormalTok{               arg1)}

\CommentTok{# version 2}
\NormalTok{temp1 <-}\StringTok{ }\KeywordTok{fct1}\NormalTok{(my_df, arg1)}
\NormalTok{temp2 <-}\StringTok{ }\KeywordTok{fct2}\NormalTok{(temp1, arg2)}

\NormalTok{my_tab <-}\StringTok{ }\KeywordTok{fct3}\NormalTok{(temp1, arg3)}
\end{Highlighting}
\end{Shaded}

Notice how the alternatives result in a messy code structure. Version one is the ugliest. You need to pay good attention to understand the code. You probably haven't noticed, but both codes have typos and would cause a bug. For the first, the last \texttt{arg1} argument should be \texttt{arg3} and, in the second, the \texttt{fct3} function is using the \texttt{temp1} dataframe and not \texttt{temp2}. This example shows how using \emph{pipelines} makes the code more elegant and readable. From now on we will use the pipeline operator extensively.

\hypertarget{accessing-columns}{%
\subsection{Accessing Columns}\label{accessing-columns}}

To discover the names of the columns of a \texttt{dataframe}, we have two functions, \texttt{names} and \texttt{colnames}, with the exact same behavior: \index{base!names} \index{base!colnames}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get names of columns with names}
\KeywordTok{names}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "tickers" "dates"   "prices"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{colnames}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "tickers" "dates"   "prices"
\end{verbatim}

Both can also modify column names:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set temp df}
\NormalTok{temp_df <-}\StringTok{ }\NormalTok{my_df}

\CommentTok{# change names}
\KeywordTok{names}\NormalTok{(temp_df) <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{'Col'}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(temp_df))}

\CommentTok{# check names}
\KeywordTok{names}\NormalTok{(temp_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Col1" "Col2" "Col3"
\end{verbatim}

In this example, the way we use \texttt{names} differs greatly from other R functions. Here, we use the function on the left side of the \texttt{assign} symbol (\texttt{\textless{}-}). Internally, we are defining an attribute of the \texttt{temp\_df} object, the name of its columns.

To access a particular column of a \texttt{dataframe} as a vector, we can use operator \texttt{\$} or the name/position of the column with double brackets:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# isolate columns of df}
\NormalTok{my_tickers <-}\StringTok{ }\NormalTok{my_df}\OperatorTok{$}\NormalTok{tickers}
\NormalTok{my_prices <-}\StringTok{ }\NormalTok{my_df}\OperatorTok{$}\NormalTok{prices}

\CommentTok{# print the results}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_tickers))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "AAP" "AAP" "AAP" "AAP" "AAP" "COG"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_prices))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 40.38 40.14 40.49 40.48 40.64 46.23
\end{verbatim}

It's worth knowing that, internally, dataframes are stored as \texttt{lists}, where each element is a column. This is important because some properties of \texttt{lists} also work for \texttt{dataframes}. One example is using a double bracket (\texttt{{[}{[}\ {]}{]}}) for selecting columns:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# select column in dataframe with list notation}
\KeywordTok{print}\NormalTok{(my_df[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2010-01-04" "2010-01-05" "2010-01-06" "2010-01-07"
R>  [5] "2010-01-08" "2010-01-04" "2010-01-05" "2010-01-06"
R>  [9] "2010-01-07" "2010-01-08" "2010-01-04" "2010-01-05"
R> [13] "2010-01-06" "2010-01-07" "2010-01-08" "2010-01-04"
R> [17] "2010-01-05" "2010-01-06" "2010-01-07" "2010-01-08"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(my_df[[}\StringTok{'tickers'}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "AAP" "AAP" "AAP" "AAP" "AAP" "COG" "COG" "COG" "COG"
R> [10] "COG" "BLK" "BLK" "BLK" "BLK" "BLK" "CAM" "CAM" "CAM"
R> [19] "CAM" "CAM"
\end{verbatim}

To access specific rows and columns of a \texttt{dataframe}, use single brackets with atomic vectors that indicate positions:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# accessing rows 1:5, column 2}
\KeywordTok{print}\NormalTok{(my_df[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 1
R>   dates     
R>   <date>    
R> 1 2010-01-04
R> 2 2010-01-05
R> 3 2010-01-06
R> 4 2010-01-07
R> 5 2010-01-08
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# accessing rows 1:5, columns 1 and 2}
\KeywordTok{print}\NormalTok{(my_df[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>   tickers dates     
R>   <chr>   <date>    
R> 1 AAP     2010-01-04
R> 2 AAP     2010-01-05
R> 3 AAP     2010-01-06
R> 4 AAP     2010-01-07
R> 5 AAP     2010-01-08
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# accessing rows 1:5, all columns}
\KeywordTok{print}\NormalTok{(my_df[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 3
R>   tickers dates      prices
R>   <chr>   <date>      <dbl>
R> 1 AAP     2010-01-04   40.4
R> 2 AAP     2010-01-05   40.1
R> 3 AAP     2010-01-06   40.5
R> 4 AAP     2010-01-07   40.5
R> 5 AAP     2010-01-08   40.6
\end{verbatim}

Column selection can also be performed using names, as in the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# selecting rows 1 to 3, columns 'ticker' and 'prices'}
\KeywordTok{print}\NormalTok{(my_df[}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\StringTok{'tickers'}\NormalTok{, }\StringTok{'prices'}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 2
R>   tickers prices
R>   <chr>    <dbl>
R> 1 AAP       40.4
R> 2 AAP       40.1
R> 3 AAP       40.5
\end{verbatim}

Or, using the pipeline operator and function \texttt{dplyr::slice} and \texttt{dplyr::select}: \index{dplyr!select}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my.temp <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(tickers, prices) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 3
R> Columns: 2
R> $ tickers <chr> "AAP", "AAP", "AAP"
R> $ prices  <dbl> 40.38, 40.14, 40.49
\end{verbatim}

\hypertarget{modifying-a-dataframe}{%
\subsection{\texorpdfstring{Modifying a \texttt{dataframe}}{Modifying a dataframe}}\label{modifying-a-dataframe}}

To create new columns in a dataframe, simply use function \texttt{dplyr::mutate} and the \emph{pipeline} operator. \index{adding column to dataframe} \index{dplyr!mutate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add columns with mutate}
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ret =}\NormalTok{ prices}\OperatorTok{/}\KeywordTok{lag}\NormalTok{(prices) }\DecValTok{-1}\NormalTok{,}
         \DataTypeTok{seq_1 =} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(my_df),}
         \DataTypeTok{seq_2 =}\NormalTok{  seq_}\DecValTok{1} \OperatorTok{+}\DecValTok{9}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 6
R> $ tickers <chr> "AAP", "AAP", "AAP", "AAP", "AAP", "COG", ~
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-~
R> $ prices  <dbl> 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, ~
R> $ ret     <dbl> NA, -0.0059435364, 0.0087194818, -0.000246~
R> $ seq_1   <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~
R> $ seq_2   <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20~
\end{verbatim}

All new columns are defined as arguments in \texttt{dplyr::mutate}. Also note we use the \texttt{price} column to construct \texttt{ret}, the daily return of prices. A special case here is the creation of column \texttt{seq\_2} based on \texttt{seq\_1}, that is, even before it is explicitly calculated, it is possible to use the new column to create another one.

Another, more traditional way of creating new columns is using operator \texttt{\$}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add new column with base R}
\NormalTok{my_df}\OperatorTok{$}\NormalTok{seq_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(my_df)}

\CommentTok{# check it}
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 7
R> $ tickers <chr> "AAP", "AAP", "AAP", "AAP", "AAP", "COG", ~
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-~
R> $ prices  <dbl> 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, ~
R> $ ret     <dbl> NA, -0.0059435364, 0.0087194818, -0.000246~
R> $ seq_1   <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~
R> $ seq_2   <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20~
R> $ seq_3   <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~
\end{verbatim}

Therefore, you can use \texttt{\$} to either access or modify a dataframe.

Going further, if we try to create a column with the number of elements different than the number of rows of the target \texttt{dataframe}, an error will appear.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{seq_3 =}  \DecValTok{1}\OperatorTok{:}\DecValTok{100}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error: Column `seq_3` must be length 20 (the number of rows) ...
\end{verbatim}

However, due to the simplified recycling rule, we can use single values to fill up a whole column:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{seq_3 =}  \DecValTok{1}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 7
R> $ tickers <chr> "AAP", "AAP", "AAP", "AAP", "AAP", "COG", ~
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-~
R> $ prices  <dbl> 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, ~
R> $ ret     <dbl> NA, -0.0059435364, 0.0087194818, -0.000246~
R> $ seq_1   <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~
R> $ seq_2   <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20~
R> $ seq_3   <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~
\end{verbatim}

To remove columns from a \texttt{dataframe}, use function \texttt{dplyr::select} with the minus symbol for the undesired columns:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# removing columns}
\NormalTok{my_df.temp <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{seq_}\DecValTok{1}\NormalTok{, }\OperatorTok{-}\NormalTok{seq_}\DecValTok{2}\NormalTok{, }\OperatorTok{-}\NormalTok{seq_}\DecValTok{3}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 4
R> $ tickers <chr> "AAP", "AAP", "AAP", "AAP", "AAP", "COG", ~
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-~
R> $ prices  <dbl> 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, ~
R> $ ret     <dbl> NA, -0.0059435364, 0.0087194818, -0.000246~
\end{verbatim}

Using base R, the traditional way of removing columns is to allocate a single value \texttt{NULL} to its contents:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set temp df}
\NormalTok{temp_df <-}\StringTok{ }\NormalTok{my_df}

\CommentTok{# remove cols}
\NormalTok{temp_df}\OperatorTok{$}\NormalTok{prices <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{temp_df}\OperatorTok{$}\NormalTok{dates  <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{temp_df}\OperatorTok{$}\NormalTok{ret  <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{temp_df}\OperatorTok{$}\NormalTok{tickers  <-}\StringTok{ }\OtherTok{NULL}

\CommentTok{# check it}
\KeywordTok{glimpse}\NormalTok{(temp_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 20
R> Columns: 3
R> $ seq_1 <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1~
R> $ seq_2 <dbl> 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ~
R> $ seq_3 <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,~
\end{verbatim}

\hypertarget{filtering-rows-of-a-dataframe}{%
\subsection{\texorpdfstring{Filtering rows of a \texttt{dataframe}}{Filtering rows of a dataframe}}\label{filtering-rows-of-a-dataframe}}

A fairly common \texttt{dataframe} operation in R is to filter rows according to one or more conditions. For example, if we only wanted data from the \texttt{\textquotesingle{}COG\textquotesingle{}} stock, we could use the \texttt{filter} function to filter the table: \index{dplyr!filter}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# filter df for single stock}
\NormalTok{my_df.temp <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(tickers }\OperatorTok{==}\StringTok{ 'COG'}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 5
R> Columns: 7
R> $ tickers <chr> "COG", "COG", "COG", "COG", "COG"
R> $ dates   <date> 2010-01-04, 2010-01-05, 2010-01-06, 2010-0~
R> $ prices  <dbl> 46.23, 46.17, 45.97, 45.56, 45.46
R> $ ret     <dbl> 0.137549213, -0.001297859, -0.004331817, ~
R> $ seq_1   <int> 6, 7, 8, 9, 10
R> $ seq_2   <dbl> 15, 16, 17, 18, 19
R> $ seq_3   <dbl> 1, 1, 1, 1, 1
\end{verbatim}

We can go further and also filter data for \texttt{\textquotesingle{}COG\textquotesingle{}} and dates after \texttt{\textquotesingle{}2010-01-05\textquotesingle{}}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# filter df for single stock and date}
\NormalTok{my_df.temp <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(tickers }\OperatorTok{==}\StringTok{ 'COG'}\NormalTok{,}
\NormalTok{         dates }\OperatorTok{>}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\StringTok{'2010-01-05'}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 3
R> Columns: 7
R> $ tickers <chr> "COG", "COG", "COG"
R> $ dates   <date> 2010-01-06, 2010-01-07, 2010-01-08
R> $ prices  <dbl> 45.97, 45.56, 45.46
R> $ ret     <dbl> -0.004331817, -0.008918860, -0.002194908
R> $ seq_1   <int> 8, 9, 10
R> $ seq_2   <dbl> 17, 18, 19
R> $ seq_3   <dbl> 1, 1, 1
\end{verbatim}

Here we used symbol \texttt{==} to test for equality in column \texttt{ticker} and \emph{greater than} (\textgreater) for selecting the rows where the dates are after 2010-01-05. There are plenty more operators for all kinds of logical conditions. We will study these in chapter \ref{basic-classes}.

\hypertarget{sorting-a-dataframe}{%
\subsection{\texorpdfstring{Sorting a \texttt{dataframe}}{Sorting a dataframe}}\label{sorting-a-dataframe}}

After creating or importing a \texttt{dataframe}, we can sort its rows according to the values of any column. A common case where a sort operation is needed is when financial or economic data is imported, but the dates are not ascending. Depending on the situation, it may be easier -- or expected -- to deal with data where the dates are always increasing along the rows, from top to bottom. The sorting operation in \texttt{dataframes} is performed using function \texttt{dplyr::arrange} or \texttt{base::order}. \index{base!order} \index{ordering dataframe}

As an example, consider creating a \texttt{dataframe} with these values:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set new df}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }
                \DataTypeTok{col2 =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{), }
                \DataTypeTok{col3 =} \KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{,}\StringTok{'b'}\NormalTok{,}\StringTok{'c'}\NormalTok{))}

\CommentTok{# print it                  }
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     4     1 a    
R> 2     1     1 b    
R> 3     2     3 c
\end{verbatim}

We use function \texttt{dplyr::arrange} and the \emph{pipeline} operator to order the whole \texttt{dataframe} by the ascending values of column \texttt{col1}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sort ascending, by col1 }
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(col1) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     2     3 c    
R> 3     4     1 a
\end{verbatim}

We can also sort by descending values using \texttt{desc}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sort descending, col1 and col2}
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(col1)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     4     1 a    
R> 2     2     3 c    
R> 3     1     1 b
\end{verbatim}

And, for multiple columns, using extra arguments in \texttt{arrange}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sort ascending, by col2 and col1}
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(col2, col1) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     4     1 a    
R> 3     2     3 c
\end{verbatim}

As for base R, function \texttt{order} returns the position of the elements for the sorted vector. With the first column of \texttt{my\_df}, the positions of the elements in ascending order are:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set index with positions of ascending order in col1}
\NormalTok{idx <-}\StringTok{ }\KeywordTok{order}\NormalTok{(my_df}\OperatorTok{$}\NormalTok{col1)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(idx)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 3 2
\end{verbatim}

Therefore, when using the output of function \texttt{order} as an index of an existing \texttt{dataframe}, you get a new version of the \texttt{dataframe}, where all rows are set according to the ascending values of a particular column. See an example next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# order my_df by col1}
\NormalTok{my_df}\FloatTok{.2}\NormalTok{ <-}\StringTok{ }\NormalTok{my_df[}\KeywordTok{order}\NormalTok{(my_df}\OperatorTok{$}\NormalTok{col1), ]}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     2     3 c    
R> 3     4     1 a
\end{verbatim}

This operation may also be performed considering more than one column. See the following example, where we sort the rows of \texttt{my\_df} using columns \texttt{col2} and \texttt{col1}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sort df with col2 and col1}
\NormalTok{my_df}\FloatTok{.3}\NormalTok{ <-}\StringTok{ }\NormalTok{my_df[}\KeywordTok{order}\NormalTok{(my_df}\OperatorTok{$}\NormalTok{col2, my_df}\OperatorTok{$}\NormalTok{col1), ]}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 3 x 3
R>    col1  col2 col3 
R>   <dbl> <dbl> <chr>
R> 1     1     1 b    
R> 2     4     1 a    
R> 3     2     3 c
\end{verbatim}

\hypertarget{combining-and-aggregating-dataframes}{%
\subsection{\texorpdfstring{Combining and Aggregating \texttt{dataframes}}{Combining and Aggregating dataframes}}\label{combining-and-aggregating-dataframes}}

In the practice of manipulating data, often you must aggregate multiple \texttt{dataframes} into a single one. This usually happens when the heterogeneous data is imported from different sources and we must bind them into a single table. In the simplest case of combining \texttt{dataframes}, we join them according to the rows (vertically) or columns (horizontally). For that, we have functions \texttt{dplyr::bind\_rows} (alternative to \texttt{base::rbind}) and \texttt{dplyr::bind\_cols} (alternative to \texttt{base::cbind}). Examples of usage are given next. \index{dplyr!bind\_rows} \index{dplyr!bind\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set two dfs with same colnames}
\NormalTok{my_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }
                  \DataTypeTok{col2 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\NormalTok{my_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{6}\OperatorTok{:}\DecValTok{10}\NormalTok{, }
                  \DataTypeTok{col2 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'b'}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\CommentTok{# bind them by rows}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{bind_rows}\NormalTok{(my_df_}\DecValTok{1}\NormalTok{, my_df_}\DecValTok{2}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 10 x 2
R>     col1 col2 
R>    <int> <chr>
R>  1     1 a    
R>  2     2 a    
R>  3     3 a    
R>  4     4 a    
R>  5     5 a    
R>  6     6 b    
R>  7     7 b    
R>  8     8 b    
R>  9     9 b    
R> 10    10 b
\end{verbatim}

Notice that, in the previous example, the names of columns are the same between \texttt{my\_df\_1} and \texttt{my\_df\_2}. Function \texttt{dplyr::bind\_rows} is very clever and will search for shared names and correctly bind the data, even if the column positions are different. If we swapped the positions of the columns, there would be no change in the result of the bind operation.

Another interesting aspect of \texttt{dplyr::bind\_rows} is that, if the names of the columns don't match, the unmatched columns will return a \texttt{NA} result (not available). This means we can bind tables with different column names:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set two df with different colnames}
\NormalTok{my_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }
                  \DataTypeTok{col2 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\NormalTok{my_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{6}\OperatorTok{:}\DecValTok{10}\NormalTok{, }
                  \DataTypeTok{col3 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'b'}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\CommentTok{# bind them by rows (NA values for missing cols)}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{bind_rows}\NormalTok{(my_df_}\DecValTok{1}\NormalTok{, }
\NormalTok{                   my_df_}\DecValTok{2}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 10 x 3
R>     col1 col2  col3 
R>    <int> <chr> <chr>
R>  1     1 a     <NA> 
R>  2     2 a     <NA> 
R>  3     3 a     <NA> 
R>  4     4 a     <NA> 
R>  5     5 a     <NA> 
R>  6     6 <NA>  b    
R>  7     7 <NA>  b    
R>  8     8 <NA>  b    
R>  9     9 <NA>  b    
R> 10    10 <NA>  b
\end{verbatim}

For the case of column bind with function \texttt{dplyr::bind\_cols}, the names of the columns must be different, but the number of rows must be the same: \index{dplyr!bind\_cols}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set two dfs}
\NormalTok{my_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }
                  \DataTypeTok{col2 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\NormalTok{my_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col3 =} \DecValTok{6}\OperatorTok{:}\DecValTok{10}\NormalTok{, }
                  \DataTypeTok{col4 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'b'}\NormalTok{, }\DecValTok{5}\NormalTok{))}

\CommentTok{# column bind dfs}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(my_df_}\DecValTok{1}\NormalTok{, my_df_}\DecValTok{2}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>   col1 col2 col3 col4
R> 1    1    a    6    b
R> 2    2    a    7    b
R> 3    3    a    8    b
R> 4    4    a    9    b
R> 5    5    a   10    b
\end{verbatim}

Sometimes, aggregating different tables won't be as easy as simply row or column binding. For example, imagine you have data for annual unemployment rates in one \texttt{dataframe} and data for monthly inflation in another. There, you can't just bind their columns as their frequency and number of rows are different. The solution is to use an index (or table key) -- a vector of dates -- that relates both tables.

For that, you can use functions \texttt{dplyr::join*} to merge two dataframes using one or more indexes. This includes \texttt{dplyr::inner\_join}, \texttt{dplyr::left\_join}, \texttt{dplyr::full\_join}, and many others. The main difference between them is how you treat the row cases without a match. For example, \texttt{dplyr::inner\_join} keeps only the data where it finds a matching index, while \texttt{dplyr::full\_join} keep everything from both tables and fills the missing information with \texttt{NA} values. Let's have a closer look by using a practical example of both.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set df}
\NormalTok{my_df_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2016-01-01'}\NormalTok{)}\OperatorTok{+}\DecValTok{0}\OperatorTok{:}\DecValTok{10}\NormalTok{,}
                  \DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{11}\NormalTok{)}

\NormalTok{my_df_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2016-01-05'}\NormalTok{)}\OperatorTok{+}\DecValTok{0}\OperatorTok{:}\DecValTok{10}\NormalTok{,}
                  \DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{11}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Please do notice that both dataframes share a column called \texttt{date}, which will be automatically used as a matching index.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# aggregate tables}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{inner_join}\NormalTok{(my_df_}\DecValTok{1}\NormalTok{, }
\NormalTok{                    my_df_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Joining, by = "date"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 7
R> Columns: 3
R> $ date <date> 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-~
R> $ x    <int> 5, 6, 7, 8, 9, 10, 11
R> $ y    <dbl> 20, 21, 22, 23, 24, 25, 26
\end{verbatim}

Now with \texttt{dplyr::full\_join}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# aggregate tables}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{full_join}\NormalTok{(my_df_}\DecValTok{1}\NormalTok{, }
\NormalTok{                   my_df_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Joining, by = "date"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 15
R> Columns: 3
R> $ date <date> 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-~
R> $ x    <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, NA, NA, NA~
R> $ y    <dbl> NA, NA, NA, NA, 20, 21, 22, 23, 24, 25, 26, 2~
\end{verbatim}

Notice the difference in the number of rows from one to the other. When using \texttt{dplyr::full\_join}, all unmatched cases are set to \texttt{NA}.

If we had \texttt{dataframes} with different column names, we can also set the index explicitly with argument \texttt{by} of \texttt{dplyr::*\_join}. See the next example, where we set different column names and still match the data using a vector of dates:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set df}
\NormalTok{my_df_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{ref_date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2016-01-01'}\NormalTok{)}\OperatorTok{+}\DecValTok{0}\OperatorTok{:}\DecValTok{10}\NormalTok{,}
                  \DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{11}\NormalTok{)}

\NormalTok{my_df_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{my_date =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2016-01-05'}\NormalTok{)}\OperatorTok{+}\DecValTok{0}\OperatorTok{:}\DecValTok{10}\NormalTok{,}
                  \DataTypeTok{y =} \KeywordTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{30}\NormalTok{, }\DataTypeTok{length.out =} \DecValTok{11}\NormalTok{))}

\CommentTok{# join by my_df.3$ref.date and my_df.4$my.date}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{inner_join}\NormalTok{(my_df_}\DecValTok{3}\NormalTok{, my_df_}\DecValTok{4}\NormalTok{,}
                    \DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{'ref_date'}\NormalTok{ =}\StringTok{ 'my_date'}\NormalTok{))}

\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 7
R> Columns: 3
R> $ ref_date <date> 2016-01-05, 2016-01-06, 2016-01-07, 2016~
R> $ x        <int> 5, 6, 7, 8, 9, 10, 11
R> $ y        <dbl> 20, 21, 22, 23, 24, 25, 26
\end{verbatim}

Whenever you need to combine tables that share information, use one of the \texttt{dplyr::*\_join} functions. The decision of how to treat the unmatched cases will depend on the problem you're analyzing.

\hypertarget{extensions-of-the-dataframe-class}{%
\subsection{\texorpdfstring{Extensions of the \texttt{dataframe} Class}{Extensions of the dataframe Class}}\label{extensions-of-the-dataframe-class}}

As mentioned in the previous chapter, one benefit of using R is the existence of a range of packages designed to deal with specific problems. This is also true for extensions of the basic data structure. While the \texttt{tibble} class is a good solution for most cases, sometimes, it can make more sense to store the data in a specific type of custom object. Over time, several solutions have been developed.

For example, it is common in economic and financial research to work with numeric data indexed by time. We can store this data in a matrix format, so each line represents dates and each column represents a variable. With this structure, time operations, such as period aggregations, are easier to perform. This is the main idea of package \texttt{xts} \citep{R-xts}. The great benefit of this alternative \texttt{dataframe} is that several functions for time aggregation and manipulation are available. We can turn a whole set of daily data for several variables to the weekly frequency in one line of code. In addition, various other functions automatically recognize the time index and adapt accordingly. One example is the creation of a figure with the values of a variable over time. The horizontal axes of the figure are automatically arranged as dates. \index{xts}

See the following example, where we represent the previous stock data as an \texttt{xts} object: \index{xts!xts}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load pkg}
\KeywordTok{library}\NormalTok{(xts)}

\CommentTok{# set ticker symbols as a vector}
\NormalTok{tickers <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'AAP'}\NormalTok{, }\StringTok{'COG'}\NormalTok{, }\StringTok{'BLK'}\NormalTok{, }\StringTok{'CAM'}\NormalTok{)}

\CommentTok{# set a date vector}
\NormalTok{dates <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"2010-01-04"}\NormalTok{, }\StringTok{"2010-01-05"}\NormalTok{, }\StringTok{"2010-01-06"}\NormalTok{, }
                   \StringTok{"2010-01-07"}\NormalTok{, }\StringTok{"2010-01-08"}\NormalTok{))}

\CommentTok{# set prices as  matrix                   }
\NormalTok{price_matrix <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\FloatTok{40.38}\NormalTok{,  }\FloatTok{40.13}\NormalTok{,  }\FloatTok{40.49}\NormalTok{,  }\FloatTok{40.48}\NormalTok{,  }\FloatTok{40.63}\NormalTok{,}
                         \FloatTok{46.23}\NormalTok{,  }\FloatTok{46.16}\NormalTok{,  }\FloatTok{45.97}\NormalTok{,  }\FloatTok{45.56}\NormalTok{,  }\FloatTok{45.45}\NormalTok{,}
                         \FloatTok{238.58}\NormalTok{, }\FloatTok{239.61}\NormalTok{, }\FloatTok{234.66}\NormalTok{, }\FloatTok{237.25}\NormalTok{, }\FloatTok{238.91}\NormalTok{,}
                         \FloatTok{43.43}\NormalTok{,  }\FloatTok{43.95}\NormalTok{,  }\FloatTok{44.25}\NormalTok{,  }\FloatTok{44.5}\NormalTok{,   }\FloatTok{44.86}\NormalTok{),}
                       \DataTypeTok{nrow =} \KeywordTok{length}\NormalTok{(dates))}

\CommentTok{# set xts object}
\NormalTok{my_xts <-}\StringTok{ }\KeywordTok{xts}\NormalTok{(price_matrix, }\DataTypeTok{order.by =}\NormalTok{ dates)}

\CommentTok{# set colnames}
\KeywordTok{colnames}\NormalTok{(my_xts) <-}\StringTok{ }\NormalTok{tickers}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_xts)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>              AAP   COG    BLK   CAM
R> 2010-01-04 40.38 46.23 238.58 43.43
R> 2010-01-05 40.13 46.16 239.61 43.95
R> 2010-01-06 40.49 45.97 234.66 44.25
R> 2010-01-07 40.48 45.56 237.25 44.50
R> 2010-01-08 40.63 45.45 238.91 44.86
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# show its class}
\KeywordTok{class}\NormalTok{(my_xts)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "xts" "zoo"
\end{verbatim}

In creating the \texttt{xts} object, notice how the time index is explicitly defined using argument \texttt{order.by}. This is a necessary step in creating every \texttt{xts} object.

The previous code can give the impression that the object \texttt{my\_xts} is similar to a native \texttt{dataframe}. However, make no mistake. By having an explicit time index, object \texttt{my\_xts} can be used for several privileged procedures. See the following example, where we create a new \texttt{xts} object with two columns and calculate the average of each column on a weekly basis.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set number of time periods}
\NormalTok{N <-}\StringTok{ }\DecValTok{500}

\CommentTok{# create matrix with data}
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, N), }\KeywordTok{seq}\NormalTok{(N, }\DecValTok{1}\NormalTok{)), }\DataTypeTok{nrow=}\NormalTok{N)}

\CommentTok{# set xts object}
\NormalTok{my_xts <-}\StringTok{ }\KeywordTok{xts}\NormalTok{(my_mat, }\DataTypeTok{order.by =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2018-01-01'}\NormalTok{)}\OperatorTok{+}\DecValTok{1}\OperatorTok{:}\NormalTok{N)}

\CommentTok{# apply mean function for each weel}
\NormalTok{my_xts_weekly_mean <-}\StringTok{ }\KeywordTok{apply.weekly}\NormalTok{(my_xts, mean)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_xts_weekly_mean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>             X.1   X.2
R> 2018-01-07  3.5 497.5
R> 2018-01-14 10.0 491.0
R> 2018-01-21 17.0 484.0
R> 2018-01-28 24.0 477.0
R> 2018-02-04 31.0 470.0
R> 2018-02-11 38.0 463.0
\end{verbatim}

In finance and economics, these time aggregations with \texttt{xts} objects are useful when working with data at different time frequencies. It is common to aggregate transaction data in the financial market for high-frequency intervals of 5 by 5 minutes. Such a procedure is easily accomplished in R through the correct representation of the data as \texttt{xts} objects. There are several other features in this package. Users that work frequently with time-indexed data are encouraged to read the \href{https://cran.r-project.org/web/packages/xts/xts.pdf}{manual}\footnote{\url{https://cran.r-project.org/web/packages/xts/xts.pdf}} and learn more about it.

Package \texttt{xts} is not alone as an alternative to \texttt{dataframes}. For example, the data structure proposed by package \texttt{data.table} \citep{R-data.table} prioritizes processing time and uses a compact notation. If you like short notations for writing code and need a quick execution time, \texttt{data.table} is an impressive and powerful package. As another example, package \texttt{tibbletime} \citep{R-tibbletime} is, well, a time-oriented version of \texttt{tibble}, bringing together the benefits of \texttt{tidyverse} and \texttt{xts}. \index{data.table} \index{tibbletime}

\hypertarget{other-useful-functions-for-handling-dataframes}{%
\subsection{\texorpdfstring{Other Useful Functions for Handling \texttt{dataframes}}{Other Useful Functions for Handling dataframes}}\label{other-useful-functions-for-handling-dataframes}}

\textbf{head} Returns the first \texttt{n} rows of a \texttt{dataframe}. This function is mostly used for showing only a small part of a \texttt{dataframe} in the prompt. \index{base!head}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set df}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{5000}\NormalTok{, }
                \DataTypeTok{col2 =} \KeywordTok{rep}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\DecValTok{5000}\NormalTok{))}

\CommentTok{# print its first 5 rows}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_df, }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    col1 col2 
R>   <int> <chr>
R> 1     1 a    
R> 2     2 a    
R> 3     3 a    
R> 4     4 a    
R> 5     5 a
\end{verbatim}

\textbf{tail} - Returns the last \texttt{n} rows of a \texttt{dataframe}. Also used to glimpse the last rows of a \texttt{dataframe}. \index{base!tail}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print its last 5 rows}
\KeywordTok{print}\NormalTok{(}\KeywordTok{tail}\NormalTok{(my_df, }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>    col1 col2 
R>   <int> <chr>
R> 1  4996 a    
R> 2  4997 a    
R> 3  4998 a    
R> 4  4999 a    
R> 5  5000 a
\end{verbatim}

\textbf{complete.cases} - Returns a logical vector with the same length as the number of rows of the \texttt{dataframe}, containing \texttt{TRUE} when all columns have non \texttt{NA} values and \texttt{FALSE} otherwise. \index{base!complete.cases}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create df}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{10}\NormalTok{),}
                \DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{5}\OperatorTok{:}\DecValTok{10}\NormalTok{, }\OtherTok{NA}\NormalTok{))}

\CommentTok{# show df}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 7 x 2
R>       x     y
R>   <dbl> <int>
R> 1     1     5
R> 2     2     6
R> 3     3     7
R> 4     4     8
R> 5     5     9
R> 6    NA    10
R> 7    10    NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print logical test of complete.cases}
\KeywordTok{print}\NormalTok{(}\KeywordTok{complete.cases}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print all rows where there is at least one NA}
\KeywordTok{print}\NormalTok{(}\KeywordTok{which}\NormalTok{(}\OperatorTok{!}\KeywordTok{complete.cases}\NormalTok{(my_df)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6 7
\end{verbatim}

\textbf{na.omit} - Returns a \texttt{dataframe} without the rows where a \texttt{NA} in any column is found. \index{base!na.omit}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{na.omit}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 5 x 2
R>       x     y
R>   <dbl> <int>
R> 1     1     5
R> 2     2     6
R> 3     3     7
R> 4     4     8
R> 5     5     9
\end{verbatim}

\textbf{unique} - Returns a \texttt{dataframe} where all duplicated rows are removed and only the unique cases, row-wise, are kept. \index{base!unique}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set df with repeating rows}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{col1 =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{), }
                    \DataTypeTok{col2 =} \KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{, }\StringTok{'A'}\NormalTok{, }\StringTok{'A'}\NormalTok{, }\StringTok{'C'}\NormalTok{, }\StringTok{'C'}\NormalTok{, }\StringTok{'B'}\NormalTok{, }\StringTok{'D'}\NormalTok{))}

\CommentTok{# print it                  }
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>   col1 col2
R> 1    1    A
R> 2    1    A
R> 3    2    A
R> 4    3    C
R> 5    3    C
R> 6    4    B
R> 7    5    D
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print unique df}
\KeywordTok{print}\NormalTok{(}\KeywordTok{unique}\NormalTok{(my_df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>   col1 col2
R> 1    1    A
R> 3    2    A
R> 4    3    C
R> 6    4    B
R> 7    5    D
\end{verbatim}

\hypertarget{lists}{%
\section{\texorpdfstring{\texttt{Lists}}{Lists}}\label{lists}}

A \texttt{list} is a flexible container that can hold many elements. Unlike atomic vectors, a \texttt{list} has no restriction on the classes or types of elements -- we can group \texttt{numeric} objects with \texttt{character} objects, \texttt{factor} with \texttt{Dates} and even \texttt{lists} within \texttt{lists}. Likewise, each element of a list need not have the same length as the others. We can also name each element within a \texttt{list}. These properties make the \texttt{list} class the most flexible object in R. It is not by accident that several functions in R return an object of type \texttt{list}. \index{list}

\hypertarget{creating-lists}{%
\subsection{\texorpdfstring{Creating \texttt{lists}}{Creating lists}}\label{creating-lists}}

A \texttt{list} can be created with the \texttt{base::list} command, followed by their comma-separated elements: \index{base!list}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
             \KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{),}
             \KeywordTok{factor}\NormalTok{(}\StringTok{'A'}\NormalTok{, }\StringTok{'B'}\NormalTok{, }\StringTok{'C'}\NormalTok{),}
             \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{col1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{))}

\CommentTok{# use base::print}
\KeywordTok{print}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] 1 2 3
R> 
R> [[2]]
R> [1] "a" "b"
R> 
R> [[3]]
R> [1] <NA>
R> Levels: C
R> 
R> [[4]]
R>   col1
R> 1    1
R> 2    2
R> 3    3
R> 4    4
R> 5    5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# use dplyr::glimpse}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 4
R>  $ : num [1:3] 1 2 3
R>  $ : chr [1:2] "a" "b"
R>  $ : Factor w/ 1 level "C": NA
R>  $ :'data.frame':    5 obs. of  1 variable:
R>   ..$ col1: int [1:5] 1 2 3 4 5
\end{verbatim}

Notice how we gather four objects: a numeric vector, a character vector, a factor and a dataframe/tibble into a single \texttt{list}. Also, notice that a \texttt{list} type object is printed differently than atomic vectors. The elements of the \texttt{list} are separated vertically and the content appears within double brackets (\texttt{{[}{[}\ {]}{]}}). We will soon learn that we can access its elements in the same way, by using double brackets.

Following other objects, the elements of a \texttt{list} can also be named, making it easier to work with heterogenous data. For example, let's consider a set of data with information about a particular company traded in the NYSE market:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set named list}
\NormalTok{my_named_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{tickers =} \StringTok{'CMPY'}\NormalTok{,}
                   \DataTypeTok{markets =} \StringTok{'NYSE'}\NormalTok{,}
                   \DataTypeTok{df_prices =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{P =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{1.5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\FloatTok{2.3}\NormalTok{),}
                                          \DataTypeTok{ref_date =} \KeywordTok{Sys.Date}\NormalTok{()}\OperatorTok{+}\DecValTok{0}\OperatorTok{:}\DecValTok{3}\NormalTok{))}

\CommentTok{# check content}
\KeywordTok{glimpse}\NormalTok{(my_named_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ tickers  : chr "CMPY"
R>  $ markets  : chr "NYSE"
R>  $ df_prices:'data.frame':   4 obs. of  2 variables:
R>   ..$ P       : num [1:4] 1 1.5 2 2.3
R>   ..$ ref_date: Date[1:4], format: "2021-03-30" ...
\end{verbatim}

The data is organized in a single object, facilitating the import/export of the data and the analysis.

\begin{rmdimportant}
Every time you work with lists, make your life easier by naming all
elements intuitively. Avoid the use of the position of the element in a
list, which can change when lists expand of contract. Using names
facilitates access and avoids possible errors in the code.
\end{rmdimportant}

\hypertarget{accessing-the-elements-of-a-list}{%
\subsection{\texorpdfstring{Accessing the Elements of a \texttt{list}}{Accessing the Elements of a list}}\label{accessing-the-elements-of-a-list}}

As mentioned, the individual elements of a \texttt{list} can be accessed with double brackets ( \texttt{{[}{[}\ {]}{]}}), as in: \index{[[ ]]}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# accessing elements from list}
\KeywordTok{print}\NormalTok{(my_named_l[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "NYSE"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(my_named_l[[}\DecValTok{3}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>     P   ref_date
R> 1 1.0 2021-03-30
R> 2 1.5 2021-03-31
R> 3 2.0 2021-04-01
R> 4 2.3 2021-04-02
\end{verbatim}

You can also access the elements of a \texttt{list} with simple brackets (\texttt{{[}{]}}), but be careful with this operation as the result will not be the element itself, but another \texttt{list}. This is a common mistake. See it below:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\StringTok{'a'}\NormalTok{,}
             \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{),}
             \KeywordTok{factor}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{))}

\CommentTok{# check classes}
\KeywordTok{class}\NormalTok{(my_l[[}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(my_l[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "list"
\end{verbatim}

If we try to add an element to \texttt{my\_l{[}2{]}}, we will receive an error message.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# adding an element to a list (WRONG)}
\NormalTok{my_l[}\DecValTok{2}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Error in my_l[2] + 1: non-numeric argument to binary operator
\end{verbatim}

An error is returned because a \texttt{list} object cannot be summed with a \texttt{numeric} object. To fix it, simply use double brackets, as in \texttt{my\_l{[}{[}2{]}{]}\ +\ 1}. Accessing elements of a list with simple brackets is only useful when looking for a sub-list within a larger list. As an example, if we wanted to obtain the first and second elements of \texttt{my\_l}, we would write:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set new list with the first and second element of my_l}
\NormalTok{my_new_l <-}\StringTok{ }\NormalTok{my_l[}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)]}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_new_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "a"
R> 
R> [[2]]
R> [1] 1 2 3
\end{verbatim}

With the named lists, we can access its elements with operator \texttt{\$} as in \texttt{my\_named\_l\$df\_prices} or using the element's name. In general, this is a more efficient and advised way of working with \texttt{lists}. Avoid using positional access of a \texttt{list}. The problem is, if you are working interactively with a \texttt{list}, the position of the elements may change as new data arrives. Using names prevents this problem because, by modifying the \texttt{list} and adding elements, you can change the order of elements, but not the names.

\begin{rmdimportant}
Be aware that RStudio's \emph{autocomplete} tool also works for lists.
To use it, enter the list name followed by \texttt{\$} and press
\emph{tab}. A dialog box with all the elements available in the list
will appear. From there, just select the desired element by pressing
\emph{enter}.
\end{rmdimportant}

Next, we provide several examples of how to access the elements of a \texttt{list} using operator \texttt{\$} and double brackets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# different ways to access a list}
\NormalTok{my_named_l}\OperatorTok{$}\NormalTok{tickers}
\NormalTok{my_named_l}\OperatorTok{$}\NormalTok{markets}
\NormalTok{my_named_l[[}\StringTok{'tickers'}\NormalTok{]]}
\NormalTok{my_named_l[[}\StringTok{'markets'}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

Another useful trick for working with lists is you can access all inner elements directly -- in one line of code -- by simply using consecutive brackets or names. See below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{slot1 =} \KeywordTok{c}\NormalTok{(}\DataTypeTok{num1 =} \DecValTok{1}\NormalTok{, }
                       \DataTypeTok{num2 =} \DecValTok{2}\NormalTok{, }
                       \DataTypeTok{num3 =} \DecValTok{3}\NormalTok{), }
             \DataTypeTok{slot2 =} \KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{))}

\CommentTok{# access the second value of the first element of my_l}
\KeywordTok{print}\NormalTok{(my_l[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> num2 
R>    2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# access the first value of the second element of my_l}
\KeywordTok{print}\NormalTok{(my_l[[}\DecValTok{2}\NormalTok{]][}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# access the value 'num3' in 'slot1'}
\KeywordTok{print}\NormalTok{(my_l[[}\StringTok{'slot1'}\NormalTok{]][}\StringTok{'num3'}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> num3 
R>    3
\end{verbatim}

This operation is very useful when interested in a few elements within a larger object. It avoids the need for creating intermediate objects.

\hypertarget{adding-and-removing-elements-from-a-list}{%
\subsection{\texorpdfstring{Adding and Removing Elements from a \texttt{list}}{Adding and Removing Elements from a list}}\label{adding-and-removing-elements-from-a-list}}

To add or replace elements in a \texttt{list}, just set the new object in the desired position:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ : chr "a"
R>  $ : num 1
R>  $ : num 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add new elements to list}
\NormalTok{my_l[[}\DecValTok{4}\NormalTok{]] <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\NormalTok{my_l[[}\DecValTok{2}\NormalTok{]] <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'b'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 4
R>  $ : chr "a"
R>  $ : chr "b"
R>  $ : num 3
R>  $ : int [1:5] 1 2 3 4 5
\end{verbatim}

This operation is also possible with the use of names and \texttt{\$}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{elem1 =} \StringTok{'a'}\NormalTok{, }
             \DataTypeTok{name1=}\DecValTok{5}\NormalTok{)}

\CommentTok{# set new element}
\NormalTok{my_l}\OperatorTok{$}\NormalTok{name2 <-}\StringTok{ }\DecValTok{10}

\CommentTok{# check it}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ elem1: chr "a"
R>  $ name1: num 5
R>  $ name2: num 10
\end{verbatim}

To remove elements from a \texttt{list}, set the element to the reserved symbol \texttt{NULL}, as in: \index{NULL}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{text =} \StringTok{'b'}\NormalTok{, }\DataTypeTok{num1 =} \DecValTok{2}\NormalTok{, }\DataTypeTok{num2 =} \DecValTok{4}\NormalTok{)}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 3
R>  $ text: chr "b"
R>  $ num1: num 2
R>  $ num2: num 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# remove elements}
\NormalTok{my_l[[}\DecValTok{3}\NormalTok{]] <-}\StringTok{ }\OtherTok{NULL}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 2
R>  $ text: chr "b"
R>  $ num1: num 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# remove elements}
\NormalTok{my_l}\OperatorTok{$}\NormalTok{num1 <-}\StringTok{ }\OtherTok{NULL}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 1
R>  $ text: chr "b"
\end{verbatim}

Another way of removing elements from a \texttt{list} is to use a negative index, which will exclude it from the returned object. See the next example, where we remove the second element of a \texttt{list} using a negative index.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{a =} \DecValTok{1}\NormalTok{, }
             \DataTypeTok{b =} \StringTok{'text'}\NormalTok{)}

\CommentTok{# remove second element}
\KeywordTok{glimpse}\NormalTok{(my_l[[}\OperatorTok{-}\DecValTok{2}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  num 1
\end{verbatim}

As with atomic vectors, removing elements of a \texttt{list} can also be accomplished with logical conditions. See next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list}
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}

\CommentTok{# remove elements by condition}
\NormalTok{my_l[my_l }\OperatorTok{>}\StringTok{ }\DecValTok{2}\NormalTok{] <-}\StringTok{ }\OtherTok{NULL}
\KeywordTok{glimpse}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> List of 2
R>  $ : num 1
R>  $ : num 2
\end{verbatim}

However, note this operation only works because all elements of \texttt{my\_l} are numeric, and a logical test can be applied to all cases. If that is impossible for a particular element, R will return an \texttt{NA} value.

\hypertarget{processing-the-elements-of-a-list}{%
\subsection{\texorpdfstring{Processing the Elements of a \texttt{list}}{Processing the Elements of a list}}\label{processing-the-elements-of-a-list}}

A very important point about working with \texttt{lists} is that its elements can be iterated in a very simple and direct way. For example, if you have a \texttt{list} with twenty dataframes, you can easily apply function \texttt{base::summary} to all of them in a single line of code. As an example, consider a list of numeric vectors of different sizes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set list with different numerical vectors.}
\NormalTok{my_l_num <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{), }
                 \KeywordTok{seq}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{50}\NormalTok{), }
                 \KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{, }\DataTypeTok{by=}\FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Let's assume we need to calculate the average of each vector in \texttt{my\_l\_num} and store the result in an atomic vector. We could do this operation by calling the \texttt{mean} function to each element of the \texttt{list}, as in: \index{base!mean}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate means}
\NormalTok{mean_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(my_l_num[[}\DecValTok{1}\NormalTok{]])}
\NormalTok{mean_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(my_l_num[[}\DecValTok{2}\NormalTok{]])}
\NormalTok{mean_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(my_l_num[[}\DecValTok{3}\NormalTok{]])}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(}\KeywordTok{c}\NormalTok{(mean_}\DecValTok{1}\NormalTok{, mean_}\DecValTok{2}\NormalTok{, mean_}\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2.0 25.5  0.0
\end{verbatim}

However, the code looks bad and it took three lines of code, not one! An easier, more elegant, and smarter way of doing that would be to use the \texttt{sapply} function, which will apply a function to each element of a list. All you need is the name of the list object and the name of the function used to process each element: \index{base!sapply}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# using sapply}
\NormalTok{my_mean <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(my_l_num, mean)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2.0 25.5  0.0
\end{verbatim}

As expected, the result is identical to the previous example. Using function \texttt{sapply} is preferable, because it is more compact and efficient than the alternative - creating \texttt{mean\_1}, and \texttt{mean\_2} and \texttt{mean\_3}. Notice the first example code only works for a \texttt{list} with three elements. If we had a fourth element and we wanted to keep this code structure, we would have to add a new line \texttt{mean\_4\ \textless{}-\ mean(my\_l\_num{[}{[}4{]}{]})} and modify the output command to \texttt{print\ \textless{}-c(mean\_1,\ mean\_2,\ mean\_3,\ mean\_4))}.

Intelligently, function \texttt{sapply} works the same way in \texttt{lists} of any size. If we had more elements in \texttt{my\_l\_num}, no modification is necessary for \texttt{my\_mean\ \textless{}-\ sapply(my\_l\_num,\ mean)}, making it easier to extend the code for more information. By combining a flexible object, such as a \texttt{list}, with the programming capacity of R, performing extensive operations in many complex objects becomes easy.

Using generic procedures is one premise of good and efficient programming practices. For the case of R, the rule is simple: \textbf{always write code flexible to the size of your objects}. The arrival of new data should never require modifications in the code. This is called the \emph{DRY} rule (\textbf{don't repeat yourself}). If you are repeating lines of code, as in the previous example, certainly a more elegant and flexible solution could be used. This section only gives a taste of the programming capacity of R. This will be explained in greater detail in chapter \ref{programming}.

\hypertarget{other-useful-functions}{%
\subsection{Other Useful Functions}\label{other-useful-functions}}

\textbf{unlist} - Returns the elements of a \texttt{list} in a single atomic vector. \index{base!unlist}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_named_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{ticker =} \StringTok{'XXXX4'}\NormalTok{,}
                   \DataTypeTok{price =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{1.5}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
                   \DataTypeTok{market =} \StringTok{'Be'}\NormalTok{)}
\NormalTok{my_unlisted <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(my_named_l)}
\KeywordTok{print}\NormalTok{(my_unlisted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  ticker  price1  price2  price3  price4  market 
R> "XXXX4"     "1"   "1.5"     "2"     "3"    "Be"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(my_unlisted)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\textbf{as.list} - Converts an object to the \texttt{list} type. \index{base!as.list}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{10}\OperatorTok{:}\DecValTok{13}
\NormalTok{my_x_as_list <-}\StringTok{ }\KeywordTok{as.list}\NormalTok{(my_x)}
\KeywordTok{print}\NormalTok{(my_x_as_list)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] 10
R> 
R> [[2]]
R> [1] 11
R> 
R> [[3]]
R> [1] 12
R> 
R> [[4]]
R> [1] 13
\end{verbatim}

\textbf{names} - Returns or defines the names of the elements of a \texttt{list}. \index{base!names}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{value1 =} \DecValTok{1}\NormalTok{, }\DataTypeTok{value2 =} \DecValTok{2}\NormalTok{, }\DataTypeTok{value3 =} \DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{names}\NormalTok{(my_l))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "value1" "value2" "value3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_l <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\KeywordTok{names}\NormalTok{(my_l) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'num1'}\NormalTok{, }\StringTok{'num2'}\NormalTok{, }\StringTok{'num3'}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $num1
R> [1] 1
R> 
R> $num2
R> [1] 2
R> 
R> $num3
R> [1] 3
\end{verbatim}

\hypertarget{matrices}{%
\section{\texorpdfstring{\texttt{Matrices}}{Matrices}}\label{matrices}}

A matrix is a two-dimensional representation of numbers, arranged in rows and columns. Using matrices is a powerful way of representing numerical data in two dimensions and, in certain situations, matrix functions can simplify complex mathematical operations. \index{Matrix} \index{Vector}

In R, matrices are objects with two dimensions, where all elements must have the same class. You can think of matrices as atomic vectors with one extra dimension. In matrices, lines and columns can be named. When used correctly, \texttt{matrix} objects can facilitate the storage and context of the data. \index{base!matrix}

A simple example of using matrices in finance is the representation of stock prices over time. The rows of the matrix represents the different dates, and the columns set each stock apart:

\begin{longtable}[]{@{}lrrrr@{}}
\toprule
& AAP & COG & BLK & CAM\tabularnewline
\midrule
\endhead
1 & 40.38 & 46.23 & 238.58 & 43.43\tabularnewline
2 & 40.14 & 46.17 & 239.61 & 43.96\tabularnewline
3 & 40.49 & 45.97 & 234.67 & 44.26\tabularnewline
4 & 40.48 & 45.56 & 237.25 & 44.50\tabularnewline
5 & 40.64 & 45.46 & 238.92 & 44.86\tabularnewline
\bottomrule
\end{longtable}

The above matrix could be created in R with the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set raw data with prices }
\NormalTok{raw_data <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{40.38}\NormalTok{,  }\FloatTok{40.14}\NormalTok{,  }\FloatTok{40.49}\NormalTok{,  }\FloatTok{40.48}\NormalTok{,  }\FloatTok{40.64}\NormalTok{,}
              \FloatTok{46.23}\NormalTok{,  }\FloatTok{46.17}\NormalTok{,  }\FloatTok{45.97}\NormalTok{,  }\FloatTok{45.56}\NormalTok{,  }\FloatTok{45.46}\NormalTok{,}
              \FloatTok{238.58}\NormalTok{, }\FloatTok{239.61}\NormalTok{, }\FloatTok{234.67}\NormalTok{, }\FloatTok{237.25}\NormalTok{, }\FloatTok{238.92}\NormalTok{,}
              \FloatTok{43.43}\NormalTok{,  }\FloatTok{43.96}\NormalTok{,  }\FloatTok{44.26}\NormalTok{,  }\FloatTok{44.5}\NormalTok{,   }\FloatTok{44.86}\NormalTok{)}

\CommentTok{# create matrix          }
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(raw_data, }\DataTypeTok{nrow =} \DecValTok{5}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{4}\NormalTok{)}
\KeywordTok{colnames}\NormalTok{(my_mat) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'AAP'}\NormalTok{, }\StringTok{'COG'}\NormalTok{, }\StringTok{'BLK'}\NormalTok{, }\StringTok{'CAM'}\NormalTok{)}
\KeywordTok{rownames}\NormalTok{(my_mat) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"2010-01-04"}\NormalTok{, }\StringTok{"2010-01-05"}\NormalTok{, }\StringTok{"2010-01-06"}\NormalTok{, }
                      \StringTok{"2010-01-07"}\NormalTok{, }\StringTok{"2010-01-08"}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>              AAP   COG    BLK   CAM
R> 2010-01-04 40.38 46.23 238.58 43.43
R> 2010-01-05 40.14 46.17 239.61 43.96
R> 2010-01-06 40.49 45.97 234.67 44.26
R> 2010-01-07 40.48 45.56 237.25 44.50
R> 2010-01-08 40.64 45.46 238.92 44.86
\end{verbatim}

We set the number of rows and columns explicitly with arguments \texttt{nrow\ =\ 4} and \texttt{ncol\ =\ 3} in \texttt{base::matrix}. The names of rows and columns are defined with functions \texttt{colnames} and \texttt{rownames}, using a left side notation as in \texttt{rownames(my\_mat)\ \textless{}-\ c(...)}. Going further, we can also retrieve the names of rows and columns with the same functions: \index{base!rownames} \index{base!colnames}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print the names of columns }
\KeywordTok{print}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "AAP" "COG" "BLK" "CAM"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print the names of rows}
\KeywordTok{print}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2010-01-04" "2010-01-05" "2010-01-06" "2010-01-07"
R> [5] "2010-01-08"
\end{verbatim}

After matrix \texttt{my\_mat} is created, we have at our disposal all its numerical properties. A simple example of using matrix operations in finance is the calculation of the value of a portfolio. If an investor has 200 shares of AAP, 300 share of COG, 100 of BLK and 50 of CAM, the value of his portfolio over time can be calculated as follows:

\[V _t = \sum _{i=1} ^{4} N _i P_{i,t}\]

In this formula, \(N_i\) is the number of shares purchased for each asset, and \(P_{i,t}\) is the price of stock \emph{i} at date \emph{t}. This is a simple operation to be performed with a matrix multiplication. Translating the procedure to R code, we have:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector with shares purchased}
\NormalTok{my_stocks <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{300}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{50}\NormalTok{), }\DataTypeTok{nrow =} \DecValTok{4}\NormalTok{)}

\CommentTok{# get value of portfolio with matrix multiplication}
\NormalTok{my_port <-}\StringTok{ }\NormalTok{my_mat }\OperatorTok{%*%}\StringTok{ }\NormalTok{my_stocks}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_port)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>               [,1]
R> 2010-01-04 47974.5
R> 2010-01-05 48038.0
R> 2010-01-06 47569.0
R> 2010-01-07 47714.0
R> 2010-01-08 47901.0
\end{verbatim}

In this last example, we use symbol \texttt{\%*\%}, which does a matrix multiplication between two objects of the class \texttt{matrix}. The output shows the value of the portfolio over time, resulting in a small loss for the investor on the last date. \index{base!\%*\%} \index{base!matrix multiplication}

A \texttt{matrix} object is also flexible with its content, as long as it is a single class. For example, you can create matrices with \texttt{character} elements:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create matrix with character}
\NormalTok{my_mat_char <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{,}\StringTok{'b'}\NormalTok{,}\StringTok{'c'}\NormalTok{), }\DecValTok{3}\NormalTok{), }
                      \DataTypeTok{nrow =} \DecValTok{3}\NormalTok{, }
                      \DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}

\CommentTok{# print it                    }
\KeywordTok{print}\NormalTok{(my_mat_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,] "a"  "a"  "a" 
R> [2,] "b"  "b"  "b" 
R> [3,] "c"  "c"  "c"
\end{verbatim}

Now with a \texttt{logic} type:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create matrix with logical}
\NormalTok{my_mat_logical <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{), }
                                \DataTypeTok{size =} \DecValTok{3}\OperatorTok{*}\DecValTok{3}\NormalTok{,}
                                \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{),}
                         \DataTypeTok{nrow =} \DecValTok{3}\NormalTok{, }
                         \DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}

\CommentTok{# print it                    }
\KeywordTok{print}\NormalTok{(my_mat_logical)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>       [,1]  [,2] [,3]
R> [1,]  TRUE FALSE TRUE
R> [2,] FALSE FALSE TRUE
R> [3,]  TRUE  TRUE TRUE
\end{verbatim}

This flexibility allows the user to expand the representation of two-dimensional data beyond numerical values.

\hypertarget{selecting-elements-from-a-matrix}{%
\subsection{\texorpdfstring{Selecting Elements from a \texttt{matrix}}{Selecting Elements from a matrix}}\label{selecting-elements-from-a-matrix}}

Following the same notation as the atomic vector, you can select \emph{pieces} of a \texttt{matrix} using indexes. A difference here is that matrices are two-dimensional objects, while atomic vectors are one-dimensional.\footnote{To avoid confusion, atomic vectors in R have no dimension attribute in the strict sense of the function. When using the \texttt{dim} function in an atomic vector, such as \texttt{dim(c(1,2,4))}, the result is \texttt{NULL}. Away from the computing environment, however, atomic vectors can be considered one-dimensional objects as it can only increase its size in one direction.} The extra dimension of matrices requires selecting elements not only by lines, but also by columns. The elements of an array can be accessed with the notation \texttt{{[}i,\ j{]}} where \emph{i} represents the row and \emph{j} the column. See the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create matrix}
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{3}\NormalTok{)}

\CommentTok{# display it}
\KeywordTok{print}\NormalTok{(my_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
R> [2,]    2    5    8
R> [3,]    3    6    9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# display element in [1,2]}
\KeywordTok{print}\NormalTok{(my_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4
\end{verbatim}

To select an entire row or column, simply leave a blank index, as in the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# select all rows from column 2}
\KeywordTok{print}\NormalTok{(my_mat[, }\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 5 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# select all columns from row 1}
\KeywordTok{print}\NormalTok{(my_mat[}\DecValTok{1}\NormalTok{, ])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 4 7
\end{verbatim}

Notice the result of indexing is an atomic vector, not a \texttt{matrix}. If we wanted the extracted piece to maintain its \texttt{matrix} class, with vertical or horizontal orientation, we could force this conversion using functions \texttt{as.matrix} and \texttt{matrix}: \index{base!matrix} \index{base!as.matrix}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# force matrix conversion and print result}
\KeywordTok{print}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(my_mat[ ,}\DecValTok{2}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]
R> [1,]    4
R> [2,]    5
R> [3,]    6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# force matrix conversion for one row and print result}
\KeywordTok{print}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(my_mat[}\DecValTok{1}\NormalTok{, ], }\DataTypeTok{nrow=}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]    1    4    7
\end{verbatim}

Pieces of the \texttt{matrix} can also be selected using vectors. If we wanted a new \texttt{matrix} with all elements from the second row and first column to the third row and second column, we could use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# select some elements and print them}
\KeywordTok{print}\NormalTok{(my_mat[}\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]    2    5
R> [2,]    3    6
\end{verbatim}

Finally, using logical tests to select elements of matrices is also possible: \index{logical matrices}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set matrix}
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{3}\NormalTok{)}

\CommentTok{# print logical matrix where value is higher than 5}
\KeywordTok{print}\NormalTok{(my_mat }\OperatorTok{>}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>       [,1]  [,2] [,3]
R> [1,] FALSE FALSE TRUE
R> [2,] FALSE FALSE TRUE
R> [3,] FALSE  TRUE TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print the result}
\KeywordTok{print}\NormalTok{(my_mat[my_mat }\OperatorTok{>}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6 7 8 9
\end{verbatim}

\hypertarget{other-useful-functions-1}{%
\subsection{Other Useful Functions}\label{other-useful-functions-1}}

\textbf{as.matrix} - Transforms raw data to a \texttt{matrix} object. \index{base!as.matrix}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]
R> [1,]    1
R> [2,]    2
R> [3,]    3
R> [4,]    4
R> [5,]    5
\end{verbatim}

\textbf{t} - Returns a transposed \texttt{matrix}. \index{base!t} \index{transpose matrix}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{20}\NormalTok{, }
                     \DataTypeTok{length.out =} \DecValTok{6}\NormalTok{), }
                 \DataTypeTok{nrow =} \DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]   10   16
R> [2,]   12   18
R> [3,]   14   20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{t}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3]
R> [1,]   10   12   14
R> [2,]   16   18   20
\end{verbatim}

\textbf{rbind} - Returns the merger (bind) of matrices, with row orientation. \index{base!rbind}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{1}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    2    3    4    5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{10}\OperatorTok{:}\DecValTok{14}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{1}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]   10   11   12   13   14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_rbind_mat <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(my_mat_}\DecValTok{1}\NormalTok{, my_mat_}\DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_rbind_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4] [,5]
R> [1,]    1    2    3    4    5
R> [2,]   10   11   12   13   14
\end{verbatim}

\textbf{cbind} - Returns the merger (bind) of matrices, with column orientation. \index{base!cbind}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]    1    3
R> [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{10}\OperatorTok{:}\DecValTok{13}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_mat_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2]
R> [1,]   10   12
R> [2,]   11   13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_cbind_mat <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(my_mat_}\DecValTok{1}\NormalTok{, my_mat_}\DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_cbind_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1] [,2] [,3] [,4]
R> [1,]    1    3   10   12
R> [2,]    2    4   11   13
\end{verbatim}

\textbf{rowMeans} - Returns the mean of a matrix, row wise. \index{base!rowMeans}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{rowMeans}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 4 5 6
\end{verbatim}

\textbf{colMeans} - Returns the mean of a matrix, column wise. \index{base!colMeans}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DataTypeTok{nrow=}\DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{colMeans}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2 5 8
\end{verbatim}

\hypertarget{exercises-3}{%
\section{Exercises}\label{exercises-3}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Using function \texttt{dplyr::tibble}, create a \texttt{dataframe} called \texttt{my\_df} with a column called \texttt{x} containing a sequence from -100 to 100 and another column called \texttt{y} with the value of column x added by 5. How many values in column \texttt{x} are greater than 10 and lower than 25?

02 -
Create a new column in object \texttt{my\_df} called \texttt{cumsum\_x}, containing the cumulative sum of \texttt{x} (\texttt{cumsum} function). In this new column, how many values are greater than -3500?

03 -
Use function \texttt{dplyr::filter} function and the pipeline operator to filter \texttt{my\_df}, keeping only the rows where the value of the \texttt{y} column is greater than 0. What is the number of rows in the resulting table?

04 -
If you have not already done so, repeat exercises 1, 2 and 3 using the functions of the \texttt{tidyverse} universe and the \emph{pipeline} operator.

05 -
Use the \texttt{BatchGetSymbols} package to download Google (GOOG) stock data, from\texttt{r\ first\_date} to 2020-12-31. If the investor had bought 1000 USD in Google shares on the first day of the data and kept the investment until today, what would be the value of his portfolio?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  \$7,485
\item
  \$9,972
\item
  \$5,572
\item
  \$8,729
\item
  \$6,241
\end{enumerate}

06 -
Use functions \texttt{afedR::get\_data\_file} and \texttt{readr::read\_csv} to import data from the \texttt{grunfeld.csv} file. Now, use function \texttt{dplyr::glimpse} functions to find out the number of lines in the imported data. What is the number of rows in the imported table?

07 -
Create a list type object with three \texttt{dataframes} in its contents,\texttt{df1}, \texttt{df2} and \texttt{df3}. The content and size of the dataframes is your personal choice. Now, use the \texttt{sapply} function and a custom function to find out the number of rows and columns in each \texttt{dataframe}.

08 -
Wihtin an R session, create an identity matrix (value 1 in the diagonal, zero in any other) of size 3X3. Tip: use the \texttt{diag} function to define the diagonal of the matrix.

\hypertarget{basic-classes}{%
\chapter{Basic Object Classes}\label{basic-classes}}

\textbf{The basic classes are the most primary elements of data representation in R}. Previously, we used the basic classes to translate raw information from files or the internet. The numeric data became a \texttt{numeric} column in a \texttt{dataframe}, while text data became a \texttt{character} object.

In this chapter, we will study R's basic object classes with depth, including the manipulation of their content. This chapter will show you what operations are possible with each object class and how you can use functions and packages to manipulate the information efficiently. It includes the following types of objects:

\begin{itemize}
\tightlist
\item
  Numeric (\texttt{numeric})
\item
  Text (\texttt{character})
\item
  Factors (\texttt{factor})
\item
  Logical Values (\texttt{logical})
\item
  Dates and Time (\texttt{Date} and \texttt{timedate})
\item
  Missing Data (\texttt{NA})
\end{itemize}

\hypertarget{numeric-objects}{%
\section{\texorpdfstring{\texttt{Numeric} Objects}{Numeric Objects}}\label{numeric-objects}}

The objects of type \texttt{numeric} represent quantities and, unsurprisingly, are one of the most used objects in data research. For example, the price of a stock at a given date, the value of inflation in a given period and country, the net profit of a company at the end of the fiscal year, among many other possibilities.

\hypertarget{creating-and-manipulating-numeric-objects}{%
\subsection{\texorpdfstring{Creating and Manipulating \texttt{numeric} Objects}{Creating and Manipulating numeric Objects}}\label{creating-and-manipulating-numeric-objects}}

It is easy to create and manipulate the \texttt{numeric} objects. As expected, we can use the common symbols of mathematical operations, such as sum (\texttt{+}), difference (\texttt{-}), division (\texttt{/}) and multiplication (\texttt{*}). When working with \texttt{numeric} vectors, all mathematical operations are carried out using an \textbf{element by element} orientation and using vector notation. For example, this means that we can add the elements from two vectors in a single line of code.

As you can see in the next example, where we have created two vectors and perform various operations.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create numeric vectors}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{5}
\NormalTok{y <-}\StringTok{ }\DecValTok{2}\OperatorTok{:}\DecValTok{6}

\CommentTok{# print sum}
\KeywordTok{print}\NormalTok{(x}\OperatorTok{+}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  3  5  7  9 11
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print multiplication}
\KeywordTok{print}\NormalTok{(x}\OperatorTok{*}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  2  6 12 20 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print division}
\KeywordTok{print}\NormalTok{(x}\OperatorTok{/}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.5000000 0.6666667 0.7500000 0.8000000 0.8333333
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print exponentiation}
\KeywordTok{print}\NormalTok{(x}\OperatorTok{^}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]     1     8    81  1024 15625
\end{verbatim}

The difference between R and other programming languages is that operations between vectors of different sizes are accepted. That is, we can also add a \texttt{numeric} vector with four elements to another with only two. Whenever that happens, R calls for the \textbf{recycling rule}. It states that, if two different sized vectors are interacting, the smaller vector is repeated as often as necessary to obtain the same number of elements as the larger vector. See the following example: \index{recycling rule}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x with 4 elements and y with 2}
\NormalTok{x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{4}
\NormalTok{y <-}\StringTok{ }\DecValTok{2}\OperatorTok{:}\DecValTok{1}

\CommentTok{# print multiplication}
\KeywordTok{print}\NormalTok{(x }\OperatorTok{+}\StringTok{ }\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3 3 5 5
\end{verbatim}

The result of \texttt{x\ +\ y} is equivalent to \texttt{1:4\ +\ c(2,\ 1,\ 2,\ 1)}. If you try to operate with vectors in which the length of the largest vector is not a multiple of the length of the smaller, R performs the same recycling procedure. However, it also sends a \texttt{warning} message to inform the user that the recycling procedure did not result in a perfect match.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set x = 4 elements and y with 3}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{# print sum (recycling rule)}
\KeywordTok{print}\NormalTok{(x }\OperatorTok{+}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Warning in x + y: longer object length is not a multiple of
R> shorter object length
\end{verbatim}

\begin{verbatim}
R> [1] 2 4 6 5
\end{verbatim}

The first three elements of \texttt{x} were summed to the first three elements of \texttt{y}, as expected. However, the fourth element of \texttt{x} was summed to the first element of \texttt{y}. In order to complete the operation, R cycled through the values of the vector, restarting with the first element of \texttt{y}.

Elements of a \texttt{numeric} vector can also be named. See an example next, where we create a vector with several named items.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create named vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DataTypeTok{item1 =} \DecValTok{10}\NormalTok{, }
       \DataTypeTok{item2 =} \DecValTok{14}\NormalTok{, }
       \DataTypeTok{item3 =} \DecValTok{9}\NormalTok{, }
       \DataTypeTok{item4 =} \DecValTok{2}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item1 item2 item3 item4 
R>    10    14     9     2
\end{verbatim}

Empty \texttt{numeric} vectors can also be created. Sometimes, you need to preallocate an empty vector to be filled with values later. In some situations this simple procedure can make the code faster; and for that, you need to use the \texttt{numeric} function: \index{base!numeric}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create empty numeric vector of length 10}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{numeric}\NormalTok{(}\DataTypeTok{length =} \DecValTok{10}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 0 0 0 0 0 0 0 0 0 0
\end{verbatim}

As you can see, when using \texttt{numeric(length\ =\ 10)}, all values are set to zero.

\hypertarget{creating-a-numeric-sequence}{%
\subsection{\texorpdfstring{Creating a \texttt{numeric} Sequence}{Creating a numeric Sequence}}\label{creating-a-numeric-sequence}}

In R, you have two ways to create a sequence of numerical values. The first with operator \texttt{:} as in \texttt{my\_seq\ \textless{}-\ 1:10}. This method is practical because the notation is clear and direct.

However, using the operator \texttt{:} can be restrictive. Did you notice that it only creates sequences where the difference between adjacent elements is +1 or -1? A more powerful version for the creation of sequences is the use of function \texttt{seq}. With it, you can set the intervals between each value with the argument \texttt{by}. See an example next: \index{base!seq}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create sequence with seq}
\NormalTok{my_seq <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \DecValTok{-10}\NormalTok{, }
              \DataTypeTok{to =} \DecValTok{10}\NormalTok{, }
              \DataTypeTok{by =} \DecValTok{2}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_seq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10
\end{verbatim}

Another interesting feature of function \texttt{seq} is the possibility of creating equally spaced vectors with an initial value, a final value, and the desired number of elements. This is accomplished using option \texttt{length.out}. In the following code, we create a array from 0 to 10 with 20 elements:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create sequence with defined number of elements}
\NormalTok{desired_len <-}\StringTok{ }\DecValTok{20}
\NormalTok{my_seq <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \DecValTok{0}\NormalTok{, }
              \DataTypeTok{to =} \DecValTok{10}\NormalTok{, }
              \DataTypeTok{length.out =}\NormalTok{ desired_len)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_seq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0.0000000  0.5263158  1.0526316  1.5789474  2.1052632
R>  [6]  2.6315789  3.1578947  3.6842105  4.2105263  4.7368421
R> [11]  5.2631579  5.7894737  6.3157895  6.8421053  7.3684211
R> [16]  7.8947368  8.4210526  8.9473684  9.4736842 10.0000000
\end{verbatim}

The final number of elements in object \texttt{my\_seq} is exactly 20. Function \texttt{seq} automatically calculates and sets the difference of 0.5263 between the adjacent elements. That is, if we calculate the difference from one element to the other, we will always find the same result of 0.5263.

\hypertarget{creating-vectors-with-repeated-elements}{%
\subsection{Creating Vectors with Repeated Elements}\label{creating-vectors-with-repeated-elements}}

Another way to create \texttt{numeric} vectors is by using repetition. For example, imagine that we are interested in a vector with the value 1 repeated ten times. For that, we use function \texttt{rep}: \index{base!rep}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# repeat vector three times}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\NormalTok{, }\DataTypeTok{times =} \DecValTok{10}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 1 1 1 1 1 1 1 1 1 1
\end{verbatim}

It also works with vectors. For example, let's say you need to create a vector with the repeated values of \texttt{c(1,\ 2)}. The result should be equal to \texttt{c(1,\ 2,\ 1,\ 2,\ 1,\ 2)}. For that, we use \texttt{rep} the same way:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# created a vector with repeated elements}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }
            \DataTypeTok{times =} \DecValTok{3}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 1 2 1 2
\end{verbatim}

\hypertarget{creating-vectors-with-random-numbers}{%
\subsection{Creating Vectors with Random Numbers}\label{creating-vectors-with-random-numbers}}

Some applications in finance and economics require the use of random numbers to simulate mathematical models. For example, the simulation method of Monte Carlo can generate asset prices based on random numbers from the Normal distribution.

In R, several functions create random numbers for different statistical distributions. The most commonly used, however, are functions \texttt{stats::rnorm} and \texttt{stats::runif}. Remember that package \texttt{stats} is automatically loaded when R starts. So, unless you changed the default settings of R's startup, there is no need to make a call to \texttt{library(stats)}. \index{base!rnorm} \index{base!runif}

Function \texttt{rnorm} generates random numbers from the Normal distribution, with options for the mean and standard deviation. The \texttt{mean} will set the point with the highest frequency and \texttt{sd} (standard deviation) will change the dispersion of the histogram.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# generate 10 random numbers from a Normal distribution}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DataTypeTok{n =} \DecValTok{10000}\NormalTok{, }
                    \DataTypeTok{mean =} \DecValTok{0}\NormalTok{, }
                    \DataTypeTok{sd =} \DecValTok{1}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{glimpse}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  num [1:10000] 0.544 1.041 0.198 -1.63 0.121 ...
\end{verbatim}

We generated ten thousand random numbers from a Normal distribution, with mean zero and standard deviation equal to one. Let's see if its distribution of numbers looks close to the Normal, a bell shaped distribution:

\begin{center}\includegraphics{afedR_ed02-ONLINE_files/figure-latex/unnamed-chunk-303-1} \end{center}

Yes, the shape of the frequency distribution is visually close to the bell curve. You can change the parameters \texttt{mean} and \texttt{sd} for different shapes of a Normal distribution.

Function \texttt{runif} generates random values uniformly distributed between a maximum and a minimum. It is commonly used to simulate probabilities with values between zero and one. The \texttt{runif} function has three input parameters: the desired number of random values, the minimum value, and maximum value. See the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a random vector with minimum and maximum}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DataTypeTok{n =} \DecValTok{10}\NormalTok{, }
                    \DataTypeTok{min =} \DecValTok{-5}\NormalTok{, }
                    \DataTypeTok{max =} \DecValTok{5}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] -0.0858712  4.3401557  2.9388118 -2.2792339  3.1741687
R>  [6] -0.3947496  3.4054654  3.1049157  3.5276227 -1.5256521
\end{verbatim}

Note that both functions, \texttt{rnorm} and \texttt{runif}, are limited to their respective distribution. An alternative and flexible way to generate random values is to use the \texttt{sample} function. It accepts any vector as input and returns a scrambled version of its elements. Its flexibility lies in the fact that the input vector can be anything. For example, if we wanted to create a random vector with elements taken from vector \texttt{c(0,\ 5,\ 15,\ 20,\ 25)}, we could do it like this: \index{base!sample}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create sequence}
\NormalTok{my_vec <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \DecValTok{0}\NormalTok{, }\DataTypeTok{to =} \DecValTok{25}\NormalTok{, }\DataTypeTok{by=}\DecValTok{5}\NormalTok{)}

\CommentTok{# sample sequence}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(my_vec)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  5 10 25  0 20 15
\end{verbatim}

Function \texttt{sample} also allows the random selection of a fixed number of elements. If we wanted to select only one element of \texttt{my\_vec} randomly, we could write the code as:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sample one element of my_vec}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(my_vec, }\DataTypeTok{size =} \DecValTok{1}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 20
\end{verbatim}

If we wanted two random elements from \texttt{my\_rnd\_vec}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sample two elements of my_vec}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(my_vec, }\DataTypeTok{size =} \DecValTok{2}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 25 20
\end{verbatim}

Besides, you can select values from a smaller vector to create a larger vector. Consider the case where you have a vector with numbers \texttt{c(5,\ 10,\ 15)} and want to create a random vector with ten elements. For that, we use the option \texttt{replace\ =\ TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create vector}
\NormalTok{my_vec <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)}

\CommentTok{# sample}
\NormalTok{my_rnd_vec <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_vec, }\DataTypeTok{size =} \DecValTok{10}\NormalTok{, }\DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_rnd_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 15 10  5  5 10  5  5 15 10 10
\end{verbatim}

Another important feature of \texttt{sample} is it works for any type of vector, not only for those of the \texttt{numeric} class:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of sample with characters}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'elem 1'}\NormalTok{,}\StringTok{'elem 2'}\NormalTok{,}\StringTok{'elem 3'}\NormalTok{),}
             \DataTypeTok{size =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "elem 2"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of sample with list}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{),}
                  \DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{)),}
             \DataTypeTok{size =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $y
R> [1] "a" "b"
\end{verbatim}

At this point, it is important to acknowledge that \textbf{the generation of random values in R is not entirely random!} Internally, the computer makes selections based on a deterministic queue. Every time that chance-related functions, such as \texttt{rnorm}, \texttt{runif}, and \texttt{sample}, are called in the code, the computer chooses a different place in this queue according to various parameters. The practical effect is that the actual chosen values are unpredictable from the user's viewpoint. However, for the computer, this selection is absolutely predictable and deterministic.

One neat trick is that we can select the starting place in the queue of random values using function \texttt{base::set.seed}. In practical terms, the result is that, after a call to \texttt{set.seed}, all subsequent numbers and random selections will be the same in every code execution. Using \texttt{set.seed} is strongly recommended for the reproducibility of code involving randomness. Anyone can replicate the exact same results, even if it involves the selection of random numbers. See the following example. \index{base!set.seed}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set seed with integer 10}
\KeywordTok{set.seed}\NormalTok{(}\DataTypeTok{seed =} \DecValTok{10}\NormalTok{)}

\CommentTok{# create and print "random" vectors}
\NormalTok{my_rnd_vec_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_rnd_vec_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.50747820 0.30676851 0.42690767 0.69310208 0.08513597
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_rnd_vec_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_rnd_vec_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.2254366 0.2745305 0.2723051 0.6158293 0.4296715
\end{verbatim}

In the previous code, the value 10 in \texttt{set.seed(10)} is an integer chosen by the user. After the call to \texttt{set.seed(10)}, all selections and random numbers will start from the same point in the queue. Therefore, the random vectors are the same. By running that previous chunk of code in your computer, you'll see that the values of \texttt{my\_rnd\_vec\_1} and \texttt{my\_rnd\_vec\_2} will be exactly the same as the ones printed in this book.

Function \texttt{set.seed} also works for \texttt{sample}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fix seed}
\KeywordTok{set.seed}\NormalTok{(}\DataTypeTok{seed =} \DecValTok{15}\NormalTok{)}

\CommentTok{# print vectors}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  5  2  1  6  8 10  3  7  9  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\DecValTok{10}\OperatorTok{:}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 13 15 10 17 20 14 19 12 11 18 16
\end{verbatim}

Likewise, if you execute the previous code in your R session, you'll see the exact same selections.

\hypertarget{accessing-the-elements-of-a-numeric-vector}{%
\subsection{\texorpdfstring{Accessing the Elements of a \texttt{numeric} Vector}{Accessing the Elements of a numeric Vector}}\label{accessing-the-elements-of-a-numeric-vector}}

All elements of a numerical vector can be accessed with brackets (\texttt{{[}{]}}). For example, if we wanted only the first element of \texttt{x}, we can use \texttt{x{[}1{]}}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{-9}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\CommentTok{# get first element}
\NormalTok{first_elem_x <-}\StringTok{ }\NormalTok{x[}\DecValTok{1}\NormalTok{]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(first_elem_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -1
\end{verbatim}

The same notation is used to extract parts of a vector. If we wanted to create a sub-vector with the first and second element of \texttt{x}, we can achieve this goal with the next chunk of code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sub-vector of x}
\NormalTok{sub_x <-}\StringTok{ }\NormalTok{x[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(sub_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -1  4
\end{verbatim}

To access named elements of a numeric array, simply use its name as a \texttt{character} value or vector inside the brackets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set named vector}
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DataTypeTok{item1 =} \DecValTok{10}\NormalTok{, }\DataTypeTok{item2 =} \DecValTok{14}\NormalTok{, }\DataTypeTok{item3 =} \DecValTok{-9}\NormalTok{, }\DataTypeTok{item4 =} \DecValTok{-2}\NormalTok{)}

\CommentTok{# access elements by name}
\KeywordTok{print}\NormalTok{(x[}\StringTok{'item2'}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item2 
R>    14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(x[}\KeywordTok{c}\NormalTok{(}\StringTok{'item2'}\NormalTok{,}\StringTok{'item4'}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item2 item4 
R>    14    -2
\end{verbatim}

We can also access the elements of a numerical vector using logical tests. For example, if we were interested in knowing which values of \texttt{x} are larger than \emph{0}, we could use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# find all values of x higher than zero}
\KeywordTok{print}\NormalTok{(x[x }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> item1 item2 
R>    10    14
\end{verbatim}

The selection of elements from a vector, according to some criteria, is called logical indexing. Objects of type \texttt{logical} will be treated later in this same chapter.

\hypertarget{modifying-and-removing-elements-of-a-numeric-vector}{%
\subsection{\texorpdfstring{Modifying and Removing Elements of a \texttt{numeric} Vector}{Modifying and Removing Elements of a numeric Vector}}\label{modifying-and-removing-elements-of-a-numeric-vector}}

The modification of a vector is very simple. Just indicate the changes with the \emph{assign} symbol (\texttt{\textless{}-}): \index{base!<-}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{4}

\CommentTok{# modify first element to 5}
\NormalTok{my_x[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\DecValTok{5}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 2 3 4
\end{verbatim}

This modification can also be performed block-wise:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{0}\OperatorTok{:}\DecValTok{5}

\CommentTok{# set the first three elements to 5}
\NormalTok{my_x[}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\DecValTok{5}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 5 5 3 4 5
\end{verbatim}

Using conditions to change values in a vector is also possible:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{-5}\OperatorTok{:}\DecValTok{5}

\CommentTok{# set any value lower than 2 to 0}
\NormalTok{my_x[my_x}\OperatorTok{<}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\DecValTok{0}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 0 0 0 0 0 0 0 2 3 4 5
\end{verbatim}

The removal of elements of a vector is carried out using a negative index:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create vector}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{-5}\OperatorTok{:}\DecValTok{5}

\CommentTok{# remove first and second element of my_x}
\NormalTok{my_x <-}\StringTok{ }\NormalTok{my_x[}\OperatorTok{-}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)]}

\CommentTok{# show result}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] -3 -2 -1  0  1  2  3  4  5
\end{verbatim}

Notice how using negative index simply returns the original vector, without the elements in the brackets.

\hypertarget{creating-groups}{%
\subsection{Creating Groups}\label{creating-groups}}

A common data task is to create groups based on numerical data. For example, we can calculate how many cases in the sample are located within a certain numerical range. Now, let's imagine that we have a vector of daily returns of a stock, the percentage change in prices from one day to another. A simple way to measure the risk of the investment is to divide the return interval into five parts and verify the percentage of occurrences of returns at each range. This simple calculation will show, for example, how many days the return was negative, with a drop of the stock price.

In R, the function used to create intervals from a numerical vector is \texttt{base::cut}. See the following example, where we create a random vector from the Normal distribution and five groups from intervals defined by the data. \index{base!cut}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set random vector}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{10000}\NormalTok{)}

\CommentTok{# create groups with 5 breaks}
\NormalTok{my_cut <-}\StringTok{ }\KeywordTok{cut}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_x, }\DataTypeTok{breaks =} \DecValTok{5}\NormalTok{)}

\CommentTok{# print it!}
\KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(my_cut))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] (-2.18,-0.71] (-0.71,0.759] (-2.18,-0.71] (-0.71,0.759]
R> [5] (-0.71,0.759] (-2.18,-0.71]
R> 5 Levels: (-3.66,-2.18] (-2.18,-0.71] ... (2.23,3.7]
\end{verbatim}

Be aware that ranges define the names in \texttt{my\_cut}, and the result is a \texttt{factor} object. We will cover this object in a future section. For now, it is worthwhile to say \texttt{factors} are simply groups within our data. Going forward, we can also check how often we find cases in each group using \texttt{base::table}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{table}\NormalTok{(my_cut))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> my_cut
R> (-3.66,-2.18] (-2.18,-0.71] (-0.71,0.759]  (0.759,2.23] 
R>           154          2132          5459          2149 
R>    (2.23,3.7] 
R>           106
\end{verbatim}

As expected, the distribution of values is balanced, with a higher occurrence of values around zero -- the mean.

With the \texttt{cut} function, you can also define custom breaks in data and group names. See next, where we use a \texttt{tibble} to organize our data:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create random vector in tibble}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{10000}\NormalTok{))}

\CommentTok{# define breaks and labels manually}
\NormalTok{my_breaks <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(my_x)}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DecValTok{-1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\KeywordTok{max}\NormalTok{(my_x)}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{my_labels <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Low'}\NormalTok{,}\StringTok{'Normal'}\NormalTok{, }\StringTok{'High'}\NormalTok{)}

\CommentTok{# create group from numerical vector}
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{cut_x =} \KeywordTok{cut}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }
                     \DataTypeTok{breaks =}\NormalTok{ my_breaks, }
                     \DataTypeTok{labels =}\NormalTok{ my_labels))}

\CommentTok{# glimpse it!}
\KeywordTok{glimpse}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 10,000
R> Columns: 2
R> $ x     <dbl> -0.42217453, 1.21510691, -0.48018365, 0.0904~
R> $ cut_x <fct> Normal, High, Normal, Normal, Low, Normal, N~
\end{verbatim}

Notice that, in this example of creating a group from a numerical vector, the breaks were defined in \texttt{my\_breaks} and the names in \texttt{my\_labels}. We can once again check the distribution of groups with function \texttt{table}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{table}\NormalTok{(my_df}\OperatorTok{$}\NormalTok{cut_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> 
R>    Low Normal   High 
R>   1593   6770   1637
\end{verbatim}

\hypertarget{other-useful-functions-2}{%
\subsection{Other Useful Functions}\label{other-useful-functions-2}}

\textbf{as.numeric} - Converts an object to the \texttt{numeric} class. \index{base!as.numeric}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_text <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'1'}\NormalTok{, }\StringTok{'2'}\NormalTok{, }\StringTok{'3'}\NormalTok{)}
\KeywordTok{class}\NormalTok{(my_text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(my_text)}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "numeric"
\end{verbatim}

\textbf{unique} - Returns all unique values of a numeric vector. \index{base!unique}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{unique}\NormalTok{(my_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 5
\end{verbatim}

\textbf{sum} - Sums all elements of a \texttt{numeric} vector. \index{base!sum}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{50}
\NormalTok{my_sum <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(my_x)}
\KeywordTok{print}\NormalTok{(my_sum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1275
\end{verbatim}

\textbf{max} - Returns the maximum value of a \texttt{numeric} vector. \index{base!max}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{max_x <-}\StringTok{ }\KeywordTok{max}\NormalTok{(x)}
\KeywordTok{print}\NormalTok{(max_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 14
\end{verbatim}

\textbf{min} - Returns the minimum value of a \texttt{numeric} vector. \index{base!min}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{min_x <-}\StringTok{ }\KeywordTok{min}\NormalTok{(x)}
\KeywordTok{print}\NormalTok{(min_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 2
\end{verbatim}

\textbf{which.max} - Returns the position of the maximum value of a \texttt{numeric} object. \index{base!which.max}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{141}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{which_max_x <-}\StringTok{ }\KeywordTok{which.max}\NormalTok{(x)}
\KeywordTok{cat}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'The position of the max value of x is '}\NormalTok{, }
\NormalTok{          which_max_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The position of the max value of x is  2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cat}\NormalTok{(}\StringTok{' and its value is '}\NormalTok{, x[which_max_x])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  and its value is  141
\end{verbatim}

\textbf{which.min} - Returns the position of the minimum value of a \texttt{numeric} object. \index{base!which.min}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{which_min_x <-}\StringTok{ }\KeywordTok{which.min}\NormalTok{(x)}
\KeywordTok{cat}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'The position of the min value of x is '}\NormalTok{,}
\NormalTok{          which_min_x, }\StringTok{' and its value is '}\NormalTok{, x[which_min_x]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> The position of the min value of x is  4  and its value is  2
\end{verbatim}

\textbf{sort} - Returns a sorted (ascending or descending) version of a \texttt{numeric} vector. \index{base!sort}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{sort}\NormalTok{(x, }\DataTypeTok{decreasing =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.1032680 0.3004002 0.4337767 0.5133841 0.7782837
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{sort}\NormalTok{(x, }\DataTypeTok{decreasing =} \OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 0.7782837 0.5133841 0.4337767 0.3004002 0.1032680
\end{verbatim}

\textbf{cumsum} - Returns the cumulative sum of the elements of a \texttt{numerical} vector. \index{base!cumsum}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{25}
\NormalTok{my_cumsum <-}\StringTok{ }\KeywordTok{cumsum}\NormalTok{(my_x)}
\KeywordTok{print}\NormalTok{(my_cumsum)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]   1   3   6  10  15  21  28  36  45  55  66  78  91 105
R> [15] 120 136 153 171 190 210 231 253 276 300 325
\end{verbatim}

\textbf{prod} - Returns the product (multiplication) of all the elements of a \texttt{numerical} vector. \index{base!prod}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{my_prod <-}\StringTok{ }\KeywordTok{prod}\NormalTok{(my_x)}
\KeywordTok{print}\NormalTok{(my_prod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3628800
\end{verbatim}

\textbf{cumprod} - Returns the cumulative product of the elements of a \texttt{numeric} vector. \index{base!cumprod}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}
\NormalTok{my_prod <-}\StringTok{ }\KeywordTok{cumprod}\NormalTok{(my_x)}
\KeywordTok{print}\NormalTok{(my_prod)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]       1       2       6      24     120     720    5040
R>  [8]   40320  362880 3628800
\end{verbatim}

\hypertarget{character-objects}{%
\section{\texorpdfstring{\texttt{Character} Objects}{Character Objects}}\label{character-objects}}

The \texttt{character} class, or simply text class, is used to store textual information. A practical example in finance would be to extract sentiments from Facebook and Twitter posts and use that to predict future market prices. It is worth knowing that analyzing textual information is an upward trend in research \citep{gentzkow2017text}, with many R packages developed over the last few years.

R has several features that facilitate the creation and manipulation of text type objects. The base functions shipped with the installation of R are comprehensive and suited for most cases. However, package \texttt{stringr} \citep{R-stringr} provides many functions that greatly expand the basic functionality.

A positive aspect of \texttt{stringr} is that all functions start with the name \texttt{str\_} and are informative. So, using the auto-completion feature (\emph{tab} key) described in the previous chapter, it is easy to find the names of functions. Following our preference for the packages in the \texttt{tidyverse}, we will focus only on the functions of \texttt{stringr}. The \texttt{base} functions for string manipulation will be presented but in a limited way. \index{stringr}

\hypertarget{creating-a-simple-character-object}{%
\subsection{\texorpdfstring{Creating a Simple \texttt{character} Object}{Creating a Simple character Object}}\label{creating-a-simple-character-object}}

In R, every \texttt{character} object is created by encapsulating a text with double quotation marks (" ") or single (' '). To create an array of characters with stock \emph{tickers}, we can do it with the following code: \index{character}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tickers <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'MMM'}\NormalTok{, }\StringTok{'FB'}\NormalTok{, }\StringTok{'ICE'}\NormalTok{)}
\KeywordTok{print}\NormalTok{(tickers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "MMM" "FB"  "ICE"
\end{verbatim}

We can confirm the class of the created object with function \texttt{class}: \index{base!class}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(tickers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "character"
\end{verbatim}

\hypertarget{creating-structured-character-objects}{%
\subsection{\texorpdfstring{Creating Structured \texttt{character} Objects}{Creating Structured character Objects}}\label{creating-structured-character-objects}}

We can also use R to create a text vector with some sort of structure. For example, vector \texttt{c(\textquotesingle{}ticker\ 1\textquotesingle{},\ \textquotesingle{}ticker\ 2\textquotesingle{},\ ...,\ \textquotesingle{}ticker\ 19\textquotesingle{},\ \textquotesingle{}ticker\ 20\textquotesingle{})} has a clear logic. It combines a text \texttt{ticker} with values from a vector that starts in 1 and ends in 20.

To create a text vector with the junction of text and numbers, use the \texttt{stringr::str\_c} or \texttt{paste} function. See the following example, where we create the previous structured text in two ways, with space between the characters and numbers, and without it. \index{stringr!str\_c} \index{base!paste}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(stringr)}

\CommentTok{# create sequence and tex}
\NormalTok{my_seq <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{20}
\NormalTok{my_text <-}\StringTok{ 'text'}

\CommentTok{# paste objects together (without space)}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{str_c}\NormalTok{(my_text, my_seq)}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "text1"  "text2"  "text3"  "text4"  "text5"  "text6" 
R>  [7] "text7"  "text8"  "text9"  "text10" "text11" "text12"
R> [13] "text13" "text14" "text15" "text16" "text17" "text18"
R> [19] "text19" "text20"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# paste objects together (with space)}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{str_c}\NormalTok{(my_text, }
\NormalTok{                 my_seq, }
                 \DataTypeTok{sep =} \StringTok{' '}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "text 1"  "text 2"  "text 3"  "text 4"  "text 5" 
R>  [6] "text 6"  "text 7"  "text 8"  "text 9"  "text 10"
R> [11] "text 11" "text 12" "text 13" "text 14" "text 15"
R> [16] "text 16" "text 17" "text 18" "text 19" "text 20"
\end{verbatim}

We can do the same procedure with text vectors:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set character value}
\NormalTok{my_x <-}\StringTok{ 'My name is'}

\CommentTok{# set character vector}
\NormalTok{my_names <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Marcelo'}\NormalTok{, }\StringTok{'Ricardo'}\NormalTok{, }\StringTok{'Tarcizio'}\NormalTok{)}

\CommentTok{# paste and print}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str_c}\NormalTok{(my_x, my_names, }\DataTypeTok{sep =} \StringTok{' '}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "My name is Marcelo"  "My name is Ricardo" 
R> [3] "My name is Tarcizio"
\end{verbatim}

Another possibility of building structured text is the repetition of the content of another object. With \texttt{character} objects, use function \texttt{stringr!str\_dup} or \texttt{base::strrep} for this purpose. Consider the following example: \index{base!strrep} \index{stringr!str\_dup}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# repeat 'abc' five times}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{str_dup}\NormalTok{(}\DataTypeTok{string =} \StringTok{'abc'}\NormalTok{, }\DataTypeTok{times =} \DecValTok{5}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "abcabcabcabcabc"
\end{verbatim}

\hypertarget{character-constants}{%
\subsection{\texorpdfstring{\texttt{character} Constants}{character Constants}}\label{character-constants}}

R also allows direct access to all letters of the Roman alphabet. They are stored in the reserved (constant) objects, called \texttt{letters} and \texttt{LETTERS}. See an example next. \index{letters} \index{LETTERS}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print all letters in alphabet (no cap)}
\KeywordTok{print}\NormalTok{(letters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n"
R> [15] "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print all letters in alphabet (WITH CAP)}
\KeywordTok{print}\NormalTok{(LETTERS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N"
R> [15] "O" "P" "Q" "R" "S" "T" "U" "V" "W" "X" "Y" "Z"
\end{verbatim}

Note that, in both cases, \texttt{letters} and \texttt{LETTERS} are not functions. They are \texttt{character} objects automatically embedded as constants in R. Even though they do not appear in the environment, and they are always available for use. You may overwrite their object names, such as in \texttt{letters\ \textless{}-\ \textquotesingle{}other\ char\textquotesingle{}}, but this is not advised. You never know where it is being used.

Other constant \texttt{character} objects in R are \texttt{month.abb}, which shows an abbreviation of months and \texttt{month.name}. Their content is presented next. \index{constants!month.abb} \index{constants!letters} \index{constants!LETTERS} \index{constants!month.name}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print abbreviation and full names of months}
\KeywordTok{print}\NormalTok{(month.abb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep"
R> [10] "Oct" "Nov" "Dec"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(month.name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "January"   "February"  "March"     "April"    
R>  [5] "May"       "June"      "July"      "August"   
R>  [9] "September" "October"   "November"  "December"
\end{verbatim}

\hypertarget{selecting-pieces-of-a-text-object}{%
\subsection{Selecting Pieces of a Text Object}\label{selecting-pieces-of-a-text-object}}

A common beginner's mistake is to select characters of a text using brackets, as it is done for selecting elements of a vector. Consider the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char object}
\NormalTok{my_char <-}\StringTok{ 'ABCDE'}

\CommentTok{# print its second element (WRONG - RESULT is NA)}
\KeywordTok{print}\NormalTok{(my_char[}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] NA
\end{verbatim}

The \texttt{NA} value indicates the second element of \texttt{my\_char} does not exist. This happens because using square brackets is reserved for accessing the elements of an atomic vector, not characters within a larger text. Watch what happens when we use \texttt{my\_char{[}1{]}}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(my_char[}\DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABCDE"
\end{verbatim}

The result is simply the \emph{ABCDE} text, on the first item of \texttt{my\_char}. To select pieces of text, we need to use function \texttt{stringr::str\_sub} or \texttt{base::substr}: \index{base!substr} \index{stringr!str\_sub}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print third and fourth characters}
\NormalTok{my_substr <-}\StringTok{ }\KeywordTok{str_sub}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ my_char,}
                     \DataTypeTok{start =} \DecValTok{2}\NormalTok{,}
                     \DataTypeTok{end =} \DecValTok{2}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_substr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "B"
\end{verbatim}

These functions also work for atomic vectors. Let's assume you imported text data, and the raw dataset contains a 3-letter identifier of a company, always in the same location of the string. Let's simulate the situation in R:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# build char vec}
\NormalTok{my_char_vec <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'ABC'}\NormalTok{,}\StringTok{'VBC'}\NormalTok{,}\StringTok{'ZMN'}\NormalTok{),}
                      \StringTok{' - other ignorable text'}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_char_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC - other ignorable text"
R> [2] "VBC - other ignorable text"
R> [3] "ZMN - other ignorable text"
\end{verbatim}

Here, we want the information in the first three characters of each element only in \texttt{my\_char\_vec}. To select them, we can use the same functions as before.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get ids with stringr::str_sub}
\NormalTok{ids_vec <-}\StringTok{ }\KeywordTok{str_sub}\NormalTok{(my_char_vec, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\KeywordTok{print}\NormalTok{(ids_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC" "VBC" "ZMN"
\end{verbatim}

\begin{rmdimportant}
\textbf{Vector operations in character objects are very common in R}.
Almost anything you can do to a single element can be expanded to
vectors. This facilitates the development of research scripts as you can
easily perform complicated tasks to a series of elements in a single
line of code.
\end{rmdimportant}

\hypertarget{finding-and-replacing-characters-of-a-text}{%
\subsection{Finding and Replacing Characters of a Text}\label{finding-and-replacing-characters-of-a-text}}

A useful operation in handling texts is to locate specific patterns of text within a \texttt{character} object with functions \texttt{stringr::str\_locate}/\texttt{base::regexpr} and \texttt{stringr::str\_locate\_all}/\texttt{base::gregexpr}. However, before we move on to the examples, it is important to point out that, by default, these functions use expressions of the type \texttt{regex} -- regular expressions \citep{thompson1968programming}. This is a specific format for the identification of patterns in text. When \texttt{regex} is used correctly, it can make your life a lot easier. You'll be able to find complex string patterns effortlessly.

The most common case of string search is to verify the position or the existence of a smaller text within a larger text. For these cases, however, using language \texttt{regex} is unnecessary. Therefore, the location and replacement of characters in the next example is of the fixed type, i.e., without using \texttt{regex}. Such information is passed to the \texttt{stringr} function by setting the \texttt{pattern} input with \texttt{stringr::fixed}, as in \texttt{str\_locate(str\_in,\ pattern\ =\ fixed(\textquotesingle{}pattern\ to\ match\textquotesingle{})}. \index{regex} \index{stringr!fixed} \index{base!regexpr} \index{base!gregexpr} \index{stringr!str\_locate} \index{stringr!str\_locate\_all}

The following example shows how to find the \emph{D} character from a range of characters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set character object}
\NormalTok{my_char <-}\StringTok{ 'ABCDEF-ABCDEF-ABC'}

\CommentTok{# find position of 'D' using str_locate}
\NormalTok{pos <-}\StringTok{ }\KeywordTok{str_locate}\NormalTok{(my_char, }\KeywordTok{fixed}\NormalTok{(}\StringTok{'D'}\NormalTok{))}
\KeywordTok{print}\NormalTok{(pos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      start end
R> [1,]     4   4
\end{verbatim}

Note the \texttt{str\_locate} function returns only the \textbf{first occurrence} of \emph{D}. To locate all instances, we use function \texttt{str\_locate\_all}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set object}
\NormalTok{my_char <-}\StringTok{ 'ABCDEF-ABCDEF-ABC'}

\CommentTok{# find position of ALL 'D' using str_locate_all}
\NormalTok{pos <-}\StringTok{ }\KeywordTok{str_locate_all}\NormalTok{(my_char, }\KeywordTok{fixed}\NormalTok{(}\StringTok{'D'}\NormalTok{))}
\KeywordTok{print}\NormalTok{(pos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R>      start end
R> [1,]     4   4
R> [2,]    11  11
\end{verbatim}

To replace characters in a text, use functions \texttt{str\_replace} and \texttt{str\_replace\_all} from \texttt{stringr} or \texttt{sub} and \texttt{gsub} from the base package. As with previous example, \texttt{stringr::str\_replace} replaces the first occurrence of the character, while \texttt{stringr::str\_replace\_all} performs a global substitution; applies to all matches. Here are the differences: \index{base!sub} \index{base!gsub} \index{stringr!str\_replace} \index{stringr!str\_replace\_all}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char object}
\NormalTok{my_char <-}\StringTok{ 'ABCDEF-ABCDEF-ABC'}

\CommentTok{# substitute the FIRST 'ABC' for 'XXX' with str_replace}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{str_replace}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ my_char,}
                       \DataTypeTok{pattern =} \StringTok{'ABC'}\NormalTok{,}
                       \DataTypeTok{replacement =} \StringTok{'XXX'}\NormalTok{)}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF-ABCDEF-ABC"
\end{verbatim}

And now, we globally substitute characters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char object}
\NormalTok{my_char <-}\StringTok{ 'ABCDEF-ABCDEF-ABC'}

\CommentTok{# substitute ALL 'ABC' for 'XXX' with str_replace_all}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{str_replace_all}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ my_char,}
                           \DataTypeTok{pattern =} \StringTok{'ABC'}\NormalTok{,}
                           \DataTypeTok{replacement =} \StringTok{'XXX'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXXDEF-XXXDEF-XXX"
\end{verbatim}

Again, it is worth pointing out that the operations of replacements of strings also work for vectors. Have a look at the next example.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char object}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'ABCDEF'}\NormalTok{,}\StringTok{'DBCFE'}\NormalTok{,}\StringTok{'ABC'}\NormalTok{)}

\CommentTok{# create an example of vector}
\NormalTok{my_char_vec <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\KeywordTok{sample}\NormalTok{(my_char, }\DecValTok{5}\NormalTok{, }\DataTypeTok{replace =}\NormalTok{ T),}
                     \KeywordTok{sample}\NormalTok{(my_char, }\DecValTok{5}\NormalTok{, }\DataTypeTok{replace =}\NormalTok{ T),}
                     \DataTypeTok{sep =} \StringTok{' - '}\NormalTok{)}

\CommentTok{# show it}
\KeywordTok{print}\NormalTok{(my_char_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC - DBCFE"     "ABCDEF - ABCDEF" "DBCFE - DBCFE"  
R> [4] "ABCDEF - ABC"    "ABCDEF - ABCDEF"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# substitute all occurrences of 'ABC'}
\NormalTok{my_char_vec <-}\StringTok{ }\KeywordTok{str_replace_all}\NormalTok{(}\DataTypeTok{string =}\NormalTok{ my_char_vec,}
                               \DataTypeTok{pattern =} \StringTok{'ABC'}\NormalTok{,}
                               \DataTypeTok{replacement =} \StringTok{'XXX'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_char_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "XXX - DBCFE"     "XXXDEF - XXXDEF" "DBCFE - DBCFE"  
R> [4] "XXXDEF - XXX"    "XXXDEF - XXXDEF"
\end{verbatim}

\hypertarget{splitting-text}{%
\subsection{Splitting Text}\label{splitting-text}}

Eventually, you will need to break a text into different parts. Most of the time, you want to isolate a piece of particular information in the full string by using a delimiter in the text. For example, the text \texttt{\textquotesingle{}ABC;DEF;GHI\textquotesingle{}} has three sub-characters divided by the symbol \texttt{;}. To separate a text into several parts, use \texttt{stringr::str\_split} or \texttt{base::strsplit}. Both functions break the original text into several fractions, according to a chosen delimiter character: \index{base!strsplit} \index{stringr!str\_split}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char}
\NormalTok{my_char <-}\StringTok{ 'ABC;ABC;BCD'}

\CommentTok{# split it based on ';' and using stringr::str_split}
\NormalTok{splitted_char <-}\StringTok{ }\KeywordTok{str_split}\NormalTok{(my_char, }\StringTok{';'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(splitted_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "ABC" "ABC" "BCD"
\end{verbatim}

The output of this function is an object of type \texttt{list}. To access the text \texttt{BCD} in object \texttt{splitted\_char}, we can use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(splitted_char[[}\DecValTok{1}\NormalTok{]][}\DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "BCD"
\end{verbatim}

For an example of a split in character vectors, see the next code.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char}
\NormalTok{my_char_vec <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'ABCDEF'}\NormalTok{,}\StringTok{'DBCFE'}\NormalTok{,}\StringTok{'ABFC'}\NormalTok{,}\StringTok{'ACD'}\NormalTok{)}

\CommentTok{# split it based on 'B' and using stringr::strsplit}
\NormalTok{splitted_char <-}\StringTok{ }\KeywordTok{str_split}\NormalTok{(my_char_vec, }\StringTok{'B'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(splitted_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [[1]]
R> [1] "A"    "CDEF"
R> 
R> [[2]]
R> [1] "D"   "CFE"
R> 
R> [[3]]
R> [1] "A"  "FC"
R> 
R> [[4]]
R> [1] "ACD"
\end{verbatim}

Notice how, again, an object of type \texttt{list} is returned, where each element is the split text from the input vector.

\hypertarget{finding-the-number-of-characters-in-a-text}{%
\subsection{Finding the Number of Characters in a Text}\label{finding-the-number-of-characters-in-a-text}}

If we want to discover the number of characters in a \texttt{character} object, you can use functions \texttt{stringr::str\_length} and \texttt{base::nchar}. Both functions also work for atomic vectors. See the examples below: \index{base!nchar} \index{stringr!str\_length}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char}
\NormalTok{my_char <-}\StringTok{ 'abcdef'}

\CommentTok{# print number of characters using stringr::str_length}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str_length}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 6
\end{verbatim}

And now an example with vectors.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#set char}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'ab'}\NormalTok{, }\StringTok{'abc'}\NormalTok{)}

\CommentTok{# print number of characters using stringr::str_length}
\KeywordTok{print}\NormalTok{(}\KeywordTok{str_length}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3
\end{verbatim}

\hypertarget{generating-combinations-of-text}{%
\subsection{Generating Combinations of Text}\label{generating-combinations-of-text}}

One useful trick in R is to use functions \texttt{outer} and \texttt{expand.grid} to create all possible combinations of elements in different objects. This is useful when you want to create a \texttt{character} vector by combining all possible elements from different vectors. For example, if we wanted to create a vector with all combinations between \texttt{c(\textquotesingle{}a\textquotesingle{},\ \textquotesingle{}b\textquotesingle{})} and \texttt{\textquotesingle{}c(\textquotesingle{}A\textquotesingle{},\textquotesingle{}A\textquotesingle{})} as \texttt{c(\textquotesingle{}a-A\textquotesingle{},\ \textquotesingle{}a-B\textquotesingle{},...)}, we could write:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set char vecs}
\NormalTok{my_vec_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{,}\StringTok{'b'}\NormalTok{)}
\NormalTok{my_vec_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{,}\StringTok{'B'}\NormalTok{)}

\CommentTok{# combine in matrix}
\NormalTok{comb_mat <-}\StringTok{ }\KeywordTok{outer}\NormalTok{(my_vec_}\DecValTok{1}\NormalTok{, my_vec_}\DecValTok{2}\NormalTok{, paste, }\DataTypeTok{sep=}\StringTok{'-'}\NormalTok{)}

\CommentTok{# print it!}
\KeywordTok{print}\NormalTok{(comb_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>      [,1]  [,2] 
R> [1,] "a-A" "a-B"
R> [2,] "b-A" "b-B"
\end{verbatim}

The output of \texttt{outer} is a \texttt{matrix} type of object. If we wanted to change \texttt{comb\_mat} to an atomic vector, we can use function \texttt{as.character}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(comb_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a-A" "b-A" "a-B" "b-B"
\end{verbatim}

Another way to reach the same objective is by using function \texttt{tidyr::expand\_grid} or \texttt{base::expand.grid}. Look at the next example, where we create different phrases based on all combinations of character vectors.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}

\CommentTok{# set vectors}
\NormalTok{my_vec_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'John '}\NormalTok{, }\StringTok{'Claire '}\NormalTok{, }\StringTok{'Adam '}\NormalTok{)}
\NormalTok{my_vec_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'is fishing.'}\NormalTok{, }\StringTok{'is working.'}\NormalTok{)}

\CommentTok{# create df with all combinations}
\NormalTok{my_df <-}\StringTok{ }\KeywordTok{expand_grid}\NormalTok{(}\DataTypeTok{name =}\NormalTok{ my_vec_}\DecValTok{1}\NormalTok{,}
                     \DataTypeTok{verb =}\NormalTok{ my_vec_}\DecValTok{2}\NormalTok{)}

\CommentTok{# print df}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 2
R>   name      verb       
R>   <chr>     <chr>      
R> 1 "John "   is fishing.
R> 2 "John "   is working.
R> 3 "Claire " is fishing.
R> 4 "Claire " is working.
R> 5 "Adam "   is fishing.
R> 6 "Adam "   is working.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# paste columns together in tibble}
\NormalTok{my_df <-}\StringTok{ }\NormalTok{my_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{phrase =} \KeywordTok{paste0}\NormalTok{(name, verb) )}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> # A tibble: 6 x 3
R>   name      verb        phrase            
R>   <chr>     <chr>       <chr>             
R> 1 "John "   is fishing. John is fishing.  
R> 2 "John "   is working. John is working.  
R> 3 "Claire " is fishing. Claire is fishing.
R> 4 "Claire " is working. Claire is working.
R> 5 "Adam "   is fishing. Adam is fishing.  
R> 6 "Adam "   is working. Adam is working.
\end{verbatim}

Here, we used the function \texttt{expand.grid} to create a \texttt{dataframe} containing all possible combinations of \texttt{my\_vec\_1} and \texttt{my\_vec\_2}. We pasted the contents of these columns using \texttt{paste0}.

\hypertarget{encoding-of-character-objects}{%
\subsection{\texorpdfstring{Encoding of \texttt{character} Objects}{Encoding of character Objects}}\label{encoding-of-character-objects}}

For R, a text string is just a sequence of \emph{bytes}. The translation of \emph{bytes} to actual characters is achieved using a particular encoding structure. Most of the time, and especially in English speaking countries, the character encoding is not an issue. However, when dealing with text data from different spoken languages, such as Portuguese, the character encoding is something that you must learn and understand.

Let's explore an example. Here, we will import data from a text file with the \texttt{\textquotesingle{}ISO-8859-9\textquotesingle{}} encoding and check the result.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readr)}

\CommentTok{# read text file}
\NormalTok{my_f <-}\StringTok{ }\NormalTok{afedR}\OperatorTok{::}\KeywordTok{get_data_file}\NormalTok{(}\StringTok{'FileWithLatinChar_Latin1.txt'}\NormalTok{)}

\NormalTok{my_char <-}\StringTok{ }\KeywordTok{read_lines}\NormalTok{(my_f)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A casa \xe9 bonita e tem muito espa\xe7o"
\end{verbatim}

The original content of the file is a text in Portuguese. As you can see, the output of \texttt{readLines} shows all Latin characters as ugly, unreadable symbols. It happens that the encoding of the file has been manually changed to \texttt{\textquotesingle{}ISO-8859-9\textquotesingle{}}, while the \texttt{readLines} function uses \texttt{\textquotesingle{}UTF-8\textquotesingle{}} as \emph{default}.

The easiest solution is to modify input \texttt{locale} of \texttt{readr::read\_lines} so that the function is aware of the different encoding format:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{read_lines}\NormalTok{(my_f, }
                      \DataTypeTok{locale =} \KeywordTok{locale}\NormalTok{(}\DataTypeTok{encoding=}\StringTok{'Latin1'}\NormalTok{))}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A casa  bonita e tem muito espao"
\end{verbatim}

The Latin characters are now correct because the encoding in \texttt{read\_lines} is the same as the file, \texttt{\textquotesingle{}Latin1\textquotesingle{}}. A good policy in this topic is always to check the encoding of imported text files and combine it into R. Most import functions have an option to do so. If you can, give preference to the \texttt{\textquotesingle{}UTF-8\textquotesingle{}} encoding in exporting and importing data, which is the most popular in text files.

\hypertarget{other-useful-functions-3}{%
\subsection{Other Useful Functions}\label{other-useful-functions-3}}

\textbf{stringr::str\_to\_lower}/\textbf{base::tolower} - Converts a string to small caps.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(stringr}\OperatorTok{::}\KeywordTok{str_to_lower}\NormalTok{(}\StringTok{'ABC'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "abc"
\end{verbatim}

\textbf{stringr::str\_to\_upper}/\textbf{base::toupper} - Converts a string to upper caps.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(stringr}\OperatorTok{::}\KeywordTok{str_to_upper}\NormalTok{(}\StringTok{'abc'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "ABC"
\end{verbatim}

\hypertarget{factor-objects}{%
\section{\texorpdfstring{\texttt{Factor} Objects}{Factor Objects}}\label{factor-objects}}

Object class \texttt{factor} is used to represent groups (categories) in a database. Imagine a dataset containing the financial expenses of different people over a whole year. In this database, you find a column that defines the gender of the individual -- male or female. This information can be imported in R as a \texttt{character} object; however, the best way to represent it is by mutating it to class \texttt{factor}.

The \texttt{factor} class integrates nicely with statistical procedures and packages, so the work of dealing with groups becomes easier. For example, if we wanted to create a chart for each group within our database, we could do it by simply telling the graph function that we have a grouping variable of type \texttt{factor}. If we wanted to check whether the medians of different groups are statistically different from each other, all we need to do is to pass the numerical values and the grouping factor to the function that performs the statistical test. When the categories of data are appropriately represented in R, working with them becomes easier and more efficient.

\hypertarget{creating-factors}{%
\subsection{\texorpdfstring{Creating \texttt{factors}}{Creating factors}}\label{creating-factors}}

The creation of factors is accomplished with function \texttt{factor}: \index{base!factor}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'M'}\NormalTok{, }\StringTok{'F'}\NormalTok{, }\StringTok{'M'}\NormalTok{,}
                      \StringTok{'M'}\NormalTok{, }\StringTok{'F'}\NormalTok{, }\StringTok{'F'}\NormalTok{))}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] M F M M F F
R> Levels: F M
\end{verbatim}

Notice that, in the previous example, the presentation of factors with function \texttt{print} shows its content and an extra item called \texttt{Levels}, which identifies the possible groups in the object, in this case, only \texttt{M} and \texttt{F}. If we had a larger number of groups, the item \texttt{Levels} increases. See next: \index{Levels}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create factor with 3 levels}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'M'}\NormalTok{, }\StringTok{'F'}\NormalTok{, }\StringTok{'M'}\NormalTok{, }
                      \StringTok{'M'}\NormalTok{, }\StringTok{'F'}\NormalTok{, }\StringTok{'F'}\NormalTok{,}
                      \StringTok{'ND'}\NormalTok{))}

\CommentTok{# print factor}
\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] M  F  M  M  F  F  ND
R> Levels: F M ND
\end{verbatim}

Here, we also have the \texttt{ND} (not defined) group.

An important point about creating factors is that the \texttt{Levels} are inferred from the data, and that may not correspond to reality. Consider the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set factors with 1 level}
\NormalTok{my_status <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'Single'}\NormalTok{, }\StringTok{'Single'}\NormalTok{, }\StringTok{'Single'}\NormalTok{))}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_status)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] Single Single Single
R> Levels: Single
\end{verbatim}

Accidentally, the data in \texttt{my\_status} only shows one category: \texttt{Single}. However, it is well-known that another category, \texttt{Married}, is expected. If we used \texttt{my\_status} as it is, we might omit important information, and that may cause problems in future parts of the code. The correct procedure is to define the \texttt{Levels} mannualy, as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_status <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'Single'}\NormalTok{, }\StringTok{'Single'}\NormalTok{, }\StringTok{'Single'}\NormalTok{),}
                    \DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{'Single'}\NormalTok{, }\StringTok{'Married'}\NormalTok{))}

\KeywordTok{print}\NormalTok{(my_status)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] Single Single Single
R> Levels: Single Married
\end{verbatim}

\hypertarget{modifying-factors}{%
\subsection{\texorpdfstring{Modifying \texttt{factors}}{Modifying factors}}\label{modifying-factors}}

An important point about the \texttt{factor} type of objects is their \texttt{Levels} are immutable and will not update with the input of new data. You cannot modify the \texttt{Levels} after the creation of a \texttt{factor}. All new groups not in the current \texttt{Levels} will be transformed into \texttt{NA} (\emph{not available} ) and a \texttt{warning} message will appear on the screen. This behavior may seem strange, at first, but it avoids possible errors in the code. See the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{, }\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{))}

\CommentTok{# change first element of a factor to 'c'}
\NormalTok{my_factor[}\DecValTok{1}\NormalTok{] <-}\StringTok{ 'c'}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Warning in `[<-.factor`(`*tmp*`, 1, value = "c"): invalid
R> factor level, NA generated
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] <NA> b    a    b   
R> Levels: a b
\end{verbatim}

As we expected, the first element of \texttt{my\_factor} becomes an \texttt{NA}. Here, the proper way to add a new factor is to first transform the \texttt{factor} object to a \texttt{character} object, change the content and, finally, change the class back from \texttt{character} to \texttt{factor}. \index{base!as.character}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{, }\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{))}

\CommentTok{# change factor to character}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(my_factor)}

\CommentTok{# change first element}
\NormalTok{my_char[}\DecValTok{1}\NormalTok{] <-}\StringTok{ 'c'}

\CommentTok{# mutate it back to class factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(my_char)}

\CommentTok{# show result}
\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] c b a b
R> Levels: a b c
\end{verbatim}

Using these steps, we have the desired result in vector \texttt{my\_factor}, with three \texttt{Levels}: \texttt{a}, \texttt{b} and \texttt{c}.

The \texttt{tidyverse} universe also has its own package for handling factors: \texttt{forcats}. For the current factor modification problem, we can use \texttt{forcats::fct\_recode} function. Here's an example where we change the values of factors and levels: \index{forcats!fct\_recode}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(forcats)}

\CommentTok{# set factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{, }\StringTok{'B'}\NormalTok{, }\StringTok{'C'}\NormalTok{, }
                      \StringTok{'A'}\NormalTok{, }\StringTok{'C'}\NormalTok{, }\StringTok{'M'}\NormalTok{, }
                      \StringTok{'N'}\NormalTok{))}

\CommentTok{# modify factors}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{fct_recode}\NormalTok{(my_factor,}
                        \StringTok{'D'}\NormalTok{ =}\StringTok{ 'A'}\NormalTok{,}
                        \StringTok{'E'}\NormalTok{ =}\StringTok{ 'B'}\NormalTok{,}
                        \StringTok{'F'}\NormalTok{ =}\StringTok{ 'C'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] D E F D F M N
R> Levels: D E F M N
\end{verbatim}

Using \texttt{forcats::fct\_recode} is intuitive. All we need to do is to set the new names with the equality symbol.

\hypertarget{converting-factors-to-other-classes}{%
\subsection{\texorpdfstring{Converting \texttt{factors} to Other Classes}{Converting factors to Other Classes}}\label{converting-factors-to-other-classes}}

Attention is required when converting a \texttt{factor} to another class. When converting a \texttt{factor} to the \texttt{character} class, the result is as expected:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create factor}
\NormalTok{my_char <-}\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{, }\StringTok{'b'}\NormalTok{, }\StringTok{'c'}\NormalTok{))}

\CommentTok{# convert and print}
\KeywordTok{print}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c"
\end{verbatim}

However, when the same procedure is performed for conversion from \texttt{factor} to the \texttt{numeric} class, the result is far from expected: \index{base!as.numeric}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set factor}
\NormalTok{my_values <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\DecValTok{5}\OperatorTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{# convert to numeric (WRONG)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(my_values))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 4 5 6
\end{verbatim}

As you can see, all elements in \texttt{my\_values} were converted to \texttt{c(1,\ 2,\ 3,\ 4,\ 5)}, which are obviously wrong. It happens that, internally, \texttt{factors} are stored as numerical counters, ranging from 1 to the total number of \texttt{Levels}. This simple transformation minimizes the use of computer memory. When we asked R to transform the \texttt{factor} object into numbers, it returned the values of the counters, not the actual numbers stored as \texttt{factors}. Solving this problem and getting the result we want is easy; just turn the \texttt{factor} object into a \texttt{character} and then to \texttt{numeric}, as shown next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# converting factors to character and then to numeric}
\KeywordTok{print}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(my_values)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  5  6  7  8  9 10
\end{verbatim}

\begin{rmdcaution}
\textbf{Always be careful when transforming factors into numbers}. This
bug is hard to catch and may go unnoticed until it breaks your code or
jeopardizes your analysis. Remember that, internally, R converts a
numerical factor to its index level number, and not the actual number.
\end{rmdcaution}

\hypertarget{creating-contingency-tables}{%
\subsection{Creating Contingency Tables}\label{creating-contingency-tables}}

After creating a factor, we can find the number of times that each group, or combination of groups, is found with function \texttt{table}. This is also called a contingency table. In a simple case, with only one factor, function \texttt{table} counts the number of occurrences of each category: \index{base!table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create factor}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'Pref'}\NormalTok{, }\StringTok{'Ord'}\NormalTok{),}
                           \DataTypeTok{size =} \DecValTok{20}\NormalTok{,}
                           \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{))}

\CommentTok{# print contingency table}
\KeywordTok{print}\NormalTok{(}\KeywordTok{table}\NormalTok{(my_factor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> my_factor
R>  Ord Pref 
R>   10   10
\end{verbatim}

A more advanced usage of function \texttt{table} is to consider more than one \texttt{factor}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set factors}
\NormalTok{my_factor_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'Pref'}\NormalTok{, }\StringTok{'Ord'}\NormalTok{),}
                             \DataTypeTok{size =} \DecValTok{20}\NormalTok{,}
                             \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{))}

\NormalTok{my_factor_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'Group'}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{),}
                             \DataTypeTok{size =} \DecValTok{20}\NormalTok{,}
                             \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{))}

\CommentTok{# print contingency table with two factors}
\KeywordTok{print}\NormalTok{(}\KeywordTok{table}\NormalTok{(my_factor_}\DecValTok{1}\NormalTok{, }
\NormalTok{            my_factor_}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>            my_factor_2
R> my_factor_1 Group 1 Group 2 Group 3
R>        Ord        4       2       8
R>        Pref       1       1       4
\end{verbatim}

The table that we created previously demonstrates the number of occurrences for each combination of groups. Therefore, it is worth knowing you can also use it with more than two factors.

\hypertarget{other-useful-functions-4}{%
\subsection{Other Useful Functions}\label{other-useful-functions-4}}

\textbf{levels} - Returns the \texttt{Levels} an object of class \texttt{factor}. \index{base!levels}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{, }\StringTok{'A'}\NormalTok{, }\StringTok{'B'}\NormalTok{, }\StringTok{'C'}\NormalTok{, }\StringTok{'B'}\NormalTok{))}
\KeywordTok{print}\NormalTok{(}\KeywordTok{levels}\NormalTok{(my_factor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "A" "B" "C"
\end{verbatim}

\textbf{as.factor} - Transforms an object to the class \texttt{factor}. \index{base!as.factor}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'a'}\NormalTok{,}\StringTok{'b'}\NormalTok{, }\StringTok{'c'}\NormalTok{, }\StringTok{'c'}\NormalTok{, }\StringTok{'a'}\NormalTok{)}
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(my_y)}

\KeywordTok{print}\NormalTok{(my_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] a b c c a
R> Levels: a b c
\end{verbatim}

\textbf{split} - Based on a grouping variable and another vector, creates a list with subsets of groups of the target object. This function is best used to separate different samples according to groups. \index{base!split}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_factor <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'A'}\NormalTok{,}\StringTok{'B'}\NormalTok{,}\StringTok{'C'}\NormalTok{,}\StringTok{'C'}\NormalTok{,}\StringTok{'C'}\NormalTok{,}\StringTok{'B'}\NormalTok{))}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(my_factor)}

\NormalTok{my_l <-}\StringTok{ }\KeywordTok{split}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_x, }\DataTypeTok{f =}\NormalTok{ my_factor)}

\KeywordTok{print}\NormalTok{(my_l)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> $A
R> [1] 1
R> 
R> $B
R> [1] 2 6
R> 
R> $C
R> [1] 3 4 5
\end{verbatim}

\hypertarget{logical-objects}{%
\section{\texorpdfstring{\texttt{Logical} Objects}{Logical Objects}}\label{logical-objects}}

Logical tests are at the heart of R. In one line of code, and we can test a condition for a large vector of data. This procedure is commonly used to find outliers in a dataset or to split the sample according to some condition, such as a particular period.

\hypertarget{creating-logical-objects}{%
\subsection{\texorpdfstring{Creating \texttt{logical} Objects}{Creating logical Objects}}\label{creating-logical-objects}}

Objects of class \texttt{logical} are created based on the use of condition tests on other objects. For example, in a sequence from 1 to 10, we can check what elements are higher than five with the following code:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set numerical}
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}

\CommentTok{# print a logical test}
\KeywordTok{print}\NormalTok{(my_x }\OperatorTok{>}\StringTok{ }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
R> [10]  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print position of elements from logical test}
\KeywordTok{print}\NormalTok{(}\KeywordTok{which}\NormalTok{(my_x }\OperatorTok{>}\StringTok{ }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  6  7  8  9 10
\end{verbatim}

In the previous example, function \texttt{which} returned the index (position) where the condition is true (\texttt{TRUE}). \index{base!which}

To perform equality tests, simply use the equality symbol twice (\textbf{\texttt{==}}): \index{base!"==}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create char}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{'abc'}\NormalTok{, }\StringTok{'bcd'}\NormalTok{), }
               \DataTypeTok{times =} \DecValTok{5}\NormalTok{)}

\CommentTok{# print its contents}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc"
R> [10] "bcd"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print logical test}
\KeywordTok{print}\NormalTok{(my_char }\OperatorTok{==}\StringTok{ 'abc'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE
R> [10] FALSE
\end{verbatim}

For an inequality test, use symbol \textbf{\texttt{!=}}, as shown in the next code: \index{base!"!=}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print inequality test}
\KeywordTok{print}\NormalTok{(my_char }\OperatorTok{!=}\StringTok{ 'abc'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
R> [10]  TRUE
\end{verbatim}

It is also possible to test multiple logical conditions. For simultaneous occurrences of events, use operator \texttt{\&}. For example, if we wanted to check the values from a sequence between 1 and 10 that are larger than 4 \textbf{and} smaller than 7, we write: \index{base!and}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_x <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{10}

\CommentTok{# print logical for values higher than 4 and lower than 7}
\KeywordTok{print}\NormalTok{((my_x }\OperatorTok{>}\StringTok{ }\DecValTok{4}\NormalTok{)}\OperatorTok{&}\NormalTok{(my_x }\OperatorTok{<}\StringTok{ }\DecValTok{7}\NormalTok{) )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
R> [10] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print the actual values}
\NormalTok{idx <-}\StringTok{ }\KeywordTok{which}\NormalTok{( (my_x }\OperatorTok{>}\StringTok{ }\DecValTok{4}\NormalTok{)}\OperatorTok{&}\NormalTok{(my_x }\OperatorTok{<}\StringTok{ }\DecValTok{7}\NormalTok{) )}
\KeywordTok{print}\NormalTok{(my_x[idx])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 5 6
\end{verbatim}

For non-simultaneous conditions, i.e., the occurrence of one event or other, use the operator \texttt{\textbar{}}. For instance, considering the previous sequence, we can find the values greater than 7 \textbf{or} lower than four by writing: \index{base!"|}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# location of elements higher than 7 or lower than 4}
\NormalTok{idx <-}\StringTok{ }\KeywordTok{which}\NormalTok{( (my_x }\OperatorTok{>}\StringTok{ }\DecValTok{7}\NormalTok{)}\OperatorTok{|}\NormalTok{(my_x }\OperatorTok{<}\StringTok{ }\DecValTok{4}\NormalTok{) )}

\CommentTok{# print elements from previous condition}
\KeywordTok{print}\NormalTok{(my_x[idx])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  1  2  3  8  9 10
\end{verbatim}

Be aware that we used parentheses to encapsulate the logical conditions for both cases. Although it is not strictly necessary, it is a good coding practice. We could have used \texttt{idx\ \textless{}-\ which(my\_x\ \textgreater{}\ 7\ \textbar{}\ my\_x\ \textless{}\ 4)} for the same result but, using parentheses makes the code cleaner by isolating the logical tests.

Another interesting use of logical objects is to test whether an item or more is found or not in another vector. For this, we use the operator \texttt{\%in\%}. For example, suppose you have the names of two countries, \texttt{c(\textquotesingle{}Country\ 1\textquotesingle{},\ \textquotesingle{}Country\ 2\textquotesingle{})}, and you want to know if you can find the same countries in another vector. This is an operation similar to using the equality test but in vector notation. Here's an example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\CommentTok{# location of elements higher than 7 or lower than 4}
\NormalTok{my_contries <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Country 1'}\NormalTok{, }\StringTok{'Country 2'}\NormalTok{)}

\CommentTok{# set df}
\NormalTok{n_obs <-}\StringTok{ }\DecValTok{100}
\NormalTok{df_temp <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{country =} \KeywordTok{str_c}\NormalTok{(}\StringTok{'Country '}\NormalTok{,}
                                  \KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{, }
                                         \DataTypeTok{size =}\NormalTok{ n_obs,}
                                         \DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{)),}
                  \DataTypeTok{inflation.rate =} \KeywordTok{rnorm}\NormalTok{(n_obs, }\DataTypeTok{sd =} \FloatTok{0.05}\NormalTok{) ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 100
R> Columns: 2
R> $ country        <chr> "Country 3", "Country 1", "Country ~
R> $ inflation.rate <dbl> -0.037301808, -0.060783522, -0.0062~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# filter rows of df with selected tickers}
\NormalTok{df_temp <-}\StringTok{ }\NormalTok{df_temp }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{%in%}\StringTok{ }\NormalTok{my_contries) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 18
R> Columns: 2
R> $ country        <chr> "Country 1", "Country 2", "Country ~
R> $ inflation.rate <dbl> -0.060783522, -0.002706447, -0.0193~
\end{verbatim}

The resulting dataframe only has rows for \texttt{\textquotesingle{}Country\ 1\textquotesingle{}} and \texttt{\textquotesingle{}Country\ 2\textquotesingle{}}. With operator \texttt{\%in\%}, we filtered our table so it only keeps the desired rows.

\hypertarget{date-and-time}{%
\section{Date and Time}\label{date-and-time}}

The representation and manipulation of dates is an important aspect of research. When you have dates in your dataset, you must be certain they are correctly represented in R with the correct timezone. In this section, we will give priority to package \texttt{lubridate} \citep{R-lubridate}, which offers efficient and diverse functions for time manipulation. There are, however, many packages that can also help the user. If the reader must perform a date operation not covered here, I suggest looking into packages \texttt{chron} \citep{R-chron}, \texttt{timeDate} \citep{R-timeDate}, and \texttt{bizdays} \citep{R-bizdays}. \index{timeDate} \index{lubridate} \index{bizdays} \index{chron}

\hypertarget{creating-simple-dates}{%
\subsection{Creating Simple Dates}\label{creating-simple-dates}}

In R, several classes can represent dates. The choice between one to another depends on the required precision of time representation. Some situations only require the knowledge of the day (and not time), while in others, the clock time can be very important as the data is collected over a day and knowing the time of day of each data point can affect the research.

The most basic class, indicating the day, month, and year, is \texttt{Date}. Using package \texttt{lubridate}, we create a date class object with functions \texttt{ymd} (year-month-date), \texttt{dmy} (day-month-year) e \texttt{mdy} (month-day-year). The order of components, and choice of function, is set according to the input character. Have a look: \index{lubridate!ymd} \index{lubridate!dmy} \index{lubridate!mdy}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# set Date object (YMD)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-06-24'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object (DMY)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{dmy}\NormalTok{(}\StringTok{'24-06-2020'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object (MDY)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{mdy}\NormalTok{(}\StringTok{'06-24-2020'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

Note that the functions return the exact same object. The difference in usage is only by the way the input string is structured with the position of the day, month, and year.

One benefit of using the \texttt{lubridate} package is that its functions are smart when dealing with different formats. You should note that we defined the data elements using the dash (\texttt{-}) separator and numeric values, as in \texttt{\textquotesingle{}2020-06-24\textquotesingle{}} in the previous case. Other formats are also automatically recognized:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object }
\KeywordTok{print}\NormalTok{(}\KeywordTok{ymd}\NormalTok{(}\StringTok{'2020/06/24'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object }
\KeywordTok{print}\NormalTok{(}\KeywordTok{ymd}\NormalTok{(}\StringTok{'2020&06&24'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object}
\KeywordTok{print}\NormalTok{(}\KeywordTok{ymd}\NormalTok{(}\StringTok{'2020 june 24'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date object}
\KeywordTok{print}\NormalTok{(}\KeywordTok{dmy}\NormalTok{(}\StringTok{'24 of june 2020'}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-06-24"
\end{verbatim}

This is a very useful property of \texttt{lubridate}, making it easy to import date information in different formats.

Now, using the \texttt{base} package, we can create a date with function \texttt{as.Date}: \index{base!as.Date} \index{dates}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set Date from dd/mm/yyyy with the definition of format}
\NormalTok{my_date <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\StringTok{'24/06/2021'}\NormalTok{, }\DataTypeTok{format =} \StringTok{'%d/%m/%Y'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-24"
\end{verbatim}

The symbols used in \emph{input} \texttt{format}, such as \texttt{\%d}, \texttt{\%m}, and \texttt{\%Y}, indicate how the character object should be converted and where the day, month and year are in the text. Likewise, many other symbols may be used for processing dates in specific formats. An overview of the main symbols is given next.

\begin{longtable}[]{@{}ccc@{}}
\toprule
Symbol & Description & Example\tabularnewline
\midrule
\endhead
\%d & day of month (decimal) & 0\tabularnewline
\%m & month (decimal) & 12\tabularnewline
\%b & month (abbreviation) & Apr\tabularnewline
\%B & month (complete name) & April\tabularnewline
\%y & year (2 digits) & 16\tabularnewline
\%Y & month (4 digits) & 2020\tabularnewline
\bottomrule
\end{longtable}

By using the previous table, you'll be able to create and represent dates in a vast number of ways. Notice how the \texttt{lubridate} functions, regarding \texttt{base}, are simpler and easier to use.

\hypertarget{creating-a-sequence-of-dates}{%
\subsection{\texorpdfstring{Creating a Sequence of \texttt{Dates}}{Creating a Sequence of Dates}}\label{creating-a-sequence-of-dates}}

An interesting aspect of objects \texttt{Date} is they interact with \texttt{numeric} objects and can be used for logical tests. If we wanted to add a day after a particular date, all we need to do is to add value 1 to the object, as shown next:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create date}
\NormalTok{my_date <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-06-01'}\NormalTok{)}

\CommentTok{# find next day}
\NormalTok{my_date_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{my_date }\OperatorTok{+}\StringTok{ }\DecValTok{1}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_date_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-06-02"
\end{verbatim}

This property also works with vectors, facilitating the creation of \texttt{Date} sequences. See an example next.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create a sequence of Dates}
\NormalTok{my_date_vec <-}\StringTok{ }\NormalTok{my_date }\OperatorTok{+}\StringTok{ }\DecValTok{0}\OperatorTok{:}\DecValTok{15}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_date_vec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2021-06-01" "2021-06-02" "2021-06-03" "2021-06-04"
R>  [5] "2021-06-05" "2021-06-06" "2021-06-07" "2021-06-08"
R>  [9] "2021-06-09" "2021-06-10" "2021-06-11" "2021-06-12"
R> [13] "2021-06-13" "2021-06-14" "2021-06-15" "2021-06-16"
\end{verbatim}

A more customizable way for creating \texttt{Date} sequences is using function \texttt{seq}. It allows the creation of date sequences with custom time intervals or with a fixed vector size. For example, if we wanted a \texttt{Date} sequence every two days, we could use the following code: \index{base!seq}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set first and last Date}
\NormalTok{my_date_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-03-07'}\NormalTok{)}
\NormalTok{my_date_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-03-20'}\NormalTok{)}

\CommentTok{# set sequence}
\NormalTok{my_vec_date <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ my_date_}\DecValTok{1}\NormalTok{,}
                   \DataTypeTok{to =}\NormalTok{ my_date_}\DecValTok{2}\NormalTok{,}
                   \DataTypeTok{by =} \StringTok{'2 days'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_vec_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-07" "2021-03-09" "2021-03-11" "2021-03-13"
R> [5] "2021-03-15" "2021-03-17" "2021-03-19"
\end{verbatim}

Likewise, if we wanted a sequence of dates for every two weeks, we can simply change input \texttt{by} to \texttt{\textquotesingle{}2\ weeks\textquotesingle{}}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set first and last Date}
\NormalTok{my_date_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-03-07'}\NormalTok{)}
\NormalTok{my_date_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-04-20'}\NormalTok{)}

\CommentTok{# set sequence}
\NormalTok{my_vec_date <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ my_date_}\DecValTok{1}\NormalTok{,}
                   \DataTypeTok{to =}\NormalTok{ my_date_}\DecValTok{2}\NormalTok{,}
                   \DataTypeTok{by =} \StringTok{'2 weeks'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_vec_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-07" "2021-03-21" "2021-04-04" "2021-04-18"
\end{verbatim}

Another way to use function \texttt{seq} is by setting the desired length of the sequence of dates. For example, if we wanted an array of dates with 10 elements, we would write:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set dates}
\NormalTok{my_date_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\StringTok{'2021-06-27'}\NormalTok{)}
\NormalTok{my_date_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\StringTok{'2021-07-27'}\NormalTok{)}

\CommentTok{# set sequence with 10 elements}
\NormalTok{my_vec_date <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ my_date_}\DecValTok{1}\NormalTok{,}
                   \DataTypeTok{to =}\NormalTok{ my_date_}\DecValTok{2}\NormalTok{,}
                   \DataTypeTok{length.out =} \DecValTok{10}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_vec_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "2021-06-27" "2021-06-30" "2021-07-03" "2021-07-07"
R>  [5] "2021-07-10" "2021-07-13" "2021-07-17" "2021-07-20"
R>  [9] "2021-07-23" "2021-07-27"
\end{verbatim}

Once again, the interval between the dates is automatically defined by the function.

\hypertarget{operations-with-dates}{%
\subsection{\texorpdfstring{Operations with \texttt{Dates}}{Operations with Dates}}\label{operations-with-dates}}

We can calculate difference of days between two dates by simply subtracting one from the other. Have a look:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set dates}
\NormalTok{my_date_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2015-06-24'}\NormalTok{)}
\NormalTok{my_date_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-06-24'}\NormalTok{)}

\CommentTok{# calculate difference}
\NormalTok{diff_date <-}\StringTok{ }\NormalTok{my_date_}\DecValTok{2} \OperatorTok{-}\StringTok{ }\NormalTok{my_date_}\DecValTok{1}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(diff_date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Time difference of 1827 days
\end{verbatim}

The output of the subtraction operation is an object of class \texttt{diffdate}. Just like in a \texttt{list}, we can access its elements using double brackets. The numerical value of the difference of days is contained in the first element of \texttt{diff\_date}: \index{diffdate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print difference of days as numerical value}
\KeywordTok{print}\NormalTok{(diff_date[[}\DecValTok{1}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1827
\end{verbatim}

Going further, we can also use mathematical operators to test whether a date is more recent or not than another:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set date and vector}
\NormalTok{my_date_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-06-20'}\NormalTok{)}
\NormalTok{my_date_vec <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-06-20'}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{)}

\CommentTok{# test which elements of my_date_vec are older than my_date_1}
\NormalTok{my.test <-}\StringTok{ }\NormalTok{(my_date_vec }\OperatorTok{>}\StringTok{ }\NormalTok{my_date_}\DecValTok{1}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my.test)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
R> [10]  TRUE  TRUE
\end{verbatim}

The previous operation is useful when selecting a certain period of time in your dataset. This is a common practice in research. We set the first and last dates of the period we are interested in and use a logical test to find all dates in between:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# set first and last dates}
\NormalTok{first_date <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-06-01'}\NormalTok{)}
\NormalTok{last_date <-}\StringTok{ }\KeywordTok{ymd}\NormalTok{(}\StringTok{'2021-06-15'}\NormalTok{)}

\CommentTok{# create dataframe and glimpse it}
\NormalTok{my_temp_df <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{date.vec =} \KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-05-25'}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{30}\NormalTok{),}
                     \DataTypeTok{prices=}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{,}
                                \DataTypeTok{length.out =} \KeywordTok{length}\NormalTok{(date.vec)))}

\CommentTok{# find dates that are between the first and last date}
\NormalTok{my_idx <-}\StringTok{ }\NormalTok{(my_temp_df}\OperatorTok{$}\NormalTok{date.vec }\OperatorTok{>=}\StringTok{ }\NormalTok{first_date) }\OperatorTok{&}
\StringTok{  }\NormalTok{(my_temp_df}\OperatorTok{$}\NormalTok{date.vec }\OperatorTok{<=}\StringTok{ }\NormalTok{last_date)}

\CommentTok{# use index to filter dataframe}
\NormalTok{my_temp_df_filtered <-}\StringTok{ }\NormalTok{my_temp_df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(my_idx) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Rows: 0
R> Columns: 2
R> $ date.vec <date> 
R> $ prices   <dbl>
\end{verbatim}

In the previous code, the object \texttt{my\_temp\_df\_filtered} will only contain rows for the time period between 2021-06-01 and 2021-06-15.

\hypertarget{dealing-with-time}{%
\subsection{Dealing with Time}\label{dealing-with-time}}

Using the \texttt{Date} class is sufficient when dealing only with days, and the hours are irrelevant. When it is necessary to consider time, we have to use an object of type \texttt{datetime}. \index{datetime}

In the \texttt{base} package, one class used for this purpose is \texttt{POSIXlt}, which stores the contents of a date as a list. Another class is \texttt{POSIXct}, which stores dates as seconds counted from \texttt{1970-01-01}. Due to its storage format, the \texttt{POSIXct} class takes up less computer memory and is the one used in package \texttt{lubridate}. Given that, we will prioritize it in these sections. Worth knowing that all examples presented here can also be replicated with the \texttt{POSIXlt} class.

In R, the time/date format also follows the \href{https://www.iso.org/iso-8601-date-and-time-format.html}{ISO 8601 standard}\footnote{\url{https://www.iso.org/iso-8601-date-and-time-format.html}} and is represented as ``year-month-day hours:minutes:seconds timezone'' (YYYY-MM-DD HH:mm:SS TMZ). See the following example:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# creating a POSIXct object}
\NormalTok{my_timedate <-}\StringTok{ }\KeywordTok{as.POSIXct}\NormalTok{(}\StringTok{'2021-01-01 16:00:00'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_timedate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-01-01 16:00:00 -03"
\end{verbatim}

The \texttt{lubridate} package also offers intelligent functions for creating date-time objects. These follow the same structural intuition as the date creation functions.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# creating a POSIXlt object}
\NormalTok{my_timedate <-}\StringTok{ }\KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 16:00:00'}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_timedate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-01-01 16:00:00 UTC"
\end{verbatim}

You should note that this class automatically adds the time zone from the operating system. If you need to represent a different time zone, you can do so with the \texttt{tz} argument:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# creating a POSIXlt object with custom timezone}
\NormalTok{my_timedate_tz <-}\StringTok{ }\KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 16:00:00'}\NormalTok{,}
                          \DataTypeTok{tz =} \StringTok{'GMT'}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_timedate_tz)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-01-01 16:00:00 GMT"
\end{verbatim}

An important note in the case of \texttt{POSIXlt} and \texttt{POSIXct} objects, \textbf{the operations of sum and subtraction refer to seconds}, not days, as with objects from the \texttt{Date} class:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Adding values (seconds) to a POSIXlt object and printing it}
\KeywordTok{print}\NormalTok{(my_timedate_tz }\OperatorTok{+}\StringTok{ }\DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2020-01-01 16:00:30 GMT"
\end{verbatim}

\hypertarget{customizing-the-format-of-dates-and-times}{%
\subsection{Customizing the Format of Dates and Times}\label{customizing-the-format-of-dates-and-times}}

The ISO format for representing dates and \texttt{datetime} object in R may not be what we need. When writing reports, using a date-time format different than the local one can unnecessarily generate confusion in your audience.

In the same way as objects of class \texttt{Date}, there are specific symbols for dealing with components of a \texttt{POSIXlt} object. Next, we have a table with the main symbols and their meanings.

\begin{longtable}[]{@{}ccc@{}}
\toprule
Symbol & Description & Example\tabularnewline
\midrule
\endhead
\%H & Hour (decimal, 24 hours) & 23\tabularnewline
\%I & Hour (decimal, 12 hours) & 11\tabularnewline
\%M & Minutes (decimal, 0-59) & 12\tabularnewline
\%p & AM/PM indicator & AM\tabularnewline
\%S & Seconds (decimal, 0-59) & 50\tabularnewline
\bottomrule
\end{longtable}

To format a date, use the \texttt{format} function. Using the symbols presented in the previous table, the user can create any desired customization. See the following example, where we change a date vector to the American format (MM/DD/YYYY): \index{base!format}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create vector of dates}
\NormalTok{my_dates <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2020-01-01'}\NormalTok{),}
                \DataTypeTok{to =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2020-01-15'}\NormalTok{),}
                \DataTypeTok{by =} \StringTok{'1 day'}\NormalTok{)}

\CommentTok{# change format}
\NormalTok{my_dates_US_format <-}\StringTok{ }\KeywordTok{format}\NormalTok{(my_dates, }\StringTok{'%m/%d/%Y'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_dates_US_format)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "01/01/2020" "01/02/2020" "01/03/2020" "01/04/2020"
R>  [5] "01/05/2020" "01/06/2020" "01/07/2020" "01/08/2020"
R>  [9] "01/09/2020" "01/10/2020" "01/11/2020" "01/12/2020"
R> [13] "01/13/2020" "01/14/2020" "01/15/2020"
\end{verbatim}

The same procedure can be used for \texttt{POSIXlt} objects:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create vector of date-time}
\NormalTok{my_datetime <-}\StringTok{ }\KeywordTok{as.POSIXlt}\NormalTok{(}\StringTok{'2020-02-01 12:00:00'}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{560}\NormalTok{,}\DecValTok{60}\NormalTok{)}

\CommentTok{# change to US format}
\NormalTok{my_dates_US_format <-}\StringTok{ }\KeywordTok{format}\NormalTok{(my_datetime, }\StringTok{'%m/%d/%Y %H:%M:%S'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_dates_US_format)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "02/01/2020 12:00:00" "02/01/2020 12:01:00"
R>  [3] "02/01/2020 12:02:00" "02/01/2020 12:03:00"
R>  [5] "02/01/2020 12:04:00" "02/01/2020 12:05:00"
R>  [7] "02/01/2020 12:06:00" "02/01/2020 12:07:00"
R>  [9] "02/01/2020 12:08:00" "02/01/2020 12:09:00"
\end{verbatim}

Likewise, we can customize our dates for very specific formats:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set custom format}
\NormalTok{my_dates_my_format <-}\StringTok{ }\KeywordTok{format}\NormalTok{(my_dates,}
                             \StringTok{'Year=%Y | Month=%m | Day=%d'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_dates_my_format)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Year=2020 | Month=01 | Day=01"
R>  [2] "Year=2020 | Month=01 | Day=02"
R>  [3] "Year=2020 | Month=01 | Day=03"
R>  [4] "Year=2020 | Month=01 | Day=04"
R>  [5] "Year=2020 | Month=01 | Day=05"
R>  [6] "Year=2020 | Month=01 | Day=06"
R>  [7] "Year=2020 | Month=01 | Day=07"
R>  [8] "Year=2020 | Month=01 | Day=08"
R>  [9] "Year=2020 | Month=01 | Day=09"
R> [10] "Year=2020 | Month=01 | Day=10"
R> [11] "Year=2020 | Month=01 | Day=11"
R> [12] "Year=2020 | Month=01 | Day=12"
R> [13] "Year=2020 | Month=01 | Day=13"
R> [14] "Year=2020 | Month=01 | Day=14"
R> [15] "Year=2020 | Month=01 | Day=15"
\end{verbatim}

\hypertarget{extracting-elements-of-a-date}{%
\subsection{Extracting Elements of a Date}\label{extracting-elements-of-a-date}}

We can use function \texttt{format} to extract data elements such as the year, month, day, hour, minute and second. Look at the next example, where we retrieve only the hours of a \texttt{POSIXct} object: \index{base!format}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(lubridate)}

\CommentTok{# create vector of date-time}
\NormalTok{my_datetime <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 12:00:00'}\NormalTok{),}
                   \DataTypeTok{to =} \KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 18:00:00'}\NormalTok{),}
                   \DataTypeTok{by =} \StringTok{'1 hour'}\NormalTok{)}

\CommentTok{# get hours from POSIXlt}
\NormalTok{my_hours <-}\StringTok{ }\KeywordTok{format}\NormalTok{(my_datetime, }\StringTok{'%H'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_hours)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "12" "13" "14" "15" "16" "17" "18"
\end{verbatim}

Likewise, we can use symbols \texttt{\%M} and \texttt{\%S} to extract the hours, minutes and seconds of a \texttt{POSIXct} object:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create vector of date-time}
\NormalTok{n_dates <-}\StringTok{ }\DecValTok{10}
\NormalTok{my_datetime <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 12:00:00'}\NormalTok{),}
                   \DataTypeTok{to =} \KeywordTok{ymd_hms}\NormalTok{(}\StringTok{'2020-01-01 18:00:00'}\NormalTok{),}
                   \DataTypeTok{length.out =}\NormalTok{ n_dates) }\OperatorTok{+}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{59}\NormalTok{, }
                                                  \DataTypeTok{size =}\NormalTok{ n_dates)}

\CommentTok{# get minutes from POSIXlt}
\NormalTok{my_minutes <-}\StringTok{ }\KeywordTok{format}\NormalTok{(my_datetime, }\StringTok{'%M'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_minutes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "00" "40" "20" "00" "40" "20" "00" "40" "20" "00"
\end{verbatim}

Alternatively, we can use \texttt{lubridate} functions such as \texttt{hour} and \texttt{minute}: \index{lubridate!hour} \index{lubridate!minute}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get hours with lubridate}
\KeywordTok{print}\NormalTok{(}\KeywordTok{hour}\NormalTok{(my_datetime))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 12 12 13 14 14 15 16 16 17 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get minutes with lubridate}
\KeywordTok{print}\NormalTok{(}\KeywordTok{minute}\NormalTok{(my_datetime))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  0 40 20  0 40 20  0 40 20  0
\end{verbatim}

Functions for extracting other components of a date, such as \texttt{lubridate::year} and \texttt{lubridate::second}, are also available.

\hypertarget{find-the-current-date-and-time}{%
\subsection{Find the Current Date and Time}\label{find-the-current-date-and-time}}

R also allows the user to find the current date and time from the operating system. This is particularly useful when it is important for the user to know the date and time when the code was executed.

If you want to find the present day, use function \texttt{base::Sys.Date} or \texttt{lubridate::today} \index{base!Sys.Date} \index{lubridate!today}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get today from base}
\KeywordTok{print}\NormalTok{(}\KeywordTok{Sys.Date}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-30"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get today from lubridate}
\KeywordTok{print}\NormalTok{(lubridate}\OperatorTok{::}\KeywordTok{today}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-30"
\end{verbatim}

If you want to find the current date and time, we use function \texttt{base::Sys.time} or \texttt{lubridate::now}: \index{base!Sys.time} \index{lubridate!now}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get time from base}
\KeywordTok{print}\NormalTok{(}\KeywordTok{Sys.time}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-30 11:32:54 -03"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get time from lubridate}
\KeywordTok{print}\NormalTok{(lubridate}\OperatorTok{::}\KeywordTok{now}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "2021-03-30 11:32:54 -03"
\end{verbatim}

Going further, based on these functions, we can write:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# example of log message}
\NormalTok{my_sys_info <-}\StringTok{ }\KeywordTok{Sys.info}\NormalTok{()}
\NormalTok{my_str <-}\StringTok{ }\KeywordTok{str_c}\NormalTok{(}\StringTok{'Log of execution}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{,}
                \StringTok{'Time of execution: '}\NormalTok{, }\KeywordTok{now}\NormalTok{(), }\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{,}
                \StringTok{'User: '}\NormalTok{, my_sys_info[}\StringTok{'user'}\NormalTok{], }\StringTok{'}\CharTok{\textbackslash{}n}\StringTok{'}\NormalTok{,}
                \StringTok{'Computer: '}\NormalTok{, my_sys_info[}\StringTok{'nodename'}\NormalTok{])}

\CommentTok{# print it}
\KeywordTok{cat}\NormalTok{(my_str)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> Log of execution
R> Time of execution: 2021-03-30 11:32:54
R> User: msperlin
R> Computer: msperlin-Inspiron-5557
\end{verbatim}

This is the exact time when this book was compiled in its final version. Notice we also got some details regarding username and computer with function \texttt{Sys.info}.

\hypertarget{other-useful-functions-5}{%
\subsection{Other Useful Functions}\label{other-useful-functions-5}}

\textbf{weekdays} - Returns the day of the week from one or more dates. \index{base!weekdays}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set date vector}
\NormalTok{my_dates <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-01-01'}\NormalTok{),}
                \DataTypeTok{to =} \KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-01-5'}\NormalTok{),}
                \DataTypeTok{by =} \StringTok{'1 day'}\NormalTok{)}

\CommentTok{# find corresponding weekdays}
\NormalTok{my_weekdays <-}\StringTok{ }\KeywordTok{weekdays}\NormalTok{(my_dates)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_weekdays)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Wednesday" "Thursday"  "Friday"    "Saturday" 
R> [5] "Sunday"
\end{verbatim}

\textbf{months} - Returns the month of one or more dates. \index{base!months}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create date vector}
\NormalTok{my_dates <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-01-01'}\NormalTok{),}
                \DataTypeTok{to =} \KeywordTok{ymd}\NormalTok{(}\StringTok{'2020-12-31'}\NormalTok{),}
                \DataTypeTok{by =} \StringTok{'1 month'}\NormalTok{)}

\CommentTok{# find months}
\NormalTok{my_months <-}\StringTok{ }\KeywordTok{months}\NormalTok{(my_dates)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_months)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "January"   "February"  "March"     "April"    
R>  [5] "May"       "June"      "July"      "August"   
R>  [9] "September" "October"   "November"  "December"
\end{verbatim}

\textbf{quarters} - Returns the location of one or more dates within the year quartiles. \index{base!quarters}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get quartiles of the year}
\NormalTok{my_quarters <-}\StringTok{ }\KeywordTok{quarters}\NormalTok{(my_dates)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_quarters)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] "Q1" "Q1" "Q1" "Q2" "Q2" "Q2" "Q3" "Q3" "Q3" "Q4" "Q4"
R> [12] "Q4"
\end{verbatim}

\textbf{OlsonNames} - Returns an array with the time zones available in R. In total, there are over 500 items. Here, we present only the first five elements. \index{base!OlsonNames}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# get possible timezones}
\NormalTok{possible_tz <-}\StringTok{ }\KeywordTok{OlsonNames}\NormalTok{()}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(possible_tz[}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "Africa/Abidjan"     "Africa/Accra"      
R> [3] "Africa/Addis_Ababa" "Africa/Algiers"    
R> [5] "Africa/Asmara"
\end{verbatim}

\textbf{Sys.timezone} - Returns the current timezone of the operating system. \index{base!Sys.timezone}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{Sys.timezone}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "America/Sao_Paulo"
\end{verbatim}

\textbf{cut} - Returns a factor by grouping dates and time. \index{base!cut}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set example date vector}
\NormalTok{my_dates <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2020-01-01'}\NormalTok{),}
                \DataTypeTok{to =} \KeywordTok{as.Date}\NormalTok{(}\StringTok{'2020-03-01'}\NormalTok{),}
                \DataTypeTok{by =} \StringTok{'5 days'}\NormalTok{)}

\CommentTok{# group vector based on monthly breaks}
\NormalTok{my_month_cut <-}\StringTok{ }\KeywordTok{cut}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_dates,}
                    \DataTypeTok{breaks =} \StringTok{'month'}\NormalTok{,}
                    \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{'Jan'}\NormalTok{, }\StringTok{'Fev'}\NormalTok{, }\StringTok{'Mar'}\NormalTok{))}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_month_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] Jan Jan Jan Jan Jan Jan Jan Fev Fev Fev Fev Fev Mar
R> Levels: Jan Fev Mar
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set example datetime vector}
\NormalTok{my_datetime <-}\StringTok{ }\KeywordTok{as.POSIXlt}\NormalTok{(}\StringTok{'2020-01-01 12:00:00'}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{250}\NormalTok{,}\DecValTok{15}\NormalTok{)}

\CommentTok{# set groups for each 30 seconds}
\NormalTok{my_cut <-}\StringTok{ }\KeywordTok{cut}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ my_datetime, }\DataTypeTok{breaks =} \StringTok{'30 secs'}\NormalTok{)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_cut)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] 2020-01-01 12:00:00 2020-01-01 12:00:00
R>  [3] 2020-01-01 12:00:30 2020-01-01 12:00:30
R>  [5] 2020-01-01 12:01:00 2020-01-01 12:01:00
R>  [7] 2020-01-01 12:01:30 2020-01-01 12:01:30
R>  [9] 2020-01-01 12:02:00 2020-01-01 12:02:00
R> [11] 2020-01-01 12:02:30 2020-01-01 12:02:30
R> [13] 2020-01-01 12:03:00 2020-01-01 12:03:00
R> [15] 2020-01-01 12:03:30 2020-01-01 12:03:30
R> [17] 2020-01-01 12:04:00
R> 9 Levels: 2020-01-01 12:00:00 ... 2020-01-01 12:04:00
\end{verbatim}

\hypertarget{missing-data---na-not-available}{%
\section{\texorpdfstring{Missing Data - \texttt{NA} (\emph{Not available})}{Missing Data - NA (Not available)}}\label{missing-data---na-not-available}}

One of the main innovations of R is the representation of missing data with objects of class \texttt{NA} (\emph{Not Available}). The lack of data can have many reasons, such as failure to collect information or simply the absence of it. These cases are generally treated by removing or replacing the missing information before analyzing the data. The identification of these cases, therefore, is imperative. \index{NA}

\hypertarget{defining-na-values}{%
\subsection{\texorpdfstring{Defining \texttt{NA} Values}{Defining NA Values}}\label{defining-na-values}}

To define omissions in the dataset, use symbol \texttt{NA} without quotes:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# a vector with NA}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  1  2 NA  4  5
\end{verbatim}

An important information that you must remember from previous chapters is that an \texttt{NA} object is contagious. Any object that interacts with an \texttt{NA} will turn into the same class of missing data:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# a vector }
\NormalTok{my_y <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\CommentTok{# example of NA interacting with other objects}
\KeywordTok{print}\NormalTok{(my_x }\OperatorTok{+}\StringTok{ }\NormalTok{my_y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  3  5 NA  8  6
\end{verbatim}

This property demands special attention if you are calculating a value recursively, such as when using functions \texttt{cumsum} and \texttt{cumprod}. In these cases, any value after \texttt{NA} will turn into \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector with NA}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{5}\OperatorTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{# print cumsum (NA after sixth element)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{cumsum}\NormalTok{(my_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]  1  3  6 10 15 NA NA NA NA NA NA NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# print cumprod (NA after sixth element)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{cumprod}\NormalTok{(my_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1]   1   2   6  24 120  NA  NA  NA  NA  NA  NA  NA
\end{verbatim}

Therefore, when using functions \texttt{cumsum} and \texttt{cumprod}, make sure no \texttt{NA} value is found in the input vector.

\begin{rmdcaution}
Every time you use the \texttt{cumsum} and\texttt{cumprod} functions,
make sure that there is no \texttt{NA} value in the input vector.
Remember that every \texttt{NA} is contagious and recursive calculations
will result in a vector full of missing data.
\end{rmdcaution}

\hypertarget{finding-and-replacing-na}{%
\subsection{\texorpdfstring{Finding and Replacing \texttt{NA}}{Finding and Replacing NA}}\label{finding-and-replacing-na}}

To find \texttt{NA} values, use function \texttt{is.na}: \index{base!is.na}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector with NA}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{4}\OperatorTok{:}\DecValTok{10}\NormalTok{)}

\CommentTok{# Test and find location of NA}
\KeywordTok{print}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(my_x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R>  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
R> [10] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(my_x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 3
\end{verbatim}

To replace it, use indexing with the output of \texttt{is.na}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{my_x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{3}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\OtherTok{NA}\NormalTok{)}

\CommentTok{# replace NA for 2}
\NormalTok{my_x[}\KeywordTok{is.na}\NormalTok{(my_x)] <-}\StringTok{ }\DecValTok{2}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 2 3 4 2
\end{verbatim}

Another way to remove \texttt{NA} values is to use the function \texttt{na.omit}. which returns the same object, but without the \texttt{NA} values. Note, however, that the vector size will change and the output will be an object of class \texttt{omit}. Have a look: \index{base!na.omit} \index{omit}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set vector}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{c}\NormalTok{(letters[}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{], }\OtherTok{NA}\NormalTok{, letters[}\DecValTok{5}\OperatorTok{:}\DecValTok{8}\NormalTok{])}

\CommentTok{# print it}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c" NA  "e" "f" "g" "h"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# use na.omit to remove NA}
\NormalTok{my_char <-}\StringTok{ }\KeywordTok{na.omit}\NormalTok{(my_char)}

\CommentTok{# print result}
\KeywordTok{print}\NormalTok{(my_char)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] "a" "b" "c" "e" "f" "g" "h"
R> attr(,"na.action")
R> [1] 4
R> attr(,"class")
R> [1] "omit"
\end{verbatim}

Although the class of the object has changed due to the use of \texttt{na.omit}, the basic properties of the initial vector remains. For example, using the function \texttt{nchar} in the resulting object is still possible.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# trying nchar on a na.omit object}
\KeywordTok{print}\NormalTok{(}\KeywordTok{nchar}\NormalTok{(my_char))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1] 1 1 1 1 1 1 1
\end{verbatim}

For other objects, however, this property may not hold. Some caution is advised when using \texttt{na.omit}. If needed, you can return to the basic class with the \texttt{as.*} functions, such as in \texttt{as.numeric} or \texttt{as.tibble}.

\hypertarget{other-useful-functions-6}{%
\subsection{Other Useful Functions}\label{other-useful-functions-6}}

\textbf{complete.cases} - Returns a logical vector indicating whether the lines of a bi-dimensional object are complete (without \texttt{NA}). This function is used exclusively for \texttt{dataframes} and matrices. \index{base!complete.cases}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# create matrix}
\NormalTok{my_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{15}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{5}\NormalTok{)}

\CommentTok{# set an NA value}
\NormalTok{my_mat[}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\OtherTok{NA}

\CommentTok{# print index with rows without NA}
\KeywordTok{print}\NormalTok{(}\KeywordTok{complete.cases}\NormalTok{(my_mat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
R> [1]  TRUE FALSE  TRUE  TRUE  TRUE
\end{verbatim}

\hypertarget{exercises-4}{%
\section{Exercises}\label{exercises-4}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Consider the following vectors x and y:

\begin{verbatim}
set.seed(7)
x <- sample (1:3, size = 5, replace = T)
y <- sample (1:3, size = 5, replace = T)
\end{verbatim}

What is the sum of the elements of a new vector resulting from the multiplication between the elements of \texttt{x} and\texttt{y}?

02 -
If we performed a cumulative sum of a sequence between 1 and 100, in what element would this sum go beyond the value of 50?

03 -
Using R, create an sequence called \texttt{seq\_1} between -15 and 10, where the interval between values is always equal to 2. What is the sum of the elements of \texttt{seq\_1}?

04 -
Define another object called \texttt{seq\_2} containing a sequence of size 1000, with values between 0 and 100. What is the standard deviation (function\texttt{sd}) of this sequence?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  45.26
\item
  28.91
\item
  22.19
\item
  12.94
\item
  74.17
\end{enumerate}

05 -
Calculate the sum between \texttt{seq\_1} and \texttt{seq\_2} vectors (see previous exercises). Did this operation work despite the different size of the vectors? Explain your answer. If it works, what is the highest value of the resulting vector?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  191.5
\item
  150.8
\item
  109.0
\item
  171.2
\item
  130.4
\end{enumerate}

06 -
Let's assume that, on a certain date, you bought 100 shares in a company, paying \texttt{price\_purchase} per share. After some time, you sold 30 shares for a 18 each and the remaining 70 shares were sold for 22 on a later day. Using a \emph{script} in R, structure this financial problem by creating numeric objects. What is the total gross profit from this sequence of transactions on the stock market?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  R\$678
\item
  R\$904
\item
  R\$791
\item
  R\$1.017
\item
  R\$580
\end{enumerate}

07 -
Create a vector x according to the following formula, where \(i = 1 ... 100\). What is the sum of the elements of x?

\[
x_i=\frac{-1^{i+1}}{2i-1}
\]

08 -
Create a \(z_i\) vector according to the following formula where \(x_i = 1 ... 50\) and \(y_i = 50 ... 1\). What is the sum of the elements of \(z_i\)? Tip: check out how the \texttt{dplyr::lag} function works.

\[
z_i=\frac{y_i - x_{i-1}}{y_{i-2}}
\]

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  -7.116
\item
  -65.957
\item
  -46.795
\item
  -20.343
\item
  -33.569
\end{enumerate}

09 -
Using \texttt{set.seed\ (10)}, create an object called \texttt{x} with random values from the Normal distribution with a mean of 10 and standard deviation of 10. Using the \texttt{cut} function, create another object that defines two groups based on values of \texttt{x} greater than 15 and lower than 15. How many observations you find in the first group?

10 -
Create the following object with the following code:

\begin{verbatim}
set.seed(15)
my_char <- paste(sample(letters, 5000, replace = T), 
                 collapse = '')
\end{verbatim}

How many times is the letter \texttt{\textquotesingle{}x\textquotesingle{}} found in the resulting text object?

11 -
Based on the \texttt{my\_char} object created earlier, if we divided it into several smaller pieces using the letter \texttt{"b"}, what is the number of characters in the \textbf{largest} piece found?

12 -
At the address \url{https://www.gutenberg.org/files/1342/1342-0.txt} it is possible to access a file containing the full text of the book \emph{Pride and Prejudice} by Jane Austen. Use functions \texttt{download.file} and \texttt{readr::read\_lines} to import the entire book as a vector of characters called \texttt{my\_book} in R. How many lines does the resulting object have?

13 -
Bind the vector of characters in \texttt{my\_book} into a single object called \texttt{full\_text} using command \texttt{paste0(my\_book,\ collapse\ =\ \textquotesingle{}\textbackslash{}n\textquotesingle{}}. Using the \texttt{stringr} package, how many times is the word \texttt{\textquotesingle{}King\textquotesingle{}} repeated throughout the text?

14 -
For the \texttt{full\_text} object created earlier, use the \texttt{stringr::str\_split} function to split the entire text using blanks. Based on the resulting vector, create a frequency table. What is the most used word in the text? Tip: Remove all cases of empty characters.

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  the
\item
  and
\item
  you
\item
  I
\item
  a
\end{enumerate}

15 -
Assuming that a person born on 2000-05-12 will live for 100 years, what is the number of birthday days that will fall on a weekend (Saturday or Sunday)? Tip: use operator \texttt{\%in\%} to check for a multiple condition in a vector.

16 -
What date and time is found \ensuremath{10^{4}} \textbf{seconds} after 2021-02-02 11:50:02?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2021-02-02 09:39:55
\item
  2021-02-02 14:36:42
\item
  2021-02-02 12:39:23
\item
  2021-02-02 14:22:58
\item
  2021-02-02 13:23:34
\end{enumerate}

\hypertarget{programming}{%
\chapter{Programming and Data Analysis}\label{programming}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{r-functions}{%
\section{R Functions}\label{r-functions}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-for-loops}{%
\section{\texorpdfstring{Using \texttt{for} Loops}{Using for Loops}}\label{using-for-loops}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{conditional-statements-if-else-switch}{%
\section{\texorpdfstring{Conditional Statements (\texttt{if}, \texttt{else}, \texttt{switch})}{Conditional Statements (if, else, switch)}}\label{conditional-statements-if-else-switch}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-apply-functions}{%
\section{\texorpdfstring{Using \texttt{apply} Functions}{Using apply Functions}}\label{using-apply-functions}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-lapply}{%
\subsection{\texorpdfstring{Using \texttt{lapply}}{Using lapply}}\label{using-lapply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-sapply}{%
\subsection{\texorpdfstring{Using \texttt{sapply}}{Using sapply}}\label{using-sapply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-tapply}{%
\subsection{\texorpdfstring{Using \texttt{tapply}}{Using tapply}}\label{using-tapply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-mapply}{%
\subsection{\texorpdfstring{Using \texttt{mapply}}{Using mapply}}\label{using-mapply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-apply}{%
\subsection{\texorpdfstring{Using \texttt{apply}}{Using apply}}\label{using-apply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-by}{%
\subsection{\texorpdfstring{Using \texttt{by}}{Using by}}\label{using-by}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-package-purrr}{%
\section{\texorpdfstring{Using package \texttt{purrr}}{Using package purrr}}\label{using-package-purrr}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{function-map_}{%
\subsection{\texorpdfstring{Function \texttt{map\_*}}{Function map\_*}}\label{function-map_}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{function-safely}{%
\subsection{\texorpdfstring{Function \texttt{safely}}{Function safely}}\label{function-safely}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{function-pmap}{%
\subsection{\texorpdfstring{Function \texttt{pmap}}{Function pmap}}\label{function-pmap}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{data-manipulation-with-package-dplyr}{%
\section{\texorpdfstring{Data Manipulation with Package \texttt{dplyr}}{Data Manipulation with Package dplyr}}\label{data-manipulation-with-package-dplyr}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{group-operations-with-dplyr}{%
\subsection{\texorpdfstring{Group Operations with \texttt{dplyr}}{Group Operations with dplyr}}\label{group-operations-with-dplyr}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{complex-group-operations-with-dplyr}{%
\subsection{\texorpdfstring{Complex Group Operations with \texttt{dplyr}}{Complex Group Operations with dplyr}}\label{complex-group-operations-with-dplyr}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-5}{%
\section{Exercises}\label{exercises-5}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-6}{%
\section{Exercises}\label{exercises-6}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Create a function called \texttt{say\_my\_name} that takes a person's name as input and shows the text \emph{Your name is \ldots{}} on the screen. Within the scope of the function, use comments to describe the purpose of the function, its inputs and outputs.

02 -
Implement a test for the input objects, so that when the input name is not of the \texttt{character} class, an error is returned to the user. Test your new function and verify if it is working as expected.

03 -
Create a vector with any five names, called \texttt{my\_names}. Using a \emph{loop}, apply function \texttt{say\_my\_name} to each element of \texttt{my\_names}.

04 -
In the database of \href{https://data.brasil.io/dataset/genero-nomes/groups.csv.gz}{Brasil.IO}\footnote{\url{https://data.brasil.io/dataset/genero-nomes/groups.csv.gz}} you will find a table with names and genres. Import the data from the file and, using a loop, apply function \texttt{say\_my\_name} to 15 random names in the database. Tip: you can read the data directly from the link using \texttt{readr::read\_csv(LINK)}.

05 -
Redo previous exercises using function \texttt{sapply} or \texttt{purrr::map}.

06 -
Use the \texttt{BatchGetSymbols} package to download data from the SP500 (\texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}), Ibovespa (\texttt{\textquotesingle{}\^{}BVSP\textquotesingle{}}), FTSE (\texttt{\textquotesingle{}\^{}\ FSTE\textquotesingle{}}) and Nikkei 225 (\texttt{\textquotesingle{}\^{}N225\textquotesingle{}} index)) from `2010-01-01'` to the current date. With the imported data, use a loop to calculate the average, maximum and minimum return for each index during the analyzed period. Save all results in a single table and show it in the \emph{prompt} of R.

07 -
Redo previous exercise using functions \texttt{group\_by} and \texttt{summarise}, both from package \texttt{dplyr}.

08 -
On the \href{http://cran-logs.rstudio.com/}{Rstudio CRAN logs website}\footnote{\url{http://cran-logs.rstudio.com/}} you will find data on download statistics for the base distribution of R in the \emph{Daily R downloads} section. Using your programming skills, import all available data between 2020-01-01 and 2020-01-15 and aggregate them into a single table. Which country has the highest download count for R?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  PT
\item
  VE
\item
  DO
\item
  US
\item
  BE
\end{enumerate}

\hypertarget{cleaning}{%
\chapter{Cleaning and Structuring Data}\label{cleaning}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{the-format-of-a-dataframe}{%
\section{\texorpdfstring{The Format of a \texttt{dataframe}}{The Format of a dataframe}}\label{the-format-of-a-dataframe}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{converting-a-dataframe-structure-long-and-wide}{%
\subsection{\texorpdfstring{Converting a \texttt{dataframe} Structure (long and wide)}{Converting a dataframe Structure (long and wide)}}\label{converting-a-dataframe-structure-long-and-wide}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{converting-lists-into-dataframes}{%
\section{\texorpdfstring{Converting \texttt{lists} into \texttt{dataframes}}{Converting lists into dataframes}}\label{converting-lists-into-dataframes}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{removing-outliers}{%
\section{Removing Outliers}\label{removing-outliers}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{outliers}{%
\subsection{\texorpdfstring{Treating Outliers in \texttt{dataframes}}{Treating Outliers in dataframes}}\label{outliers}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{inflation-and-price-data}{%
\section{Inflation and Price Data}\label{inflation-and-price-data}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{modifying-time-frequency-and-aggregating-data}{%
\section{Modifying Time Frequency and Aggregating Data}\label{modifying-time-frequency-and-aggregating-data}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-7}{%
\section{Exercises}\label{exercises-7}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-8}{%
\section{Exercises}\label{exercises-8}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Consider the \texttt{dataframe} created with the following code:

\begin{verbatim}
library(tidyverse)

my_N <- 100

df <- bind_rows(tibble(ticker = rep('STOCK 1', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))),
                tibble(ticker = rep('STOCK 2', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))) )

print(df)
\end{verbatim}

Is the \texttt{dataframe} format long or wide? Explain your answer.

02 -
Change the format of the previous \texttt{dataframe}, from long to wide or vice versa.

\begin{verbatim}
library(tidyverse)

my_N <- 100

df <- bind_rows(tibble(ticker = rep('STOCK 1', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))),
                tibble(ticker = rep('STOCK 2', my_N),
                       ref_date = Sys.Date() + 1:my_N,
                       price = 100 + cumsum(rnorm(my_N))) )

print(df)
\end{verbatim}

03 -
Consider the following list:

\begin{verbatim}
library(tidyverse)

my_l <- list(df1 = tibble(x = 1:100, y = runif(100)),
             df2 = tibble(x = 1:100, y = runif(100), v = runif(100)),
             df3 = tibble(x = 1:100, y = runif(100), z = runif(100)) )
\end{verbatim}

Add all \texttt{dataframes} in \texttt{my\_l} to a single object using \texttt{do.call} or \texttt{dplyr::bind\_rows} functions. What happened to the \texttt{df1} data where \texttt{v} and \texttt{z} columns do not exist?

04 -
Use the \texttt{BatchGetSymbols} package to download the SP500 index data (\texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}}) from 1950-01-01 to 2021-01-01. What is the sum of the 5 highest positive returns on the index?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0.5014
\item
  0.7740
\item
  1.2754
\item
  0.2184
\item
  0.3257
\end{enumerate}

05 -
Use the \texttt{replace\_outliers} function (see section \ref{outliers}) to remove \emph{outliers} from all numeric columns of the SP500 data previously imported with \texttt{my\_prob\ =\ 0.025}. How many lines were \textbf{lost} in this cleaning process?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  2977
\item
  16771
\item
  7282
\item
  4650
\item
  9489
\end{enumerate}

06 -
Use the \texttt{BatchGetSymbols::BatchGetSymbols} function to import the prices of the FTSE index (\texttt{\textquotesingle{}\^{}\ FTSE\textquotesingle{}}) from 2010-01-01 to 2021-01-01. Then, reconstruct the data at the annual frequency, defining each year's value as the last observation of the period. Tip: see the \texttt{dplyr::summary\_all} function for a functional way to aggregate all the columns of a \texttt{dataframe}.

07 -
Use the same daily data as the FTSE and reconstruct the data at the monthly frequency, again using the last observation of the period.

08 -
For the same daily FTSE data, check the dates and prices of the 20 biggest price drops. If, for each of these cases, an investor bought the index at the price of the biggest drops and kept it for 30 days, what would be his average nominal return per transaction?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  1.40\%
\item
  2.53\%
\item
  1.91\%
\item
  0.88\%
\item
  0.37\%
\end{enumerate}

\hypertarget{figures}{%
\chapter{\texorpdfstring{Creating and Saving Figures with \texttt{ggplot2}}{Creating and Saving Figures with ggplot2}}\label{figures}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{the-ggplot2-package}{%
\section{\texorpdfstring{The \texttt{ggplot2} Package}{The ggplot2 Package}}\label{the-ggplot2-package}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-graphics-windows}{%
\section{Using Graphics Windows}\label{using-graphics-windows}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-figures-with-function-qplot}{%
\section{\texorpdfstring{Creating Figures with Function \texttt{qplot}}{Creating Figures with Function qplot}}\label{creating-figures-with-function-qplot}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{ggplot}{%
\section{\texorpdfstring{Creating Figures with Function \texttt{ggplot}}{Creating Figures with Function ggplot}}\label{ggplot}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{the-us-yield-curve}{%
\subsection{The US Yield Curve}\label{the-us-yield-curve}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-themes}{%
\section{Using Themes}\label{using-themes}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-panels-with-facet_wrap}{%
\section{\texorpdfstring{Creating Panels with \texttt{facet\_wrap}}{Creating Panels with facet\_wrap}}\label{creating-panels-with-facet_wrap}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-the-pipeline}{%
\section{Using the Pipeline}\label{using-the-pipeline}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-statistical-graphics}{%
\section{Creating Statistical Graphics}\label{creating-statistical-graphics}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-histograms}{%
\subsection{Creating Histograms}\label{creating-histograms}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-boxplot-figures}{%
\subsection{\texorpdfstring{Creating \emph{boxplot} Figures}{Creating boxplot Figures}}\label{creating-boxplot-figures}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-qq-plots}{%
\subsection{\texorpdfstring{Creating \emph{QQ} Plots}{Creating QQ Plots}}\label{creating-qq-plots}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{saving-graphics-to-a-file}{%
\section{Saving Graphics to a File}\label{saving-graphics-to-a-file}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-9}{%
\section{Exercises}\label{exercises-9}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-10}{%
\section{Exercises}\label{exercises-10}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Download TESLA (TSLA) stock data with the \texttt{BatchGetSymbols} package for the last 500 days. Display the price line chart adjusted over time using the \texttt{ggplot2\ ::\ ggplot} function. Make sure that:

\begin{itemize}
\tightlist
\item
  x and y axes are correctly named;
\item
  The chart has a title (``Prices for TESLA''), subtitle (``Data from YYYY-MM-DD to YYYY-MM-DD'') and a \emph{caption} (``Solution for exercise 01, chapter 10 - afedR'').
\end{itemize}

02 -
Download stock data for:

\begin{itemize}
\tightlist
\item
  APPLE INC. (AAPL)
\item
  MICROSOFT CORPORATION (MSFT)
\item
  AMAZON.COM, INC. (AMZN)
\item
  ALPHABET INC. (GOOG)
\end{itemize}

using the \texttt{BatchGetSymbols} package for the last 1500 days. Display stock prices with different line colors on the same graph. Adapt all other aspects of the graph from previous exercises such as title and axis labels.

03 -
For the previous plot, add dots in the lines.

04 -
For the same plot, separate the stock prices on different panels with the \texttt{ggplot::facet\_wrap} function. Use the \texttt{scales\ =\ \textquotesingle{}free\textquotesingle{}} argument to release the x and y axis of each panel.

05 -
Change the theme of the previous graph to a black and white scale, both for the graph area and for the colors of the lines.

06 -
For the previous data, present the histogram of the returns of the different stocks in different panels and save the result in a file called \texttt{\textquotesingle{}histograms.png\textquotesingle{}}.

07 -
Use the \texttt{BatchGetSymbols::GetSP500Stocks} function to discover all tickers currently belonging to the SP500 index. Using \texttt{BatchGetSymbols}, download the annual return data for all stocks in the index, from 2015-01-01 to the current day. After that, create the average/variance map by plotting the average annual return as the y axis and the standard deviation as the x axis. Tip: Use the parallel option in \texttt{BatchGetSymbols} to speed up the execution of the code. Also, you will find many outliers in the raw data. Make sure that the graph is visible limiting the x and y axes (see the \texttt{ggplot2::xlim} and \texttt{ggplot2::ylim} functions).

08 -
Head over to the \href{https://www.kaggle.com/datasets}{Kaggle data website}\footnote{\url{https://www.kaggle.com/datasets}} and choose a particular dataset for your analysis. It need not be related to economics or finance. Feel free to make a decision based on your own interests. After downloading the data, create a visual analysis of the data. Fell free to try out one or more plots of interest.

\hypertarget{models}{%
\chapter{Financial Econometrics with R}\label{models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{linear-models}{%
\section{Linear Models (OLS)}\label{linear-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-a-linear-model}{%
\subsection{Simulating a Linear Model}\label{simulating-a-linear-model}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{estimating-ols}{%
\subsection{Estimating a Linear Model}\label{estimating-ols}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{testing-ols}{%
\subsection{Statistical Inference in Linear Models}\label{testing-ols}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{generalized-linear-models-glm}{%
\section{Generalized Linear Models (GLM)}\label{generalized-linear-models-glm}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-a-glm-model}{%
\subsection{Simulating a GLM Model}\label{simulating-a-glm-model}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{estimating-a-glm-model}{%
\subsection{Estimating a GLM Model}\label{estimating-a-glm-model}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{panel-data-models}{%
\section{Panel Data Models}\label{panel-data-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-panel-data-models}{%
\subsection{Simulating Panel Data Models}\label{simulating-panel-data-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{estimating-panel-data-models}{%
\subsection{Estimating Panel Data Models}\label{estimating-panel-data-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{arima-models}{%
\section{Arima Models}\label{arima-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-arima-models}{%
\subsection{Simulating Arima Models}\label{simulating-arima-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{arima-estimating}{%
\subsection{Estimating Arima Models}\label{arima-estimating}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{forecasting-arima-models}{%
\subsection{Forecasting Arima Models}\label{forecasting-arima-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{garch-models}{%
\section{GARCH Models}\label{garch-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-garch-models}{%
\subsection{Simulating Garch Models}\label{simulating-garch-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{estimating-garch}{%
\subsection{Estimating Garch Models}\label{estimating-garch}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{forecasting-garch-models}{%
\subsection{Forecasting Garch Models}\label{forecasting-garch-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{regime-switching-models}{%
\section{Regime Switching Models}\label{regime-switching-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simulating-regime-switching-models}{%
\subsection{Simulating Regime Switching Models}\label{simulating-regime-switching-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{estimating-markov}{%
\subsection{Estimating Regime Switching Models}\label{estimating-markov}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{forecasting-regime-switching-models}{%
\subsection{Forecasting Regime Switching Models}\label{forecasting-regime-switching-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{dealing-with-several-models}{%
\section{Dealing with Several Models}\label{dealing-with-several-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-tapply-and-sapply}{%
\subsection{\texorpdfstring{Using \texttt{tapply} and \texttt{sapply}}{Using tapply and sapply}}\label{using-tapply-and-sapply}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-by-1}{%
\subsection{\texorpdfstring{Using \texttt{by}}{Using by}}\label{using-by-1}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-dplyrgroup_by}{%
\subsection{\texorpdfstring{Using \texttt{dplyr::group\_by}}{Using dplyr::group\_by}}\label{using-dplyrgroup_by}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-11}{%
\section{Exercises}\label{exercises-11}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-12}{%
\section{Exercises}\label{exercises-12}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Simulate the following linear process in R:

\begin{verbatim}
set.seed(5)

# number of obs
n_row <- 100

# set x as Normal (0, 1)
x <- rnorm(n_row)

# set coefficients
my_alpha <- 1.5
my_beta <- 0.5

# build y
y <- my_alpha + my_beta*x + rnorm(n_row)
\end{verbatim}

Now, estimate a linear model where \texttt{x} is the explanatory variable and \texttt{y} is the explained variable. Use the \texttt{summary} function on the estimation return object to get more details about the model. What is the estimated beta value of the simulated data?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  0.4003
\item
  1.5038
\item
  0.8707
\item
  0.2910
\item
  0.6331
\end{enumerate}

02 -
Using the \texttt{car} package, test the joint hypothesis that the value of alpha is equal to 1.5 and the value of beta is equal to 0.5. What is the value of the resulting F test?

\begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  10.727
\item
  16.967
\item
  7.799
\item
  40.301
\item
  23.335
\end{enumerate}

03 -
Use the \texttt{gvlma} package to test the OLS assumptions for the model previously estimated. Does the model pass all tests? If not, increase the value of \texttt{n\_row} to 1000 and try again. Did the increase in the number of observations of the model impact the assumptions test? In what way?

04 -
Use the \texttt{BatchGetSymbols::GetSP500Stocks} function to download data for all stocks that are part of the current SP500 index for the last three years. Using the SP500 itself -- ticker \texttt{\textquotesingle{}\^{}GSPC\textquotesingle{}} -- as the market index, calculate the beta for each of the stocks. Display the histogram of the estimated \emph{betas}. Note that the SP500 returns are not available in the original database and must be downloaded and added to the original database.

05 -
For previously imported data, estimate a panel data version for the market model (beta). In this version, each stock has a different intercept, but they share the same beta. Is the estimated beta significant at 5\%?

06 -
Using the tidyverse functions, \texttt{dplyr::group\_by} and \texttt{dplyr::do}, estimate an ARIMA model for the returns of each stock, available from the import process of previous exercise. In the same output dataframe, create a new column with the forecast in \emph{t + 1} for each model. Which stock has the highest expected return for \emph{t + 1}?

07 -
In the same code used for the previous question, add a new column-list with the estimation of an ARMA (1, 0)-GARCH(1, 1) model for the returns of each stock. Add another column with the volatility forecast (standard deviation) at \emph{t + 1}.

By dividing the expected return calculated in the previous item by the expected risk, we have a market direction index, where those stocks with the highest index value have the highest ratio of expected return to risk. Which stock is more attractive and has the highest value of this index?

08 -
For the same SP500 database, select 4 stocks at random and estimate a Markov regime switching model with a configuration equivalent to that presented in section \ref{estimating-markov}. Use the \texttt{plot} function to display the graph of the smoothed probabilities and save each figure in a folder called \texttt{\textquotesingle{}fig\textquotesingle{}}.

\hypertarget{reporting}{%
\chapter{Reporting Results}\label{reporting}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{reporting-tables}{%
\section{Reporting Tables}\label{reporting-tables}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{reporting-models}{%
\section{Reporting Models}\label{reporting-models}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{creating-rmarkdown}{%
\section{\texorpdfstring{Creating Reports with \emph{RMarkdown}}{Creating Reports with RMarkdown}}\label{creating-rmarkdown}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-13}{%
\section{Exercises}\label{exercises-13}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-14}{%
\section{Exercises}\label{exercises-14}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Observe the data available in the \texttt{grunfeld.csv} file. Import the data into R using package \texttt{afedR} and create a descriptive table of the variables. This table should provide enough information for the reader to understand the data. Use \texttt{xtable} package to report it in \emph{LaTeX} or Word/Writer format.

02 -
Using the \texttt{BatchGetSymbols::GetSP500Stocks} function, select 4 stocks at random and download the adjusted price data for the last three years. Estimate an ARIMA(1, 0, 1) model for each stock and report the result on the R screen with the \texttt{texreg::screenreg} function.

03 -
Create a new \emph{Rmarkdown} report from previous two exercises. Compile the report in html and open it in your \emph{browser}.

\hypertarget{optimizing}{%
\chapter{Optimizing Code}\label{optimizing}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{optimizing-your-programming-time}{%
\section{Optimizing your Programming Time}\label{optimizing-your-programming-time}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{optimizing-code-speed}{%
\section{Optimizing Code Speed}\label{optimizing-code-speed}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{profiling-code}{%
\subsection{Profiling Code}\label{profiling-code}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{simple-strategies-to-improve-code-speed}{%
\subsection{Simple Strategies to Improve Code Speed}\label{simple-strategies-to-improve-code-speed}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{use-vector-operations}{%
\subsubsection{Use Vector Operations}\label{use-vector-operations}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{repetitive-binding-of-dataframes}{%
\subsubsection{\texorpdfstring{Repetitive binding of \texttt{dataframes}}{Repetitive binding of dataframes}}\label{repetitive-binding-of-dataframes}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-c-code-package-rcpp}{%
\subsection{\texorpdfstring{Using C++ code (package \texttt{Rcpp})}{Using C++ code (package Rcpp)}}\label{using-c-code-package-rcpp}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-cache-package-memoise}{%
\subsection{\texorpdfstring{Using cache (package \texttt{memoise})}{Using cache (package memoise)}}\label{using-cache-package-memoise}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{using-parallel-processing-package-furrr}{%
\subsubsection{\texorpdfstring{Using parallel processing (package \texttt{furrr})}{Using parallel processing (package furrr)}}\label{using-parallel-processing-package-furrr}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-15}{%
\section{Exercises}\label{exercises-15}}

\begin{pleasebuyit}
You reached the end of the online version of \emph{Analyzing Financial
and Economic Data with R}. The full content of the book can be acquired
at \href{https://www.amazon.com/dp/B084LSNXMN}{Amazon} for less than ten
dollars. Purchasing this book is a great way of supporting this and
other projects of the \href{https://www.msperlin.com/blog/}{author}. If
you are satisfied with the content, please leave your feedback at Amazon
or by email
(\href{mailto:marceloperlin@gmail.com}{\nolinkurl{marceloperlin@gmail.com}}).
The book is a lifelong project and I'll keep improving it based on the
received feedback.
\end{pleasebuyit}

\hypertarget{exercises-16}{%
\section{Exercises}\label{exercises-16}}

All solutions are available at \url{https://www.msperlin.com/afedR}.

01 -
Consider the following code:

\begin{verbatim}
library(tidyverse)
library(forecast)
library(BatchGetSymbols)

ticker <- '^GSPC'
df_prices <- BatchGetSymbols(tickers = ticker, 
                             first.date = '2010-01-01')[[2]]

my_arima <- auto.arima(df_prices$ret.adjusted.prices)
summary(my_arima)
\end{verbatim}

Use functions \texttt{Rprof} and \texttt{profvis} to identify the bottleneck of the code. Which line number is taking the longest execution time?

02 -
Use the \texttt{Rcpp} package to write a C++ language function that will add elements of two numerical vectors. The output must be another vector of the same size and with elements equivalent to the \texttt{x\ +\ y} operation. Use the \texttt{identical} function to test that all elements of both vectors are equal.

03 -
Use the \texttt{tictoc} package to compare the performance of the previous function with the native operator \texttt{+}, and a loop-based version with the pre-allocation of the result vector. Which alternative has the shortest execution time and why? Does the \texttt{Rcpp} version beat the loop version?

04 -
Use the \texttt{memoise} package to create a memorized version of function \texttt{Quandl::Quandl}. Use the new function to import data about the United States Consumer Price Index (quandl code \texttt{\textquotesingle{}FRED/DDOE01USA086NWDB\textquotesingle{}}). How much percentage speed gain do you get from the second call to the memorized version?

  \bibliography{bib-files/book.bib,bib-files/packages.bib,bib-files/problematic.bib}

%\backmatter
\printindex

\end{document}
