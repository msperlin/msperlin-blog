<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Dataframes and other objects | Analyzing Financial and Economic Data with R - Online Edition</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 6 Dataframes and other objects | Analyzing Financial and Economic Data with R - Online Edition">
<meta property="og:type" content="book">
<meta property="og:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<meta property="og:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Dataframes and other objects | Analyzing Financial and Economic Data with R - Online Edition">
<meta name="twitter:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyzing Financial and Economic Data with R - Online Edition</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="about-new-edition.html">About New Edition</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basicoperations.html"><span class="header-section-number">2</span> Basic Operations in R</a></li>
<li><a class="" href="research-scripts.html"><span class="header-section-number">3</span> Writing Research Scripts</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">4</span> Importing Data from Local Files</a></li>
<li><a class="" href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></li>
<li><a class="active" href="data-structure-objects.html"><span class="header-section-number">6</span> Dataframes and other objects</a></li>
<li><a class="" href="basic-classes.html"><span class="header-section-number">7</span> Basic Object Classes</a></li>
<li><a class="" href="programming.html"><span class="header-section-number">8</span> Programming and Data Analysis</a></li>
<li><a class="" href="cleaning.html"><span class="header-section-number">9</span> Cleaning and Structuring Data</a></li>
<li><a class="" href="figures.html"><span class="header-section-number">10</span> Creating and Saving Figures with ggplot2</a></li>
<li><a class="" href="models.html"><span class="header-section-number">11</span> Financial Econometrics with R</a></li>
<li><a class="" href="reporting.html"><span class="header-section-number">12</span> Reporting Results</a></li>
<li><a class="" href="optimizing.html"><span class="header-section-number">13</span> Optimizing Code</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98297869-1', 'auto');
  ga('send', 'pageview');

</script><!-- Global site tag (gtag.js) - Google Analytics GOOGLE ADS--><script async src="https://www.googletagmanager.com/gtag/js?id=UA-89690212-2">
</script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89690212-2');
</script><div id="data-structure-objects" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Dataframes and other objects<a class="anchor" aria-label="anchor" href="#data-structure-objects"><i class="fas fa-link"></i></a>
</h1>
<p><strong>In R, everything is an object with its own properties</strong>. A <code>numeric</code> vector can interact with other <code>numeric</code> objects in operations such as multiplication, division, and addition. The same is not for objects of the <code>character</code> class, where mathematical properties are not valid or intuitive – it does not make sense to add a numeric value to a text or to divide a text for other text. But, the <code>character</code> class has other properties, such as allowing the user to look for a specific chunk of characters, splitting parts of a text, and replacing specific characters, among many other possibilities. <strong>One of the most important aspects of working with R is learning the functionalities of the object classes</strong>.</p>
<p>The basic object classes in R include numeric values, characters (text), factors, dates, among many other cases. However, base classes are stored in more complex data structures, such as <code>dataframes</code> (tables) and lists. Such an organization makes the job of manipulating data a lot easier. Imagine, for example, conducting a study using price and volume data for five hundred stocks. If we used one numeric object – a vector – for each stock’s volume and price, we would have one thousand objects to handle in our <em>environment</em>. Although it is possible to work this way, the resulting code would be disorganized, difficult to understand, and prone to errors – the so-called <a href="https://en.wikipedia.org/wiki/Spaghetti_code">spaguetti code</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Spaghetti_code" class="uri"&gt;https://en.wikipedia.org/wiki/Spaghetti_code&lt;/a&gt;&lt;/p&gt;'><sup>55</sup></a>. So twisted and tangled that it becomes difficult to use and maintain.</p>
<p>To avoid that, a simpler way to organize our data is to create an object named <code>my_data</code> and allocate prices and volumes there. All the information needed to perform the study would be in this object, facilitating the import and export of data. Our code would also be simpler and more structured as would only need to manipulate one object – a table, expanding it with new variables or relating it to other tables. Said that, let’s have a closer look at objects for structuring datasets, including <code>dataframes</code>, <code>lists</code> and <code>matrices</code>.</p>
<div id="dataframes" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> <code>Dataframes</code><a class="anchor" aria-label="anchor" href="#dataframes"><i class="fas fa-link"></i></a>
</h2>
<p>Without a doubt, the <code>dataframe</code> class is the most used and most important object to understand while learning R. You will spend most of your time manipulating one or many <code>dataframes</code> to get the result you need. A <code>dataframe</code> is simply a table with rows and columns. It allows for each column to have a different class. We can organize text data into a dataframe along with numbers, for example. This flexibility makes the <code>dataframe</code> an efficient object to represent heterogeneous datasets. Internally, a dataframe is a special type of a <code>list</code>, where each column is an atomic vector. </p>
<p><strong>A <code>dataframe</code> can organize our work significantly</strong>. The tabular structure of a <code>dataframe</code> forces the data to be <em>paired</em>, where each row is a different data point with several pieces of information (columns). This simple data structure can accommodate an infinite variety of information. As new data points arrive, the number of rows increases. When a new variable is inserted in the analysis, we simply add a new column to the existing table.</p>
<p>Another positive aspect of using the <code>dataframe</code> class in R is that several functions expect a <code>dataframe</code> as input. For example, the data manipulation package <code>dplyr</code> <span class="citation">(<a href="references.html#ref-R-dplyr" role="doc-biblioref">Wickham, François, et al. 2022</a>)</span> and the graphical package <code>ggplot2</code> <span class="citation">(<a href="references.html#ref-R-ggplot2" role="doc-biblioref">Wickham, Chang, et al. 2022</a>)</span> work from a <code>dataframe</code> only. Operations of importing and exporting information are mostly <code>dataframe</code> oriented. Without a doubt, <code>dataframes</code> are at the centre of functionalities in R, and you <strong>must</strong> master the manipulation of this object.</p>
<div id="creating-dataframes" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Creating <code>dataframes</code><a class="anchor" aria-label="anchor" href="#creating-dataframes"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>dataframe</code> object is one of R’s native classes and is implemented in the <code>base</code> package. We can, for example, create a <code>dataframe</code> with function <code><a href="https://rdrr.io/r/base/data.frame.html">base::data.frame</a></code>. However, the <code>tidyverse</code> universe offers its own version of a dataframe, called <code>tibble</code>. Converting a dataframe to <code>tibble</code> is internal and automatic. A <code>tibble</code> object is more flexible than native <code>dataframes</code>, making it significantly easier to use. Following our preference for the <code>tidyverse</code> functions, from now on we will use <code>tibbles</code> as our version of <code>dataframes</code>. </p>
<p>We call function <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble::tibble</a></code> to create a <code>dataframe</code>. Notice that function <code>tibble:data_frame</code> does the same job, but has been deprecated. This means that developers of the <code>tibble</code> package will give preference to the <code>tibble</code> function in the future and, as users, we should follow the recommendation. We will now use this function for creating a <code>dataframe</code> with financial data of different stocks. </p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set tickers</span></span>
<span><span class="va">tickers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'AAP'</span>,<span class="fl">5</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'COG'</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'BLK'</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'CAM'</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># set a date vector</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-01-04"</span>, <span class="st">"2010-01-05"</span>, <span class="st">"2010-01-06"</span>, </span>
<span>                       <span class="st">"2010-01-07"</span>, <span class="st">"2010-01-08"</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># set prices                      </span></span>
<span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40.38</span>,  <span class="fl">40.14</span>,  <span class="fl">40.49</span>,  <span class="fl">40.48</span>,  <span class="fl">40.64</span>,</span>
<span>            <span class="fl">46.23</span>,  <span class="fl">46.17</span>,  <span class="fl">45.97</span>,  <span class="fl">45.56</span>,  <span class="fl">45.46</span>,</span>
<span>            <span class="fl">238.58</span>, <span class="fl">239.61</span>, <span class="fl">234.67</span>, <span class="fl">237.25</span>, <span class="fl">238.92</span>,</span>
<span>            <span class="fl">43.43</span>,  <span class="fl">43.96</span>,  <span class="fl">44.26</span>,  <span class="fl">44.5</span>,   <span class="fl">44.86</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create tibble/dataframe</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">tickers</span>, <span class="va">dates</span>, <span class="va">prices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print its first 5 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 3
R&gt;   tickers dates      prices
R&gt;   &lt;chr&gt;   &lt;date&gt;      &lt;dbl&gt;
R&gt; 1 AAP     2010-01-04   40.4
R&gt; 2 AAP     2010-01-05   40.1
R&gt; 3 AAP     2010-01-06   40.5
R&gt; 4 AAP     2010-01-07   40.5
R&gt; 5 AAP     2010-01-08   40.6
R&gt; 6 COG     2010-01-04   46.2</code></pre>
<p>We used the function <code>rep</code> to replicate and facilitate the creation of the raw data for the <code>dataframe</code> object. Notice how all our data is now stored in a single object, facilitating access and organization of the resulting code. The content of <code>my_df</code> can also be viewed in the RStudio interface. To do so, click on the object name in the <em>environment</em> tab, top right of the screen. After that, a viewer will appear on the main screen of the program, as in <a href="data-structure-objects.html#fig:example-view">6.1</a>. </p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:example-view"></span>
<img src="figs/Command_view.png" alt="Example of viewing a dataframe in RStudio" width="100%"><p class="caption">
Figure 6.1: Example of viewing a dataframe in RStudio
</p>
</div>
<p>The advantage of using the viewer is that you can explore the data and easily sort the columns by clicking on their names. For those who like to use the prompt, you can open the viewer with function <code>View</code>, as in <code>View(my_df)</code>. </p>
</div>
<div id="inspecting-a-dataframe" class="section level3" number="6.1.2">
<h3>
<span class="header-section-number">6.1.2</span> Inspecting a Dataframe<a class="anchor" aria-label="anchor" href="#inspecting-a-dataframe"><i class="fas fa-link"></i></a>
</h3>
<p>Once you have a dataframe in your R session, a <strong>mandatory</strong> step is to check its contents. With time, this should become a healthy habit in your work. You need to be aware of:</p>
<ul>
<li>Properly defined column’s names and classes;</li>
<li>Correct number of rows and columns;</li>
<li>The existence (or not) of missing data (<code>NA</code>).</li>
</ul>
<p>We often have no control over how we get our data and errors in column names are very common. With that in mind, having meaningful column names that are intuitive, easy to access and without special characters is essential. Therefore, the first step in checking a <code>dataframe</code> is to analyze the names of columns and, if necessary, adjust the code. As a rule, <strong>never touch the content of raw tables</strong>, always use code to further manipulate the data.</p>
<p>It is also very important to make sure that the classes of columns from the imported <code>dataframe</code> are correctly specified. Otherwise, future column operations may cause an error. For example, if a column of numeric values is imported with the text class (<code>character</code>), any mathematical operation with that column will cause an error. <strong>Checking column’s classes right after importing the data is very important</strong> and will save you a lot of time in the future.</p>
<p>You should also check for the number of <code>NA</code> values in the different columns. Whenever you find a large proportion of <code>NA</code> values in the imported table, you should find out what is going on and if the information is being correctly imported. As mentioned in the previous chapter, <code>NA</code> values are contagious and will turn anything it touches into another <code>NA</code>.</p>
<p>Back to the code, one of the most recommended functions for familiarizing yourself with a <code>dataframe</code> is <code><a href="https://pillar.r-lib.org/reference/glimpse.html">dplyr::glimpse</a></code>. It shows the name and class of the columns and the number of rows/columns. We used and abused this function in previous chapters. Here’s a simple example:</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check content of my_df</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 3
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP", "AAP", "AAP", "COG", …
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-…
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, …</code></pre>
<p>Usually, the use of <code>glimpse</code> is sufficient to check if the data import process has succeeded. However, a deeper analysis can also help to understand how each column varies in the imported data and if that makes sense to our problem. Here comes the role of the <code><a href="https://rdrr.io/r/base/summary.html">base::summary</a></code> function:</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check variation my_df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;    tickers              dates                prices      
R&gt;  Length:20          Min.   :2010-01-04   Min.   : 40.14  
R&gt;  Class :character   1st Qu.:2010-01-05   1st Qu.: 42.73  
R&gt;  Mode  :character   Median :2010-01-06   Median : 45.16  
R&gt;                     Mean   :2010-01-06   Mean   : 92.08  
R&gt;                     3rd Qu.:2010-01-07   3rd Qu.: 93.34  
R&gt;                     Max.   :2010-01-08   Max.   :239.61</code></pre>
<p>The objective of <code>summary</code> is to provide a grasp of the content for each column of the <code>dataframe</code>. Notice that <code>summary</code> interprets each column differently. For the first case, column <code>ticker</code>, a <em>character</em> vector, it shows only its length. But, for column <code>prices</code>, a <code>numeric</code> vector, it presents its maximum, minimum, median and quartiles. We can use a simple call to <code><a href="https://rdrr.io/r/base/summary.html">base::summary</a></code> for inspecting the contents of all columns. For example, an extreme observation (<em>outlier</em>) could easily be identified by analyzing the output of <code>summary</code>.</p>
<div class="rmdimportant">
<p>
Whenever you start to work on a new <code>dataframe</code>, check its
contents with functions <code><a href="https://pillar.r-lib.org/reference/glimpse.html">dplyr::glimpse</a></code> and
<code><a href="https://rdrr.io/r/base/summary.html">base::summary</a></code> and verify possible problems with the
importing process or the content of the file itself. With experience you
will notice that many future errors in code can be remedied by a simple
inspection of the imported tables.
</p>
</div>
</div>
<div id="the-pipeline-operator" class="section level3" number="6.1.3">
<h3>
<span class="header-section-number">6.1.3</span> The <em>pipeline</em> Operator (<code>%&gt;%</code>)<a class="anchor" aria-label="anchor" href="#the-pipeline-operator"><i class="fas fa-link"></i></a>
</h3>
<p>An important feature of the <code>tidyverse</code> universe is the extensive use of the <em>pipeline</em> operator, first proposed in package <code>magrittr</code> <span class="citation">(<a href="references.html#ref-R-magrittr" role="doc-biblioref">Bache and Wickham 2022</a>)</span> and defined by symbol <code>%&gt;%</code>. The <em>pipeline</em> operator allows data operations to be performed sequentially and in a modular fashion, increasing readability and maintainability of the resulting code.</p>
<p>Imagine a situation where we have three functions to be applied to a <code>dataframe</code>. Each function depends on the output of another function. This requires chaining your calls, so one output feeds an object to the next call. Using the <em>pipeline</em> operator, we can write the <code>dataframe</code> manipulation procedure with the following code: </p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_tab</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fct1</span><span class="op">(</span><span class="va">arg1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fct2</span><span class="op">(</span><span class="va">arg2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fct3</span><span class="op">(</span><span class="va">arg3</span><span class="op">)</span></span></code></pre></div>
<p>We use symbol <code>%&gt;%</code> at the end of each line to “glue” the operations. The <code>fct*</code> functions are operations performed at each step. The <code>arg*</code> objects are just arguments (options) for each function call. The result of each code line is passed to the next function sequentially. Thus, there is no need to create intermediate objects. To compare, here are two ways to perform the same operation <strong>without</strong> the <em>pipeline</em> operator:</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># version 1</span></span>
<span><span class="va">my_tab</span> <span class="op">&lt;-</span> <span class="fu">fct3</span><span class="op">(</span><span class="fu">fct2</span><span class="op">(</span><span class="fu">fct1</span><span class="op">(</span><span class="va">my_df</span>,</span>
<span>                         <span class="va">arg1</span><span class="op">)</span>,</span>
<span>                    <span class="va">arg2</span><span class="op">)</span>,</span>
<span>               <span class="va">arg1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># version 2</span></span>
<span><span class="va">temp1</span> <span class="op">&lt;-</span> <span class="fu">fct1</span><span class="op">(</span><span class="va">my_df</span>, <span class="va">arg1</span><span class="op">)</span></span>
<span><span class="va">temp2</span> <span class="op">&lt;-</span> <span class="fu">fct2</span><span class="op">(</span><span class="va">temp1</span>, <span class="va">arg2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_tab</span> <span class="op">&lt;-</span> <span class="fu">fct3</span><span class="op">(</span><span class="va">temp1</span>, <span class="va">arg3</span><span class="op">)</span></span></code></pre></div>
<p>Notice how the alternatives result in a messy code structure. Version one is the ugliest. You need to pay good attention to understand the code. You probably haven’t noticed, but both codes have typos and would cause a bug. For the first, the last <code>arg1</code> argument should be <code>arg3</code> and, in the second, the <code>fct3</code> function is using the <code>temp1</code> dataframe and not <code>temp2</code>. This example shows how using <em>pipelines</em> makes the code more elegant and readable. From now on we will use the pipeline operator extensively.</p>
</div>
<div id="accessing-columns" class="section level3" number="6.1.4">
<h3>
<span class="header-section-number">6.1.4</span> Accessing Columns<a class="anchor" aria-label="anchor" href="#accessing-columns"><i class="fas fa-link"></i></a>
</h3>
<p>To discover the names of the columns of a <code>dataframe</code>, we have two functions, <code>names</code> and <code>colnames</code>, with the exact same behavior: </p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get names of columns with names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "tickers" "dates"   "prices"</code></pre>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "tickers" "dates"   "prices"</code></pre>
<p>Both can also modify column names:</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set temp df</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span></span>
<span></span>
<span><span class="co"># change names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Col'</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Col1" "Col2" "Col3"</code></pre>
<p>In this example, the way we use <code>names</code> differs greatly from other R functions. Here, we use the function on the left side of the <code>assign</code> symbol (<code>&lt;-</code>). Internally, we are defining an attribute of the <code>temp_df</code> object, the name of its columns.</p>
<p>To access a particular column of a <code>dataframe</code> as a vector, we can use operator <code>$</code> or the name/position of the column with double brackets:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># isolate columns of df</span></span>
<span><span class="va">my_tickers</span> <span class="op">&lt;-</span> <span class="va">my_df</span><span class="op">$</span><span class="va">tickers</span></span>
<span><span class="va">my_prices</span> <span class="op">&lt;-</span> <span class="va">my_df</span><span class="op">$</span><span class="va">prices</span></span>
<span></span>
<span><span class="co"># print the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_tickers</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "AAP" "AAP" "AAP" "AAP" "AAP" "COG"</code></pre>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_prices</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 40.38 40.14 40.49 40.48 40.64 46.23</code></pre>
<p>It’s worth knowing that, internally, dataframes are stored as <code>lists</code>, where each element is a column. This is important because some properties of <code>lists</code> also work for <code>dataframes</code>. One example is using a double bracket (<code>[[ ]]</code>) for selecting columns:</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select column in dataframe with list notation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "2010-01-04" "2010-01-05" "2010-01-06" "2010-01-07"
R&gt;  [5] "2010-01-08" "2010-01-04" "2010-01-05" "2010-01-06"
R&gt;  [9] "2010-01-07" "2010-01-08" "2010-01-04" "2010-01-05"
R&gt; [13] "2010-01-06" "2010-01-07" "2010-01-08" "2010-01-04"
R&gt; [17] "2010-01-05" "2010-01-06" "2010-01-07" "2010-01-08"</code></pre>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[[</span><span class="st">'tickers'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "AAP" "AAP" "AAP" "AAP" "AAP" "COG" "COG" "COG" "COG"
R&gt; [10] "COG" "BLK" "BLK" "BLK" "BLK" "BLK" "CAM" "CAM" "CAM"
R&gt; [19] "CAM" "CAM"</code></pre>
<p>To access specific rows and columns of a <code>dataframe</code>, use single brackets with atomic vectors that indicate positions:</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># accessing rows 1:5, column 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 1
R&gt;   dates     
R&gt;   &lt;date&gt;    
R&gt; 1 2010-01-04
R&gt; 2 2010-01-05
R&gt; 3 2010-01-06
R&gt; 4 2010-01-07
R&gt; 5 2010-01-08</code></pre>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># accessing rows 1:5, columns 1 and 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;   tickers dates     
R&gt;   &lt;chr&gt;   &lt;date&gt;    
R&gt; 1 AAP     2010-01-04
R&gt; 2 AAP     2010-01-05
R&gt; 3 AAP     2010-01-06
R&gt; 4 AAP     2010-01-07
R&gt; 5 AAP     2010-01-08</code></pre>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># accessing rows 1:5, all columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 3
R&gt;   tickers dates      prices
R&gt;   &lt;chr&gt;   &lt;date&gt;      &lt;dbl&gt;
R&gt; 1 AAP     2010-01-04   40.4
R&gt; 2 AAP     2010-01-05   40.1
R&gt; 3 AAP     2010-01-06   40.5
R&gt; 4 AAP     2010-01-07   40.5
R&gt; 5 AAP     2010-01-08   40.6</code></pre>
<p>Column selection can also be performed using names, as in the following example:</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># selecting rows 1 to 3, columns 'ticker' and 'prices'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'tickers'</span>, <span class="st">'prices'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 2
R&gt;   tickers prices
R&gt;   &lt;chr&gt;    &lt;dbl&gt;
R&gt; 1 AAP       40.4
R&gt; 2 AAP       40.1
R&gt; 3 AAP       40.5</code></pre>
<p>Or, using the pipeline operator and function <code><a href="https://dplyr.tidyverse.org/reference/slice.html">dplyr::slice</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code>: </p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my.temp</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tickers</span>, <span class="va">prices</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 3
R&gt; Columns: 2
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP"
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49</code></pre>
</div>
<div id="modifying-a-dataframe" class="section level3" number="6.1.5">
<h3>
<span class="header-section-number">6.1.5</span> Modifying a <code>dataframe</code><a class="anchor" aria-label="anchor" href="#modifying-a-dataframe"><i class="fas fa-link"></i></a>
</h3>
<p>To create new columns in a dataframe, simply use function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> and the <em>pipeline</em> operator. </p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add columns with mutate</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ret <span class="op">=</span> <span class="va">prices</span><span class="op">/</span><span class="fu">lag</span><span class="op">(</span><span class="va">prices</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>         seq_1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span>,</span>
<span>         seq_2 <span class="op">=</span>  <span class="va">seq_1</span> <span class="op">+</span><span class="fl">9</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 6
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP", "AAP", "AAP", "COG", …
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-…
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, …
R&gt; $ ret     &lt;dbl&gt; NA, -0.0059435364, 0.0087194818, -0.000246…
R&gt; $ seq_1   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…
R&gt; $ seq_2   &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…</code></pre>
<p>All new columns are defined as arguments in <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code>. Also note we use the <code>price</code> column to construct <code>ret</code>, the daily return of prices. A special case here is the creation of column <code>seq_2</code> based on <code>seq_1</code>, that is, even before it is explicitly calculated, it is possible to use the new column to create another one.</p>
<p>Another, more traditional way of creating new columns is using operator <code>$</code>:</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add new column with base R</span></span>
<span><span class="va">my_df</span><span class="op">$</span><span class="va">seq_3</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 7
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP", "AAP", "AAP", "COG", …
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-…
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, …
R&gt; $ ret     &lt;dbl&gt; NA, -0.0059435364, 0.0087194818, -0.000246…
R&gt; $ seq_1   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…
R&gt; $ seq_2   &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…
R&gt; $ seq_3   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…</code></pre>
<p>Therefore, you can use <code>$</code> to either access or modify a dataframe.</p>
<p>Going further, if we try to create a column with the number of elements different than the number of rows of the target <code>dataframe</code>, an error will appear.</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>seq_3 <span class="op">=</span>  <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Error: Column `seq_3` must be length 20 (the number of rows) ...</code></pre>
<p>However, due to the simplified recycling rule, we can use single values to fill up a whole column:</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>seq_3 <span class="op">=</span>  <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 7
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP", "AAP", "AAP", "COG", …
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-…
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, …
R&gt; $ ret     &lt;dbl&gt; NA, -0.0059435364, 0.0087194818, -0.000246…
R&gt; $ seq_1   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…
R&gt; $ seq_2   &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…
R&gt; $ seq_3   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
<p>To remove columns from a <code>dataframe</code>, use function <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code> with the minus symbol for the undesired columns:</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># removing columns</span></span>
<span><span class="va">my_df.temp</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">seq_1</span>, <span class="op">-</span><span class="va">seq_2</span>, <span class="op">-</span><span class="va">seq_3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 4
R&gt; $ tickers &lt;chr&gt; "AAP", "AAP", "AAP", "AAP", "AAP", "COG", …
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-…
R&gt; $ prices  &lt;dbl&gt; 40.38, 40.14, 40.49, 40.48, 40.64, 46.23, …
R&gt; $ ret     &lt;dbl&gt; NA, -0.0059435364, 0.0087194818, -0.000246…</code></pre>
<p>Using base R, the traditional way of removing columns is to allocate a single value <code>NULL</code> to its contents:</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set temp df</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span></span>
<span></span>
<span><span class="co"># remove cols</span></span>
<span><span class="va">temp_df</span><span class="op">$</span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_df</span><span class="op">$</span><span class="va">dates</span>  <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_df</span><span class="op">$</span><span class="va">ret</span>  <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp_df</span><span class="op">$</span><span class="va">tickers</span>  <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 20
R&gt; Columns: 3
R&gt; $ seq_1 &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…
R&gt; $ seq_2 &lt;dbl&gt; 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, …
R&gt; $ seq_3 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</code></pre>
</div>
<div id="filtering-rows-of-a-dataframe" class="section level3" number="6.1.6">
<h3>
<span class="header-section-number">6.1.6</span> Filtering rows of a <code>dataframe</code><a class="anchor" aria-label="anchor" href="#filtering-rows-of-a-dataframe"><i class="fas fa-link"></i></a>
</h3>
<p>A fairly common <code>dataframe</code> operation in R is to filter rows according to one or more conditions. For example, if we only wanted data from the <code>'COG'</code> stock, we could use the <code>filter</code> function to filter the table: </p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter df for single stock</span></span>
<span><span class="va">my_df.temp</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tickers</span> <span class="op">==</span> <span class="st">'COG'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 5
R&gt; Columns: 7
R&gt; $ tickers &lt;chr&gt; "COG", "COG", "COG", "COG", "COG"
R&gt; $ dates   &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2010-0…
R&gt; $ prices  &lt;dbl&gt; 46.23, 46.17, 45.97, 45.56, 45.46
R&gt; $ ret     &lt;dbl&gt; 0.137549213, -0.001297859, -0.004331817, …
R&gt; $ seq_1   &lt;int&gt; 6, 7, 8, 9, 10
R&gt; $ seq_2   &lt;dbl&gt; 15, 16, 17, 18, 19
R&gt; $ seq_3   &lt;dbl&gt; 1, 1, 1, 1, 1</code></pre>
<p>We can go further and also filter data for <code>'COG'</code> and dates after <code>'2010-01-05'</code>:</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter df for single stock and date</span></span>
<span><span class="va">my_df.temp</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tickers</span> <span class="op">==</span> <span class="st">'COG'</span>,</span>
<span>         <span class="va">dates</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2010-01-05'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 3
R&gt; Columns: 7
R&gt; $ tickers &lt;chr&gt; "COG", "COG", "COG"
R&gt; $ dates   &lt;date&gt; 2010-01-06, 2010-01-07, 2010-01-08
R&gt; $ prices  &lt;dbl&gt; 45.97, 45.56, 45.46
R&gt; $ ret     &lt;dbl&gt; -0.004331817, -0.008918860, -0.002194908
R&gt; $ seq_1   &lt;int&gt; 8, 9, 10
R&gt; $ seq_2   &lt;dbl&gt; 17, 18, 19
R&gt; $ seq_3   &lt;dbl&gt; 1, 1, 1</code></pre>
<p>Here we used symbol <code>==</code> to test for equality in column <code>ticker</code> and <em>greater than</em> (&gt;) for selecting the rows where the dates are after 2010-01-05. There are plenty more operators for all kinds of logical conditions. We will study these in chapter <a href="basic-classes.html#basic-classes">7</a>.</p>
</div>
<div id="sorting-a-dataframe" class="section level3" number="6.1.7">
<h3>
<span class="header-section-number">6.1.7</span> Sorting a <code>dataframe</code><a class="anchor" aria-label="anchor" href="#sorting-a-dataframe"><i class="fas fa-link"></i></a>
</h3>
<p>After creating or importing a <code>dataframe</code>, we can sort its rows according to the values of any column. A common case where a sort operation is needed is when financial or economic data is imported, but the dates are not ascending. Depending on the situation, it may be easier – or expected – to deal with data where the dates are always increasing along the rows, from top to bottom. The sorting operation in <code>dataframes</code> is performed using function <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">dplyr::arrange</a></code> or <code><a href="https://rdrr.io/r/base/order.html">base::order</a></code>. </p>
<p>As an example, consider creating a <code>dataframe</code> with these values:</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set new df</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                col3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it                  </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     4     1 a    
R&gt; 2     1     1 b    
R&gt; 3     2     3 c</code></pre>
<p>We use function <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">dplyr::arrange</a></code> and the <em>pipeline</em> operator to order the whole <code>dataframe</code> by the ascending values of column <code>col1</code>:</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort ascending, by col1 </span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">col1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     2     3 c    
R&gt; 3     4     1 a</code></pre>
<p>We can also sort by descending values using <code>desc</code>:</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort descending, col1 and col2</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">col1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     4     1 a    
R&gt; 2     2     3 c    
R&gt; 3     1     1 b</code></pre>
<p>And, for multiple columns, using extra arguments in <code>arrange</code>:</p>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort ascending, by col2 and col1</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">col2</span>, <span class="va">col1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     4     1 a    
R&gt; 3     2     3 c</code></pre>
<p>As for base R, function <code>order</code> returns the position of the elements for the sorted vector. With the first column of <code>my_df</code>, the positions of the elements in ascending order are:</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set index with positions of ascending order in col1</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">$</span><span class="va">col1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 3 2</code></pre>
<p>Therefore, when using the output of function <code>order</code> as an index of an existing <code>dataframe</code>, you get a new version of the <code>dataframe</code>, where all rows are set according to the ascending values of a particular column. See an example next:</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order my_df by col1</span></span>
<span><span class="va">my_df.2</span> <span class="op">&lt;-</span> <span class="va">my_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">$</span><span class="va">col1</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df.2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     2     3 c    
R&gt; 3     4     1 a</code></pre>
<p>This operation may also be performed considering more than one column. See the following example, where we sort the rows of <code>my_df</code> using columns <code>col2</code> and <code>col1</code>.</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort df with col2 and col1</span></span>
<span><span class="va">my_df.3</span> <span class="op">&lt;-</span> <span class="va">my_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">$</span><span class="va">col2</span>, <span class="va">my_df</span><span class="op">$</span><span class="va">col1</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df.3</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 3 × 3
R&gt;    col1  col2 col3 
R&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
R&gt; 1     1     1 b    
R&gt; 2     4     1 a    
R&gt; 3     2     3 c</code></pre>
</div>
<div id="combining-and-aggregating-dataframes" class="section level3" number="6.1.8">
<h3>
<span class="header-section-number">6.1.8</span> Combining and Aggregating <code>dataframes</code><a class="anchor" aria-label="anchor" href="#combining-and-aggregating-dataframes"><i class="fas fa-link"></i></a>
</h3>
<p>In the practice of manipulating data, often you must aggregate multiple <code>dataframes</code> into a single one. This usually happens when the heterogeneous data is imported from different sources and we must bind them into a single table. In the simplest case of combining <code>dataframes</code>, we join them according to the rows (vertically) or columns (horizontally). For that, we have functions <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows</a></code> (alternative to <code><a href="https://rdrr.io/r/base/cbind.html">base::rbind</a></code>) and <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_cols</a></code> (alternative to <code><a href="https://rdrr.io/r/base/cbind.html">base::cbind</a></code>). Examples of usage are given next. </p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set two dfs with same colnames</span></span>
<span><span class="va">my_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, </span>
<span>                  col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span>, </span>
<span>                  col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'b'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bind them by rows</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">my_df_1</span>, <span class="va">my_df_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 10 × 2
R&gt;     col1 col2 
R&gt;    &lt;int&gt; &lt;chr&gt;
R&gt;  1     1 a    
R&gt;  2     2 a    
R&gt;  3     3 a    
R&gt;  4     4 a    
R&gt;  5     5 a    
R&gt;  6     6 b    
R&gt;  7     7 b    
R&gt;  8     8 b    
R&gt;  9     9 b    
R&gt; 10    10 b</code></pre>
<p>Notice that, in the previous example, the names of columns are the same between <code>my_df_1</code> and <code>my_df_2</code>. Function <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows</a></code> is very clever and will search for shared names and correctly bind the data, even if the column positions are different. If we swapped the positions of the columns, there would be no change in the result of the bind operation.</p>
<p>Another interesting aspect of <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows</a></code> is that, if the names of the columns don’t match, the unmatched columns will return a <code>NA</code> result (not available). This means we can bind tables with different column names:</p>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set two df with different colnames</span></span>
<span><span class="va">my_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, </span>
<span>                  col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span>, </span>
<span>                  col3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'b'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bind them by rows (NA values for missing cols)</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">my_df_1</span>, </span>
<span>                   <span class="va">my_df_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 10 × 3
R&gt;     col1 col2  col3 
R&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
R&gt;  1     1 a     &lt;NA&gt; 
R&gt;  2     2 a     &lt;NA&gt; 
R&gt;  3     3 a     &lt;NA&gt; 
R&gt;  4     4 a     &lt;NA&gt; 
R&gt;  5     5 a     &lt;NA&gt; 
R&gt;  6     6 &lt;NA&gt;  b    
R&gt;  7     7 &lt;NA&gt;  b    
R&gt;  8     8 &lt;NA&gt;  b    
R&gt;  9     9 &lt;NA&gt;  b    
R&gt; 10    10 &lt;NA&gt;  b</code></pre>
<p>For the case of column bind with function <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_cols</a></code>, the names of the columns must be different, but the number of rows must be the same: </p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set two dfs</span></span>
<span><span class="va">my_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, </span>
<span>                  col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col3 <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span>, </span>
<span>                  col4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'b'</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># column bind dfs</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">my_df_1</span>, <span class="va">my_df_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;   col1 col2 col3 col4
R&gt; 1    1    a    6    b
R&gt; 2    2    a    7    b
R&gt; 3    3    a    8    b
R&gt; 4    4    a    9    b
R&gt; 5    5    a   10    b</code></pre>
<p>Sometimes, aggregating different tables won’t be as easy as simply row or column binding. For example, imagine you have data for annual unemployment rates in one <code>dataframe</code> and data for monthly inflation in another. There, you can’t just bind their columns as their frequency and number of rows are different. The solution is to use an index (or table key) – a vector of dates – that relates both tables.</p>
<p>For that, you can use functions <code>dplyr::join*</code> to merge two dataframes using one or more indexes. This includes <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::inner_join</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join</a></code>, and many others. The main difference between them is how you treat the row cases without a match. For example, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::inner_join</a></code> keeps only the data where it finds a matching index, while <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join</a></code> keep everything from both tables and fills the missing information with <code>NA</code> values. Let’s have a closer look by using a practical example of both.</p>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set df</span></span>
<span><span class="va">my_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2016-01-01'</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2016-01-05'</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">30</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Please do notice that both dataframes share a column called <code>date</code>, which will be automatically used as a matching index.</p>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aggregate tables</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">my_df_1</span>, </span>
<span>                    <span class="va">my_df_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Joining, by = "date"</code></pre>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 7
R&gt; Columns: 3
R&gt; $ date &lt;date&gt; 2016-01-05, 2016-01-06, 2016-01-07, 2016-01-…
R&gt; $ x    &lt;int&gt; 5, 6, 7, 8, 9, 10, 11
R&gt; $ y    &lt;dbl&gt; 20, 21, 22, 23, 24, 25, 26</code></pre>
<p>Now with <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join</a></code>:</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aggregate tables</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">my_df_1</span>, </span>
<span>                   <span class="va">my_df_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Joining, by = "date"</code></pre>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 15
R&gt; Columns: 3
R&gt; $ date &lt;date&gt; 2016-01-01, 2016-01-02, 2016-01-03, 2016-01-…
R&gt; $ x    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, NA, NA, NA…
R&gt; $ y    &lt;dbl&gt; NA, NA, NA, NA, 20, 21, 22, 23, 24, 25, 26, 2…</code></pre>
<p>Notice the difference in the number of rows from one to the other. When using <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::full_join</a></code>, all unmatched cases are set to <code>NA</code>.</p>
<p>If we had <code>dataframes</code> with different column names, we can also set the index explicitly with argument <code>by</code> of <code>dplyr::*_join</code>. See the next example, where we set different column names and still match the data using a vector of dates:</p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set df</span></span>
<span><span class="va">my_df_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>ref_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2016-01-01'</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_df_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>my_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2016-01-05'</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">30</span>, length.out <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join by my_df.3$ref.date and my_df.4$my.date</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">my_df_3</span>, <span class="va">my_df_4</span>,</span>
<span>                    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ref_date'</span> <span class="op">=</span> <span class="st">'my_date'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 7
R&gt; Columns: 3
R&gt; $ ref_date &lt;date&gt; 2016-01-05, 2016-01-06, 2016-01-07, 2016…
R&gt; $ x        &lt;int&gt; 5, 6, 7, 8, 9, 10, 11
R&gt; $ y        &lt;dbl&gt; 20, 21, 22, 23, 24, 25, 26</code></pre>
<p>Whenever you need to combine tables that share information, use one of the <code>dplyr::*_join</code> functions. The decision of how to treat the unmatched cases will depend on the problem you’re analyzing.</p>
</div>
<div id="extensions-of-the-dataframe-class" class="section level3" number="6.1.9">
<h3>
<span class="header-section-number">6.1.9</span> Extensions of the <code>dataframe</code> Class<a class="anchor" aria-label="anchor" href="#extensions-of-the-dataframe-class"><i class="fas fa-link"></i></a>
</h3>
<p>As mentioned in the previous chapter, one benefit of using R is the existence of a range of packages designed to deal with specific problems. This is also true for extensions of the basic data structure. While the <code>tibble</code> class is a good solution for most cases, sometimes, it can make more sense to store the data in a specific type of custom object. Over time, several solutions have been developed.</p>
<p>For example, it is common in economic and financial research to work with numeric data indexed by time. We can store this data in a matrix format, so each line represents dates and each column represents a variable. With this structure, time operations, such as period aggregations, are easier to perform. This is the main idea of package <code>xts</code> <span class="citation">(<a href="references.html#ref-R-xts" role="doc-biblioref">Ryan and Ulrich 2022</a>)</span>. The great benefit of this alternative <code>dataframe</code> is that several functions for time aggregation and manipulation are available. We can turn a whole set of daily data for several variables to the weekly frequency in one line of code. In addition, various other functions automatically recognize the time index and adapt accordingly. One example is the creation of a figure with the values of a variable over time. The horizontal axes of the figure are automatically arranged as dates. </p>
<p>See the following example, where we represent the previous stock data as an <code>xts</code> object: </p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load pkg</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/xts">xts</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set ticker symbols as a vector</span></span>
<span><span class="va">tickers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'AAP'</span>, <span class="st">'COG'</span>, <span class="st">'BLK'</span>, <span class="st">'CAM'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set a date vector</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-01-04"</span>, <span class="st">"2010-01-05"</span>, <span class="st">"2010-01-06"</span>, </span>
<span>                   <span class="st">"2010-01-07"</span>, <span class="st">"2010-01-08"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set prices as  matrix                   </span></span>
<span><span class="va">price_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40.38</span>,  <span class="fl">40.13</span>,  <span class="fl">40.49</span>,  <span class="fl">40.48</span>,  <span class="fl">40.63</span>,</span>
<span>                         <span class="fl">46.23</span>,  <span class="fl">46.16</span>,  <span class="fl">45.97</span>,  <span class="fl">45.56</span>,  <span class="fl">45.45</span>,</span>
<span>                         <span class="fl">238.58</span>, <span class="fl">239.61</span>, <span class="fl">234.66</span>, <span class="fl">237.25</span>, <span class="fl">238.91</span>,</span>
<span>                         <span class="fl">43.43</span>,  <span class="fl">43.95</span>,  <span class="fl">44.25</span>,  <span class="fl">44.5</span>,   <span class="fl">44.86</span><span class="op">)</span>,</span>
<span>                       nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set xts object</span></span>
<span><span class="va">my_xts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">price_matrix</span>, order.by <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set colnames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">my_xts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tickers</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_xts</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;              AAP   COG    BLK   CAM
R&gt; 2010-01-04 40.38 46.23 238.58 43.43
R&gt; 2010-01-05 40.13 46.16 239.61 43.95
R&gt; 2010-01-06 40.49 45.97 234.66 44.25
R&gt; 2010-01-07 40.48 45.56 237.25 44.50
R&gt; 2010-01-08 40.63 45.45 238.91 44.86</code></pre>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show its class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_xts</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "xts" "zoo"</code></pre>
<p>In creating the <code>xts</code> object, notice how the time index is explicitly defined using argument <code>order.by</code>. This is a necessary step in creating every <code>xts</code> object.</p>
<p>The previous code can give the impression that the object <code>my_xts</code> is similar to a native <code>dataframe</code>. However, make no mistake. By having an explicit time index, object <code>my_xts</code> can be used for several privileged procedures. See the following example, where we create a new <code>xts</code> object with two columns and calculate the average of each column on a weekly basis.</p>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set number of time periods</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># create matrix with data</span></span>
<span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set xts object</span></span>
<span><span class="va">my_xts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">my_mat</span>, order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2018-01-01'</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply mean function for each week</span></span>
<span><span class="va">my_xts_weekly_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/apply.monthly.html">apply.weekly</a></span><span class="op">(</span><span class="va">my_xts</span>, <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_xts_weekly_mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;             X.1   X.2
R&gt; 2018-01-07  3.5 497.5
R&gt; 2018-01-14 10.0 491.0
R&gt; 2018-01-21 17.0 484.0
R&gt; 2018-01-28 24.0 477.0
R&gt; 2018-02-04 31.0 470.0
R&gt; 2018-02-11 38.0 463.0</code></pre>
<p>In finance and economics, these time aggregations with <code>xts</code> objects are useful when working with data at different time frequencies. It is common to aggregate transaction data in the financial market for high-frequency intervals of 5 by 5 minutes. Such a procedure is easily accomplished in R through the correct representation of the data as <code>xts</code> objects. There are several other features in this package. Users that work frequently with time-indexed data are encouraged to read the <a href="https://cran.r-project.org/web/packages/xts/xts.pdf">manual</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://cran.r-project.org/web/packages/xts/xts.pdf" class="uri"&gt;https://cran.r-project.org/web/packages/xts/xts.pdf&lt;/a&gt;&lt;/p&gt;'><sup>56</sup></a> and learn more about it.</p>
<p>Package <code>xts</code> is not alone as an alternative to <code>dataframes</code>. For example, the data structure proposed by package <code>data.table</code> <span class="citation">(<a href="references.html#ref-R-data.table" role="doc-biblioref">Dowle and Srinivasan 2022</a>)</span> prioritizes processing time and uses a compact notation. If you like short notations for writing code and need a quick execution time, <code>data.table</code> is an impressive and powerful package. As another example, package <code>tibbletime</code> <span class="citation">(<a href="references.html#ref-R-tibbletime" role="doc-biblioref">Vaughan and Dancho 2022</a>)</span> is, well, a time-oriented version of <code>tibble</code>, bringing together the benefits of <code>tidyverse</code> and <code>xts</code>. </p>
</div>
<div id="other-useful-functions-for-handling-dataframes" class="section level3" number="6.1.10">
<h3>
<span class="header-section-number">6.1.10</span> Other Useful Functions for Handling <code>dataframes</code><a class="anchor" aria-label="anchor" href="#other-useful-functions-for-handling-dataframes"><i class="fas fa-link"></i></a>
</h3>
<p><strong>head</strong> Returns the first <code>n</code> rows of a <code>dataframe</code>. This function is mostly used for showing only a small part of a <code>dataframe</code> in the prompt. </p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set df</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5000</span>, </span>
<span>                col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print its first 5 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    col1 col2 
R&gt;   &lt;int&gt; &lt;chr&gt;
R&gt; 1     1 a    
R&gt; 2     2 a    
R&gt; 3     3 a    
R&gt; 4     4 a    
R&gt; 5     5 a</code></pre>
<p><strong>tail</strong> - Returns the last <code>n</code> rows of a <code>dataframe</code>. Also used to glimpse the last rows of a <code>dataframe</code>. </p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print its last 5 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;    col1 col2 
R&gt;   &lt;int&gt; &lt;chr&gt;
R&gt; 1  4996 a    
R&gt; 2  4997 a    
R&gt; 3  4998 a    
R&gt; 4  4999 a    
R&gt; 5  5000 a</code></pre>
<p><strong>complete.cases</strong> - Returns a logical vector with the same length as the number of rows of the <code>dataframe</code>, containing <code>TRUE</code> when all columns have non <code>NA</code> values and <code>FALSE</code> otherwise. </p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create df</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="cn">NA</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 7 × 2
R&gt;       x     y
R&gt;   &lt;dbl&gt; &lt;int&gt;
R&gt; 1     1     5
R&gt; 2     2     6
R&gt; 3     3     7
R&gt; 4     4     8
R&gt; 5     5     9
R&gt; 6    NA    10
R&gt; 7    10    NA</code></pre>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print logical test of complete.cases</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print all rows where there is at least one NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 6 7</code></pre>
<p><strong>na.omit</strong> - Returns a <code>dataframe</code> without the rows where a <code>NA</code> in any column is found. </p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 5 × 2
R&gt;       x     y
R&gt;   &lt;dbl&gt; &lt;int&gt;
R&gt; 1     1     5
R&gt; 2     2     6
R&gt; 3     3     7
R&gt; 4     4     8
R&gt; 5     5     9</code></pre>
<p><strong>unique</strong> - Returns a <code>dataframe</code> where all duplicated rows are removed and only the unique cases, row-wise, are kept. </p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set df with repeating rows</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                    col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'C'</span>, <span class="st">'C'</span>, <span class="st">'B'</span>, <span class="st">'D'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it                  </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;   col1 col2
R&gt; 1    1    A
R&gt; 2    1    A
R&gt; 3    2    A
R&gt; 4    3    C
R&gt; 5    3    C
R&gt; 6    4    B
R&gt; 7    5    D</code></pre>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print unique df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;   col1 col2
R&gt; 1    1    A
R&gt; 3    2    A
R&gt; 4    3    C
R&gt; 6    4    B
R&gt; 7    5    D</code></pre>
</div>
</div>
<div id="lists" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> <code>Lists</code><a class="anchor" aria-label="anchor" href="#lists"><i class="fas fa-link"></i></a>
</h2>
<p>A <code>list</code> is a flexible container that can hold many elements. Unlike atomic vectors, a <code>list</code> has no restriction on the classes or types of elements – we can group <code>numeric</code> objects with <code>character</code> objects, <code>factor</code> with <code>Dates</code> and even <code>lists</code> within <code>lists</code>. Likewise, each element of a list need not have the same length as the others. We can also name each element within a <code>list</code>. These properties make the <code>list</code> class the most flexible object in R. It is not by accident that several functions in R return an object of type <code>list</code>. </p>
<div id="creating-lists" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Creating <code>lists</code><a class="anchor" aria-label="anchor" href="#creating-lists"><i class="fas fa-link"></i></a>
</h3>
<p>A <code>list</code> can be created with the <code><a href="https://rdrr.io/r/base/list.html">base::list</a></code> command, followed by their comma-separated elements: </p>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use base::print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt; [1] 1 2 3
R&gt; 
R&gt; [[2]]
R&gt; [1] "a" "b"
R&gt; 
R&gt; [[3]]
R&gt; [1] &lt;NA&gt;
R&gt; Levels: C
R&gt; 
R&gt; [[4]]
R&gt;   col1
R&gt; 1    1
R&gt; 2    2
R&gt; 3    3
R&gt; 4    4
R&gt; 5    5</code></pre>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use dplyr::glimpse</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 4
R&gt;  $ : num [1:3] 1 2 3
R&gt;  $ : chr [1:2] "a" "b"
R&gt;  $ : Factor w/ 1 level "C": NA
R&gt;  $ :'data.frame':    5 obs. of  1 variable:
R&gt;   ..$ col1: int [1:5] 1 2 3 4 5</code></pre>
<p>Notice how we gather four objects: a numeric vector, a character vector, a factor and a dataframe/tibble into a single <code>list</code>. Also, notice that a <code>list</code> type object is printed differently than atomic vectors. The elements of the <code>list</code> are separated vertically and the content appears within double brackets (<code>[[ ]]</code>). We will soon learn that we can access its elements in the same way, by using double brackets.</p>
<p>Following other objects, the elements of a <code>list</code> can also be named, making it easier to work with heterogenous data. For example, let’s consider a set of data with information about a particular company traded in the NYSE market:</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set named list</span></span>
<span><span class="va">my_named_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>tickers <span class="op">=</span> <span class="st">'CMPY'</span>,</span>
<span>                   markets <span class="op">=</span> <span class="st">'NYSE'</span>,</span>
<span>                   df_prices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1.5</span>,<span class="fl">2</span>,<span class="fl">2.3</span><span class="op">)</span>,</span>
<span>                                          ref_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check content</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_named_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 3
R&gt;  $ tickers  : chr "CMPY"
R&gt;  $ markets  : chr "NYSE"
R&gt;  $ df_prices:'data.frame':   4 obs. of  2 variables:
R&gt;   ..$ P       : num [1:4] 1 1.5 2 2.3
R&gt;   ..$ ref_date: Date[1:4], format: "2022-11-23" ...</code></pre>
<p>The data is organized in a single object, facilitating the import/export of the data and the analysis.</p>
<div class="rmdimportant">
<p>
Every time you work with lists, make your life easier by naming all
elements intuitively. Avoid the use of the position of the element in a
list, which can change when lists expand of contract. Using names
facilitates access and avoids possible errors in the code.
</p>
</div>
</div>
<div id="accessing-the-elements-of-a-list" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Accessing the Elements of a <code>list</code><a class="anchor" aria-label="anchor" href="#accessing-the-elements-of-a-list"><i class="fas fa-link"></i></a>
</h3>
<p>As mentioned, the individual elements of a <code>list</code> can be accessed with double brackets ( <code>[[ ]]</code>), as in: </p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># accessing elements from list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_named_l</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "NYSE"</code></pre>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_named_l</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;     P   ref_date
R&gt; 1 1.0 2022-11-23
R&gt; 2 1.5 2022-11-24
R&gt; 3 2.0 2022-11-25
R&gt; 4 2.3 2022-11-26</code></pre>
<p>You can also access the elements of a <code>list</code> with simple brackets (<code>[]</code>), but be careful with this operation as the result will not be the element itself, but another <code>list</code>. This is a common mistake. See it below:</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'a'</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "numeric"</code></pre>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "list"</code></pre>
<p>If we try to add an element to <code>my_l[2]</code>, we will receive an error message.</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding an element to a list (WRONG)</span></span>
<span><span class="va">my_l</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<pre><code>R&gt; Error in my_l[2] + 1: non-numeric argument to binary operator</code></pre>
<p>An error is returned because a <code>list</code> object cannot be summed with a <code>numeric</code> object. To fix it, simply use double brackets, as in <code>my_l[[2]] + 1</code>. Accessing elements of a list with simple brackets is only useful when looking for a sub-list within a larger list. As an example, if we wanted to obtain the first and second elements of <code>my_l</code>, we would write:</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set new list with the first and second element of my_l</span></span>
<span><span class="va">my_new_l</span> <span class="op">&lt;-</span> <span class="va">my_l</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_new_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt; [1] "a"
R&gt; 
R&gt; [[2]]
R&gt; [1] 1 2 3</code></pre>
<p>With the named lists, we can access its elements with operator <code>$</code> as in <code>my_named_l$df_prices</code> or using the element’s name. In general, this is a more efficient and advised way of working with <code>lists</code>. Avoid using positional access of a <code>list</code>. The problem is, if you are working interactively with a <code>list</code>, the position of the elements may change as new data arrives. Using names prevents this problem because, by modifying the <code>list</code> and adding elements, you can change the order of elements, but not the names.</p>
<div class="rmdimportant">
<p>
Be aware that RStudio’s <em>autocomplete</em> tool also works for
lists. To use it, enter the list name followed by <code>$</code> and
press <em>tab</em>. A dialog box with all the elements available in the
list will appear. From there, just select the desired element by
pressing <em>enter</em>.
</p>
</div>
<p>Next, we provide several examples of how to access the elements of a <code>list</code> using operator <code>$</code> and double brackets.</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># different ways to access a list</span></span>
<span><span class="va">my_named_l</span><span class="op">$</span><span class="va">tickers</span></span>
<span><span class="va">my_named_l</span><span class="op">$</span><span class="va">markets</span></span>
<span><span class="va">my_named_l</span><span class="op">[[</span><span class="st">'tickers'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">my_named_l</span><span class="op">[[</span><span class="st">'markets'</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Another useful trick for working with lists is you can access all inner elements directly – in one line of code – by simply using consecutive brackets or names. See below:</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>slot1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>num1 <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                       num2 <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                       num3 <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             slot2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># access the second value of the first element of my_l</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; num2 
R&gt;    2</code></pre>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># access the first value of the second element of my_l</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "a"</code></pre>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># access the value 'num3' in 'slot1'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[[</span><span class="st">'slot1'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">'num3'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; num3 
R&gt;    3</code></pre>
<p>This operation is very useful when interested in a few elements within a larger object. It avoids the need for creating intermediate objects.</p>
</div>
<div id="adding-and-removing-elements-from-a-list" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> Adding and Removing Elements from a <code>list</code><a class="anchor" aria-label="anchor" href="#adding-and-removing-elements-from-a-list"><i class="fas fa-link"></i></a>
</h3>
<p>To add or replace elements in a <code>list</code>, just set the new object in the desired position:</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 3
R&gt;  $ : chr "a"
R&gt;  $ : num 1
R&gt;  $ : num 3</code></pre>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add new elements to list</span></span>
<span><span class="va">my_l</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">my_l</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'b'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 4
R&gt;  $ : chr "a"
R&gt;  $ : chr "b"
R&gt;  $ : num 3
R&gt;  $ : int [1:5] 1 2 3 4 5</code></pre>
<p>This operation is also possible with the use of names and <code>$</code>:</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>elem1 <span class="op">=</span> <span class="st">'a'</span>, </span>
<span>             name1<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set new element</span></span>
<span><span class="va">my_l</span><span class="op">$</span><span class="va">name2</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># check it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 3
R&gt;  $ elem1: chr "a"
R&gt;  $ name1: num 5
R&gt;  $ name2: num 10</code></pre>
<p>To remove elements from a <code>list</code>, set the element to the reserved symbol <code>NULL</code>, as in: </p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">'b'</span>, num1 <span class="op">=</span> <span class="fl">2</span>, num2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 3
R&gt;  $ text: chr "b"
R&gt;  $ num1: num 2
R&gt;  $ num2: num 4</code></pre>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove elements</span></span>
<span><span class="va">my_l</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 2
R&gt;  $ text: chr "b"
R&gt;  $ num1: num 2</code></pre>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove elements</span></span>
<span><span class="va">my_l</span><span class="op">$</span><span class="va">num1</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 1
R&gt;  $ text: chr "b"</code></pre>
<p>Another way of removing elements from a <code>list</code> is to use a negative index, which will exclude it from the returned object. See the next example, where we remove the second element of a <code>list</code> using a negative index.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, </span>
<span>             b <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove second element</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">[[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  num 1</code></pre>
<p>As with atomic vectors, removing elements of a <code>list</code> can also be accomplished with logical conditions. See next:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list</span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove elements by condition</span></span>
<span><span class="va">my_l</span><span class="op">[</span><span class="va">my_l</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; List of 2
R&gt;  $ : num 1
R&gt;  $ : num 2</code></pre>
<p>However, note this operation only works because all elements of <code>my_l</code> are numeric, and a logical test can be applied to all cases. If that is impossible for a particular element, R will return an <code>NA</code> value.</p>
</div>
<div id="processing-the-elements-of-a-list" class="section level3" number="6.2.4">
<h3>
<span class="header-section-number">6.2.4</span> Processing the Elements of a <code>list</code><a class="anchor" aria-label="anchor" href="#processing-the-elements-of-a-list"><i class="fas fa-link"></i></a>
</h3>
<p>A very important point about working with <code>lists</code> is that its elements can be iterated in a very simple and direct way. For example, if you have a <code>list</code> with twenty dataframes, you can easily apply function <code><a href="https://rdrr.io/r/base/summary.html">base::summary</a></code> to all of them in a single line of code. As an example, consider a list of numeric vectors of different sizes:</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set list with different numerical vectors.</span></span>
<span><span class="va">my_l_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>, </span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">5</span>, by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s assume we need to calculate the average of each vector in <code>my_l_num</code> and store the result in an atomic vector. We could do this operation by calling the <code>mean</code> function to each element of the <code>list</code>, as in: </p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate means</span></span>
<span><span class="va">mean_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_l_num</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mean_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_l_num</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mean_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_l_num</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mean_1</span>, <span class="va">mean_2</span>, <span class="va">mean_3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  2.0 25.5  0.0</code></pre>
<p>However, the code looks bad and it took three lines of code, not one! An easier, more elegant, and smarter way of doing that would be to use the <code>sapply</code> function, which will apply a function to each element of a list. All you need is the name of the list object and the name of the function used to process each element: </p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using sapply</span></span>
<span><span class="va">my_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">my_l_num</span>, <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mean</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  2.0 25.5  0.0</code></pre>
<p>As expected, the result is identical to the previous example. Using function <code>sapply</code> is preferable, because it is more compact and efficient than the alternative - creating <code>mean_1</code>, and <code>mean_2</code> and <code>mean_3</code>. Notice the first example code only works for a <code>list</code> with three elements. If we had a fourth element and we wanted to keep this code structure, we would have to add a new line <code>mean_4 &lt;- mean(my_l_num[[4]])</code> and modify the output command to <code>print &lt;-c(mean_1, mean_2, mean_3, mean_4))</code>.</p>
<p>Intelligently, function <code>sapply</code> works the same way in <code>lists</code> of any size. If we had more elements in <code>my_l_num</code>, no modification is necessary for <code>my_mean &lt;- sapply(my_l_num, mean)</code>, making it easier to extend the code for more information. By combining a flexible object, such as a <code>list</code>, with the programming capacity of R, performing extensive operations in many complex objects becomes easy.</p>
<p>Using generic procedures is one premise of good and efficient programming practices. For the case of R, the rule is simple: <strong>always write code flexible to the size of your objects</strong>. The arrival of new data should never require modifications in the code. This is called the <em>DRY</em> rule (<strong>don’t repeat yourself</strong>). If you are repeating lines of code, as in the previous example, certainly a more elegant and flexible solution could be used. This section only gives a taste of the programming capacity of R. This will be explained in greater detail in chapter <a href="programming.html#programming">8</a>.</p>
</div>
<div id="other-useful-functions" class="section level3" number="6.2.5">
<h3>
<span class="header-section-number">6.2.5</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions"><i class="fas fa-link"></i></a>
</h3>
<p><strong>unlist</strong> - Returns the elements of a <code>list</code> in a single atomic vector. </p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_named_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ticker <span class="op">=</span> <span class="st">'XXXX4'</span>,</span>
<span>                   price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1.5</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                   market <span class="op">=</span> <span class="st">'Be'</span><span class="op">)</span></span>
<span><span class="va">my_unlisted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">my_named_l</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_unlisted</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  ticker  price1  price2  price3  price4  market 
R&gt; "XXXX4"     "1"   "1.5"     "2"     "3"    "Be"</code></pre>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_unlisted</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "character"</code></pre>
<p><strong>as.list</strong> - Converts an object to the <code>list</code> type. </p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">13</span></span>
<span><span class="va">my_x_as_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x_as_list</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt; [1] 10
R&gt; 
R&gt; [[2]]
R&gt; [1] 11
R&gt; 
R&gt; [[3]]
R&gt; [1] 12
R&gt; 
R&gt; [[4]]
R&gt; [1] 13</code></pre>
<p><strong>names</strong> - Returns or defines the names of the elements of a <code>list</code>. </p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>value1 <span class="op">=</span> <span class="fl">1</span>, value2 <span class="op">=</span> <span class="fl">2</span>, value3 <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "value1" "value2" "value3"</code></pre>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'num1'</span>, <span class="st">'num2'</span>, <span class="st">'num3'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; $num1
R&gt; [1] 1
R&gt; 
R&gt; $num2
R&gt; [1] 2
R&gt; 
R&gt; $num3
R&gt; [1] 3</code></pre>
</div>
</div>
<div id="matrices" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> <code>Matrices</code><a class="anchor" aria-label="anchor" href="#matrices"><i class="fas fa-link"></i></a>
</h2>
<p>A matrix is a two-dimensional representation of numbers, arranged in rows and columns. Using matrices is a powerful way of representing numerical data in two dimensions and, in certain situations, matrix functions can simplify complex mathematical operations. </p>
<p>In R, matrices are objects with two dimensions, where all elements must have the same class. You can think of matrices as atomic vectors with one extra dimension. In matrices, lines and columns can be named. When used correctly, <code>matrix</code> objects can facilitate the storage and context of the data. </p>
<p>A simple example of using matrices in finance is the representation of stock prices over time. The rows of the matrix represents the different dates, and the columns set each stock apart:</p>
<pre><code>R&gt; New names:
R&gt; • `` -&gt; `...1`</code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left"></th>
<th align="right">AAP</th>
<th align="right">COG</th>
<th align="right">BLK</th>
<th align="right">CAM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">40.38</td>
<td align="right">46.23</td>
<td align="right">238.58</td>
<td align="right">43.43</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">40.14</td>
<td align="right">46.17</td>
<td align="right">239.61</td>
<td align="right">43.96</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">40.49</td>
<td align="right">45.97</td>
<td align="right">234.67</td>
<td align="right">44.26</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">40.48</td>
<td align="right">45.56</td>
<td align="right">237.25</td>
<td align="right">44.50</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">40.64</td>
<td align="right">45.46</td>
<td align="right">238.92</td>
<td align="right">44.86</td>
</tr>
</tbody>
</table></div>
<p>The above matrix could be created in R with the following code:</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set raw data with prices </span></span>
<span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40.38</span>,  <span class="fl">40.14</span>,  <span class="fl">40.49</span>,  <span class="fl">40.48</span>,  <span class="fl">40.64</span>,</span>
<span>              <span class="fl">46.23</span>,  <span class="fl">46.17</span>,  <span class="fl">45.97</span>,  <span class="fl">45.56</span>,  <span class="fl">45.46</span>,</span>
<span>              <span class="fl">238.58</span>, <span class="fl">239.61</span>, <span class="fl">234.67</span>, <span class="fl">237.25</span>, <span class="fl">238.92</span>,</span>
<span>              <span class="fl">43.43</span>,  <span class="fl">43.96</span>,  <span class="fl">44.26</span>,  <span class="fl">44.5</span>,   <span class="fl">44.86</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create matrix          </span></span>
<span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">raw_data</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'AAP'</span>, <span class="st">'COG'</span>, <span class="st">'BLK'</span>, <span class="st">'CAM'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-01-04"</span>, <span class="st">"2010-01-05"</span>, <span class="st">"2010-01-06"</span>, </span>
<span>                      <span class="st">"2010-01-07"</span>, <span class="st">"2010-01-08"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;              AAP   COG    BLK   CAM
R&gt; 2010-01-04 40.38 46.23 238.58 43.43
R&gt; 2010-01-05 40.14 46.17 239.61 43.96
R&gt; 2010-01-06 40.49 45.97 234.67 44.26
R&gt; 2010-01-07 40.48 45.56 237.25 44.50
R&gt; 2010-01-08 40.64 45.46 238.92 44.86</code></pre>
<p>We set the number of rows and columns explicitly with arguments <code>nrow = 4</code> and <code>ncol = 3</code> in <code><a href="https://rdrr.io/r/base/matrix.html">base::matrix</a></code>. The names of rows and columns are defined with functions <code>colnames</code> and <code>rownames</code>, using a left side notation as in <code>rownames(my_mat) &lt;- c(...)</code>. Going further, we can also retrieve the names of rows and columns with the same functions: </p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the names of columns </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "AAP" "COG" "BLK" "CAM"</code></pre>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the names of rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2010-01-04" "2010-01-05" "2010-01-06" "2010-01-07"
R&gt; [5] "2010-01-08"</code></pre>
<p>After matrix <code>my_mat</code> is created, we have at our disposal all its numerical properties. A simple example of using matrix operations in finance is the calculation of the value of a portfolio. If an investor has 200 shares of AAP, 300 share of COG, 100 of BLK and 50 of CAM, the value of his portfolio over time can be calculated as follows:</p>
<p><span class="math display">\[V _t = \sum _{i=1} ^{4} N _i P_{i,t}\]</span></p>
<p>In this formula, <span class="math inline">\(N_i\)</span> is the number of shares purchased for each asset, and <span class="math inline">\(P_{i,t}\)</span> is the price of stock <em>i</em> at date <em>t</em>. This is a simple operation to be performed with a matrix multiplication. Translating the procedure to R code, we have:</p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector with shares purchased</span></span>
<span><span class="va">my_stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">100</span>, <span class="fl">50</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get value of portfolio with matrix multiplication</span></span>
<span><span class="va">my_port</span> <span class="op">&lt;-</span> <span class="va">my_mat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">my_stocks</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_port</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;               [,1]
R&gt; 2010-01-04 47974.5
R&gt; 2010-01-05 48038.0
R&gt; 2010-01-06 47569.0
R&gt; 2010-01-07 47714.0
R&gt; 2010-01-08 47901.0</code></pre>
<p>In this last example, we use symbol <code>%*%</code>, which does a matrix multiplication between two objects of the class <code>matrix</code>. The output shows the value of the portfolio over time, resulting in a small loss for the investor on the last date. </p>
<p>A <code>matrix</code> object is also flexible with its content, as long as it is a single class. For example, you can create matrices with <code>character</code> elements:</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create matrix with character</span></span>
<span><span class="va">my_mat_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                      nrow <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                      ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it                    </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3]
R&gt; [1,] "a"  "a"  "a" 
R&gt; [2,] "b"  "b"  "b" 
R&gt; [3,] "c"  "c"  "c"</code></pre>
<p>Now with a <code>logic</code> type:</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create matrix with logical</span></span>
<span><span class="va">my_mat_logical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>                                size <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fl">3</span>,</span>
<span>                                replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                         nrow <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                         ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it                    </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_logical</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;       [,1]  [,2]  [,3]
R&gt; [1,] FALSE  TRUE  TRUE
R&gt; [2,]  TRUE FALSE  TRUE
R&gt; [3,]  TRUE  TRUE FALSE</code></pre>
<p>This flexibility allows the user to expand the representation of two-dimensional data beyond numerical values.</p>
<div id="selecting-elements-from-a-matrix" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Selecting Elements from a <code>matrix</code><a class="anchor" aria-label="anchor" href="#selecting-elements-from-a-matrix"><i class="fas fa-link"></i></a>
</h3>
<p>Following the same notation as the atomic vector, you can select <em>pieces</em> of a <code>matrix</code> using indexes. A difference here is that matrices are two-dimensional objects, while atomic vectors are one-dimensional.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;To avoid confusion, atomic vectors in R have no dimension attribute in the strict sense of the function. When using the &lt;code&gt;dim&lt;/code&gt; function in an atomic vector, such as &lt;code&gt;dim(c(1,2,4))&lt;/code&gt;, the result is &lt;code&gt;NULL&lt;/code&gt;. Away from the computing environment, however, atomic vectors can be considered one-dimensional objects as it can only increase its size in one direction.&lt;/p&gt;"><sup>57</sup></a> The extra dimension of matrices requires selecting elements not only by lines, but also by columns. The elements of an array can be accessed with the notation <code>[i, j]</code> where <em>i</em> represents the row and <em>j</em> the column. See the following example:</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create matrix</span></span>
<span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># display it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3]
R&gt; [1,]    1    4    7
R&gt; [2,]    2    5    8
R&gt; [3,]    3    6    9</code></pre>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display element in [1,2]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 4</code></pre>
<p>To select an entire row or column, simply leave a blank index, as in the following example:</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select all rows from column 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 4 5 6</code></pre>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select all columns from row 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 4 7</code></pre>
<p>Notice the result of indexing is an atomic vector, not a <code>matrix</code>. If we wanted the extracted piece to maintain its <code>matrix</code> class, with vertical or horizontal orientation, we could force this conversion using functions <code>as.matrix</code> and <code>matrix</code>: </p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># force matrix conversion and print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span> ,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1]
R&gt; [1,]    4
R&gt; [2,]    5
R&gt; [3,]    6</code></pre>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># force matrix conversion for one row and print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3]
R&gt; [1,]    1    4    7</code></pre>
<p>Pieces of the <code>matrix</code> can also be selected using vectors. If we wanted a new <code>matrix</code> with all elements from the second row and first column to the third row and second column, we could use the following code:</p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select some elements and print them</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2]
R&gt; [1,]    2    5
R&gt; [2,]    3    6</code></pre>
<p>Finally, using logical tests to select elements of matrices is also possible: </p>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set matrix</span></span>
<span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print logical matrix where value is higher than 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span> <span class="op">&gt;</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;       [,1]  [,2] [,3]
R&gt; [1,] FALSE FALSE TRUE
R&gt; [2,] FALSE FALSE TRUE
R&gt; [3,] FALSE  TRUE TRUE</code></pre>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">[</span><span class="va">my_mat</span> <span class="op">&gt;</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 6 7 8 9</code></pre>
</div>
<div id="other-useful-functions-1" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong>as.matrix</strong> - Transforms raw data to a <code>matrix</code> object. </p>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1]
R&gt; [1,]    1
R&gt; [2,]    2
R&gt; [3,]    3
R&gt; [4,]    4
R&gt; [5,]    5</code></pre>
<p><strong>t</strong> - Returns a transposed <code>matrix</code>. </p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>, </span>
<span>                     length.out <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, </span>
<span>                 nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2]
R&gt; [1,]   10   16
R&gt; [2,]   12   18
R&gt; [3,]   14   20</code></pre>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3]
R&gt; [1,]   10   12   14
R&gt; [2,]   16   18   20</code></pre>
<p><strong>rbind</strong> - Returns the merger (bind) of matrices, with row orientation. </p>
<div class="sourceCode" id="cb508"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_1</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3] [,4] [,5]
R&gt; [1,]    1    2    3    4    5</code></pre>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">14</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3] [,4] [,5]
R&gt; [1,]   10   11   12   13   14</code></pre>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_rbind_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">my_mat_1</span>, <span class="va">my_mat_2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rbind_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3] [,4] [,5]
R&gt; [1,]    1    2    3    4    5
R&gt; [2,]   10   11   12   13   14</code></pre>
<p><strong>cbind</strong> - Returns the merger (bind) of matrices, with column orientation. </p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_1</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2]
R&gt; [1,]    1    3
R&gt; [2,]    2    4</code></pre>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">13</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_mat_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2]
R&gt; [1,]   10   12
R&gt; [2,]   11   13</code></pre>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cbind_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">my_mat_1</span>, <span class="va">my_mat_2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_cbind_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1] [,2] [,3] [,4]
R&gt; [1,]    1    3   10   12
R&gt; [2,]    2    4   11   13</code></pre>
<p><strong>rowMeans</strong> - Returns the mean of a matrix, row wise. </p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 4 5 6</code></pre>
<p><strong>colMeans</strong> - Returns the mean of a matrix, column wise. </p>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 2 5 8</code></pre>
</div>
</div>
<div id="exercises-3" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-3"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-5" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-5"><i class="fas fa-link"></i></a>
</h3>
<p>Using function <code><a href="https://tibble.tidyverse.org/reference/tibble.html">dplyr::tibble</a></code>, create a <code>dataframe</code> called <code>my_df</code> with a column called <code>x</code> containing a sequence from -100 to 100 and another column called <code>y</code> with the value of column x added by 5. How many values in column <code>x</code> are greater than 10 and lower than 25?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["14"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06cb8d751" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06cb8d751" class="collapse">
The solution is 14. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_df &lt;- dplyr::tibble(x = -100:100, 
                        y = x + 5)
# solution
my_sol &lt;- sum((my_df$x &gt; 10)&amp;(my_df$x &lt; 25))</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-5" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-5"><i class="fas fa-link"></i></a>
</h3>
<p>Create a new column in object <code>my_df</code> called <code>cumsum_x</code>, containing the cumulative sum of <code>x</code> (<code>cumsum</code> function). In this new column, how many values are greater than -3500?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["89"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e066b347d20" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e066b347d20" class="collapse">
The solution is 89. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_df &lt;- dplyr::tibble(x = -100:100, 
                       y = x + 5)

# solution
my_df$cumsum_x &lt;- cumsum(my_df$x)

# solution
my_sol &lt;- sum(my_df$cumsum_x &gt; -3500)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-4" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-4"><i class="fas fa-link"></i></a>
</h3>
<p>Use function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code> function and the pipeline operator to filter <code>my_df</code>, keeping only the rows where the value of the <code>y</code> column is greater than 0. What is the number of rows in the resulting table?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["105"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06237eee36" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06237eee36" class="collapse">
The solution is 105. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_df &lt;- dplyr::tibble(x = -100:100, 
                       y = x + 5)

# solution
library(tidyverse)

my_df2 &lt;- my_df %&gt;%
  filter(y &gt; 0)

# solution
my_sol &lt;- nrow(my_df2)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-4" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-4"><i class="fas fa-link"></i></a>
</h3>
<p>If you have not already done so, repeat exercises 1, 2 and 3 using the functions of the <code>tidyverse</code> universe and the <em>pipeline</em> operator.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e066e1289ce" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e066e1289ce" class="collapse">
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

set.seed(1)

my_df &lt;- tibble(x = -100:100,
                y = x + 5) %&gt;%
  mutate(cumsum_x = cumsum(x))

# solution 01
sol_01 &lt;- my_df %&gt;%
  filter(x &gt; 10, 
         x &lt; 25) %&gt;%
  nrow()

# solution 02
sol_02 &lt;- my_df %&gt;%
  mutate(cumsum_x = cumsum(x)) %&gt;%
  filter(cumsum_x &gt; -3500) %&gt;%
  nrow()

# solution 03
sol_03 &lt;- my_df %&gt;%
  filter(y &gt; 0) %&gt;%
  nrow()

message(str_glue(
  'Solution 01 = {sol_01} \n',
  'Solution 02 = {sol_02} \n',
  'Solution 03 = {sol_03}'
  )
)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-4" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-4"><i class="fas fa-link"></i></a>
</h3>
<p>Use the <code>BatchGetSymbols</code> package to download Google (GOOG) stock data, from<code>r first_date</code> to 2020-12-31. If the investor had bought 1000 USD in Google shares on the first day of the data and kept the investment until today, what would be the value of his portfolio?</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">$9,972.50</option>
<option value="answer">$5,571.73</option>
<option value="">$6,241.27</option>
<option value="">$8,728.75</option>
<option value="">$7,485.01</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e066a4deebf" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e066a4deebf" class="collapse">
The solution is $5,571.73. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)
library(tidyverse)

first_date &lt;- '2010-01-01'
last_date &lt;- '2020-12-31'

df_prices &lt;- BatchGetSymbols(tickers = 'GOOG', 
                             first.date = first_date,
                             last.date = last_date)[[2]]

value_purchase &lt;- 1000

# solution
my_sol &lt;- last(df_prices$price.adjusted)/first(df_prices$price.adjusted)*value_purchase</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-4" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-4"><i class="fas fa-link"></i></a>
</h3>
<p>Use functions <code><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">afedR::get_data_file</a></code> and <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> to import data from the <code>grunfeld.csv</code> file. Now, use function <code><a href="https://pillar.r-lib.org/reference/glimpse.html">dplyr::glimpse</a></code> functions to find out the number of lines in the imported data. What is the number of rows in the imported table?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["200"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e067ce6ef41" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e067ce6ef41" class="collapse">
The solution is 200. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_file &lt;- afedR::get_data_file('grunfeld.csv')

df_grunfeld &lt;- read_csv(my_file, 
                        col_types = cols())

# solution
glimpse(df_grunfeld)

my_sol &lt;- nrow(df_grunfeld)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-3" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-3"><i class="fas fa-link"></i></a>
</h3>
<p>Create a list type object with three <code>dataframes</code> in its contents,<code>df1</code>, <code>df2</code> and <code>df3</code>. The content and size of the dataframes is your personal choice. Now, use the <code>sapply</code> function and a custom function to find out the number of rows and columns in each <code>dataframe</code>.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e066ae486e3" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e066ae486e3" class="collapse">
<div class="card card-body">
<pre><code>df1 &lt;- dplyr::tibble(x = 1:10)
df2 &lt;- dplyr::tibble(y = runif(100))
df3 &lt;- dplyr::tibble(z = rnorm(150),
                     m = rnorm(150))

my_l &lt;- list(df1, df2, df3)

my_fct &lt;- function(df_in) {
  out &lt;- c('nrows' = nrow(df_in), 
           'ncols' = ncol(df_in))
  return(out)
}

tab &lt;- sapply(my_l, my_fct)
tab</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.8-2" class="section level3 unnumbered">
<h3>Q.8<a class="anchor" aria-label="anchor" href="#q.8-2"><i class="fas fa-link"></i></a>
</h3>
<p>Wihtin an R session, create an identity matrix (value 1 in the diagonal, zero in any other) of size 3X3. Tip: use the <code>diag</code> function to define the diagonal of the matrix.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e065b3bd7d" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e065b3bd7d" class="collapse">
<div class="card card-body">
<pre><code>my_size &lt;- 3
M_identity &lt;- matrix(0, 
                     nrow = my_size, 
                     ncol = my_size)

# solution
diag(M_identity) &lt;- 1

print(M_identity)</code></pre>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://afedr-ed2.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
                            
  <div class="chapter-nav">
<div class="prev"><a href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></div>
<div class="next"><a href="basic-classes.html"><span class="header-section-number">7</span> Basic Object Classes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-structure-objects"><span class="header-section-number">6</span> Dataframes and other objects</a></li>
<li>
<a class="nav-link" href="#dataframes"><span class="header-section-number">6.1</span> Dataframes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-dataframes"><span class="header-section-number">6.1.1</span> Creating dataframes</a></li>
<li><a class="nav-link" href="#inspecting-a-dataframe"><span class="header-section-number">6.1.2</span> Inspecting a Dataframe</a></li>
<li><a class="nav-link" href="#the-pipeline-operator"><span class="header-section-number">6.1.3</span> The pipeline Operator (%&gt;%)</a></li>
<li><a class="nav-link" href="#accessing-columns"><span class="header-section-number">6.1.4</span> Accessing Columns</a></li>
<li><a class="nav-link" href="#modifying-a-dataframe"><span class="header-section-number">6.1.5</span> Modifying a dataframe</a></li>
<li><a class="nav-link" href="#filtering-rows-of-a-dataframe"><span class="header-section-number">6.1.6</span> Filtering rows of a dataframe</a></li>
<li><a class="nav-link" href="#sorting-a-dataframe"><span class="header-section-number">6.1.7</span> Sorting a dataframe</a></li>
<li><a class="nav-link" href="#combining-and-aggregating-dataframes"><span class="header-section-number">6.1.8</span> Combining and Aggregating dataframes</a></li>
<li><a class="nav-link" href="#extensions-of-the-dataframe-class"><span class="header-section-number">6.1.9</span> Extensions of the dataframe Class</a></li>
<li><a class="nav-link" href="#other-useful-functions-for-handling-dataframes"><span class="header-section-number">6.1.10</span> Other Useful Functions for Handling dataframes</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#lists"><span class="header-section-number">6.2</span> Lists</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-lists"><span class="header-section-number">6.2.1</span> Creating lists</a></li>
<li><a class="nav-link" href="#accessing-the-elements-of-a-list"><span class="header-section-number">6.2.2</span> Accessing the Elements of a list</a></li>
<li><a class="nav-link" href="#adding-and-removing-elements-from-a-list"><span class="header-section-number">6.2.3</span> Adding and Removing Elements from a list</a></li>
<li><a class="nav-link" href="#processing-the-elements-of-a-list"><span class="header-section-number">6.2.4</span> Processing the Elements of a list</a></li>
<li><a class="nav-link" href="#other-useful-functions"><span class="header-section-number">6.2.5</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#matrices"><span class="header-section-number">6.3</span> Matrices</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#selecting-elements-from-a-matrix"><span class="header-section-number">6.3.1</span> Selecting Elements from a matrix</a></li>
<li><a class="nav-link" href="#other-useful-functions-1"><span class="header-section-number">6.3.2</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exercises-3"><span class="header-section-number">6.4</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-5">Q.1</a></li>
<li><a class="nav-link" href="#q.2-5">Q.2</a></li>
<li><a class="nav-link" href="#q.3-4">Q.3</a></li>
<li><a class="nav-link" href="#q.4-4">Q.4</a></li>
<li><a class="nav-link" href="#q.5-4">Q.5</a></li>
<li><a class="nav-link" href="#q.6-4">Q.6</a></li>
<li><a class="nav-link" href="#q.7-3">Q.7</a></li>
<li><a class="nav-link" href="#q.8-2">Q.8</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyzing Financial and Economic Data with R - Online Edition</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-11-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
