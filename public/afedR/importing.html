<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Importing Data from Local Files | Analyzing Financial and Economic Data with R - Online Edition</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 4 Importing Data from Local Files | Analyzing Financial and Economic Data with R - Online Edition">
<meta property="og:type" content="book">
<meta property="og:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<meta property="og:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Importing Data from Local Files | Analyzing Financial and Economic Data with R - Online Edition">
<meta name="twitter:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyzing Financial and Economic Data with R - Online Edition</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="about-new-edition.html">About New Edition</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basicoperations.html"><span class="header-section-number">2</span> Basic Operations in R</a></li>
<li><a class="" href="research-scripts.html"><span class="header-section-number">3</span> Writing Research Scripts</a></li>
<li><a class="active" href="importing.html"><span class="header-section-number">4</span> Importing Data from Local Files</a></li>
<li><a class="" href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></li>
<li><a class="" href="data-structure-objects.html"><span class="header-section-number">6</span> Dataframes and other objects</a></li>
<li><a class="" href="basic-classes.html"><span class="header-section-number">7</span> Basic Object Classes</a></li>
<li><a class="" href="programming.html"><span class="header-section-number">8</span> Programming and Data Analysis</a></li>
<li><a class="" href="cleaning.html"><span class="header-section-number">9</span> Cleaning and Structuring Data</a></li>
<li><a class="" href="figures.html"><span class="header-section-number">10</span> Creating and Saving Figures with ggplot2</a></li>
<li><a class="" href="models.html"><span class="header-section-number">11</span> Financial Econometrics with R</a></li>
<li><a class="" href="reporting.html"><span class="header-section-number">12</span> Reporting Results</a></li>
<li><a class="" href="optimizing.html"><span class="header-section-number">13</span> Optimizing Code</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98297869-1', 'auto');
  ga('send', 'pageview');

</script><!-- Global site tag (gtag.js) - Google Analytics GOOGLE ADS--><script async src="https://www.googletagmanager.com/gtag/js?id=UA-89690212-2">
</script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89690212-2');
</script><div id="importing" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Importing Data from Local Files<a class="anchor" aria-label="anchor" href="#importing"><i class="fas fa-link"></i></a>
</h1>
<p>Surely, the very first step of script is getting your data into R. In this chapter, we will learn to import and export data available as local files in the computer. Although the task is not particularly difficult, a good data analyst should understand the different characteristics of file formats and how to take the best advantage of them in every situation. While some are best suited for sharing and collaboration, others can offer a significant boost in reading and writing speeds.</p>
<p>Here we will draw a comprehensive list of file formats for importing and exporting data, including:</p>
<ul>
<li>Text data with comma-separated values (<em>csv</em>);</li>
<li>Microsoft Excel (<em>xls</em>, <em>xlsx</em>);</li>
<li>R native files (<em>RData</em>, <em>rds</em>);</li>
<li>
<code>fst</code> format;</li>
<li>SQLite;</li>
<li>Unstructured text data.</li>
</ul>
<p>The first lesson in importing data from local files is that the location of the file must be explicitly stated in the code. The path of the file is then passed to a function that will read the file. The best way to work with paths is to use the <em>autocomplete</em> feature of RStudio (see section <a href="basicoperations.html#autocomplete">2.20</a>). An example of full path is:</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'C:/My Research/data/SP500_Data.csv'</span></span></code></pre></div>
<p>Note the use of forwarding slashes (<code>/</code>) to designate the file directory. Relative references also work, as in:</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/SP500_Data.csv'</span></span></code></pre></div>
<p>Here, it is assumed that in the current working folder there is a directory called <code>data</code> and, inside of it, exists a file called <code>SP500_Data.csv</code>. If the file path is simply its name, such as in <code>my_file &lt;- 'SP500_Data.csv'</code>, it is implicitly assumed that the file is located in the root of the working directory. From the previous chapter, recall you can use <code>setwd</code> to change the working folder to where the work is being done and simply use the relative path of the data file. An example:</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">'C:/My Research'</span><span class="op">)</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/SP500_Data.csv'</span></span></code></pre></div>
<div class="rmdimportant">
<p>
Here, again, I reinforce the use of <em>tab</em> and the
<em>autocomplete</em> tool of RStudio. It is much more <strong>easier
and practical</strong> to find files on your computer’s hard disk using
<em>tab</em> navigation than to copy and paste the address from your
file explorer. To use it, open double or quotes in RStudio, place the
<em>mouse</em> cursor in between the quotes and press <em>tab</em>.
</p>
</div>
<p>Another very important point here is that <strong>the data will be imported and exported in R as an object of type <code>dataframe</code></strong>. That is, a table contained in an Excel or <em>.csv</em> file will become a <code>dataframe</code> object in R. When we export data, the most common format is this same type of object. Conveniently, <code>dataframes</code> are nothing more than tables, with rows and columns.</p>
<p>Each column in the <code>dataframe</code> will have its own class, the most common being numeric (<em>numeric</em>), text (<em>character</em>), factor (<em>factor</em>) and date (<em>Date</em>). When importing the data, <strong>it is imperative that each column is represented in the correct class</strong>. A vast amount of errors can be avoided by simply checking the column classes in the <code>dataframe</code> resulting from the import process. For now, we only need to understand this basic property of <code>dataframes</code>. We will study the details of this object in chapter <a href="data-structure-objects.html#data-structure-objects">6</a>.</p>
<div id="csv-files" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> <em>csv</em> files<a class="anchor" aria-label="anchor" href="#csv-files"><i class="fas fa-link"></i></a>
</h2>
<p>Consider a data file called SP500.csv, available in the book package. It contains daily closing prices of the SP500 index from 2010-01-04 until 2020-12-30. We will now use package <code>afedR</code> for finding the file and copying it to your local folder. If you followed the instructions in the book preface chapter, you should have package <code>afedR</code> already installed. If not, execute the following code: </p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install devtools dependency</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install book package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'msperlin/afedR'</span><span class="op">)</span></span></code></pre></div>
<p>Once you installed package <code>afedR</code>, file SP500.csv and all other data files used in the book were downloaded from Github. The package also includes functions for facilitating the reproduction of code examples. Command <code><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">afedR::get_data_file</a></code> will return the local path of a book data file by its name.</p>
<p>Let’s copy SP500.csv to your “My Documents” folder with the following code using the tilde (<code>~</code>) shortcut:</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'SP500.csv'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">my_f</span>, to <span class="op">=</span> <span class="st">'~'</span> <span class="op">)</span></span></code></pre></div>
<p>Now, if it is your first time working with <em>.csv</em> files, use a file browser (Explorer in Windows) and open SP500.csv in the “My Documents” folder with any text editor software such as Notepad (see figure <a href="importing.html#fig:notepad">4.1</a>). The first lines of SP500.csv, also called header lines, show the column names. Following international standards, rows are set using line breaks, and all columns are separated by commas (<code>,</code>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:notepad"></span>
<img src="figs/example_csv_notepad.png" alt="Ibov.csv in Notepad" width="100%"><p class="caption">
Figure 4.1: Ibov.csv in Notepad
</p>
</div>
<p>The content of SP500.csv is standard and we should have no problem importing the data in R. However, you should be aware this is not always the case. So, if you want to avoid the common issues, I suggest that you use a set of steps that can avoid most problems in importing data from <em>.csv</em> files:</p>
<ol style="list-style-type: decimal">
<li><p>Check the existence of text before the actual data. A standard <em>.csv</em> file will only have the contents of a table but, sometimes, you will find a header text with some details about the data. In R, you can control how many lines you skip in the <em>csv</em> reading function;</p></li>
<li><p>Verify the existence of names for all columns and if those names are readable;</p></li>
<li><p>Check the symbol for column separation. Normally it is a comma, but you never know for sure;</p></li>
<li><p>For the numerical data, verify the decimal symbol. R will expect it to be a dot. If necessary, you can adjust this information in the CSV reading function.</p></li>
<li><p>Check the encoding of the text file. Normally it is one of UTF-8, Latin1 (ISO-8859) or Windows 1252. These are broad encoding formats and should suffice for most languages. Whenever you find strange symbols in the text columns of the resulting <code>dataframe</code>, the problem is due to a difference in encoding. While the file is encoded in a specific format, R is reading it with a different encoding structure. Windows users can check the encoding of a text file by opening it in <a href="https://notepad-plus-plus.org/">Notepad++</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://notepad-plus-plus.org/" class="uri"&gt;https://notepad-plus-plus.org/&lt;/a&gt;&lt;/p&gt;'><sup>37</sup></a>. The information about the encoding will be available in the bottom right corner of the Notepad++ editor. Linux and Mac users can find the same information in any advanced text editor software such as <a href="https://kate-editor.org/">Kate</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://kate-editor.org/" class="uri"&gt;https://kate-editor.org/&lt;/a&gt;&lt;/p&gt;'><sup>38</sup></a>.</p></li>
</ol>
<div class="rmdimportant">
<p>
Whenever you find an unexpected text structure in a <em>.csv</em>
file, use the arguments of the <em>csv</em> reading function to import
the information correctly. As a rule of thumb, <strong>never modify raw
.csv data manually</strong>. Its far more efficient to use the R code to
deal with different structures of <em>.csv</em> files. It takes a bit of
work, but such a policy will save you a lot of time in the future as, in
a couple of months, you are unlikely to remember how you manually
cleaned that <em>.csv</em> file for your R script.
</p>
</div>
<div id="importing-data" class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>base</code> package of R includes a native function called <code>read.csv</code> for importing data from <em>.csv</em> files. However, we will prefer the <code>tidyverse</code> alternative, <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> <span class="citation">(<a href="references.html#ref-R-readr" role="doc-biblioref">Wickham, Hester, and Bryan 2022</a>)</span>, as it is more efficient and easier to work with. In short, the benefit is that it reads the data very quickly, and it uses clever rules for defining the classes of imported columns.</p>
<p>This is the first package from the <code>tidyverse</code> that we will use. Before doing so, it is necessary to install it in your R session. A simple way of installing all <code>tidyverse</code> packages as a bundle is as follows:</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span></span></code></pre></div>
<p>After running the previous code, all <code>tidyverse</code> packages will be installed on your computer. Once it finishes, let’s load the <code>tidyverse</code> set of packages.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>Back to importing data from <em>.csv</em> files, to load the contents of file SP500.csv in R, use the <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> function. </p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file to read</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'SP500.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file</span></span>
<span><span class="va">my_df_sp500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2718 Columns: 2
R&gt; ── Column specification ────────────────────────────────────
R&gt; Delimiter: ","
R&gt; dbl  (1): price.close
R&gt; date (1): ref.date
R&gt; 
R&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
R&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df_sp500</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 2
R&gt;   ref.date   price.close
R&gt;   &lt;date&gt;           &lt;dbl&gt;
R&gt; 1 2010-01-04       70045
R&gt; 2 2010-01-05       70240
R&gt; 3 2010-01-06       70729
R&gt; 4 2010-01-07       70451
R&gt; 5 2010-01-08       70263
R&gt; 6 2010-01-11       70433</code></pre>
<p>The contents of the imported file becomes a <code>dataframe</code> object in R. As mentioned in the previous chapter, each column of a <code>dataframe</code> has a class. We can check the classes of <code>my_df_sp500</code> using function <code>glimpse</code> from package <code>dplyr</code>, which is also part of the <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the content of dataframe</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df_sp500</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,718
R&gt; Columns: 2
R&gt; $ ref.date    &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2…
R&gt; $ price.close &lt;dbl&gt; 70045, 70240, 70729, 70451, 70263, 704…</code></pre>
<p>Note that the column of dates – <code>ref.date</code> – was imported as a <code>Date</code> vector and the closing prices – <code>price.close</code> – as numeric (<code>dbl</code>, double accuracy). This is exactly what we expected. Internally, function <code>read_csv</code> identifies columns classes according to their content.</p>
<p>Notice how the previous code presented a message entitled <code>Parsed with column specification: ...</code>. This message shows how the function sets the attributes of the columns by reading the first 1000 lines of the file. Column <code>ref.date</code> was imported as <code>date</code> and column <code>price.close</code> was imported as <code>double</code> (numeric). We can use this information in our own code by copying the text and assigning it to a variable. Have a look:</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set cols from import message</span></span>
<span><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>ref.date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                price.close <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> </span>
<span></span>
<span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_sp500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>, col_types <span class="op">=</span> <span class="va">my_cols</span><span class="op">)</span></span></code></pre></div>
<p>As an exercise, Let’s import the same data, but use a <code>character</code> class for column <code>date</code>:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set cols from import message</span></span>
<span><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>ref.date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                price.close <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> </span>
<span></span>
<span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_sp500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>, col_types <span class="op">=</span> <span class="va">my_cols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># glimpse the dataframe</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df_sp500</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,718
R&gt; Columns: 2
R&gt; $ ref.date    &lt;chr&gt; "2010-01-04", "2010-01-05", "2010-01-0…
R&gt; $ price.close &lt;chr&gt; "70045", "70240", "70729", "70451", "7…</code></pre>
<p>As expected, both columns are of class <code>character</code>. So, a possible set of steps using <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> is, first, to read the file without arguments in <code>read_csv</code>, copy the default column classes from the output message, add it as argument <code>col_types</code>, and re-execute the script. This is handy when the imported file has several columns and manually defining each column class requires lots of typing.</p>
<p>There is also a simpler way of using the classes defined by <code>read_csv</code>, just set <code>col_types = cols()</code>. This way you don’t need to manually copy and paste the message from <code>read_csv</code>.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_sp500</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>, </span>
<span>                        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># glimpse the dataframe</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df_sp500</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,718
R&gt; Columns: 2
R&gt; $ ref.date    &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2…
R&gt; $ price.close &lt;dbl&gt; 70045, 70240, 70729, 70451, 70263, 704…</code></pre>
<p>Going further, <code>read_csv</code> has several other input options such as:</p>
<ul>
<li>change the format of the import data, including symbols for decimal places and encoding (<code>locale</code> option);</li>
<li>change column names (argument <code>col_names</code>);</li>
<li>skip <em>n</em> lines before importation (<code>skip</code> option);</li>
<li>custom definition for NA values (<code>na</code> option)</li>
</ul>
<p>Now, let’s study a more abnormal case of <em>.csv</em> file. In the book package we have a file called <code>funky_csv_file.csv</code> where:</p>
<ul>
<li>the header has textual information;</li>
<li>the file will use the comma as a decimal;</li>
<li>the file text will contain Latin characters.</li>
</ul>
<p>The first 5 lines of the files contain the following content:</p>
<pre><code>R&gt; Example of csv file with alternative format:
R&gt; - columns separated by ";"
R&gt; - decimal as ","
R&gt; 
R&gt; Data compiled in 2021-02-26</code></pre>
<p>He ave a header text up to line number 7 and the columns being separated by a semicolon (“;”). When importing the data with standard (and wrong) options, we will have the following result:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'funky_csv_file.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_funky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>, </span>
<span>                     col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_funky</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2
R&gt; Columns: 1
R&gt; $ `Example of csv file with alternative format:` &lt;chr&gt; "- …</code></pre>
<p>Clearly something went wrong, with the issue of several <em>warning</em> messages. To solve it, we use the following code, making sure the particularities of the file are handled:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_not_funky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span></span>
<span>        file <span class="op">=</span> <span class="va">my_f</span>, </span>
<span>        skip <span class="op">=</span> <span class="fl">7</span>, <span class="co"># how many lines do skip</span></span>
<span>        delim <span class="op">=</span> <span class="st">';'</span>, <span class="co"># column separator</span></span>
<span>        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># column types</span></span>
<span>        locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>decimal_mark <span class="op">=</span> <span class="st">','</span><span class="op">)</span><span class="co"># locale</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_not_funky</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 100
R&gt; Columns: 6
R&gt; $ COD.UF     &lt;dbl&gt; 35, 21, 35, 35, 41, 31, 31, 21, 29, 26,…
R&gt; $ COD        &lt;dbl&gt; 3546306, 2103109, 3514700, 3538105, 411…
R&gt; $ NOME       &lt;chr&gt; "Santa Cruz das Palmeiras", "Cedral", "…
R&gt; $ state      &lt;chr&gt; "São Paulo", "Maranhão", "São Paulo", "…
R&gt; $ SIGLA      &lt;chr&gt; " SP", " MA", " SP", " SP", " PR", " MG…
R&gt; $ number_col &lt;dbl&gt; 1.902087, 69.808750, 81.509312, 56.8400…</code></pre>
<p>Note that the data has now been correctly imported, with the correct column classes. For that, we use the alternative function <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_delim</a></code> with custom inputs. Package <code>readr</code> also provides several other functions for specific import situations. If the <code>read_csv</code> function does not solve your problem in reading some structured text file, surely another function of this package will.</p>
</div>
<div id="exporting-data" class="section level3" number="4.1.2">
<h3>
<span class="header-section-number">4.1.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data"><i class="fas fa-link"></i></a>
</h3>
<p>To write a <em>.csv</em> file, use the <code><a href="https://readr.tidyverse.org/reference/write_delim.html">readr::write_csv</a></code> function. First, we create a new dataframe with some random data: </p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># set dataframe</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, </span>
<span>                    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;           y z
R&gt; 1 0.2086880 a
R&gt; 2 0.3237866 a
R&gt; 3 0.3906633 a
R&gt; 4 0.4064216 a
R&gt; 5 0.5066105 a
R&gt; 6 0.8073321 a</code></pre>
<p>And now we use <code>write_csv</code> to save it in a new <em>.csv</em> file:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file out</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="st">'data/temp.csv'</span></span>
<span></span>
<span><span class="co"># write to files</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>,  </span>
<span>          file <span class="op">=</span> <span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<p>In the previous example, we save the object <code>my_df</code> into a file with path <code>data/temp.csv</code>. We can read it back and check its contents using <code>read_csv</code> once again:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read it</span></span>
<span><span class="va">my_df_imported</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 100 Columns: 2
R&gt; ── Column specification ────────────────────────────────────
R&gt; Delimiter: ","
R&gt; chr (1): z
R&gt; dbl (1): y
R&gt; 
R&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
R&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print first five rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df_imported</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 2
R&gt;       y z    
R&gt;   &lt;dbl&gt; &lt;chr&gt;
R&gt; 1 0.209 a    
R&gt; 2 0.324 a    
R&gt; 3 0.391 a    
R&gt; 4 0.406 a    
R&gt; 5 0.507 a    
R&gt; 6 0.807 a</code></pre>
<p>As we can see, the data imported from the file is identical to the one created in the previous code chunk.</p>
</div>
</div>
<div id="excel-files-xls-and-xlsx" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> <em>Excel</em> Files (<em>xls</em> and <em>xlsx</em>)<a class="anchor" aria-label="anchor" href="#excel-files-xls-and-xlsx"><i class="fas fa-link"></i></a>
</h2>
<p>Although it is not an efficient or portable data storage format, Excel is a very popular software due to its spreadsheet-like capacities. It is not uncommon for data to be stored and distributed in this format, especially in the finance industry.</p>
<p>The downside of using Excel files for storing data is its low portability and the longer time required to read and write it. This may not be a problem for small tables, but when handling a large volume of data, using Excel files can be very frustrating. If you can, avoid the use of Excel files in your work cycle.</p>
<div id="importing-data-1" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data-1"><i class="fas fa-link"></i></a>
</h3>
<p>R does not have a native function for importing Excel files; therefore, we must install and use packages to perform this operation. There are several good options including <code>XLConnect</code> <span class="citation">(<a href="references.html#ref-R-XLConnect" role="doc-biblioref">Mirai Solutions GmbH 2022</a>)</span>, <code>xlsx</code> <span class="citation">(<a href="references.html#ref-R-xlsx" role="doc-biblioref">Dragulescu and Arendt 2020</a>)</span>, <code>readxl</code> <span class="citation">(<a href="references.html#ref-R-readxl" role="doc-biblioref">Wickham and Bryan 2022</a>)</span> and <code>tidyxl</code> <span class="citation">(<a href="references.html#ref-R-tidyxl" role="doc-biblioref">Garmonsway 2022</a>)</span>. </p>
<p>Despite their similar goals, each package has its peculiarities. If reading Excel files is important to your work, I strongly advise the study of each package. For example, package <code>tidyxl</code> was specially designed to read unstructured Excel files, where the desired information is not contained in a tabular format. Package <code>XLConnect</code> allows the user to open a live connection and, from R, control an Excel file, making it possible to export and send data, format cells, and so on.</p>
<p>In this section, we will give priority to package <code>readxl</code>, one of the most straightforward packages to use. It also does not require the installation of external software such as <em>Java</em>. Let’s start with an example. Consider a file called <code>SP500-Excel.xlsx</code> that contains the same SP500 data. We can import the information from the file using function <code>read_excel</code> from <code>readxl</code>: </p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set excel file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'SP500_Excel.xlsx'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read excel file </span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">my_f</span>, sheet <span class="op">=</span> <span class="st">'Sheet1'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="va">class</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; $ref.date
R&gt; [1] "POSIXct" "POSIXt" 
R&gt; 
R&gt; $price.close
R&gt; [1] "numeric"</code></pre>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print with head (first five rows)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 2
R&gt;   ref.date            price.close
R&gt;   &lt;dttm&gt;                    &lt;dbl&gt;
R&gt; 1 2010-01-04 00:00:00       1133.
R&gt; 2 2010-01-05 00:00:00       1137.
R&gt; 3 2010-01-06 00:00:00       1137.
R&gt; 4 2010-01-07 00:00:00       1142.
R&gt; 5 2010-01-08 00:00:00       1145.
R&gt; 6 2010-01-11 00:00:00       1147.</code></pre>
<p>As we can see, one benefit of using Excel files is that the column’s classes are directly inherited. If the classes are correct in the Excel file, then they will automatically be correct in R. In our case, the date column of file SP500_Excel.xlsx was correctly set as a <code>dttm</code> object, a special type of <code>DateTime</code> class. Likewise, even if the Excel file used commas for decimals, the import process would still succeed as the conversion is handled internally.</p>
</div>
<div id="exporting-data-1" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data-1"><i class="fas fa-link"></i></a>
</h3>
<p>Exporting a <code>dataframe</code> to an Excel file is also easy. Again, no native function in R performs this procedure. We can, however, use packages <code>xlsx</code> and <code>writexl</code>. A requisite for using <code>xlsx</code> is the installation of Java JDK in the operating system. For Windows users, visit the <a href="https://www.java.com/pt_BR/">Java site</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.java.com/pt_BR/" class="uri"&gt;https://www.java.com/pt_BR/&lt;/a&gt;&lt;/p&gt;'><sup>39</sup></a> and install it with option <em>Windows Off-line (64 bits)</em>. After that, install <code>xlsx</code> with command <code>install.packages('xlsx')</code> and try loading it with <code><a href="https://github.com/colearendt/xlsx">library(xlsx)</a></code>. If you got an error message about <em>Java</em> , try rebooting your system.</p>
<p>An example of <code>xlsx</code> usage is given next: </p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/colearendt/xlsx">xlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set excel file</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="st">'data/temp.xlsx'</span></span>
<span></span>
<span><span class="co"># write to excel</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>, file <span class="op">=</span> <span class="va">f_out</span>, sheetName <span class="op">=</span> <span class="st">"my df"</span><span class="op">)</span></span></code></pre></div>
<p>If you want to save several <code>dataframes</code> into several worksheets of the same Excel file, you must use the input option <code>append=TRUE</code> in the call to <code>write.xlsx</code>. Otherwise, the function will create a new file on each call and erase all previous content. See the following example, where we export two <code>dataframes</code> for two different sheets in the same Excel file: </p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create two dataframes</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, </span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_df_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'b'</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set file out</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="st">'data/temp.xlsx'</span></span>
<span></span>
<span><span class="co"># write in different sheets</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>, </span>
<span>           file <span class="op">=</span> <span class="va">f_out</span>, </span>
<span>           sheetName <span class="op">=</span> <span class="st">"my df A"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_B</span>, </span>
<span>           file <span class="op">=</span> <span class="va">f_out</span>, </span>
<span>           sheetName <span class="op">=</span> <span class="st">"my df B"</span>, </span>
<span>           append <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<p>After executing the code, we can open the excel files and check their contents to see that they mirror the artificial data.</p>
<p>As for package <code>writexl</code>, its innovation is that a Java installation is not needed. Writing speed is also significantly increased. See an example next. </p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/">writexl</a></span><span class="op">)</span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>,</span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>           path <span class="op">=</span> <span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<p>In order to compare writing performance, let’s calculate the difference of time from <code>xlsx</code> to <code>writexl</code>:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/">writexl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/colearendt/xlsx">xlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2500</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set files</span></span>
<span><span class="va">my_file_1</span> <span class="op">&lt;-</span> <span class="st">'data/temp_writexl.xlsx'</span></span>
<span><span class="va">my_file_2</span> <span class="op">&lt;-</span> <span class="st">'data/temp_xlsx.xlsx'</span></span>
<span></span>
<span><span class="co"># test export</span></span>
<span><span class="va">time_write_writexl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>                                             path <span class="op">=</span> <span class="va">my_file_1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_write_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>                                          file <span class="op">=</span> <span class="va">my_file_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test read</span></span>
<span><span class="va">time_read_readxl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">my_file_1</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_read_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file_2</span>,</span>
<span>                                        sheetIndex <span class="op">=</span> <span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And now we show the results:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results</span></span>
<span><span class="va">my_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'xlsx'</span>, <span class="st">'readxl'</span><span class="op">)</span></span>
<span><span class="va">results_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_read_xlsx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_read_readxl</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_write</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_write_xlsx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_write_writexl</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print text</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to WRITE dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">results_write</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                  <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to WRITE dataframe with xlsx: 1.461 seconds
R&gt; Time to WRITE dataframe with readxl: 0.010 seconds</code></pre>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to READ dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">results_read</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                  <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to READ dataframe with xlsx: 2.301 seconds
R&gt; Time to READ dataframe with readxl: 0.007 seconds</code></pre>
<p>As we can see, even for low-volume data, a dataframe with 2500 rows and 2 columns, the run-time difference is significant. If you are working with large spreadsheets, the use of packages <code>readxl</code> and <code>writexl</code> for reading and writing Excel files is strongly recommended.</p>
</div>
</div>
<div id="rdata-and-rds-files" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> <em>RData</em> and <em>rds</em> Files<a class="anchor" aria-label="anchor" href="#rdata-and-rds-files"><i class="fas fa-link"></i></a>
</h2>
<p>R offers native formats to write objects to a local file. The great benefit of using both native formats, <em>RData</em>, and <em>rds</em>, is that the saved file is compact and its access is very fast. The downside is the low portability, i.e., it’s difficult to use the files in other software. </p>
<p>The difference between <em>RData</em> and <em>rds</em> is that the first can save many R objects in a single file, while the latter only one. This, however, is not a hard restriction for the <em>rds</em> format as we can incorporate several objects into a single one using a <code>list</code>, a special type of object. In practice, a <em>rds</em> file can store as many objects as needed.</p>
<div id="importing-data-2" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data-2"><i class="fas fa-link"></i></a>
</h3>
<p>To create a new <em>.RData</em> file, use the <code>save</code> function. See the following example, where we create a <em>.RData</em> file with some content, clear R’s memory, and then load the previously created file: </p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set a object</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># set name of RData file</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/temp.RData'</span></span>
<span></span>
<span><span class="co"># save it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'my_x'</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>We can verify the existence of the file with the <code>file.exists</code> function: </p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check if file exists</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>As expected, file temp.RData is available.</p>
<p>Importing data from <code>.rds</code> files is very similar. For that we use function <code><a href="https://readr.tidyverse.org/reference/read_rds.html">readr::read_rds</a></code>:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file path</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/temp.rds'</span></span>
<span></span>
<span><span class="co"># load content into workspace</span></span>
<span><span class="va">my_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>Comparing the code between using <code>.RData</code> and <code>.rds</code> files, note that the <code>.rds</code> format allows the explicit definition of the output object. The contents of <code>my_file</code> in <code>read_rds</code> is saved in <code>my_y</code>. When we use the <code>load</code> function for <em>RData</em> files, we cannot name the output directly. This is particularly inconvenient when you need to modify the name of the imported object.</p>
<div class="rmdimportant">
<p>
As a suggestion, give preference to the <em>.rds</em> format, which
is more practical, resulting in cleaner code. The difference in speed
between one and the other is minimal. The benefit of importing multiple
objects into the same <code>RData</code> format file becomes irrelevant
when using <code>list</code> objects, which can incorporate other
objects into its content.
</p>
</div>
</div>
<div id="exporting-data-2" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data-2"><i class="fas fa-link"></i></a>
</h3>
<p>We can create a new <em>RData</em> file with command <code>save</code>:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vars</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">my_y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># write to RData</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/temp.RData'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'my_x'</span>, <span class="st">'my_y'</span><span class="op">)</span>,</span>
<span>     file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>We can check if the file exists with function <code>file.exists</code>:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>The result is <code>TRUE</code> as expected.</p>
<p>As for <em>.rds</em> files, we save it with function <code><a href="https://readr.tidyverse.org/reference/read_rds.html">readr::write_rds</a></code>:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set data and file</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/temp.rds'</span></span>
<span></span>
<span><span class="co"># save as .rds</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">write_rds</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_x</span>,</span>
<span>          file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read it</span></span>
<span><span class="va">my_x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test equality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">my_x</span>, <span class="va">my_x2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>Command <code>identical</code> tests if both objects are equal. Again, as expected, we find the result to be <code>TRUE</code>.</p>
</div>
</div>
<div id="fst-files" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> <em>fst</em> files<a class="anchor" aria-label="anchor" href="#fst-files"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://www.fstpackage.org/"><em>fst</em> format</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="http://www.fstpackage.org/" class="uri"&gt;http://www.fstpackage.org/&lt;/a&gt;&lt;/p&gt;'><sup>40</sup></a> is specially designed to enable quick writing and reading time from tabular data, with minimal disk space. Using this format is particularly beneficial when working with large databases in powerful computers. The trick here is the use of all computer cores to import and export data, while all other formats only use one. If you have a computer with several cores, the gain in speed is impressive, as we will soon learn. </p>
<div id="importing-data-3" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data-3"><i class="fas fa-link"></i></a>
</h3>
<p>Using <em>fst</em> file format is similar to the previous cases. We use function <code>read_fst</code> from package <code>fst</code> <span class="citation">(<a href="references.html#ref-R-fst" role="doc-biblioref">Klik 2022</a>)</span> to read files:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set file location</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'temp.fst'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read fst file</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">read_fst</a></span><span class="op">(</span><span class="va">my_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check contents</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 1,000
R&gt; Columns: 1
R&gt; $ x &lt;dbl&gt; 0.70968891, 0.83903044, 0.70026554, 0.78120026, …</code></pre>
<p>As with the other cases, the data from file temp.fst is available in the workspace. </p>
</div>
<div id="exporting-data-3" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data-3"><i class="fas fa-link"></i></a>
</h3>
<p>We use function <code><a href="http://www.fstpackage.org/reference/write_fst.html">fst::write_fst</a></code> to save dataframes in the <em>fst</em> format: </p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'data/temp.fst'</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to fst</span></span>
<span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">write_fst</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>, path <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="timing-the-fst-format" class="section level3" number="4.4.3">
<h3>
<span class="header-section-number">4.4.3</span> Timing the <em>fst</em> format<a class="anchor" aria-label="anchor" href="#timing-the-fst-format"><i class="fas fa-link"></i></a>
</h3>
<p>As a test of the potential of the <code>fst</code> format, we will now time the read and write time between <code>fst</code> and <code>rds</code> for a large table: 5.000.000 rows and 2 columns. We will also report the size of the resulting file.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">5000000</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set files</span></span>
<span><span class="va">my_file_1</span> <span class="op">&lt;-</span> <span class="st">'data/temp_rds.rds'</span></span>
<span><span class="va">my_file_2</span> <span class="op">&lt;-</span> <span class="st">'data/temp_fst.fst'</span></span>
<span></span>
<span><span class="co"># test write</span></span>
<span><span class="va">time_write_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">write_rds</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="va">my_file_1</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_write_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">write_fst</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="va">my_file_2</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test read</span></span>
<span><span class="va">time_read_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">my_file_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_read_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">read_fst</a></span><span class="op">(</span><span class="va">my_file_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test file size (MB)</span></span>
<span><span class="va">file_size_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.size</a></span><span class="op">(</span><span class="va">my_file_1</span><span class="op">)</span><span class="op">/</span><span class="fl">1000000</span></span>
<span><span class="va">file_size_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.size</a></span><span class="op">(</span><span class="va">my_file_2</span><span class="op">)</span><span class="op">/</span><span class="fl">1000000</span></span></code></pre></div>
<p>And now we check the results:</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results</span></span>
<span><span class="va">my_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'.rds'</span>, <span class="st">'.fst'</span><span class="op">)</span></span>
<span><span class="va">results_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_read_rds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_read_fst</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_write</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_write_rds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_write_fst</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_file_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">file_size_rds</span> , <span class="va">file_size_fst</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print text</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to WRITE dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_write</span>, <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to WRITE dataframe with .rds: 1.08799999999997 seconds
R&gt; Time to WRITE dataframe with .fst: 0.0940000000000509 seconds</code></pre>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to READ dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_read</span>, <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to READ dataframe with .rds: 1.07600000000002 seconds
R&gt; Time to READ dataframe with .fst: 0.0930000000000746 seconds</code></pre>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nResulting FILE SIZE for '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_file_size</span>, <span class="st">' MBs'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Resulting FILE SIZE for .rds: 65.01011 MBs
R&gt; Resulting FILE SIZE for .fst: 14.791938 MBs</code></pre>
<p>The difference is very impressive! The <code>fst</code> not only reads and writes faster but also results in smaller file sizes. Be aware, however, this result is found in a 16 core computer in which the book was compiled. You may not be able to replicate the same result in a more modest machine.</p>
<div class="rmdimportant">
<p>
Due to the use of all the computer’s cores, the <em>fst</em> format
is highly recommended when working with large data on a powerful
computer. Not only will the resulting files be smaller, but the writing
and reading process will be considerably faster.
</p>
</div>
</div>
</div>
<div id="sqlite-files" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> SQLite Files<a class="anchor" aria-label="anchor" href="#sqlite-files"><i class="fas fa-link"></i></a>
</h2>
<p>The use of <em>.csv</em> or <em>.rds</em> files for storing objects has its limits as the size of the files increases. If you are waiting a long time to read a <code>dataframe</code> from a file or if you are only interested in a small portion of a large table, you should look for alternatives. Likewise, if you are working in a network of computers from your institution and many people are using the same tables, it makes sense to keep and distribute the information from a central server. This way, every user can access the same information, concurrently.</p>
<p>This brings us to the topic of <strong>database software</strong>. These specific programs usually work with a query language, called <em>SQL</em> (<em>Structured Query Language</em>). It allows the user to read portions of the data and even manipulate it efficiently. Many options of database software integrate nicely with R. The list includes <strong>MySQL</strong>, <strong>SQLite</strong> and <strong>MariaDB</strong>. Here, we will provide a quick tutorial on this topic using SQLite, which is the easiest one to work. </p>
<p>Before moving to the examples, we need to understand how to use database software. First, R will connect to the database and return a connection object. Based on this connection, we will send queries for importing data using the <em>SQL</em> language. The main advantage is we can have a large database of, let’s say, 10 GB and only load a small portion of it in R. This operation is also very quick, allowing efficient access to the available tables.</p>
<div id="importing-data-4" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data-4"><i class="fas fa-link"></i></a>
</h3>
<p>Assuming the existence of an SQLite file in the computer, we can import its tables with package <code>RSQLite</code> <span class="citation">(<a href="references.html#ref-R-RSQLite" role="doc-biblioref">Müller et al. 2022</a>)</span>:</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set name of SQLITE file</span></span>
<span><span class="va">f_sqlite</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'SQLite_db.SQLITE'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># open connection</span></span>
<span><span class="va">my_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span>drv <span class="op">=</span> <span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_sqlite</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read table</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu">dbReadTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">'MyTable1'</span><span class="op">)</span> <span class="co"># name of table in sqlite</span></span>
<span></span>
<span><span class="co"># print with str</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 1,000,000
R&gt; Columns: 2
R&gt; $ x &lt;dbl&gt; 0.007504194, 0.439465174, 0.178387480, 0.9857759…
R&gt; $ G &lt;chr&gt; "B", "B", "B", "B", "A", "B", "A", "B", "B", "B"…</code></pre>
<p>It worked. The <code>dataframe</code> from table <code>MyTable1</code> is exactly as expected. </p>
<p>Another example of using SQLite is with the actual SQL statements. Notice, in the previous code, we used function <code>dbReadTable</code> to get the contents of all rows in table <code>MyTable1</code>. Now, let’s use an SQL command to get from <code>MyTable2</code> only the rows where the <code>G</code> column is equal to <code>A</code>.</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set sql statement</span></span>
<span><span class="va">my_SQL_statement</span> <span class="op">&lt;-</span> <span class="st">"select * from myTable2 where G='A'"</span></span>
<span></span>
<span><span class="co"># get query</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, </span>
<span>                      statement <span class="op">=</span> <span class="va">my_SQL_statement</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># disconnect from db</span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">my_con</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print with str</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my_df_A</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 'data.frame':    499522 obs. of  2 variables:
R&gt;  $ x: num  0.0637 0.1982 0.2894 0.7389 0.0669 ...
R&gt;  $ G: chr  "A" "A" "A" "A" ...
R&gt; NULL</code></pre>
<p>It also worked, as expected.</p>
<p>In this simple example, we can see how easy it is to create a connection to a database, retrieve tables, and disconnect. If you have to work with large tables, which, in my opinion, is any database that occupies more than 4 GB of your computer memory, it is worth moving it to proper database software. You’ll be able to retrieve data faster, without the need of loading the whole database in the computer’s memory. If you have a server available in your workplace, I strongly advise learning how to connect to it and use the SQL language to your advantage.</p>
</div>
<div id="exporting-data-4" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data-4"><i class="fas fa-link"></i></a>
</h3>
<p>As an example of exporting data to an SQLite file, let’s first create an SQLite database. For that, we will set two large <code>dataframes</code> with random data and save both in an SQLite file using the package <code>RSQLite</code>. </p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows in df</span></span>
<span><span class="va">N</span> <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span> </span>
<span></span>
<span><span class="co"># create simulated dataframe</span></span>
<span><span class="va">my_large_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, </span>
<span>                            G<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,</span>
<span>                                      size <span class="op">=</span> <span class="va">N</span>,</span>
<span>                                      replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_large_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, </span>
<span>                            G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,</span>
<span>                                       size <span class="op">=</span> <span class="va">N</span>,</span>
<span>                                       replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set name of SQLITE file</span></span>
<span><span class="va">f_sqlite</span> <span class="op">&lt;-</span> <span class="st">'data/SQLite_db.SQLITE'</span></span>
<span></span>
<span><span class="co"># open connection</span></span>
<span><span class="va">my_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span>drv <span class="op">=</span> <span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_sqlite</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write df to sqlite</span></span>
<span><span class="fu">dbWriteTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, name <span class="op">=</span> <span class="st">'MyTable1'</span>, </span>
<span>             value <span class="op">=</span> <span class="va">my_large_df_1</span><span class="op">)</span></span>
<span><span class="fu">dbWriteTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, name <span class="op">=</span> <span class="st">'MyTable2'</span>, </span>
<span>             value <span class="op">=</span> <span class="va">my_large_df_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># disconnect</span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">my_con</span><span class="op">)</span></span></code></pre></div>
<p>The <code>TRUE</code> output of <code>dbWriteTable</code> indicates everything went well. A connection was opened using function <code>dbConnect</code>, and the <code>dataframes</code> were written to an SQLite file, called SQLite_db.SQLITE. Unlike other database software, SQLite stores data and configurations from a single file, without the need of a formal server. Also, notice how we disconnected from the database using the function <code>dbDisconnect</code>. </p>
</div>
</div>
<div id="unstructured-data-and-other-formats" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Unstructured Data and Other Formats<a class="anchor" aria-label="anchor" href="#unstructured-data-and-other-formats"><i class="fas fa-link"></i></a>
</h2>
<p>The previous packages and functions are sufficient for getting most of the work done. Nevertheless, it is worth mentioning that R can also import data from other formats such as SPSS, Stata, Matlab, among many others. If that is your case, I suggest a thorough study of the <code>foreign</code> package <span class="citation">(<a href="references.html#ref-R-foreign" role="doc-biblioref">R Core Team 2022</a>)</span>.</p>
<p>Another example is the case of importing data from unstructured text files. Reading raw text files is the last resort for data importation. If none of the previous packages can read the data, then it must be parsed line by line. Let’s explore this problem.</p>
<div id="importing-data-5" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Importing Data<a class="anchor" aria-label="anchor" href="#importing-data-5"><i class="fas fa-link"></i></a>
</h3>
<p>You can read the contents of a text file with function <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code>: </p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file to read</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'pride_and_prejudice.txt'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file line by line</span></span>
<span><span class="va">my_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print 50 characters of first fifteen lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_txt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, </span>
<span>              start <span class="op">=</span> <span class="fl">1</span>, </span>
<span>              end <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "The Project Gutenberg EBook of Pride and Prejudice"
R&gt;  [2] ""                                                  
R&gt;  [3] "This eBook is for the use of anyone anywhere at no"
R&gt;  [4] "almost no restrictions whatsoever.  You may copy i"
R&gt;  [5] "re-use it under the terms of the Project Gutenberg"
R&gt;  [6] "with this eBook or online at www.gutenberg.org"    
R&gt;  [7] ""                                                  
R&gt;  [8] ""                                                  
R&gt;  [9] "Title: Pride and Prejudice"                        
R&gt; [10] ""                                                  
R&gt; [11] "Author: Jane Austen"                               
R&gt; [12] ""                                                  
R&gt; [13] "Posting Date: August 26, 2008 [EBook #1342]"       
R&gt; [14] "Release Date: June, 1998"                          
R&gt; [15] "Last Updated: March 10, 2018"</code></pre>
<p>In this example, file pride_and_prejudice.txt contains the whole content of the book <em>Pride and Prejudice</em> by Jane Austen, freely available in the <a href="http://www.gutenberg.org/">Gutenberg</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="http://www.gutenberg.org/" class="uri"&gt;http://www.gutenberg.org/&lt;/a&gt;&lt;/p&gt;'><sup>41</sup></a> project. We imported the entire content of the file as a <code>character</code> vector named <code>my_txt</code>. Each element of <code>my_txt</code> is a line from the raw text file. Based on it, we can calculate many things such as the number of lines in the book and the number of times that the name <code>'Bennet'</code>, one of the protagonists, appears in the text:</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># count number of lines</span></span>
<span><span class="va">n_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">my_txt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set target text</span></span>
<span><span class="va">name_to_search</span> <span class="op">&lt;-</span> <span class="st">'Bennet'</span></span>
<span>  </span>
<span><span class="co"># set function for counting words</span></span>
<span><span class="va">fct_count_bennet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">str_in</span>, <span class="va">target_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span>  <span class="va">n_words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">str_in</span>, </span>
<span>                                   pattern <span class="op">=</span> <span class="va">target_text</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">n_words</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># use fct for all lines of Pride and Prejudice</span></span>
<span><span class="va">n_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">my_txt</span>, </span>
<span>                      FUN <span class="op">=</span> <span class="va">fct_count_bennet</span>, </span>
<span>                      target_text <span class="op">=</span> <span class="va">name_to_search</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print results</span></span>
<span><span class="va">my_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'The number of lines found in the file is '</span>, </span>
<span>                 <span class="va">n_lines</span>, <span class="st">'.\n'</span>,</span>
<span>                 <span class="st">'The word "'</span>, <span class="va">name_to_search</span>, <span class="st">'" appears '</span>, </span>
<span>                 <span class="va">n_times</span>, <span class="st">' in the book.'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_msg</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; The number of lines found in the file is 13427.
R&gt; The word "Bennet" appears 664 in the book.</code></pre>
<p>In the example, we once again used <code>sapply</code>. In this case, it allowed us to use a function for each element of <code>my_txt</code>. We searched and counted the number of times the word “Bennet” was found. Notice we could simply change <code>name_to_search</code> for any other name if we wanted to.</p>
</div>
<div id="exporting-data-5" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data-5"><i class="fas fa-link"></i></a>
</h3>
<p>A typical case of exporting unstructured text is saving the log record of a procedure. This is quite simple. Using function <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::write_lines</a></code>, use the input <code>file</code> to set the name of the local file and <code>x</code> for the actual textual content. </p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="st">'data/temp.txt'</span></span>
<span></span>
<span><span class="co"># set some string</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Today is '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'\n'</span>, </span>
<span>                  <span class="st">'Tomorrow is '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save string to file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">write_lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_text</span>, file <span class="op">=</span> <span class="va">my_f</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In the previous example, we created a simple text object and saved it in data/temp.txt. We can check the result with the <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code> function:</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Today is 2022-11-23"    "Tomorrow is 2022-11-24"</code></pre>
<p>As we can see, it worked as expected.</p>
</div>
</div>
<div id="how-to-select-a-format" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> How to Select a Format<a class="anchor" aria-label="anchor" href="#how-to-select-a-format"><i class="fas fa-link"></i></a>
</h2>
<p>The choice of file format is an important topic and might actually be a time-saver at your work. In that decision, we must consider three points:</p>
<ul>
<li>speed of reading and writing operations;</li>
<li>size of the resulting file;</li>
<li>compatibility with other software and operating systems.</li>
</ul>
<p>Usually, the use of <em>csv</em> files easily satisfies these requirements. A <em>csv</em> file is nothing more than a text file that can be opened, viewed, and imported into any other statistical software. This makes it easy to share it with other people. Also, the size of <em>csv</em> files is usually not restrictive and, if needed, it can be compressed using the <em>zip</em> function. For these reasons, the use of <em>csv</em> files for importing and exporting data is preferable in the vast majority of situations. </p>
<p>However, there are cases where the execution speed of import and export operations matter. If you don’t mind giving up portability, the <em>rds</em> format is a great choice for most projects. If you have good hardware and execution speed with <em>rds</em> is still not great, then the best alternative is the <em>fst</em> format, which uses all cores to import and export data. Finally, if you can, my most important suggestion is to <strong>avoid the Excel format at all costs</strong>.</p>
</div>
<div id="exerc-importacao-exportacao" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Exercises<a class="anchor" aria-label="anchor" href="#exerc-importacao-exportacao"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-3" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-3"><i class="fas fa-link"></i></a>
</h3>
<p>Create a <code>dataframe</code> with the following code:</p>
<pre><code><a href="https://dplyr.tidyverse.org">library(dplyr)

my_N &lt;- 10000
my_df &lt;- tibble(x = 1:my_N,
                y = runif(my_N))</a></code></pre>
<p>Export the resulting <code>dataframe</code> to each of the five formats: csv, rds, xlsx, fst. Which of the formats took up the most space in the computer’s memory? Tip: <code>file.size</code> calculates the size of files within R.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e067b4f0467" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e067b4f0467" class="collapse">
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

do_tests &lt;- function(my_N) {
  
  my_df &lt;- tibble(x = 1:my_N,
                  y = runif(my_N))
  
  # csv
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.csv')
  time.csv &lt;- system.time({
    write_csv(my_df, my_f)
  })['elapsed']
  size.csv &lt;- file.size(my_f)/1000000
  
  # rds
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.rds')
  time.rds &lt;- system.time({
    write_rds(my_df, my_f)
  })['elapsed']
  
  size.rds &lt;- file.size(my_f)/1000000
  
  # xlsx
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.xlsx')
  library(writexl) 
  time.xlsx &lt;- system.time({
    write_xlsx(my_df, my_f)
  })['elapsed']
  
  size.xlsx &lt;- file.size(my_f)/1000000
  
  # fst
  library(fst)
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.fst')
  time.fst &lt;- system.time({
    write_fst(my_df, my_f)
  })['elapsed']
  
  size.fst &lt;- file.size(my_f)/1000000
  
  print(c(size.csv, size.rds, size.xlsx, size.fst))
  
  print(c(time.csv, time.rds, time.xlsx, time.fst))
  
  tab &lt;- tibble(Result = c('csv', 'rds', 'xlsx', 'fst'), 
                Size =  c(size.csv, size.rds, size.xlsx, size.fst),
                Time = c(time.csv, time.rds, time.xlsx, time.fst))
  
  return(tab)
}

my_N &lt;- 10000

tab &lt;- do_tests(my_N)
print(tab)

my_msg &lt;- paste0('The format with largest disk space for N = ', my_N, ' is ', 
                 tab$Result[which.max(tab$Size)], '.')
message(my_msg)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-3" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-3"><i class="fas fa-link"></i></a>
</h3>
<p>Improve the previous code by measuring the execution time for saving the data in different formats. Which file format resulted in the fastest execution for exporting data? Tip: use the <code>system.time</code> function or the<code>tictoc</code> package to calculate the execution times.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0669e4687e" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0669e4687e" class="collapse">
<div class="card card-body">
<pre><code># do notice that this chunk requires the execution of previous solution
my_msg &lt;- paste0('The format with least execution time for N = ', my_N, ' is ', 
                 tab$Result[which.min(tab$Time)], '.')
message(my_msg)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-2" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-2"><i class="fas fa-link"></i></a>
</h3>
<p>For the previous code, reset the value of <code>my_N</code> to <code>1000000</code>. Does it change the answers to the last two questions?</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e061a970302" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e061a970302" class="collapse">
<div class="card card-body">
<pre><code># do notice that this chunk requires the execution of previous solution
my_N &lt;- 1000000

tab &lt;- do_tests(my_N)
print(tab)

my_msg &lt;- paste0('The format with largest disk space for N = ', my_N, ' is ', 
                 tab$Result[which.max(tab$Size)], '.')

message(my_msg)

my_msg &lt;- paste0('The format with least execution time for N = ', my_N, ' is ', 
                 tab$Result[which.min(tab$Time)], '.')
message(my_msg)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-2" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-2"><i class="fas fa-link"></i></a>
</h3>
<p>Use <code><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">afedR::get_data_file</a></code> function to access the <code>SP500.csv</code> file in the book’s data repository. Import the contents of the file into R with the function <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code>. How many lines are there in the resulting <code>dataframe</code>?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="4" data-answer='["2718"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e065ce7090" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e065ce7090" class="collapse">
The solution is 2718. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_f &lt;- afedR::get_data_file('SP500.csv')

df_SP500 &lt;- read_csv(my_f, 
                     col_types = cols())

my_msg &lt;- paste0('There are ', nrow(df_SP500), ' rows and ', 
                 ncol(df_SP500), ' columns in file ', basename(my_f))
message(my_msg)

my_sol &lt;- nrow(df_SP500)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-2" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-2"><i class="fas fa-link"></i></a>
</h3>
<p>Within link <a href="https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv">https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv/</a> you will find a <em>.csv</em> file for the <em>Grunfeld</em> data. This is a particularly famous table due to its use as reference data in econometric models. Using <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> function, read this file using the direct link as input <code>read_csv</code>. How many columns do you find in the resulting <code>dataframe</code>?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="1" data-answer='["5"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0661568db2" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0661568db2" class="collapse">
The solution is 5. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_url &lt;- 'https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv'

df_grunfeld &lt;- read_csv(my_url, col_types = cols())

my_sol &lt;- ncol(df_grunfeld)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-2" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-2"><i class="fas fa-link"></i></a>
</h3>
<p>Use function <code><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">afedR::get_data_file</a></code> function to access the <code>example_tsv.csv</code> file in the book’s data repository. Note that the columns of the data are separated by the tab symbol (<code>'\t'</code>), and not the usual comma. After reading the <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_delim</a></code> manual, import the information from this file to your R session. How many rows does the resulting <code>dataframe</code> contain?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="4" data-answer='["5570"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e062972f8ef" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e062972f8ef" class="collapse">
The solution is 5570. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_f &lt;- afedR::get_data_file('example_tsv.csv')

df_tsv &lt;- read_delim(my_f, delim = '\t', col_types = cols())

my_sol &lt;- nrow(df_tsv)

#check_answers(my_answers)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-2" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-2"><i class="fas fa-link"></i></a>
</h3>
<p>In the book package there is a data file called <code>'funky_csv2.csv'</code>. This has a particularly bizarre format for the data. Open it in a text editor and try to understand how the columns are separated and what is symbol for decimals. After that, study the inputs of function <code>read.table</code> and import the table into your R session. If we add the number of rows to the number of columns in the imported table, what is the result?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["19"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e063be88395" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e063be88395" class="collapse">
The solution is 19. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_f &lt;- afedR::get_data_file('funky_csv2.csv')

df_funky &lt;- read.table(file = my_f, 
           dec = '?', 
           skip = 7, 
           sep = '|', 
           header = TRUE)

my_sol &lt;- nrow(df_funky) + ncol(df_funky)</a></code></pre>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://afedr-ed2.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
                            
  <div class="chapter-nav">
<div class="prev"><a href="research-scripts.html"><span class="header-section-number">3</span> Writing Research Scripts</a></div>
<div class="next"><a href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing"><span class="header-section-number">4</span> Importing Data from Local Files</a></li>
<li>
<a class="nav-link" href="#csv-files"><span class="header-section-number">4.1</span> csv files</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data"><span class="header-section-number">4.1.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data"><span class="header-section-number">4.1.2</span> Exporting Data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#excel-files-xls-and-xlsx"><span class="header-section-number">4.2</span> Excel Files (xls and xlsx)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data-1"><span class="header-section-number">4.2.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data-1"><span class="header-section-number">4.2.2</span> Exporting Data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#rdata-and-rds-files"><span class="header-section-number">4.3</span> RData and rds Files</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data-2"><span class="header-section-number">4.3.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data-2"><span class="header-section-number">4.3.2</span> Exporting Data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#fst-files"><span class="header-section-number">4.4</span> fst files</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data-3"><span class="header-section-number">4.4.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data-3"><span class="header-section-number">4.4.2</span> Exporting Data</a></li>
<li><a class="nav-link" href="#timing-the-fst-format"><span class="header-section-number">4.4.3</span> Timing the fst format</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sqlite-files"><span class="header-section-number">4.5</span> SQLite Files</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data-4"><span class="header-section-number">4.5.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data-4"><span class="header-section-number">4.5.2</span> Exporting Data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#unstructured-data-and-other-formats"><span class="header-section-number">4.6</span> Unstructured Data and Other Formats</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importing-data-5"><span class="header-section-number">4.6.1</span> Importing Data</a></li>
<li><a class="nav-link" href="#exporting-data-5"><span class="header-section-number">4.6.2</span> Exporting Data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#how-to-select-a-format"><span class="header-section-number">4.7</span> How to Select a Format</a></li>
<li>
<a class="nav-link" href="#exerc-importacao-exportacao"><span class="header-section-number">4.8</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-3">Q.1</a></li>
<li><a class="nav-link" href="#q.2-3">Q.2</a></li>
<li><a class="nav-link" href="#q.3-2">Q.3</a></li>
<li><a class="nav-link" href="#q.4-2">Q.4</a></li>
<li><a class="nav-link" href="#q.5-2">Q.5</a></li>
<li><a class="nav-link" href="#q.6-2">Q.6</a></li>
<li><a class="nav-link" href="#q.7-2">Q.7</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyzing Financial and Economic Data with R - Online Edition</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-11-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
