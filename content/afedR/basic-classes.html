<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Basic Object Classes | Analyzing Financial and Economic Data with R - Online Edition</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 7 Basic Object Classes | Analyzing Financial and Economic Data with R - Online Edition">
<meta property="og:type" content="book">
<meta property="og:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<meta property="og:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Basic Object Classes | Analyzing Financial and Economic Data with R - Online Edition">
<meta name="twitter:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyzing Financial and Economic Data with R - Online Edition</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="about-new-edition.html">About New Edition</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basicoperations.html"><span class="header-section-number">2</span> Basic Operations in R</a></li>
<li><a class="" href="research-scripts.html"><span class="header-section-number">3</span> Writing Research Scripts</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">4</span> Importing Data from Local Files</a></li>
<li><a class="" href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></li>
<li><a class="" href="data-structure-objects.html"><span class="header-section-number">6</span> Dataframes and other objects</a></li>
<li><a class="active" href="basic-classes.html"><span class="header-section-number">7</span> Basic Object Classes</a></li>
<li><a class="" href="programming.html"><span class="header-section-number">8</span> Programming and Data Analysis</a></li>
<li><a class="" href="cleaning.html"><span class="header-section-number">9</span> Cleaning and Structuring Data</a></li>
<li><a class="" href="figures.html"><span class="header-section-number">10</span> Creating and Saving Figures with ggplot2</a></li>
<li><a class="" href="models.html"><span class="header-section-number">11</span> Financial Econometrics with R</a></li>
<li><a class="" href="reporting.html"><span class="header-section-number">12</span> Reporting Results</a></li>
<li><a class="" href="optimizing.html"><span class="header-section-number">13</span> Optimizing Code</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98297869-1', 'auto');
  ga('send', 'pageview');

</script><!-- Global site tag (gtag.js) - Google Analytics GOOGLE ADS--><script async src="https://www.googletagmanager.com/gtag/js?id=UA-89690212-2">
</script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89690212-2');
</script><div id="basic-classes" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Basic Object Classes<a class="anchor" aria-label="anchor" href="#basic-classes"><i class="fas fa-link"></i></a>
</h1>
<p><strong>The basic classes are the most primary elements of data representation in R</strong>. Previously, we used the basic classes to translate raw information from files or the internet. The numeric data became a <code>numeric</code> column in a <code>dataframe</code>, while text data became a <code>character</code> object.</p>
<p>In this chapter, we will study R’s basic object classes with depth, including the manipulation of their content. This chapter will show you what operations are possible with each object class and how you can use functions and packages to manipulate the information efficiently. It includes the following types of objects:</p>
<ul>
<li>Numeric (<code>numeric</code>)</li>
<li>Text (<code>character</code>)</li>
<li>Factors (<code>factor</code>)</li>
<li>Logical Values (<code>logical</code>)</li>
<li>Dates and Time (<code>Date</code> and <code>timedate</code>)</li>
<li>Missing Data (<code>NA</code>)</li>
</ul>
<div id="numeric-objects" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> <code>Numeric</code> Objects<a class="anchor" aria-label="anchor" href="#numeric-objects"><i class="fas fa-link"></i></a>
</h2>
<p>The objects of type <code>numeric</code> represent quantities and, unsurprisingly, are one of the most used objects in data research. For example, the price of a stock at a given date, the value of inflation in a given period and country, the net profit of a company at the end of the fiscal year, among many other possibilities.</p>
<div id="creating-and-manipulating-numeric-objects" class="section level3" number="7.1.1">
<h3>
<span class="header-section-number">7.1.1</span> Creating and Manipulating <code>numeric</code> Objects<a class="anchor" aria-label="anchor" href="#creating-and-manipulating-numeric-objects"><i class="fas fa-link"></i></a>
</h3>
<p>It is easy to create and manipulate the <code>numeric</code> objects. As expected, we can use the common symbols of mathematical operations, such as sum (<code>+</code>), difference (<code>-</code>), division (<code>/</code>) and multiplication (<code>*</code>). When working with <code>numeric</code> vectors, all mathematical operations are carried out using an <strong>element by element</strong> orientation and using vector notation. For example, this means that we can add the elements from two vectors in a single line of code.</p>
<p>As you can see in the next example, where we have created two vectors and perform various operations.</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create numeric vectors</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span></span>
<span></span>
<span><span class="co"># print sum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  3  5  7  9 11</code></pre>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print multiplication</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  2  6 12 20 30</code></pre>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print division</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.5000000 0.6666667 0.7500000 0.8000000 0.8333333</code></pre>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print exponentiation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]     1     8    81  1024 15625</code></pre>
<p>The difference between R and other programming languages is that operations between vectors of different sizes are accepted. That is, we can also add a <code>numeric</code> vector with four elements to another with only two. Whenever that happens, R calls for the <strong>recycling rule</strong>. It states that, if two different sized vectors are interacting, the smaller vector is repeated as often as necessary to obtain the same number of elements as the larger vector. See the following example: </p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set x with 4 elements and y with 2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span></span>
<span></span>
<span><span class="co"># print sum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 3 3 5 5</code></pre>
<p>The result of <code>x + y</code> is equivalent to <code>1:4 + c(2, 1, 2, 1)</code>. If you try to operate with vectors in which the length of the largest vector is not a multiple of the length of the smaller, R performs the same recycling procedure. However, it also sends a <code>warning</code> message to inform the user that the recycling procedure did not result in a perfect match.</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set x = 4 elements and y with 3</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print sum (recycling rule)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Warning in x + y: longer object length is not a multiple of
R&gt; shorter object length</code></pre>
<pre><code>R&gt; [1] 2 4 6 5</code></pre>
<p>The first three elements of <code>x</code> were summed to the first three elements of <code>y</code>, as expected. However, the fourth element of <code>x</code> was summed to the first element of <code>y</code>. In order to complete the operation, R cycled through the values of the vector, restarting with the first element of <code>y</code>.</p>
<p>Elements of a <code>numeric</code> vector can also be named. See an example next, where we create a vector with several named items.</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create named vector</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>item1 <span class="op">=</span> <span class="fl">10</span>, </span>
<span>       item2 <span class="op">=</span> <span class="fl">14</span>, </span>
<span>       item3 <span class="op">=</span> <span class="fl">9</span>, </span>
<span>       item4 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; item1 item2 item3 item4 
R&gt;    10    14     9     2</code></pre>
<p>Empty <code>numeric</code> vectors can also be created. Sometimes, you need to preallocate an empty vector to be filled with values later. In some situations this simple procedure can make the code faster; and for that, you need to use the <code>numeric</code> function: </p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create empty numeric vector of length 10</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>As you can see, when using <code>numeric(length = 10)</code>, all values are set to zero.</p>
</div>
<div id="creating-a-numeric-sequence" class="section level3" number="7.1.2">
<h3>
<span class="header-section-number">7.1.2</span> Creating a <code>numeric</code> Sequence<a class="anchor" aria-label="anchor" href="#creating-a-numeric-sequence"><i class="fas fa-link"></i></a>
</h3>
<p>In R, you have two ways to create a sequence of numerical values. The first with operator <code>:</code> as in <code>my_seq &lt;- 1:10</code>. This method is practical because the notation is clear and direct.</p>
<p>However, using the operator <code>:</code> can be restrictive. Did you notice that it only creates sequences where the difference between adjacent elements is +1 or -1? A more powerful version for the creation of sequences is the use of function <code>seq</code>. With it, you can set the intervals between each value with the argument <code>by</code>. See an example next: </p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create sequence with seq</span></span>
<span><span class="va">my_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, </span>
<span>              to <span class="op">=</span> <span class="fl">10</span>, </span>
<span>              by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_seq</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10</code></pre>
<p>Another interesting feature of function <code>seq</code> is the possibility of creating equally spaced vectors with an initial value, a final value, and the desired number of elements. This is accomplished using option <code>length.out</code>. In the following code, we create a array from 0 to 10 with 20 elements:</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create sequence with defined number of elements</span></span>
<span><span class="va">desired_len</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">my_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, </span>
<span>              to <span class="op">=</span> <span class="fl">10</span>, </span>
<span>              length.out <span class="op">=</span> <span class="va">desired_len</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_seq</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]  0.0000000  0.5263158  1.0526316  1.5789474  2.1052632
R&gt;  [6]  2.6315789  3.1578947  3.6842105  4.2105263  4.7368421
R&gt; [11]  5.2631579  5.7894737  6.3157895  6.8421053  7.3684211
R&gt; [16]  7.8947368  8.4210526  8.9473684  9.4736842 10.0000000</code></pre>
<p>The final number of elements in object <code>my_seq</code> is exactly 20. Function <code>seq</code> automatically calculates and sets the difference of 0.5263 between the adjacent elements. That is, if we calculate the difference from one element to the other, we will always find the same result of 0.5263.</p>
</div>
<div id="creating-vectors-with-repeated-elements" class="section level3" number="7.1.3">
<h3>
<span class="header-section-number">7.1.3</span> Creating Vectors with Repeated Elements<a class="anchor" aria-label="anchor" href="#creating-vectors-with-repeated-elements"><i class="fas fa-link"></i></a>
</h3>
<p>Another way to create <code>numeric</code> vectors is by using repetition. For example, imagine that we are interested in a vector with the value 1 repeated ten times. For that, we use function <code>rep</code>: </p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># repeat vector three times</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
<p>It also works with vectors. For example, let’s say you need to create a vector with the repeated values of <code>c(1, 2)</code>. The result should be equal to <code>c(1, 2, 1, 2, 1, 2)</code>. For that, we use <code>rep</code> the same way:</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># created a vector with repeated elements</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>            times <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 1 2 1 2</code></pre>
</div>
<div id="creating-vectors-with-random-numbers" class="section level3" number="7.1.4">
<h3>
<span class="header-section-number">7.1.4</span> Creating Vectors with Random Numbers<a class="anchor" aria-label="anchor" href="#creating-vectors-with-random-numbers"><i class="fas fa-link"></i></a>
</h3>
<p>Some applications in finance and economics require the use of random numbers to simulate mathematical models. For example, the simulation method of Monte Carlo can generate asset prices based on random numbers from the Normal distribution.</p>
<p>In R, several functions create random numbers for different statistical distributions. The most commonly used, however, are functions <code><a href="https://rdrr.io/r/stats/Normal.html">stats::rnorm</a></code> and <code><a href="https://rdrr.io/r/stats/Uniform.html">stats::runif</a></code>. Remember that package <code>stats</code> is automatically loaded when R starts. So, unless you changed the default settings of R’s startup, there is no need to make a call to <code><a href="https://rdrr.io/r/base/library.html">library(stats)</a></code>. </p>
<p>Function <code>rnorm</code> generates random numbers from the Normal distribution, with options for the mean and standard deviation. The <code>mean</code> will set the point with the highest frequency and <code>sd</code> (standard deviation) will change the dispersion of the histogram.</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate 10 random numbers from a Normal distribution</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, </span>
<span>                    mean <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                    sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  num [1:10000] -0.169 0.612 0.678 0.568 -0.573 ...</code></pre>
<p>We generated ten thousand random numbers from a Normal distribution, with mean zero and standard deviation equal to one. Let’s see if its distribution of numbers looks close to the Normal, a bell shaped distribution:</p>
<div class="inline-figure"><img src="afedR_ed02-ONLINE_files/figure-html/unnamed-chunk-304-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Yes, the shape of the frequency distribution is visually close to the bell curve. You can change the parameters <code>mean</code> and <code>sd</code> for different shapes of a Normal distribution.</p>
<p>Function <code>runif</code> generates random values uniformly distributed between a maximum and a minimum. It is commonly used to simulate probabilities with values between zero and one. The <code>runif</code> function has three input parameters: the desired number of random values, the minimum value, and maximum value. See the following example:</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a random vector with minimum and maximum</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                    min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, </span>
<span>                    max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] -0.3947496  3.4054654  3.1049157  3.5276227 -1.5256521
R&gt;  [6] -1.0434816 -4.0893803  3.2413137 -4.5963401  4.3946481</code></pre>
<p>Note that both functions, <code>rnorm</code> and <code>runif</code>, are limited to their respective distribution. An alternative and flexible way to generate random values is to use the <code>sample</code> function. It accepts any vector as input and returns a scrambled version of its elements. Its flexibility lies in the fact that the input vector can be anything. For example, if we wanted to create a random vector with elements taken from vector <code>c(0, 5, 15, 20, 25)</code>, we could do it like this: </p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create sequence</span></span>
<span><span class="va">my_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">25</span>, by<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sample sequence</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_vec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 20 25  0  5 15 10</code></pre>
<p>Function <code>sample</code> also allows the random selection of a fixed number of elements. If we wanted to select only one element of <code>my_vec</code> randomly, we could write the code as:</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample one element of my_vec</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_vec</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 25</code></pre>
<p>If we wanted two random elements from <code>my_rnd_vec</code>:</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample two elements of my_vec</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_vec</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 20  0</code></pre>
<p>Besides, you can select values from a smaller vector to create a larger vector. Consider the case where you have a vector with numbers <code>c(5, 10, 15)</code> and want to create a random vector with ten elements. For that, we use the option <code>replace = TRUE</code>.</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector</span></span>
<span><span class="va">my_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sample</span></span>
<span><span class="va">my_rnd_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_vec</span>, size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 10  5  5 15 10 10 10 10 10 15</code></pre>
<p>Another important feature of <code>sample</code> is it works for any type of vector, not only for those of the <code>numeric</code> class:</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of sample with characters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'elem 1'</span>,<span class="st">'elem 2'</span>,<span class="st">'elem 3'</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "elem 1"</code></pre>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of sample with list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; $y
R&gt; [1] "a" "b"</code></pre>
<p>At this point, it is important to acknowledge that <strong>the generation of random values in R is not entirely random!</strong> Internally, the computer makes selections based on a deterministic queue. Every time that chance-related functions, such as <code>rnorm</code>, <code>runif</code>, and <code>sample</code>, are called in the code, the computer chooses a different place in this queue according to various parameters. The practical effect is that the actual chosen values are unpredictable from the user’s viewpoint. However, for the computer, this selection is absolutely predictable and deterministic.</p>
<p>One neat trick is that we can select the starting place in the queue of random values using function <code><a href="https://rdrr.io/r/base/Random.html">base::set.seed</a></code>. In practical terms, the result is that, after a call to <code>set.seed</code>, all subsequent numbers and random selections will be the same in every code execution. Using <code>set.seed</code> is strongly recommended for the reproducibility of code involving randomness. Anyone can replicate the exact same results, even if it involves the selection of random numbers. See the following example. </p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed with integer 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create and print "random" vectors</span></span>
<span><span class="va">my_rnd_vec_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec_1</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.50747820 0.30676851 0.42690767 0.69310208 0.08513597</code></pre>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_rnd_vec_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_rnd_vec_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.2254366 0.2745305 0.2723051 0.6158293 0.4296715</code></pre>
<p>In the previous code, the value 10 in <code>set.seed(10)</code> is an integer chosen by the user. After the call to <code>set.seed(10)</code>, all selections and random numbers will start from the same point in the queue. Therefore, the random vectors are the same. By running that previous chunk of code in your computer, you’ll see that the values of <code>my_rnd_vec_1</code> and <code>my_rnd_vec_2</code> will be exactly the same as the ones printed in this book.</p>
<p>Function <code>set.seed</code> also works for <code>sample</code>:</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fix seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]  5  2  1  6  8 10  3  7  9  4</code></pre>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 13 15 10 17 20 14 19 12 11 18 16</code></pre>
<p>Likewise, if you execute the previous code in your R session, you’ll see the exact same selections.</p>
</div>
<div id="accessing-the-elements-of-a-numeric-vector" class="section level3" number="7.1.5">
<h3>
<span class="header-section-number">7.1.5</span> Accessing the Elements of a <code>numeric</code> Vector<a class="anchor" aria-label="anchor" href="#accessing-the-elements-of-a-numeric-vector"><i class="fas fa-link"></i></a>
</h3>
<p>All elements of a numerical vector can be accessed with brackets (<code>[]</code>). For example, if we wanted only the first element of <code>x</code>, we can use <code>x[1]</code>:</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="op">-</span><span class="fl">9</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get first element</span></span>
<span><span class="va">first_elem_x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">first_elem_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] -1</code></pre>
<p>The same notation is used to extract parts of a vector. If we wanted to create a sub-vector with the first and second element of <code>x</code>, we can achieve this goal with the next chunk of code:</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sub-vector of x</span></span>
<span><span class="va">sub_x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">sub_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] -1  4</code></pre>
<p>To access named elements of a numeric array, simply use its name as a <code>character</code> value or vector inside the brackets.</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set named vector</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>item1 <span class="op">=</span> <span class="fl">10</span>, item2 <span class="op">=</span> <span class="fl">14</span>, item3 <span class="op">=</span> <span class="op">-</span><span class="fl">9</span>, item4 <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># access elements by name</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">'item2'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; item2 
R&gt;    14</code></pre>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'item2'</span>,<span class="st">'item4'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; item2 item4 
R&gt;    14    -2</code></pre>
<p>We can also access the elements of a numerical vector using logical tests. For example, if we were interested in knowing which values of <code>x</code> are larger than <em>0</em>, we could use the following code:</p>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find all values of x higher than zero</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; item1 item2 
R&gt;    10    14</code></pre>
<p>The selection of elements from a vector, according to some criteria, is called logical indexing. Objects of type <code>logical</code> will be treated later in this same chapter.</p>
</div>
<div id="modifying-and-removing-elements-of-a-numeric-vector" class="section level3" number="7.1.6">
<h3>
<span class="header-section-number">7.1.6</span> Modifying and Removing Elements of a <code>numeric</code> Vector<a class="anchor" aria-label="anchor" href="#modifying-and-removing-elements-of-a-numeric-vector"><i class="fas fa-link"></i></a>
</h3>
<p>The modification of a vector is very simple. Just indicate the changes with the <em>assign</em> symbol (<code>&lt;-</code>): </p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span></span>
<span><span class="co"># modify first element to 5</span></span>
<span><span class="va">my_x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 5 2 3 4</code></pre>
<p>This modification can also be performed block-wise:</p>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span></span>
<span></span>
<span><span class="co"># set the first three elements to 5</span></span>
<span><span class="va">my_x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 5 5 5 3 4 5</code></pre>
<p>Using conditions to change values in a vector is also possible:</p>
<div class="sourceCode" id="cb595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span></span>
<span></span>
<span><span class="co"># set any value lower than 2 to 0</span></span>
<span><span class="va">my_x</span><span class="op">[</span><span class="va">my_x</span><span class="op">&lt;</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 0 0 0 0 0 0 0 2 3 4 5</code></pre>
<p>The removal of elements of a vector is carried out using a negative index:</p>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span></span>
<span></span>
<span><span class="co"># remove first and second element of my_x</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="va">my_x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># show result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] -3 -2 -1  0  1  2  3  4  5</code></pre>
<p>Notice how using negative index simply returns the original vector, without the elements in the brackets.</p>
</div>
<div id="creating-groups" class="section level3" number="7.1.7">
<h3>
<span class="header-section-number">7.1.7</span> Creating Groups<a class="anchor" aria-label="anchor" href="#creating-groups"><i class="fas fa-link"></i></a>
</h3>
<p>A common data task is to create groups based on numerical data. For example, we can calculate how many cases in the sample are located within a certain numerical range. Now, let’s imagine that we have a vector of daily returns of a stock, the percentage change in prices from one day to another. A simple way to measure the risk of the investment is to divide the return interval into five parts and verify the percentage of occurrences of returns at each range. This simple calculation will show, for example, how many days the return was negative, with a drop of the stock price.</p>
<p>In R, the function used to create intervals from a numerical vector is <code><a href="https://rdrr.io/r/base/cut.html">base::cut</a></code>. See the following example, where we create a random vector from the Normal distribution and five groups from intervals defined by the data. </p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set random vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create groups with 5 breaks</span></span>
<span><span class="va">my_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_x</span>, breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_cut</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] (-2.18,-0.71] (-0.71,0.759] (-2.18,-0.71] (-0.71,0.759]
R&gt; [5] (-0.71,0.759] (-2.18,-0.71]
R&gt; 5 Levels: (-3.66,-2.18] (-2.18,-0.71] ... (2.23,3.7]</code></pre>
<p>Be aware that ranges define the names in <code>my_cut</code>, and the result is a <code>factor</code> object. We will cover this object in a future section. For now, it is worthwhile to say <code>factors</code> are simply groups within our data. Going forward, we can also check how often we find cases in each group using <code><a href="https://rdrr.io/r/base/table.html">base::table</a></code>:</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">my_cut</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; my_cut
R&gt; (-3.66,-2.18] (-2.18,-0.71] (-0.71,0.759]  (0.759,2.23] 
R&gt;           154          2132          5459          2149 
R&gt;    (2.23,3.7] 
R&gt;           106</code></pre>
<p>As expected, the distribution of values is balanced, with a higher occurrence of values around zero – the mean.</p>
<p>With the <code>cut</code> function, you can also define custom breaks in data and group names. See next, where we use a <code>tibble</code> to organize our data:</p>
<div class="sourceCode" id="cb603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create random vector in tibble</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define breaks and labels manually</span></span>
<span><span class="va">my_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Low'</span>,<span class="st">'Normal'</span>, <span class="st">'High'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create group from numerical vector</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cut_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, </span>
<span>                     breaks <span class="op">=</span> <span class="va">my_breaks</span>, </span>
<span>                     labels <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># glimpse it!</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 10,000
R&gt; Columns: 2
R&gt; $ x     &lt;dbl&gt; -0.42217453, 1.21510691, -0.48018365, 0.0904…
R&gt; $ cut_x &lt;fct&gt; Normal, High, Normal, Normal, Low, Normal, N…</code></pre>
<p>Notice that, in this example of creating a group from a numerical vector, the breaks were defined in <code>my_breaks</code> and the names in <code>my_labels</code>. We can once again check the distribution of groups with function <code>table</code>:</p>
<div class="sourceCode" id="cb605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">$</span><span class="va">cut_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt;    Low Normal   High 
R&gt;   1593   6770   1637</code></pre>
</div>
<div id="other-useful-functions-2" class="section level3" number="7.1.8">
<h3>
<span class="header-section-number">7.1.8</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-2"><i class="fas fa-link"></i></a>
</h3>
<p><strong>as.numeric</strong> - Converts an object to the <code>numeric</code> class. </p>
<div class="sourceCode" id="cb607"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1'</span>, <span class="st">'2'</span>, <span class="st">'3'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "character"</code></pre>
<div class="sourceCode" id="cb609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 3</code></pre>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "numeric"</code></pre>
<p><strong>unique</strong> - Returns all unique values of a numeric vector. </p>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 3 5</code></pre>
<p><strong>sum</strong> - Sums all elements of a <code>numeric</code> vector. </p>
<div class="sourceCode" id="cb615"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span></span>
<span><span class="va">my_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_sum</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1275</code></pre>
<p><strong>max</strong> - Returns the maximum value of a <code>numeric</code> vector. </p>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">9</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">max_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">max_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 14</code></pre>
<p><strong>min</strong> - Returns the minimum value of a <code>numeric</code> vector. </p>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">9</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">min_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">min_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 2</code></pre>
<p><strong>which.max</strong> - Returns the position of the maximum value of a <code>numeric</code> object. </p>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">141</span>, <span class="fl">9</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">which_max_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'The position of the max value of x is '</span>, </span>
<span>          <span class="va">which_max_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; The position of the max value of x is  2</code></pre>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">' and its value is '</span>, <span class="va">x</span><span class="op">[</span><span class="va">which_max_x</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  and its value is  141</code></pre>
<p><strong>which.min</strong> - Returns the position of the minimum value of a <code>numeric</code> object. </p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">9</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">which_min_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'The position of the min value of x is '</span>,</span>
<span>          <span class="va">which_min_x</span>, <span class="st">' and its value is '</span>, <span class="va">x</span><span class="op">[</span><span class="va">which_min_x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; The position of the min value of x is  4  and its value is  2</code></pre>
<p><strong>sort</strong> - Returns a sorted (ascending or descending) version of a <code>numeric</code> vector. </p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.1032680 0.3004002 0.4337767 0.5133841 0.7782837</code></pre>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 0.7782837 0.5133841 0.4337767 0.3004002 0.1032680</code></pre>
<p><strong>cumsum</strong> - Returns the cumulative sum of the elements of a <code>numerical</code> vector. </p>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="va">my_cumsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_cumsum</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]   1   3   6  10  15  21  28  36  45  55  66  78  91 105
R&gt; [15] 120 136 153 171 190 210 231 253 276 300 325</code></pre>
<p><strong>prod</strong> - Returns the product (multiplication) of all the elements of a <code>numerical</code> vector. </p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">my_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_prod</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 3628800</code></pre>
<p><strong>cumprod</strong> - Returns the cumulative product of the elements of a <code>numeric</code> vector. </p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">my_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_prod</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]       1       2       6      24     120     720    5040
R&gt;  [8]   40320  362880 3628800</code></pre>
</div>
</div>
<div id="character-objects" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> <code>Character</code> Objects<a class="anchor" aria-label="anchor" href="#character-objects"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>character</code> class, or simply text class, is used to store textual information. A practical example in finance would be to extract sentiments from Facebook and Twitter posts and use that to predict future market prices. It is worth knowing that analyzing textual information is an upward trend in research <span class="citation">(<a href="references.html#ref-gentzkow2017text" role="doc-biblioref">Gentzkow, Kelly, and Taddy 2017</a>)</span>, with many R packages developed over the last few years.</p>
<p>R has several features that facilitate the creation and manipulation of text type objects. The base functions shipped with the installation of R are comprehensive and suited for most cases. However, package <code>stringr</code> <span class="citation">(<a href="references.html#ref-R-stringr" role="doc-biblioref">Wickham 2022b</a>)</span> provides many functions that greatly expand the basic functionality.</p>
<p>A positive aspect of <code>stringr</code> is that all functions start with the name <code>str_</code> and are informative. So, using the auto-completion feature (<em>tab</em> key) described in the previous chapter, it is easy to find the names of functions. Following our preference for the packages in the <code>tidyverse</code>, we will focus only on the functions of <code>stringr</code>. The <code>base</code> functions for string manipulation will be presented but in a limited way. </p>
<div id="creating-a-simple-character-object" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Creating a Simple <code>character</code> Object<a class="anchor" aria-label="anchor" href="#creating-a-simple-character-object"><i class="fas fa-link"></i></a>
</h3>
<p>In R, every <code>character</code> object is created by encapsulating a text with double quotation marks (” “) or single (’ ’). To create an array of characters with stock <em>tickers</em>, we can do it with the following code: </p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tickers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'MMM'</span>, <span class="st">'FB'</span>, <span class="st">'ICE'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "MMM" "FB"  "ICE"</code></pre>
<p>We can confirm the class of the created object with function <code>class</code>: </p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "character"</code></pre>
</div>
<div id="creating-structured-character-objects" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Creating Structured <code>character</code> Objects<a class="anchor" aria-label="anchor" href="#creating-structured-character-objects"><i class="fas fa-link"></i></a>
</h3>
<p>We can also use R to create a text vector with some sort of structure. For example, vector <code>c('ticker 1', 'ticker 2', ..., 'ticker 19', 'ticker 20')</code> has a clear logic. It combines a text <code>ticker</code> with values from a vector that starts in 1 and ends in 20.</p>
<p>To create a text vector with the junction of text and numbers, use the <code><a href="https://stringr.tidyverse.org/reference/str_c.html">stringr::str_c</a></code> or <code>paste</code> function. See the following example, where we create the previous structured text in two ways, with space between the characters and numbers, and without it. </p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create sequence and tex</span></span>
<span><span class="va">my_seq</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="st">'text'</span></span>
<span></span>
<span><span class="co"># paste objects together (without space)</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">my_text</span>, <span class="va">my_seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "text1"  "text2"  "text3"  "text4"  "text5"  "text6" 
R&gt;  [7] "text7"  "text8"  "text9"  "text10" "text11" "text12"
R&gt; [13] "text13" "text14" "text15" "text16" "text17" "text18"
R&gt; [19] "text19" "text20"</code></pre>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># paste objects together (with space)</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">my_text</span>, </span>
<span>                 <span class="va">my_seq</span>, </span>
<span>                 sep <span class="op">=</span> <span class="st">' '</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "text 1"  "text 2"  "text 3"  "text 4"  "text 5" 
R&gt;  [6] "text 6"  "text 7"  "text 8"  "text 9"  "text 10"
R&gt; [11] "text 11" "text 12" "text 13" "text 14" "text 15"
R&gt; [16] "text 16" "text 17" "text 18" "text 19" "text 20"</code></pre>
<p>We can do the same procedure with text vectors:</p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set character value</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="st">'My name is'</span></span>
<span></span>
<span><span class="co"># set character vector</span></span>
<span><span class="va">my_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Marcelo'</span>, <span class="st">'Ricardo'</span>, <span class="st">'Tarcizio'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># paste and print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">my_x</span>, <span class="va">my_names</span>, sep <span class="op">=</span> <span class="st">' '</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "My name is Marcelo"  "My name is Ricardo" 
R&gt; [3] "My name is Tarcizio"</code></pre>
<p>Another possibility of building structured text is the repetition of the content of another object. With <code>character</code> objects, use function <code>stringr!str_dup</code> or <code><a href="https://rdrr.io/r/base/strrep.html">base::strrep</a></code> for this purpose. Consider the following example: </p>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># repeat 'abc' five times</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_dup.html">str_dup</a></span><span class="op">(</span>string <span class="op">=</span> <span class="st">'abc'</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "abcabcabcabcabc"</code></pre>
</div>
<div id="character-constants" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> <code>character</code> Constants<a class="anchor" aria-label="anchor" href="#character-constants"><i class="fas fa-link"></i></a>
</h3>
<p>R also allows direct access to all letters of the Roman alphabet. They are stored in the reserved (constant) objects, called <code>letters</code> and <code>LETTERS</code>. See an example next. </p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print all letters in alphabet (no cap)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">letters</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n"
R&gt; [15] "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"</code></pre>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print all letters in alphabet (WITH CAP)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N"
R&gt; [15] "O" "P" "Q" "R" "S" "T" "U" "V" "W" "X" "Y" "Z"</code></pre>
<p>Note that, in both cases, <code>letters</code> and <code>LETTERS</code> are not functions. They are <code>character</code> objects automatically embedded as constants in R. Even though they do not appear in the environment, and they are always available for use. You may overwrite their object names, such as in <code>letters &lt;- 'other char'</code>, but this is not advised. You never know where it is being used.</p>
<p>Other constant <code>character</code> objects in R are <code>month.abb</code>, which shows an abbreviation of months and <code>month.name</code>. Their content is presented next. </p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print abbreviation and full names of months</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep"
R&gt; [10] "Oct" "Nov" "Dec"</code></pre>
<div class="sourceCode" id="cb655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">month.name</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "January"   "February"  "March"     "April"    
R&gt;  [5] "May"       "June"      "July"      "August"   
R&gt;  [9] "September" "October"   "November"  "December"</code></pre>
</div>
<div id="selecting-pieces-of-a-text-object" class="section level3" number="7.2.4">
<h3>
<span class="header-section-number">7.2.4</span> Selecting Pieces of a Text Object<a class="anchor" aria-label="anchor" href="#selecting-pieces-of-a-text-object"><i class="fas fa-link"></i></a>
</h3>
<p>A common beginner’s mistake is to select characters of a text using brackets, as it is done for selecting elements of a vector. Consider the following code:</p>
<div class="sourceCode" id="cb657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABCDE'</span></span>
<span></span>
<span><span class="co"># print its second element (WRONG - RESULT is NA)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] NA</code></pre>
<p>The <code>NA</code> value indicates the second element of <code>my_char</code> does not exist. This happens because using square brackets is reserved for accessing the elements of an atomic vector, not characters within a larger text. Watch what happens when we use <code>my_char[1]</code>:</p>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "ABCDE"</code></pre>
<p>The result is simply the <em>ABCDE</em> text, on the first item of <code>my_char</code>. To select pieces of text, we need to use function <code><a href="https://stringr.tidyverse.org/reference/str_sub.html">stringr::str_sub</a></code> or <code><a href="https://rdrr.io/r/base/substr.html">base::substr</a></code>: </p>
<div class="sourceCode" id="cb661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print third and fourth characters</span></span>
<span><span class="va">my_substr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_char</span>,</span>
<span>                     start <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                     end <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_substr</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "B"</code></pre>
<p>These functions also work for atomic vectors. Let’s assume you imported text data, and the raw dataset contains a 3-letter identifier of a company, always in the same location of the string. Let’s simulate the situation in R:</p>
<div class="sourceCode" id="cb663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build char vec</span></span>
<span><span class="va">my_char_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ABC'</span>,<span class="st">'VBC'</span>,<span class="st">'ZMN'</span><span class="op">)</span>,</span>
<span>                      <span class="st">' - other ignorable text'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "ABC - other ignorable text"
R&gt; [2] "VBC - other ignorable text"
R&gt; [3] "ZMN - other ignorable text"</code></pre>
<p>Here, we want the information in the first three characters of each element only in <code>my_char_vec</code>. To select them, we can use the same functions as before.</p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get ids with stringr::str_sub</span></span>
<span><span class="va">ids_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">my_char_vec</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ids_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "ABC" "VBC" "ZMN"</code></pre>
<div class="rmdimportant">
<p>
<strong>Vector operations in character objects are very common in
R</strong>. Almost anything you can do to a single element can be
expanded to vectors. This facilitates the development of research
scripts as you can easily perform complicated tasks to a series of
elements in a single line of code.
</p>
</div>
</div>
<div id="finding-and-replacing-characters-of-a-text" class="section level3" number="7.2.5">
<h3>
<span class="header-section-number">7.2.5</span> Finding and Replacing Characters of a Text<a class="anchor" aria-label="anchor" href="#finding-and-replacing-characters-of-a-text"><i class="fas fa-link"></i></a>
</h3>
<p>A useful operation in handling texts is to locate specific patterns of text within a <code>character</code> object with functions <code><a href="https://stringr.tidyverse.org/reference/str_locate.html">stringr::str_locate</a></code>/<code><a href="https://rdrr.io/r/base/grep.html">base::regexpr</a></code> and <code><a href="https://stringr.tidyverse.org/reference/str_locate.html">stringr::str_locate_all</a></code>/<code><a href="https://rdrr.io/r/base/grep.html">base::gregexpr</a></code>. However, before we move on to the examples, it is important to point out that, by default, these functions use expressions of the type <code>regex</code> – regular expressions <span class="citation">(<a href="references.html#ref-thompson1968programming" role="doc-biblioref">Thompson 1968</a>)</span>. This is a specific format for the identification of patterns in text. When <code>regex</code> is used correctly, it can make your life a lot easier. You’ll be able to find complex string patterns effortlessly.</p>
<p>The most common case of string search is to verify the position or the existence of a smaller text within a larger text. For these cases, however, using language <code>regex</code> is unnecessary. Therefore, the location and replacement of characters in the next example is of the fixed type, i.e., without using <code>regex</code>. Such information is passed to the <code>stringr</code> function by setting the <code>pattern</code> input with <code><a href="https://stringr.tidyverse.org/reference/modifiers.html">stringr::fixed</a></code>, as in <code>str_locate(str_in, pattern = fixed('pattern to match')</code>. </p>
<p>The following example shows how to find the <em>D</em> character from a range of characters.</p>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set character object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABCDEF-ABCDEF-ABC'</span></span>
<span></span>
<span><span class="co"># find position of 'D' using str_locate</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate</a></span><span class="op">(</span><span class="va">my_char</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">fixed</a></span><span class="op">(</span><span class="st">'D'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      start end
R&gt; [1,]     4   4</code></pre>
<p>Note the <code>str_locate</code> function returns only the <strong>first occurrence</strong> of <em>D</em>. To locate all instances, we use function <code>str_locate_all</code>.</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABCDEF-ABCDEF-ABC'</span></span>
<span></span>
<span><span class="co"># find position of ALL 'D' using str_locate_all</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate_all</a></span><span class="op">(</span><span class="va">my_char</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">fixed</a></span><span class="op">(</span><span class="st">'D'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt;      start end
R&gt; [1,]     4   4
R&gt; [2,]    11  11</code></pre>
<p>To replace characters in a text, use functions <code>str_replace</code> and <code>str_replace_all</code> from <code>stringr</code> or <code>sub</code> and <code>gsub</code> from the base package. As with previous example, <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">stringr::str_replace</a></code> replaces the first occurrence of the character, while <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">stringr::str_replace_all</a></code> performs a global substitution; applies to all matches. Here are the differences: </p>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABCDEF-ABCDEF-ABC'</span></span>
<span></span>
<span><span class="co"># substitute the FIRST 'ABC' for 'XXX' with str_replace</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_char</span>,</span>
<span>                       pattern <span class="op">=</span> <span class="st">'ABC'</span>,</span>
<span>                       replacement <span class="op">=</span> <span class="st">'XXX'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "XXXDEF-ABCDEF-ABC"</code></pre>
<p>And now, we globally substitute characters.</p>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABCDEF-ABCDEF-ABC'</span></span>
<span></span>
<span><span class="co"># substitute ALL 'ABC' for 'XXX' with str_replace_all</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_char</span>,</span>
<span>                           pattern <span class="op">=</span> <span class="st">'ABC'</span>,</span>
<span>                           replacement <span class="op">=</span> <span class="st">'XXX'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "XXXDEF-XXXDEF-XXX"</code></pre>
<p>Again, it is worth pointing out that the operations of replacements of strings also work for vectors. Have a look at the next example.</p>
<div class="sourceCode" id="cb675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char object</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ABCDEF'</span>,<span class="st">'DBCFE'</span>,<span class="st">'ABC'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create an example of vector</span></span>
<span><span class="va">my_char_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_char</span>, <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">my_char</span>, <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                     sep <span class="op">=</span> <span class="st">' - '</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "ABC - DBCFE"     "ABCDEF - ABCDEF" "DBCFE - DBCFE"  
R&gt; [4] "ABCDEF - ABC"    "ABCDEF - ABCDEF"</code></pre>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># substitute all occurrences of 'ABC'</span></span>
<span><span class="va">my_char_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_char_vec</span>,</span>
<span>                               pattern <span class="op">=</span> <span class="st">'ABC'</span>,</span>
<span>                               replacement <span class="op">=</span> <span class="st">'XXX'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "XXX - DBCFE"     "XXXDEF - XXXDEF" "DBCFE - DBCFE"  
R&gt; [4] "XXXDEF - XXX"    "XXXDEF - XXXDEF"</code></pre>
</div>
<div id="splitting-text" class="section level3" number="7.2.6">
<h3>
<span class="header-section-number">7.2.6</span> Splitting Text<a class="anchor" aria-label="anchor" href="#splitting-text"><i class="fas fa-link"></i></a>
</h3>
<p>Eventually, you will need to break a text into different parts. Most of the time, you want to isolate a piece of particular information in the full string by using a delimiter in the text. For example, the text <code>'ABC;DEF;GHI'</code> has three sub-characters divided by the symbol <code>;</code>. To separate a text into several parts, use <code><a href="https://stringr.tidyverse.org/reference/str_split.html">stringr::str_split</a></code> or <code><a href="https://rdrr.io/r/base/strsplit.html">base::strsplit</a></code>. Both functions break the original text into several fractions, according to a chosen delimiter character: </p>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'ABC;ABC;BCD'</span></span>
<span></span>
<span><span class="co"># split it based on ';' and using stringr::str_split</span></span>
<span><span class="va">splitted_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">my_char</span>, <span class="st">';'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">splitted_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt; [1] "ABC" "ABC" "BCD"</code></pre>
<p>The output of this function is an object of type <code>list</code>. To access the text <code>BCD</code> in object <code>splitted_char</code>, we can use the following code:</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">splitted_char</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "BCD"</code></pre>
<p>For an example of a split in character vectors, see the next code.</p>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char</span></span>
<span><span class="va">my_char_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ABCDEF'</span>,<span class="st">'DBCFE'</span>,<span class="st">'ABFC'</span>,<span class="st">'ACD'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split it based on 'B' and using stringr::strsplit</span></span>
<span><span class="va">splitted_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">my_char_vec</span>, <span class="st">'B'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">splitted_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [[1]]
R&gt; [1] "A"    "CDEF"
R&gt; 
R&gt; [[2]]
R&gt; [1] "D"   "CFE"
R&gt; 
R&gt; [[3]]
R&gt; [1] "A"  "FC"
R&gt; 
R&gt; [[4]]
R&gt; [1] "ACD"</code></pre>
<p>Notice how, again, an object of type <code>list</code> is returned, where each element is the split text from the input vector.</p>
</div>
<div id="finding-the-number-of-characters-in-a-text" class="section level3" number="7.2.7">
<h3>
<span class="header-section-number">7.2.7</span> Finding the Number of Characters in a Text<a class="anchor" aria-label="anchor" href="#finding-the-number-of-characters-in-a-text"><i class="fas fa-link"></i></a>
</h3>
<p>If we want to discover the number of characters in a <code>character</code> object, you can use functions <code><a href="https://stringr.tidyverse.org/reference/str_length.html">stringr::str_length</a></code> and <code><a href="https://rdrr.io/r/base/nchar.html">base::nchar</a></code>. Both functions also work for atomic vectors. See the examples below: </p>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="st">'abcdef'</span></span>
<span></span>
<span><span class="co"># print number of characters using stringr::str_length</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 6</code></pre>
<p>And now an example with vectors.</p>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set char</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'ab'</span>, <span class="st">'abc'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print number of characters using stringr::str_length</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 3</code></pre>
</div>
<div id="generating-combinations-of-text" class="section level3" number="7.2.8">
<h3>
<span class="header-section-number">7.2.8</span> Generating Combinations of Text<a class="anchor" aria-label="anchor" href="#generating-combinations-of-text"><i class="fas fa-link"></i></a>
</h3>
<p>One useful trick in R is to use functions <code>outer</code> and <code>expand.grid</code> to create all possible combinations of elements in different objects. This is useful when you want to create a <code>character</code> vector by combining all possible elements from different vectors. For example, if we wanted to create a vector with all combinations between <code>c('a', 'b')</code> and <code>'c('A','A')</code> as <code>c('a-A', 'a-B',...)</code>, we could write:</p>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set char vecs</span></span>
<span><span class="va">my_vec_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span><span class="op">)</span></span>
<span><span class="va">my_vec_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine in matrix</span></span>
<span><span class="va">comb_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">my_vec_1</span>, <span class="va">my_vec_2</span>, <span class="va">paste</span>, sep<span class="op">=</span><span class="st">'-'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">comb_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;      [,1]  [,2] 
R&gt; [1,] "a-A" "a-B"
R&gt; [2,] "b-A" "b-B"</code></pre>
<p>The output of <code>outer</code> is a <code>matrix</code> type of object. If we wanted to change <code>comb_mat</code> to an atomic vector, we can use function <code>as.character</code>:</p>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">comb_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "a-A" "b-A" "a-B" "b-B"</code></pre>
<p>Another way to reach the same objective is by using function <code><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">tidyr::expand_grid</a></code> or <code><a href="https://rdrr.io/r/base/expand.grid.html">base::expand.grid</a></code>. Look at the next example, where we create different phrases based on all combinations of character vectors.</p>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set vectors</span></span>
<span><span class="va">my_vec_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'John '</span>, <span class="st">'Claire '</span>, <span class="st">'Adam '</span><span class="op">)</span></span>
<span><span class="va">my_vec_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'is fishing.'</span>, <span class="st">'is working.'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create df with all combinations</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">my_vec_1</span>,</span>
<span>                     verb <span class="op">=</span> <span class="va">my_vec_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print df</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 2
R&gt;   name      verb       
R&gt;   &lt;chr&gt;     &lt;chr&gt;      
R&gt; 1 "John "   is fishing.
R&gt; 2 "John "   is working.
R&gt; 3 "Claire " is fishing.
R&gt; 4 "Claire " is working.
R&gt; 5 "Adam "   is fishing.
R&gt; 6 "Adam "   is working.</code></pre>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># paste columns together in tibble</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="va">my_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>phrase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">verb</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 3
R&gt;   name      verb        phrase            
R&gt;   &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;             
R&gt; 1 "John "   is fishing. John is fishing.  
R&gt; 2 "John "   is working. John is working.  
R&gt; 3 "Claire " is fishing. Claire is fishing.
R&gt; 4 "Claire " is working. Claire is working.
R&gt; 5 "Adam "   is fishing. Adam is fishing.  
R&gt; 6 "Adam "   is working. Adam is working.</code></pre>
<p>Here, we used the function <code>expand.grid</code> to create a <code>dataframe</code> containing all possible combinations of <code>my_vec_1</code> and <code>my_vec_2</code>. We pasted the contents of these columns using <code>paste0</code>.</p>
</div>
<div id="encoding-of-character-objects" class="section level3" number="7.2.9">
<h3>
<span class="header-section-number">7.2.9</span> Encoding of <code>character</code> Objects<a class="anchor" aria-label="anchor" href="#encoding-of-character-objects"><i class="fas fa-link"></i></a>
</h3>
<p>For R, a text string is just a sequence of <em>bytes</em>. The translation of <em>bytes</em> to actual characters is achieved using a particular encoding structure. Most of the time, and especially in English speaking countries, the character encoding is not an issue. However, when dealing with text data from different spoken languages, such as Portuguese, the character encoding is something that you must learn and understand.</p>
<p>Let’s explore an example. Here, we will import data from a text file with the <code>'ISO-8859-9'</code> encoding and check the result.</p>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read text file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">afedR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/afedR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'FileWithLatinChar_Latin1.txt'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "A casa \xe9 bonita e tem muito espa\xe7o"</code></pre>
<p>The original content of the file is a text in Portuguese. As you can see, the output of <code>readLines</code> shows all Latin characters as ugly, unreadable symbols. It happens that the encoding of the file has been manually changed to <code>'ISO-8859-9'</code>, while the <code>readLines</code> function uses <code>'UTF-8'</code> as <em>default</em>.</p>
<p>The easiest solution is to modify input <code>locale</code> of <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code> so that the function is aware of the different encoding format:</p>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span>, </span>
<span>                      locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding<span class="op">=</span><span class="st">'Latin1'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "A casa é bonita e tem muito espaço"</code></pre>
<p>The Latin characters are now correct because the encoding in <code>read_lines</code> is the same as the file, <code>'Latin1'</code>. A good policy in this topic is always to check the encoding of imported text files and combine it into R. Most import functions have an option to do so. If you can, give preference to the <code>'UTF-8'</code> encoding in exporting and importing data, which is the most popular in text files.</p>
</div>
<div id="other-useful-functions-3" class="section level3" number="7.2.10">
<h3>
<span class="header-section-number">7.2.10</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-3"><i class="fas fa-link"></i></a>
</h3>
<p><strong>stringr::str_to_lower</strong>/<strong>base::tolower</strong> - Converts a string to small caps.</p>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="st">'ABC'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "abc"</code></pre>
<p><strong>stringr::str_to_upper</strong>/<strong>base::toupper</strong> - Converts a string to upper caps.</p>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper</a></span><span class="op">(</span><span class="st">'abc'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "ABC"</code></pre>
</div>
</div>
<div id="factor-objects" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> <code>Factor</code> Objects<a class="anchor" aria-label="anchor" href="#factor-objects"><i class="fas fa-link"></i></a>
</h2>
<p>Object class <code>factor</code> is used to represent groups (categories) in a database. Imagine a dataset containing the financial expenses of different people over a whole year. In this database, you find a column that defines the gender of the individual – male or female. This information can be imported in R as a <code>character</code> object; however, the best way to represent it is by mutating it to class <code>factor</code>.</p>
<p>The <code>factor</code> class integrates nicely with statistical procedures and packages, so the work of dealing with groups becomes easier. For example, if we wanted to create a chart for each group within our database, we could do it by simply telling the graph function that we have a grouping variable of type <code>factor</code>. If we wanted to check whether the medians of different groups are statistically different from each other, all we need to do is to pass the numerical values and the grouping factor to the function that performs the statistical test. When the categories of data are appropriately represented in R, working with them becomes easier and more efficient.</p>
<div id="creating-factors" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Creating <code>factors</code><a class="anchor" aria-label="anchor" href="#creating-factors"><i class="fas fa-link"></i></a>
</h3>
<p>The creation of factors is accomplished with function <code>factor</code>: </p>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'M'</span>, <span class="st">'F'</span>, <span class="st">'M'</span>,</span>
<span>                      <span class="st">'M'</span>, <span class="st">'F'</span>, <span class="st">'F'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] M F M M F F
R&gt; Levels: F M</code></pre>
<p>Notice that, in the previous example, the presentation of factors with function <code>print</code> shows its content and an extra item called <code>Levels</code>, which identifies the possible groups in the object, in this case, only <code>M</code> and <code>F</code>. If we had a larger number of groups, the item <code>Levels</code> increases. See next: </p>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create factor with 3 levels</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'M'</span>, <span class="st">'F'</span>, <span class="st">'M'</span>, </span>
<span>                      <span class="st">'M'</span>, <span class="st">'F'</span>, <span class="st">'F'</span>,</span>
<span>                      <span class="st">'ND'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print factor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] M  F  M  M  F  F  ND
R&gt; Levels: F M ND</code></pre>
<p>Here, we also have the <code>ND</code> (not defined) group.</p>
<p>An important point about creating factors is that the <code>Levels</code> are inferred from the data, and that may not correspond to reality. Consider the following example:</p>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set factors with 1 level</span></span>
<span><span class="va">my_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Single'</span>, <span class="st">'Single'</span>, <span class="st">'Single'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_status</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] Single Single Single
R&gt; Levels: Single</code></pre>
<p>Accidentally, the data in <code>my_status</code> only shows one category: <code>Single</code>. However, it is well-known that another category, <code>Married</code>, is expected. If we used <code>my_status</code> as it is, we might omit important information, and that may cause problems in future parts of the code. The correct procedure is to define the <code>Levels</code> mannualy, as follows:</p>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Single'</span>, <span class="st">'Single'</span>, <span class="st">'Single'</span><span class="op">)</span>,</span>
<span>                    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Single'</span>, <span class="st">'Married'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_status</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] Single Single Single
R&gt; Levels: Single Married</code></pre>
</div>
<div id="modifying-factors" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Modifying <code>factors</code><a class="anchor" aria-label="anchor" href="#modifying-factors"><i class="fas fa-link"></i></a>
</h3>
<p>An important point about the <code>factor</code> type of objects is their <code>Levels</code> are immutable and will not update with the input of new data. You cannot modify the <code>Levels</code> after the creation of a <code>factor</code>. All new groups not in the current <code>Levels</code> will be transformed into <code>NA</code> (<em>not available</em> ) and a <code>warning</code> message will appear on the screen. This behavior may seem strange, at first, but it avoids possible errors in the code. See the following example:</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change first element of a factor to 'c'</span></span>
<span><span class="va">my_factor</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'c'</span></span></code></pre></div>
<pre><code>R&gt; Warning in `[&lt;-.factor`(`*tmp*`, 1, value = "c"): invalid
R&gt; factor level, NA generated</code></pre>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] &lt;NA&gt; b    a    b   
R&gt; Levels: a b</code></pre>
<p>As we expected, the first element of <code>my_factor</code> becomes an <code>NA</code>. Here, the proper way to add a new factor is to first transform the <code>factor</code> object to a <code>character</code> object, change the content and, finally, change the class back from <code>character</code> to <code>factor</code>. </p>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'a'</span>, <span class="st">'b'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change factor to character</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change first element</span></span>
<span><span class="va">my_char</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'c'</span></span>
<span></span>
<span><span class="co"># mutate it back to class factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] c b a b
R&gt; Levels: a b c</code></pre>
<p>Using these steps, we have the desired result in vector <code>my_factor</code>, with three <code>Levels</code>: <code>a</code>, <code>b</code> and <code>c</code>.</p>
<p>The <code>tidyverse</code> universe also has its own package for handling factors: <code>forcats</code>. For the current factor modification problem, we can use <code><a href="https://forcats.tidyverse.org/reference/fct_recode.html">forcats::fct_recode</a></code> function. Here’s an example where we change the values of factors and levels: </p>
<div class="sourceCode" id="cb719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>, </span>
<span>                      <span class="st">'A'</span>, <span class="st">'C'</span>, <span class="st">'M'</span>, </span>
<span>                      <span class="st">'N'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># modify factors</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span><span class="op">(</span><span class="va">my_factor</span>,</span>
<span>                        <span class="st">'D'</span> <span class="op">=</span> <span class="st">'A'</span>,</span>
<span>                        <span class="st">'E'</span> <span class="op">=</span> <span class="st">'B'</span>,</span>
<span>                        <span class="st">'F'</span> <span class="op">=</span> <span class="st">'C'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] D E F D F M N
R&gt; Levels: D E F M N</code></pre>
<p>Using <code><a href="https://forcats.tidyverse.org/reference/fct_recode.html">forcats::fct_recode</a></code> is intuitive. All we need to do is to set the new names with the equality symbol.</p>
</div>
<div id="converting-factors-to-other-classes" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Converting <code>factors</code> to Other Classes<a class="anchor" aria-label="anchor" href="#converting-factors-to-other-classes"><i class="fas fa-link"></i></a>
</h3>
<p>Attention is required when converting a <code>factor</code> to another class. When converting a <code>factor</code> to the <code>character</code> class, the result is as expected:</p>
<div class="sourceCode" id="cb721"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create factor</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert and print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "a" "b" "c"</code></pre>
<p>However, when the same procedure is performed for conversion from <code>factor</code> to the <code>numeric</code> class, the result is far from expected: </p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set factor</span></span>
<span><span class="va">my_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to numeric (WRONG)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">my_values</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 3 4 5 6</code></pre>
<p>As you can see, all elements in <code>my_values</code> were converted to <code>c(1, 2, 3, 4, 5)</code>, which are obviously wrong. It happens that, internally, <code>factors</code> are stored as numerical counters, ranging from 1 to the total number of <code>Levels</code>. This simple transformation minimizes the use of computer memory. When we asked R to transform the <code>factor</code> object into numbers, it returned the values of the counters, not the actual numbers stored as <code>factors</code>. Solving this problem and getting the result we want is easy; just turn the <code>factor</code> object into a <code>character</code> and then to <code>numeric</code>, as shown next:</p>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># converting factors to character and then to numeric</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">my_values</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  5  6  7  8  9 10</code></pre>
<div class="rmdcaution">
<p>
<strong>Always be careful when transforming factors into
numbers</strong>. This bug is hard to catch and may go unnoticed until
it breaks your code or jeopardizes your analysis. Remember that,
internally, R converts a numerical factor to its index level number, and
not the actual number.
</p>
</div>
</div>
<div id="creating-contingency-tables" class="section level3" number="7.3.4">
<h3>
<span class="header-section-number">7.3.4</span> Creating Contingency Tables<a class="anchor" aria-label="anchor" href="#creating-contingency-tables"><i class="fas fa-link"></i></a>
</h3>
<p>After creating a factor, we can find the number of times that each group, or combination of groups, is found with function <code>table</code>. This is also called a contingency table. In a simple case, with only one factor, function <code>table</code> counts the number of occurrences of each category: </p>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create factor</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Pref'</span>, <span class="st">'Ord'</span><span class="op">)</span>,</span>
<span>                           size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                           replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print contingency table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; my_factor
R&gt;  Ord Pref 
R&gt;   10   10</code></pre>
<p>A more advanced usage of function <code>table</code> is to consider more than one <code>factor</code>:</p>
<div class="sourceCode" id="cb729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set factors</span></span>
<span><span class="va">my_factor_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Pref'</span>, <span class="st">'Ord'</span><span class="op">)</span>,</span>
<span>                             size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                             replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_factor_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Group'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                             size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                             replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print contingency table with two factors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">my_factor_1</span>, </span>
<span>            <span class="va">my_factor_2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;            my_factor_2
R&gt; my_factor_1 Group 1 Group 2 Group 3
R&gt;        Ord        4       2       8
R&gt;        Pref       1       1       4</code></pre>
<p>The table that we created previously demonstrates the number of occurrences for each combination of groups. Therefore, it is worth knowing you can also use it with more than two factors.</p>
</div>
<div id="other-useful-functions-4" class="section level3" number="7.3.5">
<h3>
<span class="header-section-number">7.3.5</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-4"><i class="fas fa-link"></i></a>
</h3>
<p><strong>levels</strong> - Returns the <code>Levels</code> an object of class <code>factor</code>. </p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'B'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "A" "B" "C"</code></pre>
<p><strong>as.factor</strong> - Transforms an object to the class <code>factor</code>. </p>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'c'</span>, <span class="st">'a'</span><span class="op">)</span></span>
<span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">my_y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] a b c c a
R&gt; Levels: a b c</code></pre>
<p><strong>split</strong> - Based on a grouping variable and another vector, creates a list with subsets of groups of the target object. This function is best used to separate different samples according to groups. </p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'B'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">my_factor</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_x</span>, f <span class="op">=</span> <span class="va">my_factor</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_l</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; $A
R&gt; [1] 1
R&gt; 
R&gt; $B
R&gt; [1] 2 6
R&gt; 
R&gt; $C
R&gt; [1] 3 4 5</code></pre>
</div>
</div>
<div id="logical-objects" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> <code>Logical</code> Objects<a class="anchor" aria-label="anchor" href="#logical-objects"><i class="fas fa-link"></i></a>
</h2>
<p>Logical tests are at the heart of R. In one line of code, and we can test a condition for a large vector of data. This procedure is commonly used to find outliers in a dataset or to split the sample according to some condition, such as a particular period.</p>
<div id="creating-logical-objects" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> Creating <code>logical</code> Objects<a class="anchor" aria-label="anchor" href="#creating-logical-objects"><i class="fas fa-link"></i></a>
</h3>
<p>Objects of class <code>logical</code> are created based on the use of condition tests on other objects. For example, in a sequence from 1 to 10, we can check what elements are higher than five with the following code:</p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set numerical</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span></span>
<span><span class="co"># print a logical test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
R&gt; [10]  TRUE</code></pre>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print position of elements from logical test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">my_x</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  6  7  8  9 10</code></pre>
<p>In the previous example, function <code>which</code> returned the index (position) where the condition is true (<code>TRUE</code>). </p>
<p>To perform equality tests, simply use the equality symbol twice (<strong><code>==</code></strong>): </p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create char</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'abc'</span>, <span class="st">'bcd'</span><span class="op">)</span>, </span>
<span>               times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print its contents</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc" "bcd" "abc"
R&gt; [10] "bcd"</code></pre>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print logical test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span> <span class="op">==</span> <span class="st">'abc'</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE
R&gt; [10] FALSE</code></pre>
<p>For an inequality test, use symbol <strong><code>!=</code></strong>, as shown in the next code: </p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print inequality test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span> <span class="op">!=</span> <span class="st">'abc'</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
R&gt; [10]  TRUE</code></pre>
<p>It is also possible to test multiple logical conditions. For simultaneous occurrences of events, use operator <code>&amp;</code>. For example, if we wanted to check the values from a sequence between 1 and 10 that are larger than 4 <strong>and</strong> smaller than 7, we write: </p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span></span>
<span><span class="co"># print logical for values higher than 4 and lower than 7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">(</span><span class="va">my_x</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span><span class="op">&amp;</span><span class="op">(</span><span class="va">my_x</span> <span class="op">&lt;</span> <span class="fl">7</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
R&gt; [10] FALSE</code></pre>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print the actual values</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span> <span class="op">(</span><span class="va">my_x</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span><span class="op">&amp;</span><span class="op">(</span><span class="va">my_x</span> <span class="op">&lt;</span> <span class="fl">7</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 5 6</code></pre>
<p>For non-simultaneous conditions, i.e., the occurrence of one event or other, use the operator <code>|</code>. For instance, considering the previous sequence, we can find the values greater than 7 <strong>or</strong> lower than four by writing: </p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># location of elements higher than 7 or lower than 4</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span> <span class="op">(</span><span class="va">my_x</span> <span class="op">&gt;</span> <span class="fl">7</span><span class="op">)</span><span class="op">|</span><span class="op">(</span><span class="va">my_x</span> <span class="op">&lt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># print elements from previous condition</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  1  2  3  8  9 10</code></pre>
<p>Be aware that we used parentheses to encapsulate the logical conditions for both cases. Although it is not strictly necessary, it is a good coding practice. We could have used <code>idx &lt;- which(my_x &gt; 7 | my_x &lt; 4)</code> for the same result but, using parentheses makes the code cleaner by isolating the logical tests.</p>
<p>Another interesting use of logical objects is to test whether an item or more is found or not in another vector. For this, we use the operator <code>%in%</code>. For example, suppose you have the names of two countries, <code>c('Country 1', 'Country 2')</code>, and you want to know if you can find the same countries in another vector. This is an operation similar to using the equality test but in vector notation. Here’s an example:</p>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># location of elements higher than 7 or lower than 4</span></span>
<span><span class="va">my_contries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Country 1'</span>, <span class="st">'Country 2'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set df</span></span>
<span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">'Country '</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, </span>
<span>                                         size <span class="op">=</span> <span class="va">n_obs</span>,</span>
<span>                                         replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  inflation.rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 100
R&gt; Columns: 2
R&gt; $ country        &lt;chr&gt; "Country 3", "Country 1", "Country …
R&gt; $ inflation.rate &lt;dbl&gt; -0.037301808, -0.060783522, -0.0062…</code></pre>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter rows of df with selected tickers</span></span>
<span><span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="va">df_temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">my_contries</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 18
R&gt; Columns: 2
R&gt; $ country        &lt;chr&gt; "Country 1", "Country 2", "Country …
R&gt; $ inflation.rate &lt;dbl&gt; -0.060783522, -0.002706447, -0.0193…</code></pre>
<p>The resulting dataframe only has rows for <code>'Country 1'</code> and <code>'Country 2'</code>. With operator <code>%in%</code>, we filtered our table so it only keeps the desired rows.</p>
</div>
</div>
<div id="date-and-time" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Date and Time<a class="anchor" aria-label="anchor" href="#date-and-time"><i class="fas fa-link"></i></a>
</h2>
<p>The representation and manipulation of dates is an important aspect of research. When you have dates in your dataset, you must be certain they are correctly represented in R with the correct timezone. In this section, we will give priority to package <code>lubridate</code> <span class="citation">(<a href="references.html#ref-R-lubridate" role="doc-biblioref">Spinu, Grolemund, and Wickham 2022</a>)</span>, which offers efficient and diverse functions for time manipulation. There are, however, many packages that can also help the user. If the reader must perform a date operation not covered here, I suggest looking into packages <code>chron</code> <span class="citation">(<a href="references.html#ref-R-chron" role="doc-biblioref">James and Hornik 2022</a>)</span>, <code>timeDate</code> <span class="citation">(<a href="references.html#ref-R-timeDate" role="doc-biblioref">Wuertz, Setz, and Chalabi 2022</a>)</span>, and <code>bizdays</code> <span class="citation">(<a href="references.html#ref-R-bizdays" role="doc-biblioref">Freitas 2022</a>)</span>. </p>
<div id="creating-simple-dates" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Creating Simple Dates<a class="anchor" aria-label="anchor" href="#creating-simple-dates"><i class="fas fa-link"></i></a>
</h3>
<p>In R, several classes can represent dates. The choice between one to another depends on the required precision of time representation. Some situations only require the knowledge of the day (and not time), while in others, the clock time can be very important as the data is collected over a day and knowing the time of day of each data point can affect the research.</p>
<p>The most basic class, indicating the day, month, and year, is <code>Date</code>. Using package <code>lubridate</code>, we create a date class object with functions <code>ymd</code> (year-month-date), <code>dmy</code> (day-month-year) e <code>mdy</code> (month-day-year). The order of components, and choice of function, is set according to the input character. Have a look: </p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set Date object (YMD)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-06-24'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object (DMY)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">'24-06-2020'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object (MDY)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">'06-24-2020'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<p>Note that the functions return the exact same object. The difference in usage is only by the way the input string is structured with the position of the day, month, and year.</p>
<p>One benefit of using the <code>lubridate</code> package is that its functions are smart when dealing with different formats. You should note that we defined the data elements using the dash (<code>-</code>) separator and numeric values, as in <code>'2020-06-24'</code> in the previous case. Other formats are also automatically recognized:</p>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020/06/24'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020&amp;06&amp;24'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020 june 24'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">'24 of june 2020'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-06-24"</code></pre>
<p>This is a very useful property of <code>lubridate</code>, making it easy to import date information in different formats.</p>
<p>Now, using the <code>base</code> package, we can create a date with function <code>as.Date</code>: </p>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set Date from dd/mm/yyyy with the definition of format</span></span>
<span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'24/06/2021'</span>, format <span class="op">=</span> <span class="st">'%d/%m/%Y'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_date</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2021-06-24"</code></pre>
<p>The symbols used in <em>input</em> <code>format</code>, such as <code>%d</code>, <code>%m</code>, and <code>%Y</code>, indicate how the character object should be converted and where the day, month and year are in the text. Likewise, many other symbols may be used for processing dates in specific formats. An overview of the main symbols is given next.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Symbol</th>
<th align="center">Description</th>
<th align="center">Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">%d</td>
<td align="center">day of month (decimal)</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">%m</td>
<td align="center">month (decimal)</td>
<td align="center">12</td>
</tr>
<tr class="odd">
<td align="center">%b</td>
<td align="center">month (abbreviation)</td>
<td align="center">Apr</td>
</tr>
<tr class="even">
<td align="center">%B</td>
<td align="center">month (complete name)</td>
<td align="center">April</td>
</tr>
<tr class="odd">
<td align="center">%y</td>
<td align="center">year (2 digits)</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">%Y</td>
<td align="center">month (4 digits)</td>
<td align="center">2020</td>
</tr>
</tbody>
</table></div>
<p>By using the previous table, you’ll be able to create and represent dates in a vast number of ways. Notice how the <code>lubridate</code> functions, regarding <code>base</code>, are simpler and easier to use.</p>
</div>
<div id="creating-a-sequence-of-dates" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> Creating a Sequence of <code>Dates</code><a class="anchor" aria-label="anchor" href="#creating-a-sequence-of-dates"><i class="fas fa-link"></i></a>
</h3>
<p>An interesting aspect of objects <code>Date</code> is they interact with <code>numeric</code> objects and can be used for logical tests. If we wanted to add a day after a particular date, all we need to do is to add value 1 to the object, as shown next:</p>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create date</span></span>
<span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-06-01'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find next day</span></span>
<span><span class="va">my_date_2</span> <span class="op">&lt;-</span> <span class="va">my_date</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_date_2</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2021-06-02"</code></pre>
<p>This property also works with vectors, facilitating the creation of <code>Date</code> sequences. See an example next.</p>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a sequence of Dates</span></span>
<span><span class="va">my_date_vec</span> <span class="op">&lt;-</span> <span class="va">my_date</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_date_vec</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "2021-06-01" "2021-06-02" "2021-06-03" "2021-06-04"
R&gt;  [5] "2021-06-05" "2021-06-06" "2021-06-07" "2021-06-08"
R&gt;  [9] "2021-06-09" "2021-06-10" "2021-06-11" "2021-06-12"
R&gt; [13] "2021-06-13" "2021-06-14" "2021-06-15" "2021-06-16"</code></pre>
<p>A more customizable way for creating <code>Date</code> sequences is using function <code>seq</code>. It allows the creation of date sequences with custom time intervals or with a fixed vector size. For example, if we wanted a <code>Date</code> sequence every two days, we could use the following code: </p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set first and last Date</span></span>
<span><span class="va">my_date_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-03-07'</span><span class="op">)</span></span>
<span><span class="va">my_date_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-03-20'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set sequence</span></span>
<span><span class="va">my_vec_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">my_date_1</span>,</span>
<span>                   to <span class="op">=</span> <span class="va">my_date_2</span>,</span>
<span>                   by <span class="op">=</span> <span class="st">'2 days'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_vec_date</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2021-03-07" "2021-03-09" "2021-03-11" "2021-03-13"
R&gt; [5] "2021-03-15" "2021-03-17" "2021-03-19"</code></pre>
<p>Likewise, if we wanted a sequence of dates for every two weeks, we can simply change input <code>by</code> to <code>'2 weeks'</code>:</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set first and last Date</span></span>
<span><span class="va">my_date_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-03-07'</span><span class="op">)</span></span>
<span><span class="va">my_date_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-04-20'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set sequence</span></span>
<span><span class="va">my_vec_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">my_date_1</span>,</span>
<span>                   to <span class="op">=</span> <span class="va">my_date_2</span>,</span>
<span>                   by <span class="op">=</span> <span class="st">'2 weeks'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_vec_date</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2021-03-07" "2021-03-21" "2021-04-04" "2021-04-18"</code></pre>
<p>Another way to use function <code>seq</code> is by setting the desired length of the sequence of dates. For example, if we wanted an array of dates with 10 elements, we would write:</p>
<div class="sourceCode" id="cb781"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set dates</span></span>
<span><span class="va">my_date_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2021-06-27'</span><span class="op">)</span></span>
<span><span class="va">my_date_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2021-07-27'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set sequence with 10 elements</span></span>
<span><span class="va">my_vec_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">my_date_1</span>,</span>
<span>                   to <span class="op">=</span> <span class="va">my_date_2</span>,</span>
<span>                   length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_vec_date</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "2021-06-27" "2021-06-30" "2021-07-03" "2021-07-07"
R&gt;  [5] "2021-07-10" "2021-07-13" "2021-07-17" "2021-07-20"
R&gt;  [9] "2021-07-23" "2021-07-27"</code></pre>
<p>Once again, the interval between the dates is automatically defined by the function.</p>
</div>
<div id="operations-with-dates" class="section level3" number="7.5.3">
<h3>
<span class="header-section-number">7.5.3</span> Operations with <code>Dates</code><a class="anchor" aria-label="anchor" href="#operations-with-dates"><i class="fas fa-link"></i></a>
</h3>
<p>We can calculate difference of days between two dates by simply subtracting one from the other. Have a look:</p>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set dates</span></span>
<span><span class="va">my_date_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2015-06-24'</span><span class="op">)</span></span>
<span><span class="va">my_date_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-06-24'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate difference</span></span>
<span><span class="va">diff_date</span> <span class="op">&lt;-</span> <span class="va">my_date_2</span> <span class="op">-</span> <span class="va">my_date_1</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">diff_date</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Time difference of 1827 days</code></pre>
<p>The output of the subtraction operation is an object of class <code>diffdate</code>. Just like in a <code>list</code>, we can access its elements using double brackets. The numerical value of the difference of days is contained in the first element of <code>diff_date</code>: </p>
<div class="sourceCode" id="cb785"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print difference of days as numerical value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">diff_date</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1827</code></pre>
<p>Going further, we can also use mathematical operators to test whether a date is more recent or not than another:</p>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set date and vector</span></span>
<span><span class="va">my_date_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-06-20'</span><span class="op">)</span></span>
<span><span class="va">my_date_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-06-20'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test which elements of my_date_vec are older than my_date_1</span></span>
<span><span class="va">my.test</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">my_date_vec</span> <span class="op">&gt;</span> <span class="va">my_date_1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my.test</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
R&gt; [10]  TRUE  TRUE</code></pre>
<p>The previous operation is useful when selecting a certain period of time in your dataset. This is a common practice in research. We set the first and last dates of the period we are interested in and use a logical test to find all dates in between:</p>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set first and last dates</span></span>
<span><span class="va">first_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-06-01'</span><span class="op">)</span></span>
<span><span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2021-06-15'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe and glimpse it</span></span>
<span><span class="va">my_temp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>date.vec <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-05-25'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span>,</span>
<span>                     prices<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,</span>
<span>                                length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">date.vec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find dates that are between the first and last date</span></span>
<span><span class="va">my_idx</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">my_temp_df</span><span class="op">$</span><span class="va">date.vec</span> <span class="op">&gt;=</span> <span class="va">first_date</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="op">(</span><span class="va">my_temp_df</span><span class="op">$</span><span class="va">date.vec</span> <span class="op">&lt;=</span> <span class="va">last_date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use index to filter dataframe</span></span>
<span><span class="va">my_temp_df_filtered</span> <span class="op">&lt;-</span> <span class="va">my_temp_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">my_idx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 0
R&gt; Columns: 2
R&gt; $ date.vec &lt;date&gt; 
R&gt; $ prices   &lt;dbl&gt;</code></pre>
<p>In the previous code, the object <code>my_temp_df_filtered</code> will only contain rows for the time period between 2021-06-01 and 2021-06-15.</p>
</div>
<div id="dealing-with-time" class="section level3" number="7.5.4">
<h3>
<span class="header-section-number">7.5.4</span> Dealing with Time<a class="anchor" aria-label="anchor" href="#dealing-with-time"><i class="fas fa-link"></i></a>
</h3>
<p>Using the <code>Date</code> class is sufficient when dealing only with days, and the hours are irrelevant. When it is necessary to consider time, we have to use an object of type <code>datetime</code>. </p>
<p>In the <code>base</code> package, one class used for this purpose is <code>POSIXlt</code>, which stores the contents of a date as a list. Another class is <code>POSIXct</code>, which stores dates as seconds counted from <code>1970-01-01</code>. Due to its storage format, the <code>POSIXct</code> class takes up less computer memory and is the one used in package <code>lubridate</code>. Given that, we will prioritize it in these sections. Worth knowing that all examples presented here can also be replicated with the <code>POSIXlt</code> class.</p>
<p>In R, the time/date format also follows the <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601 standard</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.iso.org/iso-8601-date-and-time-format.html" class="uri"&gt;https://www.iso.org/iso-8601-date-and-time-format.html&lt;/a&gt;&lt;/p&gt;'><sup>58</sup></a> and is represented as “year-month-day hours:minutes:seconds timezone” (YYYY-MM-DD HH:mm:SS TMZ). See the following example:</p>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating a POSIXct object</span></span>
<span><span class="va">my_timedate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">'2021-01-01 16:00:00'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_timedate</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2021-01-01 16:00:00 -03"</code></pre>
<p>The <code>lubridate</code> package also offers intelligent functions for creating date-time objects. These follow the same structural intuition as the date creation functions.</p>
<div class="sourceCode" id="cb793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating a POSIXlt object</span></span>
<span><span class="va">my_timedate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 16:00:00'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_timedate</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-01-01 16:00:00 UTC"</code></pre>
<p>You should note that this class automatically adds the time zone from the operating system. If you need to represent a different time zone, you can do so with the <code>tz</code> argument:</p>
<div class="sourceCode" id="cb795"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating a POSIXlt object with custom timezone</span></span>
<span><span class="va">my_timedate_tz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 16:00:00'</span>,</span>
<span>                          tz <span class="op">=</span> <span class="st">'GMT'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_timedate_tz</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-01-01 16:00:00 GMT"</code></pre>
<p>An important note in the case of <code>POSIXlt</code> and <code>POSIXct</code> objects, <strong>the operations of sum and subtraction refer to seconds</strong>, not days, as with objects from the <code>Date</code> class:</p>
<div class="sourceCode" id="cb797"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Adding values (seconds) to a POSIXlt object and printing it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_timedate_tz</span> <span class="op">+</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2020-01-01 16:00:30 GMT"</code></pre>
</div>
<div id="customizing-the-format-of-dates-and-times" class="section level3" number="7.5.5">
<h3>
<span class="header-section-number">7.5.5</span> Customizing the Format of Dates and Times<a class="anchor" aria-label="anchor" href="#customizing-the-format-of-dates-and-times"><i class="fas fa-link"></i></a>
</h3>
<p>The ISO format for representing dates and <code>datetime</code> object in R may not be what we need. When writing reports, using a date-time format different than the local one can unnecessarily generate confusion in your audience.</p>
<p>In the same way as objects of class <code>Date</code>, there are specific symbols for dealing with components of a <code>POSIXlt</code> object. Next, we have a table with the main symbols and their meanings.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Symbol</th>
<th align="center">Description</th>
<th align="center">Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">%H</td>
<td align="center">Hour (decimal, 24 hours)</td>
<td align="center">23</td>
</tr>
<tr class="even">
<td align="center">%I</td>
<td align="center">Hour (decimal, 12 hours)</td>
<td align="center">11</td>
</tr>
<tr class="odd">
<td align="center">%M</td>
<td align="center">Minutes (decimal, 0-59)</td>
<td align="center">12</td>
</tr>
<tr class="even">
<td align="center">%p</td>
<td align="center">AM/PM indicator</td>
<td align="center">AM</td>
</tr>
<tr class="odd">
<td align="center">%S</td>
<td align="center">Seconds (decimal, 0-59)</td>
<td align="center">50</td>
</tr>
</tbody>
</table></div>
<p>To format a date, use the <code>format</code> function. Using the symbols presented in the previous table, the user can create any desired customization. See the following example, where we change a date vector to the American format (MM/DD/YYYY): </p>
<div class="sourceCode" id="cb799"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector of dates</span></span>
<span><span class="va">my_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>,</span>
<span>                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-15'</span><span class="op">)</span>,</span>
<span>                by <span class="op">=</span> <span class="st">'1 day'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change format</span></span>
<span><span class="va">my_dates_US_format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">my_dates</span>, <span class="st">'%m/%d/%Y'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_dates_US_format</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "01/01/2020" "01/02/2020" "01/03/2020" "01/04/2020"
R&gt;  [5] "01/05/2020" "01/06/2020" "01/07/2020" "01/08/2020"
R&gt;  [9] "01/09/2020" "01/10/2020" "01/11/2020" "01/12/2020"
R&gt; [13] "01/13/2020" "01/14/2020" "01/15/2020"</code></pre>
<p>The same procedure can be used for <code>POSIXlt</code> objects:</p>
<div class="sourceCode" id="cb801"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector of date-time</span></span>
<span><span class="va">my_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="st">'2020-02-01 12:00:00'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">560</span>,<span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change to US format</span></span>
<span><span class="va">my_dates_US_format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">my_datetime</span>, <span class="st">'%m/%d/%Y %H:%M:%S'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_dates_US_format</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "02/01/2020 12:00:00" "02/01/2020 12:01:00"
R&gt;  [3] "02/01/2020 12:02:00" "02/01/2020 12:03:00"
R&gt;  [5] "02/01/2020 12:04:00" "02/01/2020 12:05:00"
R&gt;  [7] "02/01/2020 12:06:00" "02/01/2020 12:07:00"
R&gt;  [9] "02/01/2020 12:08:00" "02/01/2020 12:09:00"</code></pre>
<p>Likewise, we can customize our dates for very specific formats:</p>
<div class="sourceCode" id="cb803"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set custom format</span></span>
<span><span class="va">my_dates_my_format</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">my_dates</span>,</span>
<span>                             <span class="st">'Year=%Y | Month=%m | Day=%d'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_dates_my_format</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "Year=2020 | Month=01 | Day=01"
R&gt;  [2] "Year=2020 | Month=01 | Day=02"
R&gt;  [3] "Year=2020 | Month=01 | Day=03"
R&gt;  [4] "Year=2020 | Month=01 | Day=04"
R&gt;  [5] "Year=2020 | Month=01 | Day=05"
R&gt;  [6] "Year=2020 | Month=01 | Day=06"
R&gt;  [7] "Year=2020 | Month=01 | Day=07"
R&gt;  [8] "Year=2020 | Month=01 | Day=08"
R&gt;  [9] "Year=2020 | Month=01 | Day=09"
R&gt; [10] "Year=2020 | Month=01 | Day=10"
R&gt; [11] "Year=2020 | Month=01 | Day=11"
R&gt; [12] "Year=2020 | Month=01 | Day=12"
R&gt; [13] "Year=2020 | Month=01 | Day=13"
R&gt; [14] "Year=2020 | Month=01 | Day=14"
R&gt; [15] "Year=2020 | Month=01 | Day=15"</code></pre>
</div>
<div id="extracting-elements-of-a-date" class="section level3" number="7.5.6">
<h3>
<span class="header-section-number">7.5.6</span> Extracting Elements of a Date<a class="anchor" aria-label="anchor" href="#extracting-elements-of-a-date"><i class="fas fa-link"></i></a>
</h3>
<p>We can use function <code>format</code> to extract data elements such as the year, month, day, hour, minute and second. Look at the next example, where we retrieve only the hours of a <code>POSIXct</code> object: </p>
<div class="sourceCode" id="cb805"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create vector of date-time</span></span>
<span><span class="va">my_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 12:00:00'</span><span class="op">)</span>,</span>
<span>                   to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 18:00:00'</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="st">'1 hour'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get hours from POSIXlt</span></span>
<span><span class="va">my_hours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">my_datetime</span>, <span class="st">'%H'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_hours</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "12" "13" "14" "15" "16" "17" "18"</code></pre>
<p>Likewise, we can use symbols <code>%M</code> and <code>%S</code> to extract the hours, minutes and seconds of a <code>POSIXct</code> object:</p>
<div class="sourceCode" id="cb807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create vector of date-time</span></span>
<span><span class="va">n_dates</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">my_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 12:00:00'</span><span class="op">)</span>,</span>
<span>                   to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">'2020-01-01 18:00:00'</span><span class="op">)</span>,</span>
<span>                   length.out <span class="op">=</span> <span class="va">n_dates</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">59</span>, </span>
<span>                                                  size <span class="op">=</span> <span class="va">n_dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get minutes from POSIXlt</span></span>
<span><span class="va">my_minutes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">my_datetime</span>, <span class="st">'%M'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_minutes</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "00" "40" "20" "00" "40" "20" "00" "40" "20" "00"</code></pre>
<p>Alternatively, we can use <code>lubridate</code> functions such as <code>hour</code> and <code>minute</code>: </p>
<div class="sourceCode" id="cb809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get hours with lubridate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">my_datetime</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 12 12 13 14 14 15 16 16 17 18</code></pre>
<div class="sourceCode" id="cb811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get minutes with lubridate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html">minute</a></span><span class="op">(</span><span class="va">my_datetime</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]  0 40 20  0 40 20  0 40 20  0</code></pre>
<p>Functions for extracting other components of a date, such as <code><a href="https://lubridate.tidyverse.org/reference/year.html">lubridate::year</a></code> and <code><a href="https://lubridate.tidyverse.org/reference/second.html">lubridate::second</a></code>, are also available.</p>
</div>
<div id="find-the-current-date-and-time" class="section level3" number="7.5.7">
<h3>
<span class="header-section-number">7.5.7</span> Find the Current Date and Time<a class="anchor" aria-label="anchor" href="#find-the-current-date-and-time"><i class="fas fa-link"></i></a>
</h3>
<p>R also allows the user to find the current date and time from the operating system. This is particularly useful when it is important for the user to know the date and time when the code was executed.</p>
<p>If you want to find the present day, use function <code><a href="https://rdrr.io/r/base/Sys.time.html">base::Sys.Date</a></code> or <code><a href="https://lubridate.tidyverse.org/reference/now.html">lubridate::today</a></code> </p>
<div class="sourceCode" id="cb813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get today from base</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2022-11-23"</code></pre>
<div class="sourceCode" id="cb815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get today from lubridate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2022-11-23"</code></pre>
<p>If you want to find the current date and time, we use function <code><a href="https://rdrr.io/r/base/Sys.time.html">base::Sys.time</a></code> or <code><a href="https://lubridate.tidyverse.org/reference/now.html">lubridate::now</a></code>: </p>
<div class="sourceCode" id="cb817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get time from base</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2022-11-23 16:13:59 -03"</code></pre>
<div class="sourceCode" id="cb819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get time from lubridate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "2022-11-23 16:13:59 -03"</code></pre>
<p>Going further, based on these functions, we can write:</p>
<div class="sourceCode" id="cb821"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example of log message</span></span>
<span><span class="va">my_sys_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">my_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">'Log of execution\n'</span>,</span>
<span>                <span class="st">'Time of execution: '</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'\n'</span>,</span>
<span>                <span class="st">'User: '</span>, <span class="va">my_sys_info</span><span class="op">[</span><span class="st">'user'</span><span class="op">]</span>, <span class="st">'\n'</span>,</span>
<span>                <span class="st">'Computer: '</span>, <span class="va">my_sys_info</span><span class="op">[</span><span class="st">'nodename'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">my_str</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Log of execution
R&gt; Time of execution: 2022-11-23 16:13:59
R&gt; User: msperlin
R&gt; Computer: msperlin-Inspiron-5675</code></pre>
<p>This is the exact time when this book was compiled in its final version. Notice we also got some details regarding username and computer with function <code>Sys.info</code>.</p>
</div>
<div id="other-useful-functions-5" class="section level3" number="7.5.8">
<h3>
<span class="header-section-number">7.5.8</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-5"><i class="fas fa-link"></i></a>
</h3>
<p><strong>weekdays</strong> - Returns the day of the week from one or more dates. </p>
<div class="sourceCode" id="cb823"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set date vector</span></span>
<span><span class="va">my_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>,</span>
<span>                to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-01-5'</span><span class="op">)</span>,</span>
<span>                by <span class="op">=</span> <span class="st">'1 day'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find corresponding weekdays</span></span>
<span><span class="va">my_weekdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">weekdays</a></span><span class="op">(</span><span class="va">my_dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_weekdays</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Wednesday" "Thursday"  "Friday"    "Saturday" 
R&gt; [5] "Sunday"</code></pre>
<p><strong>months</strong> - Returns the month of one or more dates. </p>
<div class="sourceCode" id="cb825"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create date vector</span></span>
<span><span class="va">my_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>,</span>
<span>                to <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-12-31'</span><span class="op">)</span>,</span>
<span>                by <span class="op">=</span> <span class="st">'1 month'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find months</span></span>
<span><span class="va">my_months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="va">my_dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_months</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "January"   "February"  "March"     "April"    
R&gt;  [5] "May"       "June"      "July"      "August"   
R&gt;  [9] "September" "October"   "November"  "December"</code></pre>
<p><strong>quarters</strong> - Returns the location of one or more dates within the year quartiles. </p>
<div class="sourceCode" id="cb827"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get quartiles of the year</span></span>
<span><span class="va">my_quarters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">quarters</a></span><span class="op">(</span><span class="va">my_dates</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_quarters</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "Q1" "Q1" "Q1" "Q2" "Q2" "Q2" "Q3" "Q3" "Q3" "Q4" "Q4"
R&gt; [12] "Q4"</code></pre>
<p><strong>OlsonNames</strong> - Returns an array with the time zones available in R. In total, there are over 500 items. Here, we present only the first five elements. </p>
<div class="sourceCode" id="cb829"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get possible timezones</span></span>
<span><span class="va">possible_tz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/timezones.html">OlsonNames</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">possible_tz</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Africa/Abidjan"     "Africa/Accra"      
R&gt; [3] "Africa/Addis_Ababa" "Africa/Algiers"    
R&gt; [5] "Africa/Asmara"</code></pre>
<p><strong>Sys.timezone</strong> - Returns the current timezone of the operating system. </p>
<div class="sourceCode" id="cb831"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "America/Sao_Paulo"</code></pre>
<p><strong>cut</strong> - Returns a factor by grouping dates and time. </p>
<div class="sourceCode" id="cb833"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set example date vector</span></span>
<span><span class="va">my_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>,</span>
<span>                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">'2020-03-01'</span><span class="op">)</span>,</span>
<span>                by <span class="op">=</span> <span class="st">'5 days'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># group vector based on monthly breaks</span></span>
<span><span class="va">my_month_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_dates</span>,</span>
<span>                    breaks <span class="op">=</span> <span class="st">'month'</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Jan'</span>, <span class="st">'Fev'</span>, <span class="st">'Mar'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_month_cut</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] Jan Jan Jan Jan Jan Jan Jan Fev Fev Fev Fev Fev Mar
R&gt; Levels: Jan Fev Mar</code></pre>
<div class="sourceCode" id="cb835"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set example datetime vector</span></span>
<span><span class="va">my_datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="st">'2020-01-01 12:00:00'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span>,<span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set groups for each 30 seconds</span></span>
<span><span class="va">my_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_datetime</span>, breaks <span class="op">=</span> <span class="st">'30 secs'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_cut</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] 2020-01-01 12:00:00 2020-01-01 12:00:00
R&gt;  [3] 2020-01-01 12:00:30 2020-01-01 12:00:30
R&gt;  [5] 2020-01-01 12:01:00 2020-01-01 12:01:00
R&gt;  [7] 2020-01-01 12:01:30 2020-01-01 12:01:30
R&gt;  [9] 2020-01-01 12:02:00 2020-01-01 12:02:00
R&gt; [11] 2020-01-01 12:02:30 2020-01-01 12:02:30
R&gt; [13] 2020-01-01 12:03:00 2020-01-01 12:03:00
R&gt; [15] 2020-01-01 12:03:30 2020-01-01 12:03:30
R&gt; [17] 2020-01-01 12:04:00
R&gt; 9 Levels: 2020-01-01 12:00:00 ... 2020-01-01 12:04:00</code></pre>
</div>
</div>
<div id="missing-data---na-not-available" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Missing Data - <code>NA</code> (<em>Not available</em>)<a class="anchor" aria-label="anchor" href="#missing-data---na-not-available"><i class="fas fa-link"></i></a>
</h2>
<p>One of the main innovations of R is the representation of missing data with objects of class <code>NA</code> (<em>Not Available</em>). The lack of data can have many reasons, such as failure to collect information or simply the absence of it. These cases are generally treated by removing or replacing the missing information before analyzing the data. The identification of these cases, therefore, is imperative. </p>
<div id="defining-na-values" class="section level3" number="7.6.1">
<h3>
<span class="header-section-number">7.6.1</span> Defining <code>NA</code> Values<a class="anchor" aria-label="anchor" href="#defining-na-values"><i class="fas fa-link"></i></a>
</h3>
<p>To define omissions in the dataset, use symbol <code>NA</code> without quotes:</p>
<div class="sourceCode" id="cb837"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a vector with NA</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  1  2 NA  4  5</code></pre>
<p>An important information that you must remember from previous chapters is that an <code>NA</code> object is contagious. Any object that interacts with an <code>NA</code> will turn into the same class of missing data:</p>
<div class="sourceCode" id="cb839"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a vector </span></span>
<span><span class="va">my_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># example of NA interacting with other objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span> <span class="op">+</span> <span class="va">my_y</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  3  5 NA  8  6</code></pre>
<p>This property demands special attention if you are calculating a value recursively, such as when using functions <code>cumsum</code> and <code>cumprod</code>. In these cases, any value after <code>NA</code> will turn into <code>NA</code>:</p>
<div class="sourceCode" id="cb841"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector with NA</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="cn">NA</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print cumsum (NA after sixth element)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]  1  3  6 10 15 NA NA NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb843"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print cumprod (NA after sixth element)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1]   1   2   6  24 120  NA  NA  NA  NA  NA  NA  NA</code></pre>
<p>Therefore, when using functions <code>cumsum</code> and <code>cumprod</code>, make sure no <code>NA</code> value is found in the input vector.</p>
<div class="rmdcaution">
<p>
Every time you use the <code>cumsum</code> and<code>cumprod</code>
functions, make sure that there is no <code>NA</code> value in the input
vector. Remember that every <code>NA</code> is contagious and recursive
calculations will result in a vector full of missing data.
</p>
</div>
</div>
<div id="finding-and-replacing-na" class="section level3" number="7.6.2">
<h3>
<span class="header-section-number">7.6.2</span> Finding and Replacing <code>NA</code><a class="anchor" aria-label="anchor" href="#finding-and-replacing-na"><i class="fas fa-link"></i></a>
</h3>
<p>To find <code>NA</code> values, use function <code>is.na</code>: </p>
<div class="sourceCode" id="cb845"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector with NA</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test and find location of NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
R&gt; [10] FALSE</code></pre>
<div class="sourceCode" id="cb847"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 3</code></pre>
<p>To replace it, use indexing with the output of <code>is.na</code>:</p>
<div class="sourceCode" id="cb849"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replace NA for 2</span></span>
<span><span class="va">my_x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_x</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 2 3 4 2</code></pre>
<p>Another way to remove <code>NA</code> values is to use the function <code>na.omit</code>. which returns the same object, but without the <code>NA</code> values. Note, however, that the vector size will change and the output will be an object of class <code>omit</code>. Have a look: </p>
<div class="sourceCode" id="cb851"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vector</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="cn">NA</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "a" "b" "c" NA  "e" "f" "g" "h"</code></pre>
<div class="sourceCode" id="cb853"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use na.omit to remove NA</span></span>
<span><span class="va">my_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "a" "b" "c" "e" "f" "g" "h"
R&gt; attr(,"na.action")
R&gt; [1] 4
R&gt; attr(,"class")
R&gt; [1] "omit"</code></pre>
<p>Although the class of the object has changed due to the use of <code>na.omit</code>, the basic properties of the initial vector remains. For example, using the function <code>nchar</code> in the resulting object is still possible.</p>
<div class="sourceCode" id="cb855"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trying nchar on a na.omit object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">my_char</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] 1 1 1 1 1 1 1</code></pre>
<p>For other objects, however, this property may not hold. Some caution is advised when using <code>na.omit</code>. If needed, you can return to the basic class with the <code>as.*</code> functions, such as in <code>as.numeric</code> or <code>as.tibble</code>.</p>
</div>
<div id="other-useful-functions-6" class="section level3" number="7.6.3">
<h3>
<span class="header-section-number">7.6.3</span> Other Useful Functions<a class="anchor" aria-label="anchor" href="#other-useful-functions-6"><i class="fas fa-link"></i></a>
</h3>
<p><strong>complete.cases</strong> - Returns a logical vector indicating whether the lines of a bi-dimensional object are complete (without <code>NA</code>). This function is used exclusively for <code>dataframes</code> and matrices. </p>
<div class="sourceCode" id="cb857"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create matrix</span></span>
<span><span class="va">my_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set an NA value</span></span>
<span><span class="va">my_mat</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># print index with rows without NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">my_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1]  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
</div>
</div>
<div id="exercises-4" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-4"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-6" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-6"><i class="fas fa-link"></i></a>
</h3>
<p>Consider the following vectors x and y:</p>
<pre><code>set.seed(7)
x &lt;- sample (1:3, size = 5, replace = T)
y &lt;- sample (1:3, size = 5, replace = T)</code></pre>
<p>What is the sum of the elements of a new vector resulting from the multiplication between the elements of <code>x</code> and<code>y</code>?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["31"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e065ed29d9d" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e065ed29d9d" class="collapse">
The solution is 31. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>set.seed(7)

x &lt;- sample (1:3, size = 5, replace = T)
y &lt;- sample (1:3, size = 5, replace = T)

# solution
my_sol &lt;- sum(x*y)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-6" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-6"><i class="fas fa-link"></i></a>
</h3>
<p>If we performed a cumulative sum of a sequence between 1 and 100, in what element would this sum go beyond the value of 50?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["10"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0617e37100" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0617e37100" class="collapse">
The solution is 10. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_sum &lt;- cumsum(1:100)

# solution
my_sol &lt;- (which(my_sum &gt; 50)[1])</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-5" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-5"><i class="fas fa-link"></i></a>
</h3>
<p>Using R, create an sequence called <code>seq_1</code> between -15 and 10, where the interval between values is always equal to 2. What is the sum of the elements of <code>seq_1</code>?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["-39"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e065b88821e" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e065b88821e" class="collapse">
The solution is -39. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code># solution
seq_1 &lt;- seq(from = -15, to = 10, by = 2)

# solution
my_sol &lt;- sum(seq_1)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-5" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-5"><i class="fas fa-link"></i></a>
</h3>
<p>Define another object called <code>seq_2</code> containing a sequence of size 1000, with values between 0 and 100. What is the standard deviation (function<code>sd</code>) of this sequence?</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">45.26</option>
<option value="">12.94</option>
<option value="answer">28.91</option>
<option value="">74.17</option>
<option value="">22.19</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0651ff5f33" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0651ff5f33" class="collapse">
The solution is 28.91. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>seq_2 &lt;- seq(from = 0, 
             to = 100, 
             length.out = 1000)

# solution
my_sol &lt;- sd(seq_2)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-5" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-5"><i class="fas fa-link"></i></a>
</h3>
<p>Calculate the sum between <code>seq_1</code> and <code>seq_2</code> vectors (see previous exercises). Did this operation work despite the different size of the vectors? Explain your answer. If it works, what is the highest value of the resulting vector?</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">164.92</option>
<option value="answer">109.00</option>
<option value=""> 69.48</option>
<option value="">273.91</option>
<option value=""> 31.69</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06299497cb" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06299497cb" class="collapse">
The solution is 109.00. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<p>Yes, it worked, but with a <em>warning</em>: _ “the length of the longest object is not a multiple of the length of the shortest object”_. The explanation is that whenever R encounters operations with different vector sizes, it uses the recycling rule, where the shortest vector is repeated as many times as necessary to match the size of the longest vector. In the book, see the section on numerical vectors for more details.</p>
<pre><code>seq_1 &lt;- seq(from = -10, to = 10, by = 2)
seq_2 &lt;- seq(from = 0, 
             to = 100, 
             length.out = 1000)

# solution
my_sol &lt;- max(seq_1+seq_2)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-5" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-5"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s assume that, on a certain date, you bought 100 shares in a company, paying <code>price_purchase</code> per share. After some time, you sold 30 shares for a 18 each and the remaining 70 shares were sold for 22 on a later day. Using a <em>script</em> in R, structure this financial problem by creating numeric objects. What is the total gross profit from this sequence of transactions on the stock market?</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">R$200</option>
<option value="answer">R$580</option>
<option value="">R$94</option>
<option value="">R$413</option>
<option value="">R$307</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e061bd2ba72" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e061bd2ba72" class="collapse">
The solution is R$580. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>total_shares &lt;- 100
price_purchase &lt;- 15

total_purchase_value &lt;- total_shares*price_purchase

qtd_sell_1 &lt;- 30
price_sell_1 &lt;- 18
total_sell_1 &lt;- qtd_sell_1*18

qtd_sell_2 &lt;- total_shares-qtd_sell_1
price_sell_2 &lt;- 22
total_sell_2 &lt;- qtd_sell_2*price_sell_2

total_sell_value &lt;- total_sell_1 + total_sell_2

# solution
my_sol &lt;- total_sell_value - total_purchase_value</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-4" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-4"><i class="fas fa-link"></i></a>
</h3>
<p>Create a vector x according to the following formula, where <span class="math inline">\(i = 1 ... 100\)</span>. What is the sum of the elements of x?</p>
<p><span class="math display">\[
x_i=\frac{-1^{i+1}}{2i-1}
\]</span></p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="9" data-answer='["0.7828982",".7828982"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0671b461ec" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0671b461ec" class="collapse">
The solution is 0.7828982. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>i &lt;- 1:100

x &lt;- ( (-1)^(i+1) )/(2*i - 1)

# solution
my_sol &lt;- sum(x)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.8-3" class="section level3 unnumbered">
<h3>Q.8<a class="anchor" aria-label="anchor" href="#q.8-3"><i class="fas fa-link"></i></a>
</h3>
<p>Create a <span class="math inline">\(z_i\)</span> vector according to the following formula where <span class="math inline">\(x_i = 1 ... 50\)</span> and <span class="math inline">\(y_i = 50 ... 1\)</span>. What is the sum of the elements of <span class="math inline">\(z_i\)</span>? Tip: check out how the <code>dplyr::lag</code> function works.</p>
<p><span class="math display">\[
z_i=\frac{y_i - x_{i-1}}{y_{i-2}}
\]</span></p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">-49.38</option>
<option value="">-22.60</option>
<option value="">-35.99</option>
<option value=""> -9.21</option>
<option value="answer">-65.96</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0613e7c1ef" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0613e7c1ef" class="collapse">
The solution is -65.96. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>x &lt;- 1:50
y &lt;- 50:1

# solution using `base`
z &lt;- (y - c(NA, x[1:(length(x)-1)]))/c(NA, NA, y[1:(length(y)-2)])

# solution with tidyverse (much prettier huh!)
z &lt;- (y - lag(x, n = 1))/lag(y, n = 2)

# solution (be aware of the NA values)
my_sol &lt;- sum(z, na.rm = TRUE)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.9-2" class="section level3 unnumbered">
<h3>Q.9<a class="anchor" aria-label="anchor" href="#q.9-2"><i class="fas fa-link"></i></a>
</h3>
<p>Using <code>set.seed (10)</code>, create an object called <code>x</code> with random values from the Normal distribution with a mean of 10 and standard deviation of 10. Using the <code>cut</code> function, create another object that defines two groups based on values of <code>x</code> greater than 15 and lower than 15. How many observations you find in the first group?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["668"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06530dad6c" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06530dad6c" class="collapse">
The solution is 668. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>set.seed(10)
x &lt;- rnorm(n = 1000, mean = 10, sd = 10)

my_group &lt;- cut(x, 
                breaks = c(-Inf, 15, Inf))

# solution
my_sol &lt;- table(my_group)[1]</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.10-2" class="section level3 unnumbered">
<h3>Q.10<a class="anchor" aria-label="anchor" href="#q.10-2"><i class="fas fa-link"></i></a>
</h3>
<p>Create the following object with the following code:</p>
<pre><code>set.seed(15)
my_char &lt;- paste(sample(letters, 5000, replace = T), 
                 collapse = '')</code></pre>
<p>How many times is the letter <code>'x'</code> found in the resulting text object?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["174"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e061b5e78b2" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e061b5e78b2" class="collapse">
The solution is 174. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>set.seed(15)
my_char &lt;- paste(sample(letters, 5000, replace = T), 
                 collapse = '')

# solution
my_sol &lt;- str_count(my_char, 'x')</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.11-1" class="section level3 unnumbered">
<h3>Q.11<a class="anchor" aria-label="anchor" href="#q.11-1"><i class="fas fa-link"></i></a>
</h3>
<p>Based on the <code>my_char</code> object created earlier, if we divided it into several smaller pieces using the letter <code>"b"</code>, what is the number of characters in the <strong>largest</strong> piece found?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="3" data-answer='["110"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e064dd67cd9" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e064dd67cd9" class="collapse">
The solution is 110. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>set.seed(15)
my_char &lt;- paste(sample(letters, 5000, replace = T), 
                 collapse = '')

my_split &lt;- str_split(my_char, pattern = 'b')[[1]]

# find number of characters in each
n_chars &lt;- sapply(my_split, nchar)

# solution
my_sol &lt;- n_chars[which.max(n_chars)]</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.12" class="section level3 unnumbered">
<h3>Q.12<a class="anchor" aria-label="anchor" href="#q.12"><i class="fas fa-link"></i></a>
</h3>
<p>At the address <a href="https://www.gutenberg.org/files/1342/1342-0.txt">https://www.gutenberg.org/files/1342/1342-0.txt</a> it is possible to access a file containing the full text of the book <em>Pride and Prejudice</em> by Jane Austen. Use functions <code>download.file</code> and <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code> to import the entire book as a vector of characters called <code>my_book</code> in R. How many lines does the resulting object have?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="4" data-answer='["3675"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e066ab5ef3" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e066ab5ef3" class="collapse">
The solution is 3675. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_link &lt;- 'https://www.gutenberg.org/ebooks/2264.txt.utf-8'

my_book &lt;- readr::read_lines(my_link)

# solution
my_sol &lt;- length(my_book)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.13" class="section level3 unnumbered">
<h3>Q.13<a class="anchor" aria-label="anchor" href="#q.13"><i class="fas fa-link"></i></a>
</h3>
<p>Bind the vector of characters in <code>my_book</code> into a single object called <code>full_text</code> using command <code>paste0(my_book, collapse = '\n'</code>. Using the <code>stringr</code> package, how many times is the word <code>'King'</code> repeated throughout the text?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["70"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e061997bfc9" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e061997bfc9" class="collapse">
The solution is 70. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_link &lt;- 'https://www.gutenberg.org/ebooks/2264.txt.utf-8'

my_book &lt;- readr::read_lines(my_link)

# solution
full_text &lt;- paste0(my_book, collapse = '\n')
my_sol &lt;- stringr::str_count(full_text, stringr::fixed('King'))</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.14" class="section level3 unnumbered">
<h3>Q.14<a class="anchor" aria-label="anchor" href="#q.14"><i class="fas fa-link"></i></a>
</h3>
<p>For the <code>full_text</code> object created earlier, use the <code><a href="https://stringr.tidyverse.org/reference/str_split.html">stringr::str_split</a></code> function to split the entire text using blanks. Based on the resulting vector, create a frequency table. What is the most used word in the text? Tip: Remove all cases of empty characters.</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">I</option>
<option value="answer">the</option>
<option value="">and</option>
<option value="">you</option>
<option value="">a</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0653213e04" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0653213e04" class="collapse">
The solution is the. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>my_link &lt;- 'https://www.gutenberg.org/ebooks/2264.txt.utf-8'

my_book &lt;- readr::read_lines(my_link)

# solution
full_text &lt;- paste0(my_book, collapse = '\n')
my_split &lt;- stringr::str_split(full_text, 
                               pattern = stringr::fixed(' '))[[1]]

# remove empty
my_split &lt;- my_split[my_split != '']

my_tab &lt;- sort(table(my_split), decreasing = TRUE)

# solution
my_sol &lt;- names(my_tab[1])</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.15" class="section level3 unnumbered">
<h3>Q.15<a class="anchor" aria-label="anchor" href="#q.15"><i class="fas fa-link"></i></a>
</h3>
<p>Assuming that a person born on 2000-05-12 will live for 100 years, what is the number of birthday days that will fall on a weekend (Saturday or Sunday)? Tip: use operator <code>%in%</code> to check for a multiple condition in a vector.</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["29"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0644888d95" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0644888d95" class="collapse">
The solution is 29. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>b_day &lt;- as.Date('2000-05-12')
n_years &lt;- 100

b_day_vec &lt;- seq(b_day, b_day + n_years*365, by = '1 year')

w_days &lt;- weekdays(b_day_vec)

n_weekend &lt;- sum(w_days %in% c('Saturday', 'Sunday'))

# solution
my_sol &lt;- n_weekend</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.16" class="section level3 unnumbered">
<h3>Q.16<a class="anchor" aria-label="anchor" href="#q.16"><i class="fas fa-link"></i></a>
</h3>
<p>What date and time is found 10000 <strong>seconds</strong> after 2021-02-02 11:50:02?</p>
<br> Your Answer: <select class="webex-select"><option value="blank"></option>
<option value="">2021-02-02 12:21:46</option>
<option value="">2021-02-02 11:05:56</option>
<option value="">2021-02-02 14:02:14</option>
<option value="">2021-02-02 09:44:54</option>
<option value="answer">2021-02-02 14:36:42</option></select><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06d584ab5" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06d584ab5" class="collapse">
The solution is 2021-02-02 14:36:42. To reach the same result, you must execute the code below. For that, open a new R script in RStudio (Control+shift+N), copy and paste the code, and execute it whole by pressing Control+Shift+Enter or line by line with shortcut Control+Enter.
<div class="card card-body">
<pre><code>time_1 &lt;- as.POSIXct('2021-02-02 11:50:02')
my_sec &lt;- 10000

my_sol &lt;- time_1 + my_sec</code></pre>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://afedr-ed2.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
                            
  <div class="chapter-nav">
<div class="prev"><a href="data-structure-objects.html"><span class="header-section-number">6</span> Dataframes and other objects</a></div>
<div class="next"><a href="programming.html"><span class="header-section-number">8</span> Programming and Data Analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#basic-classes"><span class="header-section-number">7</span> Basic Object Classes</a></li>
<li>
<a class="nav-link" href="#numeric-objects"><span class="header-section-number">7.1</span> Numeric Objects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-and-manipulating-numeric-objects"><span class="header-section-number">7.1.1</span> Creating and Manipulating numeric Objects</a></li>
<li><a class="nav-link" href="#creating-a-numeric-sequence"><span class="header-section-number">7.1.2</span> Creating a numeric Sequence</a></li>
<li><a class="nav-link" href="#creating-vectors-with-repeated-elements"><span class="header-section-number">7.1.3</span> Creating Vectors with Repeated Elements</a></li>
<li><a class="nav-link" href="#creating-vectors-with-random-numbers"><span class="header-section-number">7.1.4</span> Creating Vectors with Random Numbers</a></li>
<li><a class="nav-link" href="#accessing-the-elements-of-a-numeric-vector"><span class="header-section-number">7.1.5</span> Accessing the Elements of a numeric Vector</a></li>
<li><a class="nav-link" href="#modifying-and-removing-elements-of-a-numeric-vector"><span class="header-section-number">7.1.6</span> Modifying and Removing Elements of a numeric Vector</a></li>
<li><a class="nav-link" href="#creating-groups"><span class="header-section-number">7.1.7</span> Creating Groups</a></li>
<li><a class="nav-link" href="#other-useful-functions-2"><span class="header-section-number">7.1.8</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#character-objects"><span class="header-section-number">7.2</span> Character Objects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-a-simple-character-object"><span class="header-section-number">7.2.1</span> Creating a Simple character Object</a></li>
<li><a class="nav-link" href="#creating-structured-character-objects"><span class="header-section-number">7.2.2</span> Creating Structured character Objects</a></li>
<li><a class="nav-link" href="#character-constants"><span class="header-section-number">7.2.3</span> character Constants</a></li>
<li><a class="nav-link" href="#selecting-pieces-of-a-text-object"><span class="header-section-number">7.2.4</span> Selecting Pieces of a Text Object</a></li>
<li><a class="nav-link" href="#finding-and-replacing-characters-of-a-text"><span class="header-section-number">7.2.5</span> Finding and Replacing Characters of a Text</a></li>
<li><a class="nav-link" href="#splitting-text"><span class="header-section-number">7.2.6</span> Splitting Text</a></li>
<li><a class="nav-link" href="#finding-the-number-of-characters-in-a-text"><span class="header-section-number">7.2.7</span> Finding the Number of Characters in a Text</a></li>
<li><a class="nav-link" href="#generating-combinations-of-text"><span class="header-section-number">7.2.8</span> Generating Combinations of Text</a></li>
<li><a class="nav-link" href="#encoding-of-character-objects"><span class="header-section-number">7.2.9</span> Encoding of character Objects</a></li>
<li><a class="nav-link" href="#other-useful-functions-3"><span class="header-section-number">7.2.10</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#factor-objects"><span class="header-section-number">7.3</span> Factor Objects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-factors"><span class="header-section-number">7.3.1</span> Creating factors</a></li>
<li><a class="nav-link" href="#modifying-factors"><span class="header-section-number">7.3.2</span> Modifying factors</a></li>
<li><a class="nav-link" href="#converting-factors-to-other-classes"><span class="header-section-number">7.3.3</span> Converting factors to Other Classes</a></li>
<li><a class="nav-link" href="#creating-contingency-tables"><span class="header-section-number">7.3.4</span> Creating Contingency Tables</a></li>
<li><a class="nav-link" href="#other-useful-functions-4"><span class="header-section-number">7.3.5</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#logical-objects"><span class="header-section-number">7.4</span> Logical Objects</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#creating-logical-objects"><span class="header-section-number">7.4.1</span> Creating logical Objects</a></li></ul>
</li>
<li>
<a class="nav-link" href="#date-and-time"><span class="header-section-number">7.5</span> Date and Time</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-simple-dates"><span class="header-section-number">7.5.1</span> Creating Simple Dates</a></li>
<li><a class="nav-link" href="#creating-a-sequence-of-dates"><span class="header-section-number">7.5.2</span> Creating a Sequence of Dates</a></li>
<li><a class="nav-link" href="#operations-with-dates"><span class="header-section-number">7.5.3</span> Operations with Dates</a></li>
<li><a class="nav-link" href="#dealing-with-time"><span class="header-section-number">7.5.4</span> Dealing with Time</a></li>
<li><a class="nav-link" href="#customizing-the-format-of-dates-and-times"><span class="header-section-number">7.5.5</span> Customizing the Format of Dates and Times</a></li>
<li><a class="nav-link" href="#extracting-elements-of-a-date"><span class="header-section-number">7.5.6</span> Extracting Elements of a Date</a></li>
<li><a class="nav-link" href="#find-the-current-date-and-time"><span class="header-section-number">7.5.7</span> Find the Current Date and Time</a></li>
<li><a class="nav-link" href="#other-useful-functions-5"><span class="header-section-number">7.5.8</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#missing-data---na-not-available"><span class="header-section-number">7.6</span> Missing Data - NA (Not available)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#defining-na-values"><span class="header-section-number">7.6.1</span> Defining NA Values</a></li>
<li><a class="nav-link" href="#finding-and-replacing-na"><span class="header-section-number">7.6.2</span> Finding and Replacing NA</a></li>
<li><a class="nav-link" href="#other-useful-functions-6"><span class="header-section-number">7.6.3</span> Other Useful Functions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exercises-4"><span class="header-section-number">7.7</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-6">Q.1</a></li>
<li><a class="nav-link" href="#q.2-6">Q.2</a></li>
<li><a class="nav-link" href="#q.3-5">Q.3</a></li>
<li><a class="nav-link" href="#q.4-5">Q.4</a></li>
<li><a class="nav-link" href="#q.5-5">Q.5</a></li>
<li><a class="nav-link" href="#q.6-5">Q.6</a></li>
<li><a class="nav-link" href="#q.7-4">Q.7</a></li>
<li><a class="nav-link" href="#q.8-3">Q.8</a></li>
<li><a class="nav-link" href="#q.9-2">Q.9</a></li>
<li><a class="nav-link" href="#q.10-2">Q.10</a></li>
<li><a class="nav-link" href="#q.11-1">Q.11</a></li>
<li><a class="nav-link" href="#q.12">Q.12</a></li>
<li><a class="nav-link" href="#q.13">Q.13</a></li>
<li><a class="nav-link" href="#q.14">Q.14</a></li>
<li><a class="nav-link" href="#q.15">Q.15</a></li>
<li><a class="nav-link" href="#q.16">Q.16</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyzing Financial and Economic Data with R - Online Edition</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-11-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
