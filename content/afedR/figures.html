<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Creating and Saving Figures with ggplot2 | Analyzing Financial and Economic Data with R - Online Edition</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 10 Creating and Saving Figures with ggplot2 | Analyzing Financial and Economic Data with R - Online Edition">
<meta property="og:type" content="book">
<meta property="og:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<meta property="og:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Creating and Saving Figures with ggplot2 | Analyzing Financial and Economic Data with R - Online Edition">
<meta name="twitter:description" content="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), ...">
<meta name="twitter:image" content="/figs/CAPAdigital-AnalyzinDataR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyzing Financial and Economic Data with R - Online Edition</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li><a class="" href="about-new-edition.html">About New Edition</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basicoperations.html"><span class="header-section-number">2</span> Basic Operations in R</a></li>
<li><a class="" href="research-scripts.html"><span class="header-section-number">3</span> Writing Research Scripts</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">4</span> Importing Data from Local Files</a></li>
<li><a class="" href="importing-internet.html"><span class="header-section-number">5</span> Importing Data from the Internet</a></li>
<li><a class="" href="data-structure-objects.html"><span class="header-section-number">6</span> Dataframes and other objects</a></li>
<li><a class="" href="basic-classes.html"><span class="header-section-number">7</span> Basic Object Classes</a></li>
<li><a class="" href="programming.html"><span class="header-section-number">8</span> Programming and Data Analysis</a></li>
<li><a class="" href="cleaning.html"><span class="header-section-number">9</span> Cleaning and Structuring Data</a></li>
<li><a class="active" href="figures.html"><span class="header-section-number">10</span> Creating and Saving Figures with ggplot2</a></li>
<li><a class="" href="models.html"><span class="header-section-number">11</span> Financial Econometrics with R</a></li>
<li><a class="" href="reporting.html"><span class="header-section-number">12</span> Reporting Results</a></li>
<li><a class="" href="optimizing.html"><span class="header-section-number">13</span> Optimizing Code</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98297869-1', 'auto');
  ga('send', 'pageview');

</script><!-- Global site tag (gtag.js) - Google Analytics GOOGLE ADS--><script async src="https://www.googletagmanager.com/gtag/js?id=UA-89690212-2">
</script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89690212-2');
</script><div id="figures" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Creating and Saving Figures with <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#figures"><i class="fas fa-link"></i></a>
</h1>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
<div id="the-ggplot2-package" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> The <code>ggplot2</code> Package<a class="anchor" aria-label="anchor" href="#the-ggplot2-package"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="using-graphics-windows" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Using Graphics Windows<a class="anchor" aria-label="anchor" href="#using-graphics-windows"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="creating-figures-with-function-qplot" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Creating Figures with Function <code>qplot</code><a class="anchor" aria-label="anchor" href="#creating-figures-with-function-qplot"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="ggplot" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Creating Figures with Function <code>ggplot</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
<div id="the-us-yield-curve" class="section level3" number="10.4.1">
<h3>
<span class="header-section-number">10.4.1</span> The US Yield Curve<a class="anchor" aria-label="anchor" href="#the-us-yield-curve"><i class="fas fa-link"></i></a>
</h3>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
</div>
<div id="using-themes" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Using Themes<a class="anchor" aria-label="anchor" href="#using-themes"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="creating-panels-with-facet_wrap" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> Creating Panels with <code>facet_wrap</code><a class="anchor" aria-label="anchor" href="#creating-panels-with-facet_wrap"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="using-the-pipeline" class="section level2" number="10.7">
<h2>
<span class="header-section-number">10.7</span> Using the Pipeline<a class="anchor" aria-label="anchor" href="#using-the-pipeline"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="creating-statistical-graphics" class="section level2" number="10.8">
<h2>
<span class="header-section-number">10.8</span> Creating Statistical Graphics<a class="anchor" aria-label="anchor" href="#creating-statistical-graphics"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
<div id="creating-histograms" class="section level3" number="10.8.1">
<h3>
<span class="header-section-number">10.8.1</span> Creating Histograms<a class="anchor" aria-label="anchor" href="#creating-histograms"><i class="fas fa-link"></i></a>
</h3>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="creating-boxplot-figures" class="section level3" number="10.8.2">
<h3>
<span class="header-section-number">10.8.2</span> Creating <em>boxplot</em> Figures<a class="anchor" aria-label="anchor" href="#creating-boxplot-figures"><i class="fas fa-link"></i></a>
</h3>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="creating-qq-plots" class="section level3" number="10.8.3">
<h3>
<span class="header-section-number">10.8.3</span> Creating <em>QQ</em> Plots<a class="anchor" aria-label="anchor" href="#creating-qq-plots"><i class="fas fa-link"></i></a>
</h3>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
</div>
<div id="saving-graphics-to-a-file" class="section level2" number="10.9">
<h2>
<span class="header-section-number">10.9</span> Saving Graphics to a File<a class="anchor" aria-label="anchor" href="#saving-graphics-to-a-file"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="exercises-9" class="section level2" number="10.10">
<h2>
<span class="header-section-number">10.10</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-9"><i class="fas fa-link"></i></a>
</h2>
<div class="pleasebuyit">
<p>
You reached the end of the online version of <em>Analyzing Financial
and Economic Data with R</em>. The full content of the book can be
acquired at <a href="https://www.amazon.com/dp/B084LSNXMN">Amazon</a>
for less than ten dollars. Purchasing this book is a great way of
supporting this and other projects of the <a href="https://www.msperlin.com/">author</a>. If you are satisfied with
the content, please leave your feedback at Amazon or by email
(<a href="mailto:marceloperlin@gmail.com" class="email">marceloperlin@gmail.com</a>). The book is a lifelong project and I’ll keep
improving it based on the received feedback.
</p>
</div>
</div>
<div id="exercises-10" class="section level2" number="10.11">
<h2>
<span class="header-section-number">10.11</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-10"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-9" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-9"><i class="fas fa-link"></i></a>
</h3>
<p>Download TESLA (TSLA) stock data with the <code>BatchGetSymbols</code> package for the last 500 days. Display the price line chart adjusted over time using the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2 :: ggplot</a></code> function. Make sure that:</p>
<ul>
<li>x and y axes are correctly named;</li>
<li>The chart has a title (“Prices for TESLA”), subtitle (“Data from YYYY-MM-DD to YYYY-MM-DD”) and a <em>caption</em> (“Solution for exercise 01, chapter 10 - afedR”).</li>
</ul>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0660f666dc" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0660f666dc" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)
library(tidyverse)

tickers &lt;- 'TLSA'

df_tlsa&lt;- BatchGetSymbols(tickers = tickers, 
                         first.date = Sys.Date() - 500,
                         last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_tlsa, aes(x = ref.date, y = price.adjusted)) + 
  geom_line() + 
  labs(title = paste0('Prices for ', tickers) ,
       subtitle = paste0('Data from ', min(df_tlsa$ref.date), ' to ', 
                         max(df_tlsa$ref.date)),
       caption = "Solution for exercise 01, chapter 10 - afedR")

print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-9" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-9"><i class="fas fa-link"></i></a>
</h3>
<p>Download stock data for:</p>
<ul>
<li>APPLE INC. (AAPL)</li>
<li>MICROSOFT CORPORATION (MSFT)</li>
<li>AMAZON.COM, INC. (AMZN)</li>
<li>ALPHABET INC. (GOOG)</li>
</ul>
<p>using the <code>BatchGetSymbols</code> package for the last 1500 days. Display stock prices with different line colors on the same graph. Adapt all other aspects of the graph from previous exercises such as title and axis labels.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e067caa204a" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e067caa204a" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)
library(ggplot2)

tickers &lt;- c('AAPL', 
             'MSFT',
             'AMZN',
             'GOOG') 

df_stocks &lt;- BatchGetSymbols(tickers = tickers, 
                             first.date = Sys.Date() - 500,
                             last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_stocks, aes(x = ref.date, 
                           y = price.adjusted,
                           color = ticker)) + 
  geom_line() + 
  labs(title = paste0('Prices for ', tickers) ,
       subtitle = paste0('Data from ', min(df_stocks$ref.date), ' to ', 
                         max(df_stocks$ref.date)),
       caption = "Solution for exercise 02, chapter 10 - afedR")

print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-8" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-8"><i class="fas fa-link"></i></a>
</h3>
<p>For the previous plot, add dots in the lines.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e0653b133d3" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e0653b133d3" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)
library(ggplot2)

tickers &lt;- c('AAPL', 
             'MSFT',
             'AMZN',
             'GOOG') 

df_stocks &lt;- BatchGetSymbols(tickers = tickers, 
                             first.date = Sys.Date() - 500,
                             last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_stocks, aes(x = ref.date, 
                           y = price.adjusted,
                           color = ticker)) + 
  geom_line() + 
  labs(title = paste0('Prices for ', tickers) ,
       subtitle = paste0('Data from ', min(df_stocks$ref.date), ' to ', 
                         max(df_stocks$ref.date)),
       caption = "Solution for exercise 03, chapter 10 - afedR")


# add points
p &lt;- p + geom_point()

print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-8" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-8"><i class="fas fa-link"></i></a>
</h3>
<p>For the same plot, separate the stock prices on different panels with the <code>ggplot::facet_wrap</code> function. Use the <code>scales = 'free'</code> argument to release the x and y axis of each panel.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e067b115881" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e067b115881" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)

tickers &lt;- c('AAPL', 
             'MSFT',
             'AMZN',
             'GOOG') 

df_stocks &lt;- BatchGetSymbols(tickers = tickers, 
                             first.date = Sys.Date() - 500,
                             last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_stocks, aes(x = ref.date, 
                           y = price.adjusted,
                           color = ticker)) + 
  geom_line() + 
  labs(title = paste0('Prices for ', tickers) ,
       subtitle = paste0('Data from ', min(df_stocks$ref.date), ' to ', 
                         max(df_stocks$ref.date)),
       caption = "Solution for exercise 04, chapter 10 - afedR")

# add points and facet wrap
p &lt;- p + 
  geom_point() + 
  facet_wrap(~ticker, scales = 'free')

print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-8" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-8"><i class="fas fa-link"></i></a>
</h3>
<p>Change the theme of the previous graph to a black and white scale, both for the graph area and for the colors of the lines.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e061cb4ee05" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e061cb4ee05" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)

tickers &lt;- c('AAPL', 
             'MSFT',
             'AMZN',
             'GOOG') 

df_stocks &lt;- BatchGetSymbols(tickers = tickers, 
                             first.date = Sys.Date() - 500,
                             last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_stocks, aes(x = ref.date, 
                           y = price.adjusted,
                           color = ticker)) + 
  geom_line() + 
  labs(title = paste0('Prices for ', tickers) ,
       subtitle = paste0('Data from ', min(df_stocks$ref.date), ' to ', 
                         max(df_stocks$ref.date)),
       caption = "Solution for exercise 05, chapter 10 - afedR")

# add points and facet_wrap
p &lt;- p + geom_point() + 
  facet_wrap(~ticker, scales = 'free') + 
  theme_bw() + 
  scale_color_grey()

# 
print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-8" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-8"><i class="fas fa-link"></i></a>
</h3>
<p>For the previous data, present the histogram of the returns of the different stocks in different panels and save the result in a file called <code>'histograms.png'</code>.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e065babaead" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e065babaead" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)

tickers &lt;- c('AAPL', 
             'MSFT',
             'AMZN',
             'GOOG') 

df_stocks &lt;- BatchGetSymbols(tickers = tickers, 
                             first.date = Sys.Date() - 500,
                             last.date = Sys.Date())[[2]]

p &lt;- ggplot(df_stocks, aes(x = ret.adjusted.prices)) + 
  geom_histogram() + 
  facet_wrap(~ticker)

print(p)

# save in temp folder
my_file &lt;- file.path(tempdir(), 'histograms.png')
ggsave(filename = my_file, plot = p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-7" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-7"><i class="fas fa-link"></i></a>
</h3>
<p>Use the <code><a href="https://rdrr.io/pkg/BatchGetSymbols/man/GetSP500Stocks.html">BatchGetSymbols::GetSP500Stocks</a></code> function to discover all tickers currently belonging to the SP500 index. Using <code>BatchGetSymbols</code>, download the annual return data for all stocks in the index, from 2015-01-01 to the current day. After that, create the average/variance map by plotting the average annual return as the y axis and the standard deviation as the x axis. Tip: Use the parallel option in <code>BatchGetSymbols</code> to speed up the execution of the code. Also, you will find many outliers in the raw data. Make sure that the graph is visible limiting the x and y axes (see the <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">ggplot2::xlim</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">ggplot2::ylim</a></code> functions).</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06736fdfc7" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06736fdfc7" class="collapse">
<div class="card card-body">
<pre><code><a href="https://rdrr.io/r/base/library.html">library(BatchGetSymbols)
library(tidyverse)

df_sp500 &lt;- GetSP500Stocks()

my_tickers &lt;- df_sp500$Tickers

future::plan(future::multisession, 
             workers = floor(parallel::detectCores()/2))

first_date &lt;- '2015-01-01'
df_prices &lt;- BatchGetSymbols(tickers = my_tickers, 
                             first.date = first_date, 
                             last.date = Sys.Date(),
                             freq.data = 'yearly', 
                             do.parallel = TRUE)[[2]]

tab &lt;- df_prices %&gt;%
  na.omit() %&gt;%
  group_by(ticker) %&gt;%
  summarise(mean = mean(ret.adjusted.prices),
            sd = sd(ret.adjusted.prices))

p &lt;- ggplot(tab, aes(x = sd, y = mean)) + 
  geom_point() + 
  xlim(0, 0.5) + ylim(-0.5, 0.5)

print(p)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.8-6" class="section level3 unnumbered">
<h3>Q.8<a class="anchor" aria-label="anchor" href="#q.8-6"><i class="fas fa-link"></i></a>
</h3>
<p>Head over to the <a href="https://www.kaggle.com/datasets">Kaggle data website</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.kaggle.com/datasets" class="uri"&gt;https://www.kaggle.com/datasets&lt;/a&gt;&lt;/p&gt;'><sup>61</sup></a> and choose a particular dataset for your analysis. It need not be related to economics or finance. Feel free to make a decision based on your own interests. After downloading the data, create a visual analysis of the data. Fell free to try out one or more plots of interest.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_e06750dd1d1" aria-expanded="false" aria-controls="collapseExample">
Solution
</button>
</p>
</div>
<div id="collapse_e06750dd1d1" class="collapse">
<div class="card card-body">
<p>Head over to <a href="https://www.kaggle.com/datasets">https://www.kaggle.com/datasets</a>:</p>
<ol style="list-style-type: decimal">
<li>Choose a dataset</li>
<li>Build a visualization plot of the chosen data</li>
</ol>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://afedr-ed2.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
                            
  <div class="chapter-nav">
<div class="prev"><a href="cleaning.html"><span class="header-section-number">9</span> Cleaning and Structuring Data</a></div>
<div class="next"><a href="models.html"><span class="header-section-number">11</span> Financial Econometrics with R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#figures"><span class="header-section-number">10</span> Creating and Saving Figures with ggplot2</a></li>
<li><a class="nav-link" href="#the-ggplot2-package"><span class="header-section-number">10.1</span> The ggplot2 Package</a></li>
<li><a class="nav-link" href="#using-graphics-windows"><span class="header-section-number">10.2</span> Using Graphics Windows</a></li>
<li><a class="nav-link" href="#creating-figures-with-function-qplot"><span class="header-section-number">10.3</span> Creating Figures with Function qplot</a></li>
<li>
<a class="nav-link" href="#ggplot"><span class="header-section-number">10.4</span> Creating Figures with Function ggplot</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#the-us-yield-curve"><span class="header-section-number">10.4.1</span> The US Yield Curve</a></li></ul>
</li>
<li><a class="nav-link" href="#using-themes"><span class="header-section-number">10.5</span> Using Themes</a></li>
<li><a class="nav-link" href="#creating-panels-with-facet_wrap"><span class="header-section-number">10.6</span> Creating Panels with facet_wrap</a></li>
<li><a class="nav-link" href="#using-the-pipeline"><span class="header-section-number">10.7</span> Using the Pipeline</a></li>
<li>
<a class="nav-link" href="#creating-statistical-graphics"><span class="header-section-number">10.8</span> Creating Statistical Graphics</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#creating-histograms"><span class="header-section-number">10.8.1</span> Creating Histograms</a></li>
<li><a class="nav-link" href="#creating-boxplot-figures"><span class="header-section-number">10.8.2</span> Creating boxplot Figures</a></li>
<li><a class="nav-link" href="#creating-qq-plots"><span class="header-section-number">10.8.3</span> Creating QQ Plots</a></li>
</ul>
</li>
<li><a class="nav-link" href="#saving-graphics-to-a-file"><span class="header-section-number">10.9</span> Saving Graphics to a File</a></li>
<li><a class="nav-link" href="#exercises-9"><span class="header-section-number">10.10</span> Exercises</a></li>
<li>
<a class="nav-link" href="#exercises-10"><span class="header-section-number">10.11</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-9">Q.1</a></li>
<li><a class="nav-link" href="#q.2-9">Q.2</a></li>
<li><a class="nav-link" href="#q.3-8">Q.3</a></li>
<li><a class="nav-link" href="#q.4-8">Q.4</a></li>
<li><a class="nav-link" href="#q.5-8">Q.5</a></li>
<li><a class="nav-link" href="#q.6-8">Q.6</a></li>
<li><a class="nav-link" href="#q.7-7">Q.7</a></li>
<li><a class="nav-link" href="#q.8-6">Q.8</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyzing Financial and Economic Data with R - Online Edition</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-11-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
