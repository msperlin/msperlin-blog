<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 4 Importação e Exportação de Dados Locais | Análise de Dados Financeiros e Econômicos com o R - Versão Online</title>
<meta name="author" content="Marcelo S. Perlin (marcelo.perlin@ufrgs.br)">
<meta name="description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Sem dúvida, a primeira etapa de um script de...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="Capítulo 4 Importação e Exportação de Dados Locais | Análise de Dados Financeiros e Econômicos com o R - Versão Online">
<meta property="og:type" content="book">
<meta property="og:image" content="/00-text-resources/cover/CAPAdigital-AnaliseDadosR.jpg">
<meta property="og:description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Sem dúvida, a primeira etapa de um script de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 4 Importação e Exportação de Dados Locais | Análise de Dados Financeiros e Econômicos com o R - Versão Online">
<meta name="twitter:description" content="window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'UA-120530145-1');  Sem dúvida, a primeira etapa de um script de...">
<meta name="twitter:image" content="/00-text-resources/cover/CAPAdigital-AnaliseDadosR.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>

        /* update total correct if #total_correct exists */
        update_total_correct = function() {
          if (t = document.getElementById("total_correct")) {
            t.innerHTML =
              document.getElementsByClassName("correct").length + " of " +
              document.getElementsByClassName("solveme").length + " correct";
          }
        }
        
        /* solution button toggling function */
        b_func = function() {
          var cl = this.parentElement.classList;
          if (cl.contains('open')) {
            cl.remove("open");
          } else {
            cl.add("open");
          }
        }
        
        /* function for checking solveme answers */
        solveme_func = function(e) {
          var real_answers = JSON.parse(this.dataset.answer);
          var my_answer = this.value;
          var cl = this.classList;
          if (cl.contains("ignorecase")) {
            my_answer = my_answer.toLowerCase();
          }
          if (cl.contains("nospaces")) {
            my_answer = my_answer.replace(/ /g, "");
          }
          
          if (my_answer !== "" & real_answers.includes(my_answer)) {
            cl.add("correct");
          } else {
            cl.remove("correct");
          }
        
          // match numeric answers within a specified tolerance
          if(this.dataset.tol > 0){
            var tol = JSON.parse(this.dataset.tol);  
            var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
            if (matches.reduce((a, b) => a + b, 0) > 0) {
              cl.add("correct");
            } else {
              cl.remove("correct");
            }  
          }
        
          // added regex bit
          if (cl.contains("regex")){
            answer_regex = RegExp(real_answers.join("|"))
            if (answer_regex.test(my_answer)) {
              cl.add("correct");
            }  
          }
          
          update_total_correct();
        }
        
        window.onload = function() {
          /* set up solution buttons */
          var buttons = document.getElementsByTagName("button");
        
          for (var i = 0; i < buttons.length; i++) {
            if (buttons[i].parentElement.classList.contains('solution')) {
              buttons[i].onclick = b_func;
            }
          }
          
          /* set up solveme inputs */
          var solveme = document.getElementsByClassName("solveme");
        
          for (var i = 0; i < solveme.length; i++) {
            /* make sure input boxes don't auto-anything */
            solveme[i].setAttribute("autocomplete","off");
            solveme[i].setAttribute("autocorrect", "off");
            solveme[i].setAttribute("autocapitalize", "off"); 
            solveme[i].setAttribute("spellcheck", "false");
            solveme[i].value = "";
            
            /* adjust answer for ignorecase or nospaces */
            var cl = solveme[i].classList;
            var real_answer = solveme[i].dataset.answer;
            if (cl.contains("ignorecase")) {
              real_answer = real_answer.toLowerCase();
            }
            if (cl.contains("nospaces")) {
              real_answer = real_answer.replace(/ /g, "");
            }
            solveme[i].dataset.answer = real_answer;
            
            /* attach checking function */
            solveme[i].onkeyup = solveme_func;
            solveme[i].onchange = solveme_func;
          }
          
          update_total_correct();
        }
        
        </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="00-code-resources/css/style_html.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Análise de Dados Financeiros e Econômicos com o R - Versão Online</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bem vindo!</a></li>
<li><a class="" href="sobre-nova-edi%C3%A7%C3%A3o.html">Sobre Nova Edição</a></li>
<li><a class="" href="pref%C3%A1cio.html">Prefácio</a></li>
<li><a class="" href="introducao.html"><span class="header-section-number">1</span> Introdução</a></li>
<li><a class="" href="operacoes-basicas.html"><span class="header-section-number">2</span> Operações Básicas no R</a></li>
<li><a class="" href="scripts-pesquisa.html"><span class="header-section-number">3</span> Desenvolvendo Rotinas de Pesquisa</a></li>
<li><a class="active" href="importacao-exportacao.html"><span class="header-section-number">4</span> Importação e Exportação de Dados Locais</a></li>
<li><a class="" href="importacao-pacotes.html"><span class="header-section-number">5</span> Importação de Dados via Pacotes</a></li>
<li><a class="" href="classe-estrutura.html"><span class="header-section-number">6</span> Dataframes e outros Objetos</a></li>
<li><a class="" href="classes-basicas.html"><span class="header-section-number">7</span> As Classes Básicas de Objetos</a></li>
<li><a class="" href="programacao.html"><span class="header-section-number">8</span> Programando com o R</a></li>
<li><a class="" href="limpando-estruturando.html"><span class="header-section-number">9</span> Estruturando e Limpando Dados</a></li>
<li><a class="" href="figuras.html"><span class="header-section-number">10</span> Visualizando Dados</a></li>
<li><a class="" href="modelos.html"><span class="header-section-number">11</span> Econometria Financeira com o R</a></li>
<li><a class="" href="reportando-resultados.html"><span class="header-section-number">12</span> Reportando Resultados e Criando Relatórios</a></li>
<li><a class="" href="otimizacao.html"><span class="header-section-number">13</span> Otimização de Código</a></li>
<li><a class="" href="refer%C3%AAncias.html">Referências</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-120530145-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120530145-1');
</script><div id="importacao-exportacao" class="section level1" number="4">
<h1>
<span class="header-section-number">Capítulo 4</span> Importação e Exportação de Dados Locais<a class="anchor" aria-label="anchor" href="#importacao-exportacao"><i class="fas fa-link"></i></a>
</h1>
<p>Sem dúvida, a primeira etapa de um <em>script</em> de pesquisa é carregar os seus dados em uma sessão do R. Neste capítulo iremos aprender a importar e exportar dados contidos em arquivos locais. Apesar de não ser uma tarefa particularmente difícil, um analista de dados deve entender as diferentes características de cada formato de arquivo e como tirar vantagem deste conhecimento em cada situação. Enquanto algumas facilitam a colaboração e troca de dados, outras podem oferecer um ganho significativo em tempo de execução na leitura e gravação.</p>
<p>Aqui iremos traçar uma lista abrangente com os seguintes formatos e extensões de arquivos:</p>
<ul>
<li>Dados delimitados em texto (<em>csv</em>);</li>
<li>Microsoft Excel (<em>xls</em>, <em>xlsx</em>);</li>
<li>Arquivos de dados nativos do R (<em>RData</em> e <em>rds</em>)</li>
<li>Formato <code>fst</code> (<em>fst</em>)</li>
<li>SQLite (<em>SQLITE</em>)</li>
<li>Texto não estruturado (<em>txt</em>).</li>
</ul>
<p>A primeira lição na importação de dados para o R é que o local do arquivo deve ser indicado explicitamente no código. Este endereço é passado para a função que irá ler o arquivo. Veja a definição a seguir:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'C:/Data/MyData.csv'</span></span></code></pre></div>
<p>Note o uso de barras (<code>/</code>) para designar o diretório do arquivo. Referências relativas também funcionam, tal como em:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'Data/MyData.csv'</span></span></code></pre></div>
<p>Neste caso, assume-se que na pasta atual de trabalho existe um diretório chamado <code>Data</code> e, dentro desse, um arquivo denominado <code>MyData.csv</code>. Se o endereço do arquivo é simplesmente o seu nome, assume-se que o mesmo encontra-se na raiz da pasta de trabalho. Para verificar o endereço atual de trabalho, utilize a função <code>getwd</code>. </p>
<div class="rmdimportant">
<p>
Aqui novamente reforço o uso do <em>tab</em> e <em>autocomplete</em>
do RStudio. É muito mais <strong>fácil e prático</strong> encontrar
arquivos do disco rígido do computador usando a navegação via
<em>tab</em> do que copiar e colar o endereço do seu explorador de
arquivos. Para usar, abra aspas no RStudio, coloque o cursor do
<em>mouse</em> entre as aspas e aperte <em>tab</em>.
</p>
</div>
<p>Um ponto importante aqui é que os <strong>dados serão importados e exportados no R como objetos do tipo <code>dataframe</code></strong>. Isto é, uma tabela contida em um arquivo Excel ou <em>.csv</em> se transformará em um objeto do tipo <code>dataframe</code> no ambiente de trabalho do R. Quando exportarmos dados, o formato mais comum é esse mesmo tipo de objeto. Convenientemente, <code>dataframes</code> são nada mais que tabelas, com linhas e colunas.</p>
<p>Cada coluna do <code>dataframe</code> importado terá a sua própria classe, sendo as mais comuns numérica (<em>numeric</em>), texto (<em>character</em>), fator (<em>factor</em>) e data (<em>Date</em>). Quando realizando a importação, <strong>é de fundamental importância que os dados sejam representados na classe correta</strong>. Uma vasta quantidade de erros podem ser evitados pela simples checagem das classes das colunas no <code>dataframe</code> resultante do processo de importação. Por enquanto somente é necessário entender esta propriedade básica de <code>dataframes</code>. Estudaremos esse objeto mais profundamente no capítulo <a href="classe-estrutura.html#classe-estrutura">6</a>.</p>
<div id="pacote-adfer" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Pacote <code>adfeR</code><a class="anchor" aria-label="anchor" href="#pacote-adfer"><i class="fas fa-link"></i></a>
</h2>
<p>Nas seções futuras iremos utilizar o pacote do livro – <code>adfeR</code> – para carregar diversos exemplos de arquivos. Se você seguiu as instruções da seção <em>Material Suplementar</em> localizada no prefácio do livro, já deves ter o pacote instalado. Caso contrário, execute o seguinte código:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install devtools (if not installed)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span> <span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install book package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span> <span class="op">(</span><span class="st">'msperlin/adfeR'</span><span class="op">)</span></span></code></pre></div>
<p>Uma vez que você instalou o pacote <code>adfeR</code>, todos os arquivos de dados usados no livro foram baixados. Podemos verificar os cinco primeiros arquivos disponíveis com o comando <code><a href="https://rdrr.io/pkg/adfeR/man/list_available_data.html">adfeR::list_available_data</a></code>:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list available data files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/list_available_data.html">list_available_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "batchgetsymbols_parallel_example.rds"
R&gt; [2] "Brazil_footbal_games.csv"            
R&gt; [3] "example_tsv.csv"                     
R&gt; [4] "FileWithLatinChar_Latin1.txt"        
R&gt; [5] "FileWithLatinChar_UTF-8.txt"</code></pre>
<p>Os arquivos anteriores estão salvos na pasta de instalação dos pacote <code>adfeR</code>. Para ter o caminho completo, basta usar função <code><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">adfeR::get_data_file</a></code> tendo o nome do arquivo como entrada:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get location of file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'grunfeld.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span></code></pre></div>
<p>A partir de agora iremos usar a função <code><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">adfeR::get_data_file</a></code> para obter o caminho dos arquivos utilizados nos exemplos. Note que, desde que tenha o pacote <code>adfeR</code> instalado, podes facilmente reproduzir todos os exemplos do livro no seu computador.</p>
</div>
<div id="arquivos-csv" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Arquivos <em>csv</em><a class="anchor" aria-label="anchor" href="#arquivos-csv"><i class="fas fa-link"></i></a>
</h2>
<p>Considere o arquivo de dados no formato <code>csv</code> chamado <code>'Ibov.csv'</code>, pertencente ao repositório do livro. Vamos copiar o mesmo para a pasta “Meus Documentos” com o uso do tilda (<code>~</code>):</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get location of file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'Ibov.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># copy to ~</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">my_f</span>, </span>
<span>          to <span class="op">=</span> <span class="st">'~'</span> <span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>Caso seja a primeira vez trabalhando com arquivos do tipo <em>.csv</em>, sugiro usar o explorador de arquivos do Windows e abrir Ibov.csv com qualquer editor de texto instalado, tal como o <em>Notepad</em> (veja figura <a href="importacao-exportacao.html#fig:notepad">4.1</a>). Observe que as primeiras linhas do arquivo definem os nomes das colunas: “ref.date” e “price.close”. Conforme notação internacional, as linhas são definidas pela quebra do texto e as colunas pelo uso da vírgula (<code>,</code>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:notepad"></span>
<img src="00-text-resources/figs/example_csv_notepad.png" alt="Ibov.csv no Notepad" width="100%"><p class="caption">
Figura 4.1: Ibov.csv no Notepad
</p>
</div>
<div class="rmdcaution">
<p>
Quando trabalhando com dados brasileiros, a notação internacional
pode gerar uma confusão desnecessária. Dados locais tendem a usar a
vírgula para indicar valores decimais em números. Assim, é comum que
dados locais do Brasil sejam exportados usando a semi-vírgula
(<code>;</code>) como separador de colunas e a própria vírgula como
símbolo de decimais. Como regra de bolso, <strong>nunca mude o formato
no arquivo de texto original</strong>. Deixe esse serviço para o próprio
R e seus pacotes.
</p>
</div>
<p>O conteúdo de Ibov.csv é bastante conservador e não será difícil importar o seu conteúdo. Porém, saiba que muitas vezes o arquivo <em>.csv</em> vem com informações extras de cabeçalho – o chamado <em>metadata</em> – ou diferentes formatações que exigem adaptações. Como sugestão para evitar problemas, antes de prosseguir para a importação de dados em um arquivo <em>.csv</em>, abra o arquivo em um editor de texto qualquer e siga os seguintes passos:</p>
<ol style="list-style-type: decimal">
<li><p>Verifique a existência de texto antes dos dados e a necessidade de ignorar algumas linhas iniciais. A maioria dos arquivos .csv não contém cabeçalho, porém deves sempre checar. No R, a função de leitura de arquivos <em>.csv</em> possui uma opção para ignorar um definido número de linhas antes de começar a leitura do arquivo;</p></li>
<li><p>Verifique a existência ou não dos nomes das colunas na primeira linha com os dados. Em caso negativo, verifique com o autor qual o nome (e significado) das colunas;</p></li>
<li><p>Verifique qual o símbolo de separador de colunas. Comumente, seguindo notação internacional, será a vírgula, porém nunca se tem certeza sem checar;</p></li>
<li><p>Para dados numéricos, verifique o símbolo de decimal, o qual deve ser o ponto (<code>.</code>) tal como em <code>2.5</code>. Caso necessário, podes ajustar o símbolo na própria função de leitura;</p></li>
<li><p>Verifique a codificação do arquivo de texto. Normalmente é UTF-8, Latin1 (ISO-8859) ou windows1252. Esses são formatos amplos e devem ser suficientes para a maioria dos idiomas. Sempre que você encontrar símbolos estranhos nas colunas de texto do <code>dataframe</code> resultante, o problema é devido a uma diferença na codificação entre o arquivo e o R. Os usuários do Windows podem verificar a codificação de um arquivo de texto abrindo-o no software <a href="https://notepad-plus-plus.org/">Notepad++</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://notepad-plus-plus.org/" class="uri"&gt;https://notepad-plus-plus.org/&lt;/a&gt;&lt;/p&gt;'><sup>15</sup></a>. As informações sobre a codificação estarão disponíveis no canto inferior direito do editor. No entanto, você precisa estar ciente de que o Notepad++ não faz parte da instalação do Windows e pode ser necessário instalá-lo em seu computador. Os usuários de Linux e Mac podem encontrar as mesmas informações em qualquer software editor de texto avançado, como o <a href="https://kate-editor.org/">Kate</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://kate-editor.org/" class="uri"&gt;https://kate-editor.org/&lt;/a&gt;&lt;/p&gt;'><sup>16</sup></a>.</p></li>
</ol>
<div class="rmdimportant">
<p>
Sempre que você encontrar uma estrutura de texto inesperada em um
arquivo <em>.csv</em>, use os argumentos da função de leitura
<em>csv</em> para importar as informações corretamente. Repetindo,
<strong>nunca modifique dados brutos manualmente</strong>. É muito mais
eficiente usar o código R para lidar com diferentes estruturas de
arquivos em <em>.csv</em>. Pode parecer mais trabalhoso, mas essa
política vai economizar muito tempo no futuro, pois, em algumas semanas,
você provavelmente esquecerá como limpou manualmente aquele arquivo
<em>.csv</em> utilizado em pesquisa passada. Com o uso de código para a
adaptação da importação de dados, sempre que você precisar atualizar o
arquivo de dados, o código irá resolver todos os problemas,
automatizando o processo.
</p>
</div>
<div id="importação-de-dados" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Importação de Dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados"><i class="fas fa-link"></i></a>
</h3>
<p>O R possui uma função nativa chamada <code>base::read.csv</code> para importar dados de arquivos <em>.csv</em>. Porém, esse é um dos muitos casos em que a alternativa do <code>tidyverse</code> – <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> – é mais eficiente e mais fácil de trabalhar. Resumindo, <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> lê arquivos mais rapidamente que <code>base::read.csv</code>, além de usar regras mais inteligentes para definir as classes das colunas importadas.</p>
<p>Este é a primeira vez que usamos um pacote do <code>tidyverse</code>, neste caso o <code>readr</code>. Antes de fazer isso, é necessário instalá-lo em sua sessão R. Uma maneira simples de instalar todos os pacotes pertencentes ao <code>tidyverse</code> é instalar o módulo de mesmo nome:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'tidyverse'</span><span class="op">)</span></span></code></pre></div>
<p>Após executar o código anterior, todos os pacotes <code>tidyverse</code> serão instalados em seu computador. Você também deve ter em mente que alguns aspectos dessa instalação podem demorar um pouco. Assim que terminar, carregue o conjunto de pacotes <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>De volta à importação de dados de arquivos <em>.csv</em>, use a função <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> para carregar o conteúdo do arquivo Ibov.csv no R: </p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file to read</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'Ibov.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read data</span></span>
<span><span class="va">my_df_ibov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2716 Columns: 2
R&gt; ── Column specification ────────────────────────────────────
R&gt; Delimiter: ","
R&gt; dbl  (1): price.close
R&gt; date (1): ref.date
R&gt; 
R&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
R&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>O conteúdo do arquivo importado é convertido para um objeto do tipo <code>dataframe</code> no R. Conforme mencionado no capítulo anterior, cada coluna de um <code>dataframe</code> tem uma classe. Podemos verificar as classes de <code>my_df_ibov</code> usando a função <code>glimpse</code> do pacote <code>dplyr</code>, que também faz parte do <code>tidyverse</code>:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check content</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df_ibov</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,716
R&gt; Columns: 2
R&gt; $ ref.date    &lt;date&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2…
R&gt; $ price.close &lt;dbl&gt; 70045, 70240, 70729, 70451, 70263, 704…</code></pre>
<p>Observe que a coluna de datas (<code>ref.date</code>) foi importada como um vetor <code>Date</code> e os preços de fechamento como numéricos (<code>dbl</code>, precisão dupla). Isso é exatamente o que esperávamos. Internamente, a função <code>read_csv</code> identifica as classes das colunas de acordo com seu conteúdo.</p>
<p>Observe também como o código anterior apresentou a mensagem “Parsed with column specification: …”. Essa mensagem mostra como a função identifica as classes das colunas lendo as primeiras 1000 linhas do arquivo. Regras inteligentes tentam prever a classe com base no conteúdo importado. Podemos usar essas informações em nosso próprio código copiando o texto e atribuindo-o a uma variável: </p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set cols from readr import message</span></span>
<span><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>  price.close <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ref.date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_ibov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>,</span>
<span>                       col_types <span class="op">=</span> <span class="va">my_cols</span><span class="op">)</span></span></code></pre></div>
<p>Como um exercício, vamos importar os mesmos dados, porém usando a classe <code>character</code> (texto) para colunas <code>ref.date</code>:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set cols from readr import message</span></span>
<span><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span></span>
<span>  price.close <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ref.date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_ibov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>,</span>
<span>                       col_types <span class="op">=</span> <span class="va">my_cols</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check content</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df_ibov</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,716
R&gt; Columns: 2
R&gt; $ ref.date    &lt;chr&gt; "2010-01-04", "2010-01-05", "2010-01-0…
R&gt; $ price.close &lt;dbl&gt; 70045, 70240, 70729, 70451, 70263, 704…</code></pre>
<p>Como esperado, a coluna de datas – <code>ref.date</code> – agora foi importada como texto. Assim, o uso de <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code> pode ser resumido em duas etapas: 1) leia o arquivo sem argumentos em <code>read_csv</code>; 2) copie o texto das classes de coluna padrão da mensagem de saída e adicione como entrada <code>col_types</code>. O conjunto de passos anterior é suficiente para a grande maioria dos casos. O uso da mensagem com as classes das colunas é particularmente útil quando o arquivo importado tem várias colunas e a definição manual de cada classe exige muita digitação.</p>
<p>Uma alternativa mais prática no uso do <code>read_csv</code> é confiar na heurística da função e usar a definição padrão das colunas automaticamente. Para isto, basta definir a entrada <code>col_types</code> como <code><a href="https://readr.tidyverse.org/reference/cols.html">cols()</a></code>. Veja a seguir:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read file with readr::read_csv</span></span>
<span><span class="va">my_df_ibov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>,</span>
<span>                       col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Agora, vamos estudar um caso mais anormal de arquivo <em>.csv</em>. No pacote do livro temos um arquivo chamado <code>funky_csv_file.csv</code> onde:</p>
<ul>
<li>o cabeçalho possui texto com informações dos dados;</li>
<li>o arquivo usará a vírgula como decimal;</li>
<li>o texto do arquivo conterá caracteres latinos.</li>
</ul>
<p>As primeiras 10 linhas dos arquivos contém o seguinte conteúdo:</p>
<pre><code>R&gt; Exemplo de arquivo .csv com formato alternativo:
R&gt; - colunas separadas por ";"
R&gt; - decimal como ","
R&gt; 
R&gt; Dados retirados em 2021-01-13
R&gt; Origem: www.funkysite.com.br
R&gt; 
R&gt; COD.UF;COD;NOME;state;SIGLA;number_col
R&gt; 35;3546306;Santa Cruz das Palmeiras;São Paulo; SP;1,90208656713367
R&gt; 21;2103109;Cedral;Maranhão; MA;69,8087496915832</code></pre>
<p>Note a existência do cabeçalho até linha de número 7 e as colunas sendo separadas pela semi-vírgula (“;”).</p>
<p>Ao importar os dados com opções padrões (e erradas), teremos o resultado a seguir:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'funky_csv_file.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_funky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">my_f</span>, </span>
<span>                     col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_funky</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2
R&gt; Columns: 1
R&gt; $ `Exemplo de arquivo .csv com formato alternativo:` &lt;chr&gt; …</code></pre>
<p>Claramente a importação deu errado, com a emissão de diversas mensagens de <em>warning</em>. Para resolver, utilizamos o seguinte código, estruturando todas as particularidades do arquivo:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_not_funky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_f</span>, </span>
<span>                           skip <span class="op">=</span> <span class="fl">7</span>, <span class="co"># how many lines do skip</span></span>
<span>                           delim <span class="op">=</span> <span class="st">';'</span>, <span class="co"># column separator</span></span>
<span>                           col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># column types</span></span>
<span>                           locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>decimal_mark <span class="op">=</span> <span class="st">','</span><span class="op">)</span><span class="co"># locale</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">df_not_funky</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 100
R&gt; Columns: 6
R&gt; $ COD.UF     &lt;dbl&gt; 35, 21, 35, 35, 41, 31, 31, 21, 29, 26,…
R&gt; $ COD        &lt;dbl&gt; 3546306, 2103109, 3514700, 3538105, 411…
R&gt; $ NOME       &lt;chr&gt; "Santa Cruz das Palmeiras", "Cedral", "…
R&gt; $ state      &lt;chr&gt; "São Paulo", "Maranhão", "São Paulo", "…
R&gt; $ SIGLA      &lt;chr&gt; " SP", " MA", " SP", " SP", " PR", " MG…
R&gt; $ number_col &lt;dbl&gt; 1.902087, 69.808750, 81.509312, 56.8400…</code></pre>
<p>Veja que agora os dados foram corretamente importados, com as classes corretas das colunas. Para isso, usamos a função alternativa <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_delim</a></code>. O pacote <code>readr</code> também possui várias outras funções para situações específicas de importação. Caso a função <code>read_csv</code> não resolva o seu problema na leitura de algum arquivo de dados estruturado em texto, certamente outra função desse pacote resolverá.</p>
</div>
<div id="exportação-de-dados" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Exportação de Dados<a class="anchor" aria-label="anchor" href="#exporta%C3%A7%C3%A3o-de-dados"><i class="fas fa-link"></i></a>
</h3>
<p>Para exportar tabelas em um arquivo <em>.csv</em>, basta utilizar a função <code><a href="https://readr.tidyverse.org/reference/write_delim.html">readr::write_csv</a></code>. No próximo exemplo iremos criar dados artificiais, salvar em um dataframe e exportar para um arquivo <em>.csv</em> temporário. Veja a seguir: </p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of observations</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># create dataframe with random data</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>                    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to file</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.csv'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>, file <span class="op">=</span> <span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<p>No exemplo anterior, salvamos o <code>dataframe</code> chamado <code>my_df</code> para o arquivo file8e982cce25f.csv, localizado na pasta temporária do computador. Podemos verificar o arquivo importando o seu conteúdo:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">f_out</span>,</span>
<span>                  col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                   z <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; # A tibble: 6 × 2
R&gt;        y z    
R&gt;    &lt;dbl&gt; &lt;chr&gt;
R&gt; 1 0.0825 a    
R&gt; 2 0.903  a    
R&gt; 3 0.445  a    
R&gt; 4 0.825  a    
R&gt; 5 0.0386 a    
R&gt; 6 0.474  a</code></pre>
<p>O resultado está conforme o esperado, um dataframe com duas colunas, a primeira com números e a segunda com texto.</p>
<p>Note que toda exportação com função <code>write_csv</code> irá ser formatada, por padrão, com a notação internacional. Caso quiser algo diferentes, verifique as opções disponíveis na função <code>write_delim</code>, a qual é muito mais flexível.</p>
</div>
</div>
<div id="arquivos-excel-xls-e-xlsx" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Arquivos <em>Excel</em> (<em>xls</em> e <em>xlsx</em>)<a class="anchor" aria-label="anchor" href="#arquivos-excel-xls-e-xlsx"><i class="fas fa-link"></i></a>
</h2>
<p>Em Finanças e Economia, é bastante comum encontrarmos dados salvos em arquivos do tipo Microsoft Excel, com extensão <em>.xls</em> ou <em>.xlsx</em>. Apesar de não ser um formato de armazenamento de dados eficiente, esse é um programa de planilhas bastante popular devido às suas funcionalidades. É muito comum que informações sejam armazenadas e distribuídas dessa forma. Por exemplo, dados históricos do Tesouro Direto são disponibilizados como arquivos <em>.xls</em> no <a href="http://www.tesouro.gov.br/tesouro-direto-balanco-e-estatisticas">site do tesouro nacional</a>. A CVM (Comissão de Valores Mobiliários) e ANBIMA (Associação Brasileira das Entidades dos Mercados Financeiro e de Capitais) também tem preferência por esse tipo de formato em alguns dados publicados em seu <em>site</em>.</p>
<p>A desvantagem de usar arquivos do Excel para armazenar dados é sua baixa portabilidade e o maior tempo necessário para leitura e gravação. Isso pode não ser um problema para tabelas pequenas, mas ao lidar com um grande volume de dados, o uso de arquivos Excel é frustrante e não aconselhável. Se possível, evite o uso de arquivos do Excel em seu ciclo de trabalho.</p>
<div id="importação-de-dados-1" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Importação de Dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados-1"><i class="fas fa-link"></i></a>
</h3>
<p>O R não possui uma função nativa para importar dados do Excel e, portanto, deve-se instalar e utilizar certos pacotes para realizar essa operação. Existem diversas opções, porém, os principais pacotes são <code>XLConnect</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-XLConnect" role="doc-biblioref">Mirai Solutions GmbH 2021</a>)</span>, <code>xlsx</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-xlsx" role="doc-biblioref">Dragulescu and Arendt 2020</a>)</span>, <code>readxl</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-readxl" role="doc-biblioref">Wickham and Bryan 2022</a>)</span> e <code>tidyxl</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-tidyxl" role="doc-biblioref">Garmonsway 2020</a>)</span>. .</p>
<p>Apesar de os pacotes anteriores terem objetivos semelhantes, cada um tem suas peculiaridades. Caso a leitura de arquivos do Excel seja algo importante no seu trabalho, aconselho-o fortemente a estudar as diferenças entre esses pacotes. Por exemplo, pacote <code>tidyxl</code> permite a leitura de dados não-estruturados de um arquivo Excel, enquanto <code>XLConnect</code> possibilita a abertura de uma conexão ativa entre o R e o Excel, onde o usuário pode transmitir dados entre um e o outro, formatar células, criar gráficos no Excel e muito mais.</p>
<p>Nesta seção, daremos prioridade para funções do pacote <code>readxl</code>, que é um dos mais fáceis e diretos de se utilizar, além de não necessitar de outros softwares instalados (tal como o <em>Java</em>). Para instalar o referido pacote, basta utilizar a função <code>install.packages</code>: </p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'readxl'</span><span class="op">)</span></span></code></pre></div>
<p>Imagine agora a existência de um arquivo chamado <code>Ibov_xls.xlsx</code> que contenha os mesmos dados do Ibovespa que importamos na seção anterior. A importação das informações contidas nesse arquivo para o R será realizada através da função <code>read_excel</code>: </p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/Ibov_xlsx.xlsx'</span></span>
<span></span>
<span><span class="co"># read xlsx into dataframe</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="va">my_f</span>, sheet <span class="op">=</span> <span class="st">'Sheet1'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># glimpse contents</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 2,721
R&gt; Columns: 2
R&gt; $ ref.date    &lt;dttm&gt; 2010-01-04, 2010-01-05, 2010-01-06, 2…
R&gt; $ price.close &lt;dbl&gt; 70045, 70240, 70729, 70451, 70263, 704…</code></pre>
<p>Observe que, nesse caso, as datas já foram importadas com a formatação correta na classe <code>dttm</code> (<em>datetime</em>). Essa é uma vantagem ao utilizar arquivos do Excel: a classe dos dados do arquivo original é levada em conta no momento da importação. O lado negativo desse formato é a baixa portabilidade dos dados e o maior tempo necessário para a execução da importação. Como regra geral, dados importados do Excel apresentarão um tempo de carregamento mais alto do que dados importados de arquivos <em>.csv</em>.</p>
</div>
<div id="exportação-de-dados-1" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Exportação de Dados<a class="anchor" aria-label="anchor" href="#exporta%C3%A7%C3%A3o-de-dados-1"><i class="fas fa-link"></i></a>
</h3>
<p>A exportação para arquivo Excel também é fácil. Assim como para a importação, não existe uma função nativa do R que execute esse procedimento. Para tal tarefa, temos pacotes <code>xlsx</code> e <code>writexl</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-writexl" role="doc-biblioref">Ooms 2021</a>)</span>. Uma diferença aqui é que o pacote <code>xlsx</code> oferece mais funcionalidade mas exige a instalação do Java JDK no sistema operacional. No caso do Windows, basta visitar o <a href="https://www.java.com/pt_BR/">site do Java</a> e instalar o software na versão 64 bits (opção <em>Windows Off-line (64 bits)</em>). Logo após, instale o pacote <code>xlsx</code> normalmente no R com o comando <code>install.packages('xlsx')</code>. </p>
<p>Vamos começar com um exemplo para <code>xlsx</code></p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/colearendt/xlsx">xlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># create random dataframe</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to xlsx</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.xlsx'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>,</span>
<span>           file <span class="op">=</span> <span class="va">f_out</span>,</span>
<span>           sheetName <span class="op">=</span> <span class="st">"my df"</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Note que uma diferença nos argumentos da função <code>write.xlsx</code> é que é necessário incluir o nome da aba do arquivo Excel onde os dados da tabela serão exportados. Para exportar várias informações para um mesmo arquivo, é necessário utilizar o argumento <code>append</code> da função <code>write.xlsx</code>. Caso contrário, a função irá criar um novo arquivo em cada chamada da mesma. Veja o exemplo a seguir, onde exportamos dois dataframes para duas abas diferentes do mesmo arquivo Excel:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_df_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'b'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write both df to single file</span></span>
<span><span class="va">f_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.xlsx'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>           file <span class="op">=</span> <span class="va">f_out</span>,</span>
<span>           sheetName <span class="op">=</span> <span class="st">"Tabela A"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_B</span>,</span>
<span>           file <span class="op">=</span> <span class="va">f_out</span>,</span>
<span>           sheetName <span class="op">=</span> <span class="st">"Tabela B"</span>,</span>
<span>           append <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<p>Após a exportação, podes verificar as abas disponíveis no arquivo exportado com função <code><a href="https://rdrr.io/pkg/xlsx/man/Sheet.html">xlsx::getSheets</a></code>:</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Tabela A" "Tabela B"</code></pre>
<p>O diferencial do pacote <code>writexl</code> em relação a <code>xlsx</code> é a não necessidade do Java, e a rapidez de execução. O lado negativo é que, na versão atual (1.4.0 – 2022-08-10), não permite a escrita em arquivos já existentes. Veja a seguir: </p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/">writexl</a></span><span class="op">)</span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>           file <span class="op">=</span> <span class="va">f_out</span><span class="op">)</span></span></code></pre></div>
<p>Para comparar o desempenho, vamos verificar a diferença de tempo de execução entre um e outro:</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/">writexl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/colearendt/xlsx">xlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">2500</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                      z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set files</span></span>
<span><span class="va">my_file_1</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/temp_writexl.xlsx'</span></span>
<span><span class="va">my_file_2</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/temp_xlsx.xlsx'</span></span>
<span></span>
<span><span class="co"># test export</span></span>
<span><span class="va">time_write_writexl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>                                             path <span class="op">=</span> <span class="va">my_file_1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_write_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df_A</span>,</span>
<span>                                          file <span class="op">=</span> <span class="va">my_file_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test read</span></span>
<span><span class="va">time_read_readxl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">my_file_1</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_read_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file_2</span>,</span>
<span>                                        sheetIndex <span class="op">=</span> <span class="fl">1</span> <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Após a execução, vamos verificar a diferença de tempo:</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results</span></span>
<span><span class="va">my_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'xlsx'</span>, <span class="st">'readxl'</span><span class="op">)</span></span>
<span><span class="va">results_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_read_xlsx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_read_readxl</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_write</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_write_xlsx</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_write_writexl</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print text</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to WRITE dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">results_write</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                  <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to WRITE dataframe with xlsx: 1.736 seconds
R&gt; Time to WRITE dataframe with readxl: 0.011 seconds</code></pre>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to READ dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">results_read</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                  <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to READ dataframe with xlsx: 2.658 seconds
R&gt; Time to READ dataframe with readxl: 0.007 seconds</code></pre>
<p>Como podemos ver, mesmo para dados de pouco volume, um dataframe com 2500 linhas e 2 colunas, a diferença de tempo de execução é significativa. Caso estiveres trabalhando com grandes planilhas, o uso de pacotes <code>readxl</code> e <code>writexl</code> é fortemente recomendado. Porém, como já mostrado anteriormente, as funções de <code>xlsx</code> oferecem algumas funcionalidades extras.</p>
</div>
</div>
<div id="formato-.rdata-e-.rds" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Formato <em>.RData</em> e <em>.rds</em><a class="anchor" aria-label="anchor" href="#formato-.rdata-e-.rds"><i class="fas fa-link"></i></a>
</h2>
<p>O R possui dois formatos nativos para salvar objetos de sua área de trabalho para um arquivo local com extensão <em>RData</em> ou <em>rds</em>. O grande benefício, em ambos os casos, é que o arquivo resultante é compacto e o seu acesso é muito rápido. A desvantagem é que os dados perdem portabilidade para outros programas. A diferença entre um formato e outro é que arquivos <em>RData</em> podem salvar mais de um objeto, enquanto o formato <em>.rds</em> salva apenas um. Na prática, porém, essa não é uma restrição forte. No R existe um objeto do tipo <em>lista</em> que incorpora outros. Portanto, caso salvarmos uma <em>lista</em> em um arquivo <em>.rds</em>, podemos gravar no disco quantos objetos forem necessário.</p>
<div id="importação-de-dados-2" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> Importação de Dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados-2"><i class="fas fa-link"></i></a>
</h3>
<p>Para carregar os dados de um aquivo <code>RData</code>, utilizamos a função <code>load</code>: </p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set a object</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># set temp name of RData file</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'temp.RData'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>O arquivo temp.RData possui dois objetos, <code>my_x</code> e <code>my_y</code>, os quais se tornam disponíveis na área de trabalho depois da chamada de <code>load</code>.</p>
<p>O processo de importação para arquivos <em>.rds</em> é muito semelhante. A diferença é no uso da função <code><a href="https://readr.tidyverse.org/reference/read_rds.html">readr::read_rds</a></code>:</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file path</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'temp.rds'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load content into workspace</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>Comparando o código entre o uso de arquivos <code>.RData</code> e <code>.rds</code>, note que um benefício no uso de <code>.rds</code> é a explícita definição do objeto na área de trabalho. Isto é, o conteúdo de <code>my_file</code> em <code><a href="https://readr.tidyverse.org/reference/read_rds.html">readr::read_rds</a></code> é explicitamente salvo em <code>my_x</code>. Quando usamos a função <code>load</code>, no código não fica claro qual o nome do objeto que foi importado. Isso é particularmente inconveniente quando é necessário modificar o nome do objeto importado.</p>
<div class="rmdimportant">
<p>
Como sugestão, dê preferência ao uso do formato <em>.rds</em>, o qual
resulta em códigos mais transparentes. A diferença de velocidade de
acesso e gravação entre um e outro é mínima. O benefício de importar
vários objetos em um mesmo arquivo com o formato <code>RData</code>
torna-se irrelevante quando no uso de objetos do tipo lista, os quais
podem incorporar outros objetos no seu conteúdo.
</p>
</div>
</div>
<div id="exportação-de-dados-2" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Exportação de Dados<a class="anchor" aria-label="anchor" href="#exporta%C3%A7%C3%A3o-de-dados-2"><i class="fas fa-link"></i></a>
</h3>
<p>Para criar um novo arquivo <em>RData</em>, utilizamos a função <code>save</code>. Veja o exemplo a seguir, onde criamos um arquivo <em>RData</em> com dois objetos:</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set vars</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">my_y</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># write to RData</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.RData'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'my_x'</span>, <span class="st">'my_y'</span><span class="op">)</span>,</span>
<span>     file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<p>Podemos verificar a existência do arquivo com a função <code>file.exists</code>:</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>Observe que o arquivo file8e9821e5ed28.RData está disponível na pasta temporária.</p>
<p>Já para arquivos <em>.rds</em>, salvamos o objeto com função <code>saveRDS</code>:</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set data and file</span></span>
<span><span class="va">my_x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/temp.rds'</span></span>
<span></span>
<span><span class="co"># save as .rds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">my_x</span>,</span>
<span>        file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read it</span></span>
<span><span class="va">my_x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test equality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">my_x</span>, <span class="va">my_x2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] TRUE</code></pre>
<p>O comando <code>identical</code> testa a igualdade entre os objetos e, como esperado, verificamos que <code>my_x</code> e <code>my_x2</code> são exatamente iguais.</p>
</div>
</div>
<div id="arquivos-fst-pacote-fst" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Arquivos <em>fst</em> (pacote <code>fst</code>)<a class="anchor" aria-label="anchor" href="#arquivos-fst-pacote-fst"><i class="fas fa-link"></i></a>
</h2>
<p>O formato <a href="http://www.fstpackage.org/"><em>fst</em></a> foi especialmente desenhado para possibilitar a gravação e leitura de dados tabulares de forma rápida e com mínimo uso do espaço no disco. O uso deste formato é particularmente benéfico quando se está trabalhando com volumosas bases de dados em computadores potentes. <strong>O grande truque do formato <em>fst</em> é usar todos núcleos do computador para importar e exportar dados</strong>, enquanto todos os demais formatos se utilizam de apenas um. Como logo veremos, o ganho em velocidade é bastante significativo. </p>
<div id="importação-de-dados-3" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Importação de Dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados-3"><i class="fas fa-link"></i></a>
</h3>
<p>O uso do formato <em>fst</em> é bastante simples. Utilizamos a função <code>read_fst</code> para ler arquivos:</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; fst package v0.9.8</code></pre>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'temp.fst'</span><span class="op">)</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">read_fst</a></span><span class="op">(</span><span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; fstcore package v0.9.12</code></pre>
<pre><code>R&gt; (OpenMP detected, using 16 threads)</code></pre>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 1,000
R&gt; Columns: 1
R&gt; $ x &lt;dbl&gt; 0.70968891, 0.83903044, 0.70026554, 0.78120026, …</code></pre>
<p>Assim como para os demais casos, os dados estão disponíveis na área de trabalho após a importação.</p>
</div>
<div id="exportação-de-dados-3" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Exportação de Dados<a class="anchor" aria-label="anchor" href="#exporta%C3%A7%C3%A3o-de-dados-3"><i class="fas fa-link"></i></a>
</h3>
<p>Utilizamos a função <code>write_fst</code> para gravar arquivos no formato <em>fst</em>, :</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create dataframe</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">my_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.fst'</span><span class="op">)</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to fst</span></span>
<span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">write_fst</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_df</span>, path <span class="op">=</span> <span class="va">my_file</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="testando-o-tempo-de-execução-do-formato-fst" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> Testando o Tempo de Execução do Formato <em>fst</em><a class="anchor" aria-label="anchor" href="#testando-o-tempo-de-execu%C3%A7%C3%A3o-do-formato-fst"><i class="fas fa-link"></i></a>
</h3>
<p>Como um teste do potencial do pacote <code>fst</code>, a seguir vamos cronometrar o tempo de leitura e gravação entre <em>fst</em> e <em>rds</em> para um dataframe com grande quantidade de dados: 5,000,000 linhas e 2 colunas. Iremos reportar também o tamanho do arquivo resultante.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org">fst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">5000000</span></span>
<span></span>
<span><span class="co"># create random dfs</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">N</span><span class="op">)</span>,</span>
<span>                    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set files</span></span>
<span><span class="va">my_file_1</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/temp_rds.rds'</span></span>
<span><span class="va">my_file_2</span> <span class="op">&lt;-</span> <span class="st">'00-text-resources/data/temp_fst.fst'</span></span>
<span></span>
<span><span class="co"># test write</span></span>
<span><span class="va">time_write_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">write_rds</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="va">my_file_1</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_write_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">write_fst</a></span><span class="op">(</span><span class="va">my_df</span>, <span class="va">my_file_2</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test read</span></span>
<span><span class="va">time_read_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="va">my_file_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time_read_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html">read_fst</a></span><span class="op">(</span><span class="va">my_file_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># test file size (MB)</span></span>
<span><span class="va">file_size_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.size</a></span><span class="op">(</span><span class="va">my_file_1</span><span class="op">)</span><span class="op">/</span><span class="fl">1000000</span></span>
<span><span class="va">file_size_fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.size</a></span><span class="op">(</span><span class="va">my_file_2</span><span class="op">)</span><span class="op">/</span><span class="fl">1000000</span></span></code></pre></div>
<p>Após a execução, vamos verificar o resultado:</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># results</span></span>
<span><span class="va">my_formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'.rds'</span>, <span class="st">'.fst'</span><span class="op">)</span></span>
<span><span class="va">results_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_read_rds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_read_fst</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_write</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time_write_rds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">time_write_fst</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_file_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">file_size_rds</span> , <span class="va">file_size_fst</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print text</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to WRITE dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_write</span>, <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to WRITE dataframe with .rds: 1.15899999999999 seconds
R&gt; Time to WRITE dataframe with .fst: 0.119 seconds</code></pre>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nTime to READ dataframe with '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_read</span>, <span class="st">' seconds'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Time to READ dataframe with .rds: 1.036 seconds
R&gt; Time to READ dataframe with .fst: 0.0910000000000082 seconds</code></pre>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'\nResulting FILE SIZE for '</span>,</span>
<span>                  <span class="va">my_formats</span>, <span class="st">': '</span>,</span>
<span>                  <span class="va">results_file_size</span>, <span class="st">' MBs'</span>, collapse <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 
R&gt; Resulting FILE SIZE for .rds: 65.01011 MBs
R&gt; Resulting FILE SIZE for .fst: 14.791938 MBs</code></pre>
<p>A diferença é gritante! O formato <code>fst</code> não somente lê e grava com mais rapidez mas o arquivo resultante também é menor. Porém, saiba que os resultados anteriores foram compilados em um computador com 16 núcleos. É possível que a diferença de tempo para um computador mais modesto não seja tão significativa.</p>
<div class="rmdimportant">
<p>
Devido ao uso de todos os núcleos do computador, o formato
<em>fst</em> é altamente recomendado quando estiver trabalhando com
dados volumosos em um computador potente. Não somente os arquivos
resultantes serão menores, mas o processo de gravação e leitura será
consideravelmente mais rápido.
</p>
</div>
</div>
</div>
<div id="arquivos-sqlite" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Arquivos <em>SQLite</em><a class="anchor" aria-label="anchor" href="#arquivos-sqlite"><i class="fas fa-link"></i></a>
</h2>
<p>O uso de arquivos <em>csv</em>, <em>rds</em> e <em>fst</em> para armazenar conjuntos de dados tem seus limites a medida que o tamanho dos arquivos aumenta e os dados fragmentam-se em várias tabelas. Se você está esperando muito tempo para ler apenas uma tabela de um arquivo com várias tabelas, deves procurar alternativas mais eficientes. Da mesma forma, se você estiver trabalhando em uma rede de computadores e muitas pessoas estão usando os mesmos dados, faz sentido manter e distribuir as informações de um servidor central. Dessa forma, cada usuário pode ter acesso à mesma informação, simultaneamente.</p>
<p>Isso nos leva ao tópico de programas de armazenamento e distribuição de banco de dados. Esses programas específicos geralmente funcionam com uma linguagem de consulta chamada <em>SQL</em> (<em>Structured Query Language</em>), e permitem ao usuário ler partes dos dados e mesmo manipulá-lo de forma eficiente. Existem muitas opções de software de banco de dados que se integra muito bem com R. A lista inclui <strong>mySQL</strong>, <strong>SQLite</strong> e <strong>MariaDB</strong>. Aqui, forneceremos um tutorial rápido sobre esse tópico usando o SQLite, que é o mais fácil de usar, uma vez que não precisa de nenhuma configuração do servidor e todos dados estão contidos em um único arquivo. </p>
<p>Antes de irmos para os exemplos, precisamos entender como se usa o <em>software</em> de banco de dados. Primeiro, um banco de dados deve existir em seu computador ou rede. Segundo, o R se conectará ao banco de dados e retornará um objeto de conexão. Com base nessa conexão, enviaremos consultas para importar dados desse banco de dados usando a linguagem <em>SQL</em>. A principal vantagem é que podemos ter um grande banco de dados de, digamos, 10 GB e carregar apenas uma pequena porção dele na área de trabalho do R. Essa operação também é muito rápida, permitindo um acesso eficiente às tabelas disponíveis.</p>
<div id="importação-de-dados-4" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Importação de Dados<a class="anchor" aria-label="anchor" href="#importa%C3%A7%C3%A3o-de-dados-4"><i class="fas fa-link"></i></a>
</h3>
<p>Assumindo a existência de um arquivo com formato SQLite, podemos importar suas tabelas com o pacote <code>RSQLite</code>: </p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set name of SQLITE file</span></span>
<span><span class="va">f_sqlite</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'SQLite_db.SQLITE'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># open connection</span></span>
<span><span class="va">my_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span>drv <span class="op">=</span> <span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_sqlite</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read table</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu">dbReadTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">'MyTable1'</span><span class="op">)</span> <span class="co"># name of table in sqlite</span></span>
<span></span>
<span><span class="co"># print with str</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_df</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; Rows: 1,000,000
R&gt; Columns: 2
R&gt; $ x &lt;dbl&gt; 0.007504194, 0.439465174, 0.178387480, 0.9857759…
R&gt; $ G &lt;chr&gt; "B", "B", "B", "B", "A", "B", "A", "B", "B", "B"…</code></pre>
<p>Outro exemplo do uso do SQLITE é com instruções de um comando <em>SQL</em>. Observe que, no código anterior, usamos função <code>dbReadTable</code> para obter o conteúdo de todas as linhas da tabela <code>MyTable1</code>. Agora, vamos usar o comando <code>dbGetQuery</code> para obter dados da tabela <code>myTable2</code> apenas quando a coluna <code>G</code> é igual a <code>A</code>: </p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set sql statement</span></span>
<span><span class="va">my_SQL_statement</span> <span class="op">&lt;-</span> <span class="st">"select * from myTable2 where G='A'"</span></span>
<span></span>
<span><span class="co"># get query</span></span>
<span><span class="va">my_df_A</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, </span>
<span>                      statement <span class="op">=</span> <span class="va">my_SQL_statement</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># disconnect from db</span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">my_con</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print with str</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my_df_A</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; 'data.frame':    499522 obs. of  2 variables:
R&gt;  $ x: num  0.0637 0.1982 0.2894 0.7389 0.0669 ...
R&gt;  $ G: chr  "A" "A" "A" "A" ...
R&gt; NULL</code></pre>
<p>Nesse exemplo simples podemos ver como é fácil criar uma conexão com um banco de dados, recuperar tabelas e desconectar. Se você estiver trabalhando com dados volumosos e diversas tabelas, vale a pena utilizar um software de banco de dados apropriado. Caso existir um servidor de banco de dados disponível em seu local de trabalho, eu recomendo fortemente aprender a conectar-se a ele e carregar dados diretamente de uma sessão do R.</p>
</div>
<div id="exportação-de-dados-4" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Exportação de Dados<a class="anchor" aria-label="anchor" href="#exporta%C3%A7%C3%A3o-de-dados-4"><i class="fas fa-link"></i></a>
</h3>
<p>Como exemplo, vamos criar dois dataframes com dados aleatórios e salvar ambos em um arquivo SQLite usando pacote <code>RSQLite</code>. </p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of rows in df</span></span>
<span><span class="va">N</span> <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span> </span>
<span></span>
<span><span class="co"># create simulated dataframe</span></span>
<span><span class="va">my_large_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, </span>
<span>                            G<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,</span>
<span>                                      size <span class="op">=</span> <span class="va">N</span>,</span>
<span>                                      replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_large_df_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, </span>
<span>                            G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,</span>
<span>                                       size <span class="op">=</span> <span class="va">N</span>,</span>
<span>                                       replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set name of SQLITE file</span></span>
<span><span class="va">f_sqlite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.SQLITE'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># open connection</span></span>
<span><span class="va">my_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span>drv <span class="op">=</span> <span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_sqlite</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write df to sqlite</span></span>
<span><span class="fu">dbWriteTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, name <span class="op">=</span> <span class="st">'MyTable1'</span>, </span>
<span>             value <span class="op">=</span> <span class="va">my_large_df_1</span><span class="op">)</span></span>
<span><span class="fu">dbWriteTable</span><span class="op">(</span>conn <span class="op">=</span> <span class="va">my_con</span>, name <span class="op">=</span> <span class="st">'MyTable2'</span>, </span>
<span>             value <span class="op">=</span> <span class="va">my_large_df_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># disconnect</span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">my_con</span><span class="op">)</span></span></code></pre></div>
<p>A saída <code>TRUE</code> de <code>dbWriteTable</code> indica que tudo ocorreu bem. Uma conexão foi aberta usando a função <code>dbConnect</code> e os dataframes foram escritos em um arquivo SQLITE temporário chamado file8e9848e3e198.SQLITE. É boa política de programação sempre se desconectar do banco de dados após a utilização. Fizemos isso com a função <code>dbDisconnect</code>. </p>
</div>
</div>
<div id="dados-não-estruturados-e-outros-formatos" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Dados Não-Estruturados e Outros Formatos<a class="anchor" aria-label="anchor" href="#dados-n%C3%A3o-estruturados-e-outros-formatos"><i class="fas fa-link"></i></a>
</h2>
<p>Os pacotes e formatos anteriores são suficientes para resolver o problema de importação de dados na grande maioria das situações. Apesar disso, vale destacar que o R possui outras funções específicas para diferentes formatos. Isso inclui arquivos exportados de outros softwares, tal como SPSS, Matlab, entre vários outros. Se esse for o seu caso, sugiro um estudo aprofundado do pacote <code>foreign</code> <span class="citation">(<a href="refer%C3%AAncias.html#ref-R-foreign" role="doc-biblioref">R Core Team 2022</a>)</span>.</p>
<p>Em alguns casos nos deparamos com dados armazenados de uma forma não estruturada, tal como um texto qualquer. Pode-se importar o conteúdo de um arquivo de texto linha por linha através da função <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code>. Veja o exemplo a seguir, onde importamos o conteúdo inteiro do livro <em>Pride and Prejudice</em>:</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file to read</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu">adfeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">get_data_file</a></span><span class="op">(</span><span class="st">'pride_and_prejudice.txt'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read file line by line</span></span>
<span><span class="va">my_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print 50 characters of first fifteen lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">my_txt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, </span>
<span>              start <span class="op">=</span> <span class="fl">1</span>, </span>
<span>              end <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt;  [1] "The Project Gutenberg EBook of Pride and Prejudice"
R&gt;  [2] ""                                                  
R&gt;  [3] "This eBook is for the use of anyone anywhere at no"
R&gt;  [4] "almost no restrictions whatsoever.  You may copy i"
R&gt;  [5] "re-use it under the terms of the Project Gutenberg"
R&gt;  [6] "with this eBook or online at www.gutenberg.org"    
R&gt;  [7] ""                                                  
R&gt;  [8] ""                                                  
R&gt;  [9] "Title: Pride and Prejudice"                        
R&gt; [10] ""                                                  
R&gt; [11] "Author: Jane Austen"                               
R&gt; [12] ""                                                  
R&gt; [13] "Posting Date: August 26, 2008 [EBook #1342]"       
R&gt; [14] "Release Date: June, 1998"                          
R&gt; [15] "Last Updated: March 10, 2018"</code></pre>
<p>Neste exemplo, arquivo pride_and_prejudice.txt contém todo o conteúdo do livro <em>Pride and Prejudice</em> de Jane Austen, disponível gratuitamente pelo projeto <a href="http://www.gutenberg.org/">Gutenberg</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="http://www.gutenberg.org/" class="uri"&gt;http://www.gutenberg.org/&lt;/a&gt;&lt;/p&gt;'><sup>17</sup></a>. Importamos todo o conteúdo do arquivo como um vetor de texto denominado <code>my_txt</code>. Cada elemento de <code>my_txt</code> é uma linha do arquivo do texto original. Com base nisso, podemos calcular o número de linhas do livro e o número de vezes que o nome <code>'Bennet'</code>, um dos protagonistas, aparece no texto:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># count number of lines</span></span>
<span><span class="va">n_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">my_txt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set target text</span></span>
<span><span class="va">name_to_search</span> <span class="op">&lt;-</span> <span class="st">'Bennet'</span></span>
<span></span>
<span><span class="co"># set function for counting words</span></span>
<span><span class="va">fct_count_bennet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">str_in</span>, <span class="va">target_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">n_words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">str_in</span>, </span>
<span>                                   pattern <span class="op">=</span> <span class="va">target_text</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">n_words</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># use fct for all lines of Pride and Prejudice</span></span>
<span><span class="va">n_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">my_txt</span>, </span>
<span>                      FUN <span class="op">=</span> <span class="va">fct_count_bennet</span>, </span>
<span>                      target_text <span class="op">=</span> <span class="va">name_to_search</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print results</span></span>
<span><span class="va">my_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'The number of lines found in the file is '</span>, </span>
<span>                 <span class="va">n_lines</span>, <span class="st">'.\n'</span>,</span>
<span>                 <span class="st">'The word "'</span>, <span class="va">name_to_search</span>, <span class="st">'" appears '</span>, </span>
<span>                 <span class="va">n_times</span>, <span class="st">' times in the book.'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">my_msg</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; The number of lines found in the file is 13427.
R&gt; The word "Bennet" appears 664 times in the book.</code></pre>
<p>No exemplo, mais uma vez usamos <code>sapply</code>. Neste caso, a função nos permitiu usar outra função para cada elemento de <code>my_txt</code>. Neste caso, procuramos e contamos o número de vezes que a palavra “Bennet” foi encontrada no texto. Observe que poderíamos simplesmente mudar <code>name_to_search</code> por qualquer outro nome, caso quiséssemos.</p>
<div id="exportando-de-dados-não-estruturados" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> Exportando de Dados Não-Estruturados<a class="anchor" aria-label="anchor" href="#exportando-de-dados-n%C3%A3o-estruturados"><i class="fas fa-link"></i></a>
</h3>
<p>Em algumas situações, é necessário exportar algum tipo de texto para um arquivo. Por exemplo: quando se precisa salvar o registro de um procedimento em um arquivo de texto; ou quando se precisa gravar informações em um formato específico não suportado pelo R. Esse procedimento é bastante simples. Junto à função <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::write_lines</a></code>, basta indicar um arquivo de texto para a saída com o argumento <code>file</code>. Veja a seguir:</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set file</span></span>
<span><span class="va">my_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.txt'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set some string</span></span>
<span><span class="va">my_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Today is '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'\n'</span>, </span>
<span>                  <span class="st">'Tomorrow is '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save string to file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">write_lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_text</span>, file <span class="op">=</span> <span class="va">my_f</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>No exemplo, criamos um objeto de texto com uma mensagem sobre a data atual e gravamos a saída no arquivo temporário file8e981e454f63.txt. Podemos checar o resultado com a função <code><a href="https://readr.tidyverse.org/reference/read_lines.html">readr::read_lines</a></code>:</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span><span class="va">my_f</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>R&gt; [1] "Today is 2022-08-10"    "Tomorrow is 2022-08-11"</code></pre>
</div>
</div>
<div id="selecionando-o-formato" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Selecionando o Formato<a class="anchor" aria-label="anchor" href="#selecionando-o-formato"><i class="fas fa-link"></i></a>
</h2>
<p>Após entendermos a forma de salvar e carregar dados de arquivos locais em diferentes formatos, é importante discutirmos sobre a escolha do formato. O usuário deve levar em conta três pontos nessa decisão:</p>
<ul>
<li>velocidade de importação e exportação;</li>
<li>tamanho do arquivo resultante;</li>
<li>compatibilidade com outros programas e sistemas.</li>
</ul>
<p>Na grande maioria das situações, o uso de arquivos <em>csv</em> satisfaz esses quesitos. Ele nada mais é do que um arquivo de texto que pode ser aberto, visualizado e importado em qualquer programa. Desse modo, fica muito fácil compartilhar dados compatíveis com outros usuários. Além disso, o tamanho de arquivos <em>csv</em> geralmente não é exagerado em computadores modernos. Caso necessário, podes compactar o arquivo .csv usando o programa <a href="https://www.7-zip.org/"><em>7zip</em></a>, por exemplo, o qual irá diminuir consideravelmente o tamanho do arquivo. Por esses motivos, <strong>o uso de arquivos <em>csv</em> para importações e exportações é preferível na grande maioria das situações</strong>. </p>
<p>Existem casos, porém, onde a velocidade de importação e exportação pode fazer diferença. Caso abrir mão de portabilidade não faça diferença ao projeto, o formato <em>rds</em> é ótimo e prático. Se este não foi suficiente, então a melhor alternativa é partir para o <em>fst</em>, o qual usa maior parte do <em>hardware</em> do computador para importar os dados. Como sugestão, caso puder, apenas <strong>evite o formato do Excel</strong>, o qual é o menos eficiente de todos.</p>
</div>
<div id="exerc-importacao-exportacao" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Exercícios<a class="anchor" aria-label="anchor" href="#exerc-importacao-exportacao"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><span id="webex-total_correct"></span></p>
<div id="q.1-3" class="section level3 unnumbered">
<h3>Q.1<a class="anchor" aria-label="anchor" href="#q.1-3"><i class="fas fa-link"></i></a>
</h3>
<p>Crie um dataframe com o código a seguir:</p>
<pre class="text"><code><a href="https://dplyr.tidyverse.org">library(dplyr)

my_N &lt;- 10000
my_df &lt;- tibble(x = 1:my_N,
                y = runif(my_N))</a></code></pre>
<p>Exporte o dataframe resultante para cada um dos cinco formatos: csv, rds, xlsx, fst. Qual dos formatos ocupou maior espaço na memória do computador? Dica: <code>file.size</code> calcula o tamanho de arquivos dentro do próprio R.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e9856b8120b" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e9856b8120b" class="collapse">
A solução pode ser encontrada pelo código abaixo. Para rodar, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script apertando Control+Shift+Enter.
<div class="card card-body">
<pre class="text"><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

do_tests &lt;- function(my_N) {
  
  my_df &lt;- tibble(x = 1:my_N,
                  y = runif(my_N))
  
  # csv
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.csv')
  time.csv &lt;- system.time({
    write_csv(my_df, my_f)
  })['elapsed']
  size.csv &lt;- file.size(my_f)/1000000
  
  # rds
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.rds')
  time.rds &lt;- system.time({
    write_rds(my_df, my_f)
  })['elapsed']
  
  size.rds &lt;- file.size(my_f)/1000000
  
  # xlsx
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.xlsx')
  library(writexl) 
  time.xlsx &lt;- system.time({
    write_xlsx(my_df, my_f)
  })['elapsed']
  
  size.xlsx &lt;- file.size(my_f)/1000000
  
  # fst
  library(fst)
  my_f &lt;- tempfile(pattern = 'temp', fileext = '.fst')
  time.fst &lt;- system.time({
    write_fst(my_df, my_f)
  })['elapsed']
  
  size.fst &lt;- file.size(my_f)/1000000
  
  print(c(size.csv, size.rds, size.xlsx, size.fst))
  
  print(c(time.csv, time.rds, time.xlsx, time.fst))
  
  tab &lt;- tibble(Result = c('csv', 'rds', 'xlsx', 'fst'), 
                Size =  c(size.csv, size.rds, size.xlsx, size.fst),
                Time = c(time.csv, time.rds, time.xlsx, time.fst))
  
  return(tab)
}

my_N &lt;- 10000

tab &lt;- do_tests(my_N)
print(tab)

my_msg &lt;- paste0('The format with largest disk space for N = ', my_N, ' is ', 
                 tab$Result[which.max(tab$Size)], '.')
message(my_msg)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.2-3" class="section level3 unnumbered">
<h3>Q.2<a class="anchor" aria-label="anchor" href="#q.2-3"><i class="fas fa-link"></i></a>
</h3>
<p>Melhore o código anterior com a mensuração do tempo de execução necessário para gravar os dados nos diferentes formatos. Qual formato teve a gravação mais rápida? Dica: use função <code>system.time</code> ou pacote <code>tictoc</code> para calcular os tempos de execução.</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e987588682e" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e987588682e" class="collapse">
A solução pode ser encontrada pelo código abaixo. Para rodar, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script apertando Control+Shift+Enter.
<div class="card card-body">
<pre class="text"><code># do notice that this chunk requires the execution of previous solution
my_msg &lt;- paste0('The format with least execution time for N = ', my_N, ' is ', 
                 tab$Result[which.min(tab$Time)], '.')
message(my_msg)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.3-2" class="section level3 unnumbered">
<h3>Q.3<a class="anchor" aria-label="anchor" href="#q.3-2"><i class="fas fa-link"></i></a>
</h3>
<p>Para o código anterior, redefina o valor de <code>my_N</code> para <code>1000000</code>. Esta mudança modifica as respostas das duas últimas perguntas?</p>
<div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e983d8f4ec9" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e983d8f4ec9" class="collapse">
A solução pode ser encontrada pelo código abaixo. Para rodar, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script apertando Control+Shift+Enter.
<div class="card card-body">
<pre class="text"><code># do notice that this chunk requires the execution of previous solution
my_N &lt;- 1000000

tab &lt;- do_tests(my_N)
print(tab)

my_msg &lt;- paste0('The format with largest disk space for N = ', my_N, ' is ', 
                 tab$Result[which.max(tab$Size)], '.')

message(my_msg)

my_msg &lt;- paste0('The format with least execution time for N = ', my_N, ' is ', 
                 tab$Result[which.min(tab$Time)], '.')
message(my_msg)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.4-2" class="section level3 unnumbered">
<h3>Q.4<a class="anchor" aria-label="anchor" href="#q.4-2"><i class="fas fa-link"></i></a>
</h3>
<p>Use função <code><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">adfeR::get_data_file</a></code> para acessar o arquivo <code>SP500.csv</code> no repositório de dados do livro. Importe o conteúdo do arquivo no R com função <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code>. Quantas linhas existem no <code>dataframe</code> resultante?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="4" data-answer='["2264"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e987e101c72" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e987e101c72" class="collapse">
A solução é 2264. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre class="text"><code>my_f &lt;- adfeR::get_data_file('SP500.csv')

df_SP500 &lt;- readr::read_csv(my_f, 
                     col_types = readr::cols())

my_msg &lt;- paste0('There are ', nrow(df_SP500), ' rows and ', 
                 ncol(df_SP500), ' columns in file ', basename(my_f))
message(my_msg)

my_sol &lt;- nrow(df_SP500)</code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.5-2" class="section level3 unnumbered">
<h3>Q.5<a class="anchor" aria-label="anchor" href="#q.5-2"><i class="fas fa-link"></i></a>
</h3>
<p>No link <a href="https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv">https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv</a> você encontrará um arquivo <em>.csv</em> para os dados <em>Grunfeld</em>. Esta é uma tabela particularmente famosa devido ao seu uso como dados de referência em modelos econométricos. Usando função <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv</a></code>, leia este arquivo usando o link direto como entrada em <code>read_csv</code>. Quantas colunas você encontra no <code>dataframe</code> resultante?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="1" data-answer='["5"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e98940fe24" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e98940fe24" class="collapse">
A solução é 5. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre class="text"><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_url &lt;- 'https://eeecon.uibk.ac.at/~zeileis/grunfeld/Grunfeld.csv'

df_grunfeld &lt;- read_csv(my_url, col_types = cols())

my_sol &lt;- ncol(df_grunfeld)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.6-2" class="section level3 unnumbered">
<h3>Q.6<a class="anchor" aria-label="anchor" href="#q.6-2"><i class="fas fa-link"></i></a>
</h3>
<p>Use função <code><a href="https://rdrr.io/pkg/adfeR/man/get_data_file.html">adfeR::get_data_file</a></code> para acessar o arquivo <code>example_tsv.csv</code> no repositório de dados do livro. Note que as colunas dos dados estão separadas pelo símbolo de tabulação (<code>'\t'</code>). Após ler o manual do <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_delim</a></code>, importe as informações deste arquivo para o seu computador. Quantas linhas o arquivo contém?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="4" data-answer='["5570"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e984c076e6f" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e984c076e6f" class="collapse">
A solução é 5570. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre class="text"><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_f &lt;- adfeR::get_data_file('example_tsv.csv')

df_tsv &lt;- read_delim(my_f, delim = '\t', col_types = cols())

my_sol &lt;- nrow(df_tsv)

#check_answers(my_answers)</a></code></pre>
</div>
</div>
<hr>
<p><span id="webex-total_correct"></span></p>
</div>
<div id="q.7-2" class="section level3 unnumbered">
<h3>Q.7<a class="anchor" aria-label="anchor" href="#q.7-2"><i class="fas fa-link"></i></a>
</h3>
<p>No pacote do livro existe um arquivo de dados chamado <code>'funky_csv2.csv'</code>. Este possui um formato particularmente bizarro para os dados. Abra o mesmo em um editor de texto e procure entender como as colunas são separadas e qual o símbolo para o decimal. Após isso, veja as entradas da função <code>read.table</code> e importe a tabela na sessão do R. Caso somarmos o número de linhas com o número de colunas da tabela importada, qual o resultado?</p>
<br><br> Resposta: <input class="webex-solveme nospaces" size="2" data-answer='["19"]'><div style="text-align: left; margin-top: 2px; padding: 13px 0 10px 0;">
<p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_8e982c10c7c3" aria-expanded="false" aria-controls="collapseExample">
Solução
</button>
</p>
</div>
<div id="collapse_8e982c10c7c3" class="collapse">
A solução é 19. Para chegar no resultado anterior, deves executar o código abaixo. Para isso, abra um novo script no RStudio (Control+shift+N), copie e cole o código, e rode o script inteiro apertando Control+Shift+Enter ou por linha com Control+Enter.
<div class="card card-body">
<pre class="text"><code><a href="https://tidyverse.tidyverse.org">library(tidyverse)

my_f &lt;- adfeR::get_data_file('funky_csv2.csv')

df_funky &lt;- read.table(file = my_f, 
           dec = '?', 
           skip = 7, 
           sep = '|', 
           header = TRUE)

my_sol &lt;- nrow(df_funky) + ncol(df_funky)</a></code></pre>
</div>
</div>

</div>
</div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://padfer.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  <div class="chapter-nav">
<div class="prev"><a href="scripts-pesquisa.html"><span class="header-section-number">3</span> Desenvolvendo Rotinas de Pesquisa</a></div>
<div class="next"><a href="importacao-pacotes.html"><span class="header-section-number">5</span> Importação de Dados via Pacotes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#importacao-exportacao"><span class="header-section-number">4</span> Importação e Exportação de Dados Locais</a></li>
<li><a class="nav-link" href="#pacote-adfer"><span class="header-section-number">4.1</span> Pacote adfeR</a></li>
<li>
<a class="nav-link" href="#arquivos-csv"><span class="header-section-number">4.2</span> Arquivos csv</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados"><span class="header-section-number">4.2.1</span> Importação de Dados</a></li>
<li><a class="nav-link" href="#exporta%C3%A7%C3%A3o-de-dados"><span class="header-section-number">4.2.2</span> Exportação de Dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#arquivos-excel-xls-e-xlsx"><span class="header-section-number">4.3</span> Arquivos Excel (xls e xlsx)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados-1"><span class="header-section-number">4.3.1</span> Importação de Dados</a></li>
<li><a class="nav-link" href="#exporta%C3%A7%C3%A3o-de-dados-1"><span class="header-section-number">4.3.2</span> Exportação de Dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#formato-.rdata-e-.rds"><span class="header-section-number">4.4</span> Formato .RData e .rds</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados-2"><span class="header-section-number">4.4.1</span> Importação de Dados</a></li>
<li><a class="nav-link" href="#exporta%C3%A7%C3%A3o-de-dados-2"><span class="header-section-number">4.4.2</span> Exportação de Dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#arquivos-fst-pacote-fst"><span class="header-section-number">4.5</span> Arquivos fst (pacote fst)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados-3"><span class="header-section-number">4.5.1</span> Importação de Dados</a></li>
<li><a class="nav-link" href="#exporta%C3%A7%C3%A3o-de-dados-3"><span class="header-section-number">4.5.2</span> Exportação de Dados</a></li>
<li><a class="nav-link" href="#testando-o-tempo-de-execu%C3%A7%C3%A3o-do-formato-fst"><span class="header-section-number">4.5.3</span> Testando o Tempo de Execução do Formato fst</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#arquivos-sqlite"><span class="header-section-number">4.6</span> Arquivos SQLite</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importa%C3%A7%C3%A3o-de-dados-4"><span class="header-section-number">4.6.1</span> Importação de Dados</a></li>
<li><a class="nav-link" href="#exporta%C3%A7%C3%A3o-de-dados-4"><span class="header-section-number">4.6.2</span> Exportação de Dados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dados-n%C3%A3o-estruturados-e-outros-formatos"><span class="header-section-number">4.7</span> Dados Não-Estruturados e Outros Formatos</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#exportando-de-dados-n%C3%A3o-estruturados"><span class="header-section-number">4.7.1</span> Exportando de Dados Não-Estruturados</a></li></ul>
</li>
<li><a class="nav-link" href="#selecionando-o-formato"><span class="header-section-number">4.8</span> Selecionando o Formato</a></li>
<li>
<a class="nav-link" href="#exerc-importacao-exportacao"><span class="header-section-number">4.9</span> Exercícios</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#q.1-3">Q.1</a></li>
<li><a class="nav-link" href="#q.2-3">Q.2</a></li>
<li><a class="nav-link" href="#q.3-2">Q.3</a></li>
<li><a class="nav-link" href="#q.4-2">Q.4</a></li>
<li><a class="nav-link" href="#q.5-2">Q.5</a></li>
<li><a class="nav-link" href="#q.6-2">Q.6</a></li>
<li><a class="nav-link" href="#q.7-2">Q.7</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Análise de Dados Financeiros e Econômicos com o R - Versão Online</strong>" was written by Marcelo S. Perlin (<a href="mailto:marcelo.perlin@ufrgs.br" class="email">marcelo.perlin@ufrgs.br</a>). It was last built on 2022-08-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
